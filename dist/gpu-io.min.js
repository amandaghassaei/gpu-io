!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.GPUIO=t():e.GPUIO=t()}(self,(()=>(()=>{var e={847:(e,t,r)=>{"use strict";r.r(t),r.d(t,{Float16Array:()=>We,getFloat16:()=>je,hfround:()=>p,setFloat16:()=>Ye});const n=new ArrayBuffer(4),o=new Float32Array(n),i=new Uint32Array(n),a=new Uint32Array(512),s=new Uint32Array(512);for(let e=0;e<256;++e){const t=e-127;t<-27?(a[0|e]=0,a[256|e]=32768,s[0|e]=24,s[256|e]=24):t<-14?(a[0|e]=1024>>-t-14,a[256|e]=1024>>-t-14|32768,s[0|e]=-t-1,s[256|e]=-t-1):t<=15?(a[0|e]=t+15<<10,a[256|e]=t+15<<10|32768,s[0|e]=13,s[256|e]=13):t<128?(a[0|e]=31744,a[256|e]=64512,s[0|e]=24,s[256|e]=24):(a[0|e]=31744,a[256|e]=64512,s[0|e]=13,s[256|e]=13)}function c(e){o[0]=e;const t=i[0],r=t>>23&511;return a[r]+((8388607&t)>>s[r])}const u=new Uint32Array(2048),l=new Uint32Array(64),f=new Uint32Array(64);u[0]=0;for(let e=1;e<1024;++e){let t=e<<13,r=0;for(;0==(8388608&t);)r-=8388608,t<<=1;t&=-8388609,r+=947912704,u[e]=t|r}for(let e=1024;e<2048;++e)u[e]=939524096+(e-1024<<13);l[0]=0;for(let e=1;e<31;++e)l[e]=e<<23;l[31]=1199570944,l[32]=2147483648;for(let e=33;e<63;++e)l[e]=2147483648+(e-32<<23);l[63]=3347054592,f[0]=0;for(let e=1;e<64;++e)f[e]=32===e?0:1024;function _(e){const t=e>>10;return i[0]=u[f[t]+(1023&e)]+l[t],o[0]}function p(e){if(e=Number(e),!Number.isFinite(e)||0===e)return e;return _(c(e))}const h="object"==typeof global&&global&&global.Object===Object&&global;var d="object"==typeof self&&self&&self.Object===Object&&self;const g=h||d||Function("return this")();const m=g.Symbol;var v=Object.prototype,T=v.hasOwnProperty,E=v.toString,A=m?m.toStringTag:void 0;const I=function(e){var t=T.call(e,A),r=e[A];try{e[A]=void 0;var n=!0}catch(e){}var o=E.call(e);return n&&(t?e[A]=r:delete e[A]),o};var y=Object.prototype.toString;const R=function(e){return y.call(e)};var U=m?m.toStringTag:void 0;const O=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":U&&U in Object(e)?I(e):R(e)};const L=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};const P=function(e){if(!L(e))return!1;var t=O(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t};const F=g["__core-js_shared__"];var b,N=(b=/[^.]+$/.exec(F&&F.keys&&F.keys.IE_PROTO||""))?"Symbol(src)_1."+b:"";const w=function(e){return!!N&&N in e};var S=Function.prototype.toString;const G=function(e){if(null!=e){try{return S.call(e)}catch(e){}try{return e+""}catch(e){}}return""};var x=/^\[object .+?Constructor\]$/,M=Function.prototype,D=Object.prototype,B=M.toString,C=D.hasOwnProperty,V=RegExp("^"+B.call(C).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const k=function(e){return!(!L(e)||w(e))&&(P(e)?V:x).test(G(e))};const W=function(e,t){return null==e?void 0:e[t]};const H=function(e,t){var r=W(e,t);return k(r)?r:void 0};const X=H(Object,"create");const j=function(){this.__data__=X?X(null):{},this.size=0};const Y=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t};var z=Object.prototype.hasOwnProperty;const J=function(e){var t=this.__data__;if(X){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return z.call(t,e)?t[e]:void 0};var q=Object.prototype.hasOwnProperty;const K=function(e){var t=this.__data__;return X?void 0!==t[e]:q.call(t,e)};const $=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=X&&void 0===t?"__lodash_hash_undefined__":t,this};function Q(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Q.prototype.clear=j,Q.prototype.delete=Y,Q.prototype.get=J,Q.prototype.has=K,Q.prototype.set=$;const Z=Q;const ee=function(){this.__data__=[],this.size=0};const te=function(e,t){return e===t||e!=e&&t!=t};const re=function(e,t){for(var r=e.length;r--;)if(te(e[r][0],t))return r;return-1};var ne=Array.prototype.splice;const oe=function(e){var t=this.__data__,r=re(t,e);return!(r<0)&&(r==t.length-1?t.pop():ne.call(t,r,1),--this.size,!0)};const ie=function(e){var t=this.__data__,r=re(t,e);return r<0?void 0:t[r][1]};const ae=function(e){return re(this.__data__,e)>-1};const se=function(e,t){var r=this.__data__,n=re(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};function ce(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}ce.prototype.clear=ee,ce.prototype.delete=oe,ce.prototype.get=ie,ce.prototype.has=ae,ce.prototype.set=se;const ue=ce;const le=H(g,"Map");const fe=function(){this.size=0,this.__data__={hash:new Z,map:new(le||ue),string:new Z}};const _e=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};const pe=function(e,t){var r=e.__data__;return _e(t)?r["string"==typeof t?"string":"hash"]:r.map};const he=function(e){var t=pe(this,e).delete(e);return this.size-=t?1:0,t};const de=function(e){return pe(this,e).get(e)};const ge=function(e){return pe(this,e).has(e)};const me=function(e,t){var r=pe(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};function ve(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}ve.prototype.clear=fe,ve.prototype.delete=he,ve.prototype.get=de,ve.prototype.has=ge,ve.prototype.set=me;const Te=ve;function Ee(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var r=function(){var n=arguments,o=t?t.apply(this,n):n[0],i=r.cache;if(i.has(o))return i.get(o);var a=e.apply(this,n);return r.cache=i.set(o,a)||i,a};return r.cache=new(Ee.Cache||Te),r}Ee.Cache=Te;const Ae=Ee,Ie=Object.getOwnPropertyDescriptor(new Uint8Array(1),0).writable;function ye(e){let t="number"!=typeof e?Number(e):e;return Number.isNaN(t)&&(t=0),Math.trunc(t)}function Re(e,t){const[r,n]=[Number.isNaN(e),Number.isNaN(t)];if(r&&n)return 0;if(r)return 1;if(n)return-1;if(e<t)return-1;if(e>t)return 1;if(0===e&&0===t){const[r,n]=[Object.is(e,0),Object.is(t,0)];if(!r&&n)return-1;if(r&&!n)return 1}return 0}function Ue(e){return e instanceof DataView}function Oe(e){return"string"==typeof e&&e===ye(e)+""}const Le=function(e){return null!=e&&"object"==typeof e};const Pe=function(e){return Le(e)&&"[object ArrayBuffer]"==O(e)};const Fe=function(e){return function(t){return e(t)}};var be="object"==typeof exports&&exports&&!exports.nodeType&&exports,Ne=be&&"object"==typeof module&&module&&!module.nodeType&&module,we=Ne&&Ne.exports===be&&h.process,Se=function(){try{var e=Ne&&Ne.require&&Ne.require("util").types;return e||we&&we.binding&&we.binding("util")}catch(e){}}();var Ge=Se&&Se.isArrayBuffer;const xe=Ge?Fe(Ge):Pe;const Me=function(){const e=new WeakMap;return t=>{let r=e.get(t);return r||(r=Object.create(null),e.set(t,r),r)}}();function De(e){return e instanceof We}function Be(e){if(!De(e))throw new TypeError("This is not a Float16Array")}function Ce(e){const t=e.length,r=new Array(t);for(let n=0;n<t;++n)r[n]=_(e[n]);return r}const Ve={apply(e,t,r){return De(t)&&("function"==typeof(n=e)&&Xe.has(n))?Reflect.apply(e,Me(t).target,r):Reflect.apply(e,t,r);var n}},ke={get(e,t){let r=null;if(Ie||(r=e,e=Me(r).target),Oe(t))return Reflect.has(e,t)?_(Reflect.get(e,t)):void 0;{const n=null!==r&&Reflect.has(r,t)?Reflect.get(r,t):Reflect.get(e,t);if("function"!=typeof n)return n;let o=Me(n).proxy;return void 0===o&&(o=Me(n).proxy=new Proxy(n,Ve)),o}},set(e,t,r){let n=null;return Ie||(n=e,e=Me(n).target),Oe(t)?Reflect.set(e,t,c(r)):null===n||Reflect.has(e,t)&&!Object.isFrozen(n)?Reflect.set(e,t,r):Reflect.set(n,t,r)}};Ie||(ke.getPrototypeOf=e=>Reflect.getPrototypeOf(Me(e).target),ke.setPrototypeOf=(e,t)=>Reflect.setPrototypeOf(Me(e).target,t),ke.defineProperty=(e,t,r)=>{const n=Me(e).target;return!Reflect.has(n,t)||Object.isFrozen(e)?Reflect.defineProperty(e,t,r):Reflect.defineProperty(n,t,r)},ke.deleteProperty=(e,t)=>{const r=Me(e).target;return Reflect.has(e,t)?Reflect.deleteProperty(e,t):Reflect.deleteProperty(r,t)},ke.has=(e,t)=>Reflect.has(e,t)||Reflect.has(Me(e).target,t),ke.isExtensible=e=>Reflect.isExtensible(e),ke.preventExtensions=e=>Reflect.preventExtensions(e),ke.getOwnPropertyDescriptor=(e,t)=>Reflect.getOwnPropertyDescriptor(e,t),ke.ownKeys=e=>Reflect.ownKeys(e));class We extends Uint16Array{constructor(e,t,r){if(De(e))super(Me(e).target);else if(null===e||"object"!=typeof e||xe(e))switch(arguments.length){case 0:super();break;case 1:super(e);break;case 2:super(e,t);break;case 3:super(e,t,r);break;default:super(...arguments)}else{const t=Reflect.has(e,"length")||void 0===e[Symbol.iterator]?e:[...e],r=t.length;super(r);for(let e=0;e<r;++e)this[e]=c(t[e])}let n;if(Ie)n=new Proxy(this,ke);else{const e=Object.create(null);Me(e).target=this,n=new Proxy(e,ke)}return Me(n).target=this,Me(this).proxy=n,n}static from(e,...t){if(0===t.length)return new We(Uint16Array.from(e,c).buffer);const r=t[0],n=t[1];return new We(Uint16Array.from(e,(function(e,...t){return c(r.call(this,e,...t))}),n).buffer)}static of(...e){return new We(e)}*[Symbol.iterator](){for(const e of super[Symbol.iterator]())yield _(e)}keys(){return super.keys()}*values(){for(const e of super.values())yield _(e)}*entries(){for(const[e,t]of super.entries())yield[e,_(t)]}map(e,...t){Be(this);const r=t[0],n=[];for(let t=0,o=this.length;t<o;++t){const o=_(this[t]);n.push(e.call(r,o,t,Me(this).proxy))}return new We(n)}filter(e,...t){Be(this);const r=t[0],n=[];for(let t=0,o=this.length;t<o;++t){const o=_(this[t]);e.call(r,o,t,Me(this).proxy)&&n.push(o)}return new We(n)}reduce(e,...t){let r,n;Be(this),0===t.length?(r=_(this[0]),n=1):(r=t[0],n=0);for(let t=n,o=this.length;t<o;++t)r=e(r,_(this[t]),t,Me(this).proxy);return r}reduceRight(e,...t){let r,n;Be(this);const o=this.length;0===t.length?(r=_(this[o-1]),n=o-1):(r=t[0],n=o);for(let t=n;t--;)r=e(r,_(this[t]),t,Me(this).proxy);return r}forEach(e,...t){Be(this);const r=t[0];for(let t=0,n=this.length;t<n;++t)e.call(r,_(this[t]),t,Me(this).proxy)}find(e,...t){Be(this);const r=t[0];for(let t=0,n=this.length;t<n;++t){const n=_(this[t]);if(e.call(r,n,t,Me(this).proxy))return n}}findIndex(e,...t){Be(this);const r=t[0];for(let t=0,n=this.length;t<n;++t){const n=_(this[t]);if(e.call(r,n,t,Me(this).proxy))return t}return-1}every(e,...t){Be(this);const r=t[0];for(let t=0,n=this.length;t<n;++t)if(!e.call(r,_(this[t]),t,Me(this).proxy))return!1;return!0}some(e,...t){Be(this);const r=t[0];for(let t=0,n=this.length;t<n;++t)if(e.call(r,_(this[t]),t,Me(this).proxy))return!0;return!1}set(e,...t){Be(this);const r=t[0];let n;if(De(e))n=Me(e).target;else{const t=Reflect.has(e,"length")||void 0===e[Symbol.iterator]?e:[...e],r=t.length;n=new Uint16Array(r);for(let e=0,r=t.length;e<r;++e)n[e]=c(t[e])}super.set(n,r)}reverse(){return Be(this),super.reverse(),Me(this).proxy}fill(e,...t){return Be(this),super.fill(c(e),...t),Me(this).proxy}copyWithin(e,t,...r){return Be(this),super.copyWithin(e,t,...r),Me(this).proxy}sort(...e){Be(this);let t=e[0];void 0===t&&(t=Re);const r=Ae(_);return super.sort(((e,n)=>t(r(e),r(n)))),Me(this).proxy}slice(...e){let t;Be(this);try{t=super.slice(...e)}catch(r){if(!(r instanceof TypeError))throw r;t=new Uint16Array(this.buffer,this.byteOffset,this.length).slice(...e)}return new We(t.buffer)}subarray(...e){let t;Be(this);try{t=super.subarray(...e)}catch(r){if(!(r instanceof TypeError))throw r;t=new Uint16Array(this.buffer,this.byteOffset,this.length).subarray(...e)}return new We(t.buffer,t.byteOffset,t.length)}indexOf(e,...t){Be(this);const r=this.length;let n=ye(t[0]);n<0&&(n+=r,n<0&&(n=0));for(let t=n,o=r;t<o;++t)if(_(this[t])===e)return t;return-1}lastIndexOf(e,...t){Be(this);const r=this.length;let n=ye(t[0]);n=0===n?r:n+1,n>=0?n=n<r?n:r:n+=r;for(let t=n;t--;)if(_(this[t])===e)return t;return-1}includes(e,...t){Be(this);const r=this.length;let n=ye(t[0]);n<0&&(n+=r,n<0&&(n=0));const o=Number.isNaN(e);for(let t=n,i=r;t<i;++t){const r=_(this[t]);if(o&&Number.isNaN(r))return!0;if(r===e)return!0}return!1}join(...e){Be(this);return Ce(this).join(...e)}toLocaleString(...e){Be(this);return Ce(this).toLocaleString(...e)}get[Symbol.toStringTag](){if(De(this))return"Float16Array"}}const He=We.prototype,Xe=new WeakSet;for(const e of Reflect.ownKeys(He)){const t=He[e];"function"==typeof t&&Xe.add(t)}function je(e,t,...r){if(!Ue(e))throw new TypeError("First argument to getFloat16 function must be a DataView");return _(e.getUint16(t,...r))}function Ye(e,t,r,...n){if(!Ue(e))throw new TypeError("First argument to setFloat16 function must be a DataView");e.setUint16(t,c(r),...n)}},809:(e,t)=>{"use strict";function r(e){var t=-1;n||(n=function(){for(var e=new Int32Array(256),t=0;t<256;t++){for(var r=t,n=0;n<8;n++)r=1&r?3988292384^r>>>1:r>>>1;e[t]=r}return e}());for(var r=0;r<e.length;r++)t=n[255&(t^e[r])]^t>>>8;return-1^t}Object.defineProperty(t,"__esModule",{value:!0}),t.changeDpiBlob=function(e,t){var r=e.slice(0,33);return new Promise((function(n,o){var i=new FileReader;i.onload=function(){var r=new Uint8Array(i.result),o=e.slice(33),a=p(r,t,e.type);n(new Blob([a,o],{type:e.type}))},i.readAsArrayBuffer(r)}))},t.changeDpiDataUrl=function(e,t){var r=e.split(","),n=r[0],u=r[1],l=void 0,f=void 0,_=!1;if(-1!==n.indexOf(o)){l=o;var h=function(e){var t=e.indexOf(a);-1===t&&(t=e.indexOf(s));-1===t&&(t=e.indexOf(c));return t}(u);h>=0?(f=4*Math.ceil((h+28)/3),_=!0):f=44}-1!==n.indexOf(i)&&(l=i,f=24);for(var d=u.substring(0,f),g=u.substring(f),m=atob(d),v=new Uint8Array(m.length),T=0;T<v.length;T++)v[T]=m.charCodeAt(T);var E=p(v,t,l,_),A=btoa(String.fromCharCode.apply(String,function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(E)));return[n,",",A,g].join("")};var n=void 0,o="image/png",i="image/jpeg",a="AAlwSFlz",s="AAAJcEhZ",c="AAAACXBI",u="p".charCodeAt(0),l="H".charCodeAt(0),f="Y".charCodeAt(0),_="s".charCodeAt(0);function p(e,t,n,a){if(n===i)return e[13]=1,e[14]=t>>8,e[15]=255&t,e[16]=t>>8,e[17]=255&t,e;if(n===o){var s=new Uint8Array(13);t*=39.3701,s[0]=u,s[1]=l,s[2]=f,s[3]=_,s[4]=t>>>24,s[5]=t>>>16,s[6]=t>>>8,s[7]=255&t,s[8]=s[4],s[9]=s[5],s[10]=s[6],s[11]=s[7],s[12]=1;var c=r(s),p=new Uint8Array(4);if(p[0]=c>>>24,p[1]=c>>>16,p[2]=c>>>8,p[3]=255&c,a){var h=function(e){for(var t=e.length-1;t>=4;t--)if(9===e[t-4]&&e[t-3]===u&&e[t-2]===l&&e[t-1]===f&&e[t]===_)return t-3}(e);return e.set(s,h),e.set(p,h+13),e}var d=new Uint8Array(4);d[0]=0,d[1]=0,d[2]=0,d[3]=9;var g=new Uint8Array(54);return g.set(e,0),g.set(d,33),g.set(s,37),g.set(p,50),g}}},162:function(e,t,r){var n,o,i;o=[],n=function(){"use strict";function t(e,t){return void 0===t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}function n(e,t,r){var n=new XMLHttpRequest;n.open("GET",e),n.responseType="blob",n.onload=function(){c(n.response,t,r)},n.onerror=function(){console.error("could not download file")},n.send()}function o(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function i(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(r){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var a="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof r.g&&r.g.global===r.g?r.g:void 0,s=a.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),c=a.saveAs||("object"!=typeof window||window!==a?function(){}:"download"in HTMLAnchorElement.prototype&&!s?function(e,t,r){var s=a.URL||a.webkitURL,c=document.createElement("a");t=t||e.name||"download",c.download=t,c.rel="noopener","string"==typeof e?(c.href=e,c.origin===location.origin?i(c):o(c.href)?n(e,t,r):i(c,c.target="_blank")):(c.href=s.createObjectURL(e),setTimeout((function(){s.revokeObjectURL(c.href)}),4e4),setTimeout((function(){i(c)}),0))}:"msSaveOrOpenBlob"in navigator?function(e,r,a){if(r=r||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(t(e,a),r);else if(o(e))n(e,r,a);else{var s=document.createElement("a");s.href=e,s.target="_blank",setTimeout((function(){i(s)}))}}:function(e,t,r,o){if((o=o||open("","_blank"))&&(o.document.title=o.document.body.innerText="downloading..."),"string"==typeof e)return n(e,t,r);var i="application/octet-stream"===e.type,c=/constructor/i.test(a.HTMLElement)||a.safari,u=/CriOS\/[\d]+/.test(navigator.userAgent);if((u||i&&c||s)&&"undefined"!=typeof FileReader){var l=new FileReader;l.onloadend=function(){var e=l.result;e=u?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),o?o.location.href=e:location=e,o=null},l.readAsDataURL(e)}else{var f=a.URL||a.webkitURL,_=f.createObjectURL(e);o?o.location=_:location.href=_,o=null,setTimeout((function(){f.revokeObjectURL(_)}),4e4)}});a.saveAs=c.saveAs=c,e.exports=c},void 0===(i="function"==typeof n?n.apply(t,o):n)||(e.exports=i)},484:function(e,t,r){"use strict";var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},n.apply(this,arguments)},o=this&&this.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var n,o=0,i=t.length;o<i;o++)!n&&o in t||(n||(n=Array.prototype.slice.call(t,0,o)),n[o]=t[o]);return e.concat(n||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.GPUComposer=void 0;var i=r(809),a=r(355),s=r(601),c=r(664),u=r(404),l=r(593),f=r(707),_=r(288),p=function(){function e(e){var t;this._errorThrown=!1,this._circlePositionsBuffer={},this._extensions={},this._copyPrograms={src:r(158)},this._setValuePrograms={src:r(148)},this._vectorMagnitudePrograms={src:r(723)},this._vertexShaders=((t={})[s.DEFAULT_PROGRAM_NAME]={src:_,compiledShaders:{}},t[s.SEGMENT_PROGRAM_NAME]={src:r(974),compiledShaders:{}},t[s.LAYER_POINTS_PROGRAM_NAME]={src:r(767),compiledShaders:{}},t[s.LAYER_VECTOR_FIELD_PROGRAM_NAME]={src:r(760),compiledShaders:{}},t[s.LAYER_LINES_PROGRAM_NAME]={src:r(143),compiledShaders:{}},t),this.verboseLogging=!1,this._numTicks=0;var n=["canvas","context","contextID","contextOptions","glslVersion","verboseLogging","errorCallback"],o=Object.keys(e);o.forEach((function(e){if(n.indexOf(e)<0)throw new Error('Invalid key "'.concat(e,'" passed to new GPUComposer(params).  Valid keys are ').concat(n.join(", "),"."))})),["canvas"].forEach((function(e){if(o.indexOf(e)<0)throw new Error('Required params key "'.concat(e,'" was not passed to new GPUComposer(params).'))})),void 0!==e.verboseLogging&&(this.verboseLogging=e.verboseLogging);var i=this;this._errorCallback=function(t){i._errorThrown||(i._errorThrown=!0,e.errorCallback?e.errorCallback(t):(0,s.DEFAULT_ERROR_CALLBACK)(t))};var a=e.canvas;this.canvas=a;var c=e.context;if(!c){var u;if(e.contextID)(u=a.getContext(e.contextID,e.contextOptions))?c=u:console.warn("Unable to initialize WebGL context with contextID: ".concat(e.contextID,"."));if(!c)(u=a.getContext(s.WEBGL2,e.contextOptions)||a.getContext(s.WEBGL1,e.contextOptions)||a.getContext(s.EXPERIMENTAL_WEBGL,e.contextOptions))&&(c=u);if(!c)return void this._errorCallback("Unable to initialize WebGL context.")}(0,l.isWebGL2)(c)?this.verboseLogging&&console.log("Using WebGL 2.0 context."):this.verboseLogging&&console.log("Using WebGL 1.0 context."),this.gl=c;var f=e.glslVersion||((0,l.isWebGL2)(c)?s.GLSL3:s.GLSL1);(0,l.isWebGL2)(c)||f!==s.GLSL3||(console.warn("GLSL3.x is incompatible with WebGL1.0 contexts, falling back to GLSL1."),f=s.GLSL1),this.glslVersion=f,this.intPrecision=e.intPrecision||s.PRECISION_HIGH_P,this.floatPrecision=e.floatPrecision||s.PRECISION_HIGH_P,c.disable(c.DEPTH_TEST),c.pixelStorei(c.UNPACK_ALIGNMENT,1),c.bindBuffer(c.ARRAY_BUFFER,null),this.resize(a.clientWidth,a.clientHeight),this._maxNumTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.verboseLogging&&console.log("".concat(this._maxNumTextures," textures max."))}return e.initWithThreeRenderer=function(t,r){var o=new e(n(n({floatPrecision:t.capabilities.precision||s.PRECISION_HIGH_P,intPrecision:t.capabilities.precision||s.PRECISION_HIGH_P},r),{canvas:t.domElement,context:t.getContext(),glslVersion:t.capabilities.isWebGL2?s.GLSL3:s.GLSL1}));return o.renderer=t,o},e.prototype.isWebGL2=function(){return(0,l.isWebGL2)(this.gl)},e.prototype._glslKeyForType=function(e){switch(e){case s.HALF_FLOAT:case s.FLOAT:return s.FLOAT;case s.UNSIGNED_BYTE:case s.UNSIGNED_SHORT:case s.UNSIGNED_INT:return this.glslVersion===s.GLSL1?s.INT:s.UINT;case s.BYTE:case s.SHORT:case s.INT:return s.INT;default:throw new Error("Invalid type: ".concat(e," passed to GPUComposer.copyProgramForType."))}},e.prototype._setValueProgramForType=function(e){var t,r=this._setValuePrograms,n=this._glslKeyForType(e);if(void 0===r[n]){var o=new c.GPUProgram(this,{name:"setValue-".concat(n),fragmentShader:r.src,uniforms:[{name:"u_value",value:[0,0,0,0],type:n}],defines:(t={},t["GPUIO_".concat(n)]="1",t)});r[n]=o}return r[n]},e.prototype._copyProgramForType=function(e){var t,r=this._copyPrograms,n=this._glslKeyForType(e);if(void 0===r[n]){var o=new c.GPUProgram(this,{name:"copy-".concat(n),fragmentShader:r.src,uniforms:[{name:"u_state",value:0,type:s.INT}],defines:(t={},t["GPUIO_".concat(n)]="1",t)});r[n]=o}return r[n]},e.prototype._getWrappedLineColorProgram=function(){if(void 0===this._wrappedLineColorProgram){var e=new c.GPUProgram(this,{name:"wrappedLineColor",fragmentShader:r(598)});this._wrappedLineColorProgram=e}return this._wrappedLineColorProgram},e.prototype._vectorMagnitudeProgramForType=function(e){var t,r=this._vectorMagnitudePrograms,n=this._glslKeyForType(e);if(void 0===r[n]){var o=new c.GPUProgram(this,{name:"vectorMagnitude-".concat(n),fragmentShader:r.src,defines:(t={},t["GPUIO_".concat(n)]="1",t)});r[n]=o}return r[n]},e.prototype._getQuadPositionsBuffer=function(){if(void 0===this._quadPositionsBuffer){var e=new Float32Array([-1,-1,1,-1,-1,1,1,1]);this._quadPositionsBuffer=this._initVertexBuffer(e)}return this._quadPositionsBuffer},e.prototype._getBoundaryPositionsBuffer=function(){if(void 0===this._boundaryPositionsBuffer){var e=new Float32Array([-1,-1,1,-1,1,1,-1,1,-1,-1]);this._boundaryPositionsBuffer=this._initVertexBuffer(e)}return this._boundaryPositionsBuffer},e.prototype._getCirclePositionsBuffer=function(e){var t=this._circlePositionsBuffer;if(null==t[e]){for(var r=[0,0],n=0;n<=e;n++)r.push(Math.cos(2*Math.PI*n/e),Math.sin(2*Math.PI*n/e));var o=new Float32Array(r),i=this._initVertexBuffer(o);t[e]=i}return t[e]},e.prototype._initVertexBuffer=function(e){var t=this._errorCallback,r=this.gl,n=r.createBuffer();if(n)return r.bindBuffer(r.ARRAY_BUFFER,n),r.bufferData(r.ARRAY_BUFFER,e,r.STATIC_DRAW),n;t("Unable to allocate gl buffer.")},e.prototype._cloneGPULayer=function(e,t){var r=0;try{r=e.length}catch(t){r=[e.width,e.height]}var n=e.writable?void 0:e.getValues(),o=new a.GPULayer(this,{name:t||"".concat(e.name,"-clone"),dimensions:r,type:e.type,numComponents:e.numComponents,filter:e.filter,wrapS:e.wrapS,wrapT:e.wrapT,writable:e.writable,numBuffers:e.numBuffers,clearValue:e.clearValue,array:n});if(e.writable){for(var i=0;i<e.numBuffers-1;i++)this.step({program:this._copyProgramForType(e.type),input:e.getStateAtIndex((e.bufferIndex+i+1)%e.numBuffers),output:o});this.step({program:this._copyProgramForType(e.type),input:e.currentState,output:o})}return o},e.prototype.initTexture=function(e){var t=["name","url","filter","wrapS","wrapT","format","type","onLoad"];Object.keys(e).forEach((function(r){if(t.indexOf(r)<0)throw new Error('Invalid key "'.concat(r,'" passed to GPUComposer.initTexture with name "').concat(e.name,'".  Valid keys are ').concat(t.join(", "),"."))}));var r=e.url,n=e.name;if(!(0,f.isString)(r))throw new Error("Expected GPUComposer.initTexture params to have url of type string, got ".concat(r," of type ").concat(typeof r,"."));if(!(0,f.isString)(n))throw new Error("Expected GPUComposer.initTexture params to have name of type string, got ".concat(n," of type ").concat(typeof n,"."));var o=void 0!==e.filter?e.filter:s.NEAREST;if(!(0,f.isValidFilter)(o))throw new Error("Invalid filter: ".concat(o,' for GPULayer "').concat(n,'", must be ').concat(s.validFilters.join(", "),"."));var i=void 0!==e.wrapS?e.wrapS:s.CLAMP_TO_EDGE;if(!(0,f.isValidWrap)(i))throw new Error("Invalid wrapS: ".concat(i,' for GPULayer "').concat(n,'", must be ').concat(s.validWraps.join(", "),"."));var a=void 0!==e.wrapT?e.wrapT:s.CLAMP_TO_EDGE;if(!(0,f.isValidWrap)(a))throw new Error("Invalid wrapT: ".concat(a,' for GPULayer "').concat(n,'", must be ').concat(s.validWraps.join(", "),"."));var c=void 0!==e.format?e.format:s.RGBA;if(!(0,f.isValidTextureFormat)(c))throw new Error("Invalid format: ".concat(c,' for GPULayer "').concat(n,'", must be ').concat(s.validTextureFormats.join(", "),"."));var u=void 0!==e.type?e.type:s.UNSIGNED_BYTE;if(!(0,f.isValidTextureType)(u))throw new Error("Invalid type: ".concat(u,' for GPULayer "').concat(n,'", must be ').concat(s.validTextureTypes.join(", "),"."));var _=this.gl,p=this._errorCallback,h=_.createTexture();if(null===h)throw new Error("Unable to init glTexture.");_.bindTexture(_.TEXTURE_2D,h);var d=_.RGBA,g=_[c],m=_[u],v=new Uint8Array([0,0,0,0]);_.texImage2D(_.TEXTURE_2D,0,d,1,1,0,g,m,v);var T=new Image;return T.onload=function(){_.bindTexture(_.TEXTURE_2D,h),_.texImage2D(_.TEXTURE_2D,0,d,g,m,T),(0,l.isPowerOf2)(T.width)&&(0,l.isPowerOf2)(T.height)||console.warn("Texture ".concat(n," dimensions [").concat(T.width,", ").concat(T.height,"] are not power of 2.")),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,_[i]),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,_[a]),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,_[o]),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,_[o]),e.onLoad&&e.onLoad(h)},T.onerror=function(e){p("Error loading image ".concat(n,": ").concat(e))},T.src=r,h},e.prototype._getVertexShader=function(e,t,r,n){var o=this,i=o._errorCallback,a=o._vertexShaders,s=o.gl,c=o.glslVersion,u=o.intPrecision,f=o.floatPrecision,_=a[e],p=_.compiledShaders,h=_.src;if(""===t&&(t="_default"),void 0===p[t]){if(""===h)throw new Error('Error compiling GPUProgram "'.concat(n,'": no source for vertex shader with name "').concat(e,'".'));var d=(0,l.preprocessVertexShader)(h,c),g=(0,l.compileShader)(s,c,u,f,d,s.VERTEX_SHADER,n,i,r,!0);if(!g)return void i('Unable to compile "'.concat(e).concat(t,'" vertex shader for GPUProgram "').concat(n,'".'));p[t]=g}return p[t]},e.prototype.resize=function(e,t){var r=this.canvas;r.width=e,r.height=t,this._width=e,this._height=t},e.prototype._drawSetup=function(e,t,r,n,o,i){var s=this.gl,c=[];if(o)if(o.layer)c.push(o);else if(o.constructor===a.GPULayer)c.push(o.currentState);else for(var u=0;u<o.length;u++){var l=o[u];c.push(l.currentState?l.currentState:l)}var f=e._getProgramWithName(t,r,c);this._setOutputLayer(n,o,i),s.useProgram(f);for(u=0;u<c.length;u++)s.activeTexture(s.TEXTURE0+u),s.bindTexture(s.TEXTURE_2D,c[u].texture);return e._setInternalFragmentUniforms(f,c),f},e.prototype._setBlendMode=function(e){var t=this.gl;e&&(t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA))},e.prototype._indexOfLayerInArray=function(e,t){return t.findIndex((function(t){return t===e||t.layer===e}))},e.prototype._addLayerToInputs=function(e,t){return void 0===t?[e]:(0,f.isArray)(t)?this._indexOfLayerInArray(e,t)>=0?t:o(o([],t,!0),[e],!1):t===e||t.layer===e?[t]:[t,e]},e.prototype._passThroughLayerDataFromInputToOutput=function(e){var t=this._copyProgramForType(e._internalType);this.step({program:t,input:e,output:e})},e.prototype._setOutputLayer=function(e,t,r){var n=this.gl;if(r){if(t&&(t===r||t.layer===r||(0,f.isArray)(t)&&this._indexOfLayerInArray(r,t)>=0)){if(1===r.numBuffers)throw new Error("Cannot use same buffer for input and output of a program. Try increasing the number of buffers in your output layer to at least 2 so you can render to nextState using currentState as an input.");e?r._prepareForWrite(!0):(this._passThroughLayerDataFromInputToOutput(r),r._prepareForWrite(!1))}else e||r._usingTextureOverrideForCurrentBuffer()&&this._passThroughLayerDataFromInputToOutput(r),r._prepareForWrite(!1);var o=r.width,i=r.height;n.viewport(0,0,o,i)}else{n.bindFramebuffer(n.FRAMEBUFFER,null);var a=this._width,s=this._height;n.viewport(0,0,a,s)}},e.prototype._setVertexAttribute=function(e,t,r,n){var o=this.gl,i=o.getAttribLocation(e,t);if(i<0)throw new Error('Unable to find vertex attribute "'.concat(t,'" in program "').concat(n,'".'));o.vertexAttribPointer(i,r,o.FLOAT,!1,0,0),o.enableVertexAttribArray(i)},e.prototype._setPositionAttribute=function(e,t){this._setVertexAttribute(e,"a_gpuio_position",2,t)},e.prototype._setIndexAttribute=function(e,t){this._setVertexAttribute(e,"a_gpuio_index",1,t)},e.prototype._setUVAttribute=function(e,t){this._setVertexAttribute(e,"a_gpuio_uv",2,t)},e.prototype.step=function(e){var t=this.gl,r=e.program,n=e.input,o=e.output,i=this._drawSetup(r,s.DEFAULT_PROGRAM_NAME,{},!0,n,o);r._setVertexUniform(i,"u_gpuio_scale",[1,1],s.FLOAT),r._setVertexUniform(i,"u_gpuio_translation",[0,0],s.FLOAT),t.bindBuffer(t.ARRAY_BUFFER,this._getQuadPositionsBuffer()),this._setPositionAttribute(i,r.name),this._setBlendMode(e.shouldBlendAlpha),t.drawArrays(t.TRIANGLE_STRIP,0,4),t.disable(t.BLEND)},e.prototype.stepBoundary=function(e){var t=this.gl,r=e.program,n=e.input,o=e.output,i=o?o.width:this._width,a=o?o.height:this._height,c=this._drawSetup(r,s.DEFAULT_PROGRAM_NAME,{},!1,n,o),u=[1/i,1/a];if(r._setVertexUniform(c,"u_gpuio_scale",[1-u[0],1-u[1]],s.FLOAT),r._setVertexUniform(c,"u_gpuio_translation",u,s.FLOAT),t.bindBuffer(t.ARRAY_BUFFER,this._getBoundaryPositionsBuffer()),this._setPositionAttribute(c,r.name),this._setBlendMode(e.shouldBlendAlpha),e.singleEdge)switch(e.singleEdge){case"LEFT":t.drawArrays(t.LINES,3,2);break;case"RIGHT":t.drawArrays(t.LINES,1,2);break;case"TOP":t.drawArrays(t.LINES,2,2);break;case"BOTTOM":t.drawArrays(t.LINES,0,2);break;default:throw new Error("Unknown boundary edge type: ".concat(e.singleEdge,"."))}else t.drawArrays(t.LINE_LOOP,0,4);t.disable(t.BLEND)},e.prototype.stepNonBoundary=function(e){var t=this.gl,r=e.program,n=e.input,o=e.output,i=o?o.width:this._width,a=o?o.height:this._height,c=this._drawSetup(r,s.DEFAULT_PROGRAM_NAME,{},!1,n,o),u=[1/i,1/a];r._setVertexUniform(c,"u_gpuio_scale",[1-2*u[0],1-2*u[1]],s.FLOAT),r._setVertexUniform(c,"u_gpuio_translation",u,s.FLOAT),t.bindBuffer(t.ARRAY_BUFFER,this._getQuadPositionsBuffer),this._setPositionAttribute(c,r.name),this._setBlendMode(e.shouldBlendAlpha),t.drawArrays(t.TRIANGLE_STRIP,0,4),t.disable(t.BLEND)},e.prototype.stepCircle=function(e){var t=this,r=t.gl,n=t._width,o=t._height,i=e.program,a=e.position,c=e.diameter,u=e.input,l=e.output,f=this._drawSetup(i,s.DEFAULT_PROGRAM_NAME,{},!1,u,l);i._setVertexUniform(f,"u_gpuio_scale",[c/n,c/o],s.FLOAT),i._setVertexUniform(f,"u_gpuio_translation",[2*a[0]/n-1,2*a[1]/o-1],s.FLOAT);var _=e.numSegments?e.numSegments:s.DEFAULT_CIRCLE_NUM_SEGMENTS;if(_<3)throw new Error("numSegments for GPUComposer.stepCircle must be greater than 2, got ".concat(_,"."));r.bindBuffer(r.ARRAY_BUFFER,this._getCirclePositionsBuffer(_)),this._setPositionAttribute(f,i.name),this._setBlendMode(e.shouldBlendAlpha),r.drawArrays(r.TRIANGLE_FAN,0,_+2),r.disable(r.BLEND)},e.prototype.stepSegment=function(e){var t=this.gl,r=e.program,n=e.position1,o=e.position2,i=e.thickness,a=e.input,c=e.output,u=c?c.width:this._width,l=c?c.height:this._height,f=this._drawSetup(r,s.SEGMENT_PROGRAM_NAME,{},!1,a,c);r._setVertexUniform(f,"u_gpuio_halfThickness",i/2,s.FLOAT),r._setVertexUniform(f,"u_gpuio_scale",[2/u,2/l],s.FLOAT);var _=n[0]-o[0],p=n[1]-o[1],h=Math.atan2(p,_);r._setVertexUniform(f,"u_gpuio_rotation",h,s.FLOAT);var d=(n[0]+o[0])/2,g=(n[1]+o[1])/2;r._setVertexUniform(f,"u_gpuio_translation",[2*d/this._width-1,2*g/this._height-1],s.FLOAT);var m=Math.sqrt(_*_+p*p),v=e.numCapSegments?2*e.numCapSegments:s.DEFAULT_CIRCLE_NUM_SEGMENTS;if(e.endCaps){if(v<6||v%6!=0)throw new Error("numSegments for GPUComposer.stepSegment must be divisible by 6, got ".concat(v,"."));r._setVertexUniform(f,"u_gpuio_length",m-i*Math.sin(Math.PI/v),s.FLOAT),t.bindBuffer(t.ARRAY_BUFFER,this._getCirclePositionsBuffer(v))}else r._setVertexUniform(f,"u_gpuio_length",m-i,s.FLOAT),t.bindBuffer(t.ARRAY_BUFFER,this._getQuadPositionsBuffer());this._setPositionAttribute(f,r.name),this._setBlendMode(e.shouldBlendAlpha),e.endCaps?t.drawArrays(t.TRIANGLE_FAN,0,v+2):t.drawArrays(t.TRIANGLE_STRIP,0,4),t.disable(t.BLEND)},e.prototype.stepPolyline=function(e){for(var t=e.program,r=e.input,n=e.output,o=e.positions,i=!!e.closeLoop,a=this,c=a.gl,u=a._width,l=a._height,f=e.thickness/2,_=i?4*o.length+2:4*(o.length-1),p=new Float32Array(2*_),h=e.includeUVs?new Float32Array(2*_):void 0,d=e.includeNormals?new Float32Array(2*_):void 0,g=[0,0],m=[0,0],v=[0,0],T=[0,0],E=[0,0],A=0;A<o.length;A++)if(i||A!==o.length-1){var I=o[A],y=o[(A+1)%o.length];g[0]=y[0]-I[0],g[1]=y[1]-I[1];var R=Math.sqrt(g[0]*g[0]+g[1]*g[1]);v[0]=g[1]/R,v[1]=-g[0]/R;var U=4*A+2;i||0!==A||(p[0]=I[0]+v[0]*f,p[1]=I[1]+v[1]*f,p[2]=I[0]-v[0]*f,p[3]=I[1]-v[1]*f,h&&(h[0]=0,h[1]=1,h[2]=0,h[3]=0),d&&(d[0]=v[0],d[1]=v[1],d[2]=v[0],d[3]=v[1]));var O=(A+1)/(o.length-1);if(p[2*U]=y[0]+v[0]*f,p[2*U+1]=y[1]+v[1]*f,p[2*U+2]=y[0]-v[0]*f,p[2*U+3]=y[1]-v[1]*f,h&&(h[2*U]=O,h[2*U+1]=1,h[2*U+2]=O,h[2*U+3]=0),d&&(d[2*U]=v[0],d[2*U+1]=v[1],d[2*U+2]=v[0],d[2*U+3]=v[1]),A<o.length-2||i){var L=o[(A+1)%o.length],P=o[(A+2)%o.length];m[0]=P[0]-L[0],m[1]=P[1]-L[1];var F=Math.sqrt(m[0]*m[0]+m[1]*m[1]);T[0]=m[1]/F,T[1]=-m[0]/F,p[(U+2)%(4*o.length)*2]=L[0]+T[0]*f,p[(U+2)%(4*o.length)*2+1]=L[1]+T[1]*f,p[(U+2)%(4*o.length)*2+2]=L[0]-T[0]*f,p[(U+2)%(4*o.length)*2+3]=L[1]-T[1]*f,h&&(h[(U+2)%(4*o.length)*2]=O,h[(U+2)%(4*o.length)*2+1]=1,h[(U+2)%(4*o.length)*2+2]=O,h[(U+2)%(4*o.length)*2+3]=0),d&&(d[(U+2)%(4*o.length)*2]=T[0],d[(U+2)%(4*o.length)*2+1]=T[1],d[(U+2)%(4*o.length)*2+2]=T[0],d[(U+2)%(4*o.length)*2+3]=T[1]);var b=v[0]*T[1]-v[1]*T[0];if(Math.abs(b)<1e-6)continue;E[0]=v[0]+T[0],E[1]=v[1]+T[1];var N=Math.sqrt(E[0]*E[0]+E[1]*E[1]);E[0]/=N,E[1]/=N;var w=Math.acos(v[0]*T[0]+v[1]*T[1]),S=f/Math.cos(w/2);b<0?(p[2*U]=y[0]+E[0]*S,p[2*U+1]=y[1]+E[1]*S,p[(U+2)%(4*o.length)*2]=p[2*U],p[(U+2)%(4*o.length)*2+1]=p[2*U+1]):(p[2*U+2]=y[0]-E[0]*S,p[2*U+3]=y[1]-E[1]*S,p[(U+2)%(4*o.length)*2+2]=p[2*U+2],p[(U+2)%(4*o.length)*2+3]=p[2*U+3])}}i&&(p[8*o.length]=p[0],p[8*o.length+1]=p[1],p[8*o.length+2]=p[2],p[8*o.length+3]=p[3],h&&(h[8*o.length]=h[0],h[8*o.length+1]=h[1],h[8*o.length+2]=h[2],h[8*o.length+3]=h[3]),d&&(d[8*o.length]=d[0],d[8*o.length+1]=d[1],d[8*o.length+2]=d[2],d[8*o.length+3]=d[3]));var G={};h&&(G[s.GPUIO_VS_UV_ATTRIBUTE]="1"),d&&(G[s.GPUIO_VS_NORMAL_ATTRIBUTE]="1");var x=this._drawSetup(t,s.DEFAULT_PROGRAM_NAME,G,!1,r,n);t._setVertexUniform(x,"u_gpuio_scale",[2/u,2/l],s.FLOAT),t._setVertexUniform(x,"u_gpuio_translation",[-1,-1],s.FLOAT),c.bindBuffer(c.ARRAY_BUFFER,this._initVertexBuffer(p)),this._setPositionAttribute(x,t.name),h&&(c.bindBuffer(c.ARRAY_BUFFER,this._initVertexBuffer(h)),this._setUVAttribute(x,t.name)),d&&(c.bindBuffer(c.ARRAY_BUFFER,this._initVertexBuffer(d)),this._setVertexAttribute(x,"a_gpuio_normal",2,t.name)),this._setBlendMode(e.shouldBlendAlpha),c.drawArrays(c.TRIANGLE_STRIP,0,_),c.disable(c.BLEND)},e.prototype.stepTriangleStrip=function(e){var t=e.program,r=e.input,n=e.output,o=e.positions,i=e.uvs,a=e.normals,c=this,u=c.gl,l=c._width,f=c._height,_={};i&&(_[s.GPUIO_VS_UV_ATTRIBUTE]="1"),a&&(_[s.GPUIO_VS_NORMAL_ATTRIBUTE]="1");var p=this._drawSetup(t,s.DEFAULT_PROGRAM_NAME,_,!1,r,n);t._setVertexUniform(p,"u_gpuio_scale",[2/l,2/f],s.FLOAT),t._setVertexUniform(p,"u_gpuio_translation",[-1,-1],s.FLOAT),u.bindBuffer(u.ARRAY_BUFFER,this._initVertexBuffer(o)),this._setPositionAttribute(p,t.name),i&&(u.bindBuffer(u.ARRAY_BUFFER,this._initVertexBuffer(i)),this._setUVAttribute(p,t.name)),a&&(u.bindBuffer(u.ARRAY_BUFFER,this._initVertexBuffer(a)),this._setVertexAttribute(p,"a_gpuio_normal",2,t.name));var h=e.count?e.count:o.length/2;this._setBlendMode(e.shouldBlendAlpha),u.drawArrays(u.TRIANGLE_STRIP,0,h),u.disable(u.BLEND)},e.prototype.stepLines=function(e){var t=this,r=t.gl,n=t._width,o=t._height,i=e.indices,a=e.uvs,c=e.normals,u=e.input,l=e.output,f=e.program;if(e.closeLoop&&i)throw new Error("GPUComposer.stepLines() can't be called with closeLoop == true and indices.");var _={};a&&(_[s.GPUIO_VS_UV_ATTRIBUTE]="1"),c&&(_[s.GPUIO_VS_NORMAL_ATTRIBUTE]="1");var p=this._drawSetup(f,s.DEFAULT_PROGRAM_NAME,_,!1,u,l),h=e.count?e.count:i?i.length:e.positions.length/2;if(f._setVertexUniform(p,"u_gpuio_scale",[2/n,2/o],s.FLOAT),f._setVertexUniform(p,"u_gpuio_translation",[-1,-1],s.FLOAT),i){for(var d=new Float32Array(2*h),g=0;g<h;g++){var m=i[g];d[2*g]=e.positions[2*m],d[2*g+1]=e.positions[2*m+1]}r.bindBuffer(r.ARRAY_BUFFER,this._initVertexBuffer(d))}else r.bindBuffer(r.ARRAY_BUFFER,this._initVertexBuffer(e.positions));this._setPositionAttribute(p,f.name),a&&(r.bindBuffer(r.ARRAY_BUFFER,this._initVertexBuffer(a)),this._setUVAttribute(p,f.name)),c&&(r.bindBuffer(r.ARRAY_BUFFER,this._initVertexBuffer(c)),this._setVertexAttribute(p,"a_gpuio_normal",2,f.name)),this._setBlendMode(e.shouldBlendAlpha),e.indices?r.drawArrays(r.LINES,0,h):e.closeLoop?r.drawArrays(r.LINE_LOOP,0,h):r.drawArrays(r.LINE_STRIP,0,h),r.disable(r.BLEND)},e.prototype.drawLayerAsPoints=function(e){var t=this,r=t.gl,n=t._pointIndexArray,i=t._width,a=t._height,c=t.glslVersion,u=e.positions,f=e.output;if(2!==u.numComponents&&4!==u.numComponents)throw new Error('GPUComposer.drawLayerAsPoints() must be passed a position GPULayer with either 2 or 4 components, got position GPULayer "'.concat(u.name,'" with ').concat(u.numComponents," components."));c===s.GLSL1&&u.width*u.height>s.MAX_FLOAT_INT&&console.warn("Points positions array length: ".concat(u.width*u.height," is longer than what is supported by GLSL1 : ").concat(s.MAX_FLOAT_INT,", expect index overflow."));var _=u.length,p=e.count||_;if(p>_)throw new Error("Invalid count ".concat(p," for position GPULayer of length ").concat(_,"."));var h=e.program;if(void 0===h){h=this._setValueProgramForType(s.FLOAT);var d=e.color||[1,0,0];h.setUniform("u_value",o(o([],d,!0),[1],!1),s.FLOAT)}var g=this._addLayerToInputs(u,e.input),m={};4===u.numComponents&&(m[s.GPUIO_VS_POSITION_W_ACCUM]="1"),e.wrapX&&(m[s.GPUIO_VS_WRAP_X]="1"),e.wrapY&&(m[s.GPUIO_VS_WRAP_Y]="1");var v=this._drawSetup(h,s.LAYER_POINTS_PROGRAM_NAME,m,!1,g,f);h._setVertexUniform(v,"u_gpuio_positions",this._indexOfLayerInArray(u,g),s.INT),h._setVertexUniform(v,"u_gpuio_scale",[1/i,1/a],s.FLOAT);var T=e.pointSize||1;h._setVertexUniform(v,"u_gpuio_pointSize",T,s.FLOAT);var E=[u.width,u.height];if(h._setVertexUniform(v,"u_gpuio_positionsDimensions",E,s.FLOAT),void 0===this._pointIndexBuffer||n&&n.length<p){var A=(0,l.initSequentialFloatArray)(_);this._pointIndexArray=A,this._pointIndexBuffer=this._initVertexBuffer(A)}r.bindBuffer(r.ARRAY_BUFFER,this._pointIndexBuffer),this._setIndexAttribute(v,h.name),this._setBlendMode(e.shouldBlendAlpha),r.drawArrays(r.POINTS,0,p),r.disable(r.BLEND)},e.prototype.drawLayerAsLines=function(e){var t=this,r=t.gl,n=t._width,i=t._height,a=e.positions,c=e.output;if(2!==a.numComponents&&4!==a.numComponents)throw new Error('GPUComposer.drawLayerAsLines() must be passed a position GPULayer with either 2 or 4 components, got position GPULayer "'.concat(a.name,'" with ').concat(a.numComponents," components."));if(e.closeLoop&&e.indices)throw new Error("GPUComposer.drawLayerAsLines() can't be called with closeLoop == true and indices.");var u=e.program;if(void 0===u){u=e.wrapX||e.wrapY?this._getWrappedLineColorProgram():this._setValueProgramForType(s.FLOAT);var f=e.color||[1,0,0];u.setUniform("u_value",o(o([],f,!0),[1],!1),s.FLOAT)}var _=this._addLayerToInputs(a,e.input),p={};4===a.numComponents&&(p[s.GPUIO_VS_POSITION_W_ACCUM]="1"),e.wrapX&&(p[s.GPUIO_VS_WRAP_X]="1"),e.wrapY&&(p[s.GPUIO_VS_WRAP_Y]="1");var h=this._drawSetup(u,s.LAYER_LINES_PROGRAM_NAME,p,!1,_,c),d=e.indices?e.indices:(0,l.initSequentialFloatArray)(e.count||a.length),g=e.count?e.count:d.length;u._setVertexUniform(h,"u_gpuio_positions",this._indexOfLayerInArray(a,_),s.INT),u._setVertexUniform(h,"u_gpuio_scale",[1/n,1/i],s.FLOAT);var m=[a.width,a.height];if(u._setVertexUniform(h,"u_gpuio_positionsDimensions",m,s.FLOAT),void 0===this._indexedLinesIndexBuffer){var v=void 0;if(d.constructor!==Float32Array){v=new Float32Array(d.length);for(var T=0;T<g;T++)v[T]=d[T];console.warn("Converting indices array of type ".concat(d.constructor," to Float32Array in GPUComposer.drawIndexedLines for WebGL compatibility, you may want to use a Float32Array to store this information so the conversion is not required."))}else v=d;this._indexedLinesIndexBuffer=this._initVertexBuffer(v)}else r.bindBuffer(r.ARRAY_BUFFER,this._indexedLinesIndexBuffer),r.bufferData(r.ARRAY_BUFFER,d,r.STATIC_DRAW);this._setIndexAttribute(h,u.name),this._setBlendMode(e.shouldBlendAlpha),e.indices?r.drawArrays(r.LINES,0,g):e.closeLoop?r.drawArrays(r.LINE_LOOP,0,g):r.drawArrays(r.LINE_STRIP,0,g),r.disable(r.BLEND)},e.prototype.drawLayerAsVectorField=function(e){var t=this,r=t.gl,n=t._vectorFieldIndexArray,i=t._width,a=t._height,c=e.data,u=e.output;if(2!==c.numComponents)throw new Error('GPUComposer.drawLayerAsVectorField() must be passed a fieldLayer with 2 components, got fieldLayer "'.concat(c.name,'" with ').concat(c.numComponents," components."));var f=e.program;if(void 0===f){f=this._setValueProgramForType(s.FLOAT);var _=e.color||[1,0,0];f.setUniform("u_value",o(o([],_,!0),[1],!1),s.FLOAT)}var p=this._addLayerToInputs(c,e.input),h=this._drawSetup(f,s.LAYER_VECTOR_FIELD_PROGRAM_NAME,{},!1,p,u);f._setVertexUniform(h,"u_gpuio_vectors",this._indexOfLayerInArray(c,p),s.INT);var d=e.vectorScale||1;f._setVertexUniform(h,"u_gpuio_scale",[d/i,d/a],s.FLOAT);var g=e.vectorSpacing||10,m=[Math.floor(i/g),Math.floor(a/g)];f._setVertexUniform(h,"u_gpuio_dimensions",m,s.FLOAT);var v=2*m[0]*m[1];if(void 0===this._vectorFieldIndexBuffer||n&&n.length<v){var T=(0,l.initSequentialFloatArray)(v);this._vectorFieldIndexArray=T,this._vectorFieldIndexBuffer=this._initVertexBuffer(T)}r.bindBuffer(r.ARRAY_BUFFER,this._vectorFieldIndexBuffer),this._setIndexAttribute(h,f.name),this._setBlendMode(e.shouldBlendAlpha),r.drawArrays(r.LINES,0,v),r.disable(r.BLEND)},e.prototype.drawLayerMagnitude=function(e){var t=this.gl,r=e.data,n=e.output,o=this._vectorMagnitudeProgramForType(r.type),i=e.color||[1,0,0];o.setUniform("u_color",i,s.FLOAT);var a=e.scale||1;o.setUniform("u_scale",a,s.FLOAT),o.setUniform("u_gpuio_numDimensions",r.numComponents,s.INT);var c=this._addLayerToInputs(r,e.input),u=this._drawSetup(o,s.DEFAULT_PROGRAM_NAME,{},!0,c,n);o._setVertexUniform(u,"u_gpuio_data",this._indexOfLayerInArray(r,c),s.INT),o._setVertexUniform(u,"u_gpuio_scale",[1,1],s.FLOAT),o._setVertexUniform(u,"u_gpuio_translation",[0,0],s.FLOAT),t.bindBuffer(t.ARRAY_BUFFER,this._getQuadPositionsBuffer()),this._setPositionAttribute(u,o.name),this._setBlendMode(e.shouldBlendAlpha),t.drawArrays(t.TRIANGLE_STRIP,0,4),t.disable(t.BLEND)},e.prototype.resetThreeState=function(){if(!this._renderer)throw new Error("GPUComposer was not inited with a renderer, use GPUComposer.initWithThreeRenderer() to initialize GPUComposer instead.");var e=this.gl,t=this._renderer.getViewport(new u.Vector4);e.viewport(t.x,t.y,t.width,t.height),this._renderer.setRenderTarget(null),this._renderer.resetState()},e.prototype.savePNG=function(e){void 0===e&&(e={});var t=this.canvas,r=e.filename||"output",n=e.callback||saveAs;t.toBlob((function(t){t?e.dpi?(0,i.changeDpiBlob)(t,e.dpi).then((function(e){n(e,"".concat(r,".png"))})):n(t,"".concat(r,".png")):console.warn('Problem saving PNG from GPULayer "'.concat(name,'", unable to init blob.'))}),"image/png")},e.prototype.tick=function(){var e=this._lastTickTime,t=this._lastTickFPS,r=performance.now();if(this._lastTickTime=r,!e)return{fps:0,milliseconds:0};var n=1e3/(r-e);t||(t=n);var o=Number.parseFloat((.9*t+(1-.9)*n).toFixed(1));return this._lastTickFPS=o,this._numTicks+=1,{fps:o,numTicks:this._numTicks}},e.prototype.dispose=function(){var e,t=this,r=t.gl,n=t.verboseLogging,o=t._vertexShaders,i=t._copyPrograms,a=t._setValuePrograms,s=t._vectorMagnitudePrograms;n&&console.log("Deallocating GPUComposer."),Object.values(o).forEach((function(e){var t=e.compiledShaders;Object.keys(t).forEach((function(e){r.deleteShader(t[e]),delete t[e]}))})),Object.values(i).forEach((function(e){e.dispose&&e.dispose()})),Object.keys(i).forEach((function(e){delete i[e]})),Object.values(a).forEach((function(e){e.dispose&&e.dispose()})),Object.keys(a).forEach((function(e){delete a[e]})),Object.values(s).forEach((function(e){e.dispose&&e.dispose()})),Object.keys(s).forEach((function(e){delete s[e]})),null===(e=this._wrappedLineColorProgram)||void 0===e||e.dispose(),delete this._wrappedLineColorProgram,delete this._renderer,delete this.gl,delete this.canvas},e}();t.GPUComposer=p},355:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GPULayer=void 0;var n=r(847),o=r(809),i=r(162),a=r(707),s=r(601),c=r(593),u=r(191),l=function(){function e(e,t){this._clearValue=0,this._bufferIndex=0,this._buffers=[];var r=(t||{}).name;if(!e)throw new Error('Error initing GPULayer "'.concat(r,'": must pass GPUComposer instance to GPULayer(composer, params).'));if(!t)throw new Error("Error initing GPULayer: must pass params to GPULayer(composer, params).");if(!(0,a.isObject)(t))throw new Error("Error initing GPULayer: must pass valid params object to GPULayer(composer, params), got ".concat(JSON.stringify(t),"."));var n=["name","type","numComponents","dimensions","filter","wrapS","wrapT","writable","numBuffers","clearValue","array"],o=Object.keys(t);o.forEach((function(e){if(n.indexOf(e)<0)throw new Error('Invalid params key "'.concat(e,'" passed to GPULayer(composer, params) with name "').concat(t.name,'".  Valid keys are ').concat(JSON.stringify(n),"."))})),["name","type","numComponents","dimensions"].forEach((function(e){if(o.indexOf(e)<0)throw new Error('Required params key "'.concat(e,'" was not passed to GPULayer(composer, params) with name "').concat(r,'".'))}));var i=t.dimensions,c=t.type,l=t.numComponents,f=e.gl;if(this._composer=e,this.name=r,!(0,a.isPositiveInteger)(l)||l>4)throw new Error("Invalid numComponents: ".concat(JSON.stringify(l),' for GPULayer "').concat(r,'", must be number in range [1-4].'));this.numComponents=l;var _=!!t.writable;this.writable=_;var p=(0,u.calcGPULayerSize)(i,r,e.verboseLogging),h=p.length,d=p.width,g=p.height;this._length=h,this._width=d,this._height=g;var m=h?s.NEAREST:c===s.FLOAT||c==s.HALF_FLOAT?s.LINEAR:s.NEAREST,v=void 0!==t.filter?t.filter:m;if(!(0,a.isValidFilter)(v))throw new Error("Invalid filter: ".concat(JSON.stringify(v),' for GPULayer "').concat(r,'", must be one of ').concat(JSON.stringify(s.validFilters),"."));if(v===s.LINEAR&&c!==s.FLOAT&&c!=s.HALF_FLOAT)throw new Error('LINEAR filtering is not supported on integer types, please use NEAREST filtering for GPULayer "'.concat(r,'" with type: ').concat(c,"."));this.filter=v;var T=void 0!==t.wrapS?t.wrapS:s.CLAMP_TO_EDGE;if(!(0,a.isValidWrap)(T))throw new Error("Invalid wrapS: ".concat(JSON.stringify(T),' for GPULayer "').concat(r,'", must be one of ').concat(JSON.stringify(s.validWraps),"."));this.wrapS=T;var E=void 0!==t.wrapT?t.wrapT:s.CLAMP_TO_EDGE;if(!(0,a.isValidWrap)(E))throw new Error("Invalid wrapT: ".concat(JSON.stringify(E),' for GPULayer "').concat(r,'", must be one of ').concat(JSON.stringify(s.validWraps),"."));if(this.wrapT=E,!(0,a.isValidDataType)(c))throw new Error("Invalid type: ".concat(JSON.stringify(c),' for GPULayer "').concat(r,'", must be one of ').concat(JSON.stringify(s.validDataTypes),"."));this.type=c;var A=(0,u.getGPULayerInternalType)({composer:e,type:c,writable:_,name:r});this._internalType=A;var I=(0,u.getGLTextureParameters)({composer:e,name:r,numComponents:l,writable:_,internalType:A}),y=I.glFormat,R=I.glInternalFormat,U=I.glType,O=I.glNumChannels;this._glInternalFormat=R,this._glFormat=y,this._glType=U,this._glNumChannels=O;var L=(0,u.getGPULayerInternalFilter)({composer:e,filter:v,wrapS:T,wrapT:E,internalType:A,name:r});this._internalFilter=L,this._glFilter=f[L],this._internalWrapS=(0,u.getGPULayerInternalWrap)({composer:e,wrap:T,internalFilter:L,internalType:A,name:r}),this._glWrapS=f[this._internalWrapS],this._internalWrapT=(0,u.getGPULayerInternalWrap)({composer:e,wrap:E,internalFilter:L,internalType:A,name:r}),this._glWrapT=f[this._internalWrapT];var P=void 0!==t.numBuffers?t.numBuffers:1;if(!(0,a.isPositiveInteger)(P))throw new Error("Invalid numBuffers: ".concat(JSON.stringify(P),' for GPULayer "').concat(r,'", must be positive integer.'));this.numBuffers=P,void 0!==t.clearValue&&(this.clearValue=t.clearValue),this._initBuffers(t.array)}return Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){if(!this._length)throw new Error('Cannot access length on 2D GPULayer "'.concat(this.name,'".'));return this._length},enumerable:!1,configurable:!0}),e.prototype.is1D=function(){return void 0!==this._length},e.prototype._usingTextureOverrideForCurrentBuffer=function(){return this._textureOverrides&&this._textureOverrides[this.bufferIndex]},e.prototype._initBuffers=function(e){for(var t=this,r=t.name,n=t.numBuffers,o=t._composer,i=t._glInternalFormat,a=t._glFormat,s=t._glType,c=t._glFilter,l=t._glWrapS,f=t._glWrapT,_=t.writable,p=t.width,h=t.height,d=o.gl,g=o._errorCallback,m=e?(0,u.validateGPULayerArray)(e,this):void 0,v=0;v<n;v++){var T=d.createTexture();if(!T)return void g('Could not init texture for GPULayer "'.concat(r,'": ').concat(d.getError(),"."));d.bindTexture(d.TEXTURE_2D,T),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,l),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,f),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,c),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,c),d.texImage2D(d.TEXTURE_2D,0,i,p,h,0,a,s,m||null);var E={texture:T};if(_){var A=d.createFramebuffer();if(!A)return void g('Could not init framebuffer for GPULayer "'.concat(r,'": ').concat(d.getError(),"."));d.bindFramebuffer(d.FRAMEBUFFER,A),d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,T,0);var I=d.checkFramebufferStatus(d.FRAMEBUFFER);I!==d.FRAMEBUFFER_COMPLETE&&g('Invalid status for framebuffer for GPULayer "'.concat(r,'": ').concat(I,".")),E.framebuffer=A}this._buffers.push(E)}d.bindTexture(d.TEXTURE_2D,null),d.bindFramebuffer(d.FRAMEBUFFER,null)},Object.defineProperty(e.prototype,"bufferIndex",{get:function(){return this._bufferIndex},enumerable:!1,configurable:!0}),e.prototype.incrementBufferIndex=function(){this._bufferIndex=(this.bufferIndex+1)%this.numBuffers},Object.defineProperty(e.prototype,"currentState",{get:function(){return this.getStateAtIndex(this.bufferIndex)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastState",{get:function(){if(1===this.numBuffers)throw new Error('Cannot access lastState on GPULayer "'.concat(this.name,'" with only one buffer.'));return this.getStateAtIndex((this.bufferIndex-1+this.numBuffers)%this.numBuffers)},enumerable:!1,configurable:!0}),e.prototype.getStateAtIndex=function(e){var t=this,r=t.numBuffers,n=(t._textureOverrides,t._buffers);return e<0&&e>-r&&(e+=r),(e<0||e>=r)&&(console.warn("Out of range buffer index: ".concat(e,' for GPULayer "').concat(this.name,'" with $.numBuffers} buffer').concat(r>1?"s":"",".  Was this intentional?")),e<0?e+=r*Math.ceil(Math.abs(e)/r):e%=r),{texture:n[e].texture,layer:this}},e.prototype._bindFramebuffer=function(){var e=this._composer.gl,t=this._buffers[this.bufferIndex].framebuffer;if(!t)throw new Error('GPULayer "'.concat(this.name,'" is not writable.'));e.bindFramebuffer(e.FRAMEBUFFER,t)},e.prototype._prepareForWrite=function(e){e&&this.incrementBufferIndex(),this._bindFramebuffer(),this._textureOverrides&&(this._textureOverrides[this.bufferIndex]=void 0)},e.prototype.setFromArray=function(e,t){void 0===t&&(t=!1);for(var r=this,n=r._composer,o=r._glInternalFormat,i=r._glFormat,a=r._glType,s=r.numBuffers,c=r.width,l=r.height,f=r.bufferIndex,_=n.gl,p=(0,u.validateGPULayerArray)(e,this),h=t?s:f+1,d=t?0:f;d<h;d++){var g=this.getStateAtIndex(d).texture;_.bindTexture(_.TEXTURE_2D,g),_.texImage2D(_.TEXTURE_2D,0,o,c,l,0,i,a,p)}_.bindTexture(_.TEXTURE_2D,null)},e.prototype.resize=function(e,t){var r=this.name,n=this._composer.verboseLogging;n&&console.log('Resizing GPULayer "'.concat(r,'" to ').concat(JSON.stringify(e),"."));var o=(0,u.calcGPULayerSize)(e,r,n),i=o.length,a=o.width,s=o.height;this._length=i,this._width=a,this._height=s,this._destroyBuffers(),this._initBuffers(t)},Object.defineProperty(e.prototype,"clearValue",{get:function(){return this._clearValue},set:function(e){var t=this.numComponents,r=this.type;if(!(0,a.isValidClearValue)(e,t,r))throw new Error("Invalid clearValue: ".concat(JSON.stringify(e),' for GPULayer "').concat(this.name,'", expected ').concat(r," or array of ").concat(r," of length ").concat(t,"."));this._clearValue=(0,a.isArray)(e)?e.slice():e},enumerable:!1,configurable:!0}),e.prototype.clear=function(e){void 0===e&&(e=!1);var t=this,r=t.name,o=t._composer,i=t.clearValue,c=t.numBuffers,l=t.bufferIndex,f=t.type;o.verboseLogging&&console.log('Clearing GPULayer "'.concat(r,'".'));var _=[];if((0,a.isNumber)(i))_.push(i,i,i,i);else{_.push.apply(_,i);for(var p=_.length;p<4;p++)_.push(0)}var h=e?0:l,d=e?c:l+1;if(this.writable){var g=o._setValueProgramForType(f);g.setUniform("u_value",_);for(var m=h;m<d;m++)o.step({program:g,output:this})}else{var v=this,T=v.width,E=v.height,A=v._glNumChannels,I=v._internalType,y=v._glInternalFormat,R=v._glFormat,U=v._glType,O=o.gl,L=this._length?this._length:T*E,P=(0,u.initArrayForType)(I,T*E*A),F=I===s.HALF_FLOAT?new DataView(P.buffer):null;for(p=0;p<L;p++)for(var b=0;b<A;b++){var N=p*A+b;I===s.HALF_FLOAT?(0,n.setFloat16)(F,2*N,_[b],!0):P[N]=_[b]}for(m=h;m<d;m++){var w=this.getStateAtIndex(m).texture;O.bindTexture(O.TEXTURE_2D,w),O.texImage2D(O.TEXTURE_2D,0,y,T,E,0,R,U,P)}O.bindTexture(O.TEXTURE_2D,null)}},e.prototype.getValues=function(){var e=this,t=e.width,r=e.height,o=e._composer,i=e.numComponents,a=e.type,l=o.gl;this._bindFramebuffer();var f,_=this,p=_._glNumChannels,h=_._glType,d=_._glFormat,g=_._internalType;switch(g){case s.HALF_FLOAT:void 0!==l.FLOAT?(p=4,d=l.RGBA,h=l.FLOAT,f=new Float32Array(t*r*p)):f=new Uint16Array(t*r*p);break;case s.FLOAT:p=4,d=l.RGBA,f=new Float32Array(t*r*p);break;case s.UNSIGNED_BYTE:case s.UNSIGNED_SHORT:p=4,d=l.RGBA_INTEGER,h=l.UNSIGNED_INT,f=new Uint32Array(t*r*p);break;case s.UNSIGNED_INT:p=4,d=l.RGBA_INTEGER,f=new Uint32Array(t*r*p);break;case s.BYTE:case s.SHORT:p=4,d=l.RGBA_INTEGER,h=l.INT,f=new Int32Array(t*r*p);break;case s.INT:p=4,d=l.RGBA_INTEGER,f=new Int32Array(t*r*p);break;default:throw new Error("Unsupported internalType ".concat(g," for getValues()."))}if((0,c.readyToRead)(l)){l.readPixels(0,0,t,r,d,h,f);var m=(this._length?this._length:t*r)*i,v=g===s.HALF_FLOAT&&f.constructor===Uint16Array?new DataView(f.buffer):void 0,T=g===a?f:(0,u.initArrayForType)(a,m,!0);if(v||T!==f||i!==p)for(var E=0,A=t*r;E<A;E++){var I=E*p,y=E*i;if(y>=m)break;for(var R=0;R<i;R++)T[y+R]=v?(0,n.getFloat16)(v,2*(I+R),!0):f[I+R]}return T.length!==m&&(T=T.slice(0,m)),T}throw new Error("Unable to read values from Buffer with status: ".concat(l.checkFramebufferStatus(l.FRAMEBUFFER),"."))},e.prototype.savePNG=function(e){void 0===e&&(e={});var t=this.getValues(),r=this,n=r.width,a=r.height,c=r.type,u=r.name,l=r.numComponents,f=e.callback||i.saveAs,_=e.filename||u,p=e.multiplier||(c===s.FLOAT||c===s.HALF_FLOAT?255:1),h=document.createElement("canvas");h.width=n,h.height=a;for(var d=h.getContext("2d"),g=d.getImageData(0,0,n,a),m=g.data,v=0;v<a;v++)for(var T=0;T<n;T++){for(var E=v*n+T,A=(a-1-v)*n+T,I=0;I<l;I++)m[4*A+I]=t[l*E+I]*p;1===l&&(m[4*A+1]=m[4*A],m[4*A+2]=m[4*A]),l<4&&(m[4*A+3]=255)}d.putImageData(g,0,0),h.toBlob((function(t){t?e.dpi?(0,o.changeDpiBlob)(t,e.dpi).then((function(e){f(e,"".concat(_,".png"))})):f(t,"".concat(_,".png")):console.warn('Problem saving PNG from GPULayer "'.concat(u,'", unable to init blob.'))}),"image/png")},e.prototype.attachToThreeTexture=function(e){var t=this,r=t._composer,n=t.numBuffers,o=t.currentState,i=t.name,a=r._renderer;if(!a)throw new Error("GPUComposer was not inited with a renderer.");if(n>1)throw new Error('GPULayer "'.concat(i,'" contains multiple WebGL textures (one for each buffer) that are flip-flopped during compute cycles, please choose a GPULayer with one buffer.'));var s=a.properties.get(e);s.__webglTexture=o,s.__webglInit=!0},e.prototype._destroyBuffers=function(){var e=this._composer,t=this._buffers,r=e.gl;t.forEach((function(e){var t=e.framebuffer,n=e.texture;r.deleteTexture(n),t&&r.deleteFramebuffer(t),delete e.texture,delete e.framebuffer})),t.length=0,delete this._textureOverrides},e.prototype.clone=function(e){return this._composer._cloneGPULayer(this,e)},e.prototype.dispose=function(){var e=this.name,t=this._composer,r=t.gl;if(t.verboseLogging&&console.log('Deallocating GPULayer "'.concat(e,'".')),!r)throw new Error("Must call dispose() on all GPULayers before calling dispose() on GPUComposer.");this._destroyBuffers(),delete this._buffers,delete this._composer},e}();t.GPULayer=l},191:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.validateGPULayerArray=t.minMaxValuesForType=t.getGPULayerInternalType=t.testFilterWrap=t.testWriteSupport=t.getGLTextureParameters=t.shouldCastIntTypeAsFloat=t.getGPULayerInternalFilter=t.getGPULayerInternalWrap=t.calcGPULayerSize=t.initArrayForType=void 0;var n=r(847),o=r(707),i=r(601),a=r(581),s=r(355),c=r(593),u={writeSupport:{},filterWrapSupport:{}};function l(e,t,r){switch(void 0===r&&(r=!1),e){case i.HALF_FLOAT:return r?new Float32Array(t):new Uint16Array(t);case i.FLOAT:return new Float32Array(t);case i.UNSIGNED_BYTE:return new Uint8Array(t);case i.BYTE:return new Int8Array(t);case i.UNSIGNED_SHORT:return new Uint16Array(t);case i.SHORT:return new Int16Array(t);case i.UNSIGNED_INT:return new Uint32Array(t);case i.INT:return new Int32Array(t);default:throw new Error('Unsupported type: "'.concat(e,'".'))}}function f(e,t){var r=e.gl;return(e.glslVersion!==i.GLSL3||!(0,c.isWebGL2)(r))&&(t===i.UNSIGNED_BYTE||t===i.BYTE||t===i.SHORT||t===i.INT||t===i.UNSIGNED_SHORT||t===i.UNSIGNED_INT)}function _(e){var t,r,n,o,s=e.composer,u=e.name,l=e.numComponents,f=e.internalType,_=e.writable,p=s.gl,h=s.glslVersion;if((0,c.isWebGL2)(p)){if(o=l,3===l&&_&&(o=4),f===i.FLOAT||f===i.HALF_FLOAT)switch(o){case 1:r=p.RED;break;case 2:r=p.RG;break;case 3:r=p.RGB;break;case 4:r=p.RGBA;break;default:throw new Error("Unsupported glNumChannels: ".concat(o,' for GPULayer "').concat(u,'".'))}else switch(o){case 1:r=p.RED_INTEGER;break;case 2:r=p.RG_INTEGER;break;case 3:r=p.RGB_INTEGER;break;case 4:r=p.RGBA_INTEGER;break;default:throw new Error("Unsupported glNumChannels: ".concat(o,' for GPULayer "').concat(u,'".'))}switch(f){case i.HALF_FLOAT:switch(t=p.HALF_FLOAT,o){case 1:n=p.R16F;break;case 2:n=p.RG16F;break;case 3:n=p.RGB16F;break;case 4:n=p.RGBA16F;break;default:throw new Error("Unsupported glNumChannels: ".concat(o,' for GPULayer "').concat(u,'".'))}break;case i.FLOAT:switch(t=p.FLOAT,o){case 1:n=p.R32F;break;case 2:n=p.RG32F;break;case 3:n=p.RGB32F;break;case 4:n=p.RGBA32F;break;default:throw new Error("Unsupported glNumChannels: ".concat(o,' for GPULayer "').concat(u,'".'))}break;case i.UNSIGNED_BYTE:if(t=p.UNSIGNED_BYTE,h===i.GLSL1&&f===i.UNSIGNED_BYTE)n=r;else switch(o){case 1:n=p.R8UI;break;case 2:n=p.RG8UI;break;case 3:n=p.RGB8UI;break;case 4:n=p.RGBA8UI;break;default:throw new Error("Unsupported glNumChannels: ".concat(o,' for GPULayer "').concat(u,'".'))}break;case i.BYTE:switch(t=p.BYTE,o){case 1:n=p.R8I;break;case 2:n=p.RG8I;break;case 3:n=p.RGB8I;break;case 4:n=p.RGBA8I;break;default:throw new Error("Unsupported glNumChannels: ".concat(o,' for GPULayer "').concat(u,'".'))}break;case i.SHORT:switch(t=p.SHORT,o){case 1:n=p.R16I;break;case 2:n=p.RG16I;break;case 3:n=p.RGB16I;break;case 4:n=p.RGBA16I;break;default:throw new Error("Unsupported glNumChannels: ".concat(o,' for GPULayer "').concat(u,'".'))}break;case i.UNSIGNED_SHORT:switch(t=p.UNSIGNED_SHORT,o){case 1:n=p.R16UI;break;case 2:n=p.RG16UI;break;case 3:n=p.RGB16UI;break;case 4:n=p.RGBA16UI;break;default:throw new Error("Unsupported glNumChannels: ".concat(o,' for GPULayer "').concat(u,'".'))}break;case i.INT:switch(t=p.INT,o){case 1:n=p.R32I;break;case 2:n=p.RG32I;break;case 3:n=p.RGB32I;break;case 4:n=p.RGBA32I;break;default:throw new Error("Unsupported glNumChannels: ".concat(o,' for GPULayer "').concat(u,'".'))}break;case i.UNSIGNED_INT:switch(t=p.UNSIGNED_INT,o){case 1:n=p.R32UI;break;case 2:n=p.RG32UI;break;case 3:n=p.RGB32UI;break;case 4:n=p.RGBA32UI;break;default:throw new Error("Unsupported glNumChannels: ".concat(o,' for GPULayer "').concat(u,'".'))}break;default:throw new Error('Unsupported type: "'.concat(f,'" for GPULayer "').concat(u,'".'))}}else{switch(o=l,_&&(o=4),o){case 1:case 2:case 3:r=p.RGB,n=p.RGB,o=3;break;case 4:r=p.RGBA,n=p.RGBA,o=4;break;default:throw new Error("Unsupported numComponents: ".concat(l,' for GPULayer "').concat(u,'".'))}switch(f){case i.FLOAT:t=p.FLOAT;break;case i.HALF_FLOAT:t=p.HALF_FLOAT||(0,a.getExtension)(s,a.OES_TEXTURE_HALF_FLOAT).HALF_FLOAT_OES;break;case i.UNSIGNED_BYTE:t=p.UNSIGNED_BYTE;break;default:throw new Error('Unsupported type: "'.concat(f,'" in WebGL 1.0 for GPULayer "').concat(u,'".'))}}if(void 0===t||void 0===r||void 0===n){var d=[];throw void 0===t&&d.push("glType"),void 0===r&&d.push("glFormat"),void 0===n&&d.push("glInternalFormat"),new Error("Invalid type: ".concat(f," for numComponents: ").concat(l,", unable to init parameter").concat(d.length>1?"s":""," ").concat(d.join(", "),' for GPULayer "').concat(u,'".'))}if(void 0===o||l<1||l>4||o<l)throw new Error("Invalid numChannels: ".concat(o," for numComponents: ").concat(l,' for GPULayer "').concat(u,'".'));return{glFormat:r,glInternalFormat:n,glType:t,glNumChannels:o}}function p(e,t){var r=e.gl,n=e.glslVersion,o="".concat((0,c.isWebGL2)(r),",").concat(t,",").concat(n===i.GLSL3?"3":"1");if(void 0!==u.writeSupport[o])return u.writeSupport[o];var a=r.createTexture();if(!a)return u.writeSupport[o]=!1,u.writeSupport[o];r.bindTexture(r.TEXTURE_2D,a);var s=r[i.CLAMP_TO_EDGE],l=r[i.NEAREST];r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,s),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,s),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,l),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,l);var f=_({composer:e,name:"testWriteSupport",numComponents:1,writable:!0,internalType:t}),p=f.glInternalFormat,h=f.glFormat,d=f.glType;r.texImage2D(r.TEXTURE_2D,0,p,10,10,0,h,d,null);var g=r.createFramebuffer();if(!g)return r.deleteTexture(a),u.writeSupport[o]=!1,u.writeSupport[o];r.bindFramebuffer(r.FRAMEBUFFER,g),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,a,0);var m=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.deleteTexture(a),r.deleteFramebuffer(g),u.writeSupport[o]=m,u.writeSupport[o]}function h(e,t,r,o){var a,f=e.gl,p=e.glslVersion,h=e.intPrecision,d=e.floatPrecision,g=e._errorCallback,m="".concat((0,c.isWebGL2)(f),",").concat(t,",").concat(r,",").concat(o,",").concat(p===i.GLSL3?"3":"1");if(void 0!==u.filterWrapSupport[m])return u.filterWrapSupport[m];var v=f.createTexture();if(!v)return u.filterWrapSupport[m]=!1,u.filterWrapSupport[m];f.bindTexture(f.TEXTURE_2D,v);var T=f[o],E=f[r];f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,T),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,T),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,E),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,E);for(var A=_({composer:e,name:"testFilterWrap",numComponents:1,internalType:t,writable:!0}),I=A.glInternalFormat,y=A.glFormat,R=A.glType,U=A.glNumChannels,O=[3,56.5,834,-53.6,.003,96.2,23,90.2,32],L=l(t,O.length*U,!0),P=0;P<O.length;P++)L[P*U]=O[P],O[P]=L[P*U];if(t===i.HALF_FLOAT){var F=new Uint16Array(L.length),b=new DataView(F.buffer);for(P=0;P<L.length;P++)(0,n.setFloat16)(b,2*P,L[P],!0);L=F}f.texImage2D(f.TEXTURE_2D,0,I,3,3,0,y,R,L);var N=new s.GPULayer(e,{name:"testFloatLinearFiltering-output",type:t,numComponents:1,dimensions:[3,3],wrapS:i.CLAMP_TO_EDGE,wrapT:i.CLAMP_TO_EDGE,filter:i.NEAREST,writable:!0}),w=r===i.LINEAR?.5:1,S="testFilterWrap-program",G="\nin vec2 v_uv;\nuniform vec2 u_offset;\n#ifdef GPUIO_INT\n\tuniform isampler2D u_input;\n\tout int out_fragColor;\n#endif\n#ifdef GPUIO_UINT\n\tuniform usampler2D u_input;\n\tout uint out_fragColor;\n#endif\n#ifdef GPUIO_FLOAT\n\tuniform sampler2D u_input;\n\tout float out_fragColor;\n#endif\nvoid main() {\n\tout_fragColor = texture(u_input, v_uv + offset).x;\n}";p!==i.GLSL3&&(G=(0,c.convertFragmentShaderToGLSL1)(G,S));var x=(0,c.compileShader)(f,p,h,d,G,f.FRAGMENT_SHADER,S,g,((a={offset:"vec2(".concat(w/3,", ").concat(w/3,")")})[(0,c.isUnsignedIntType)(t)?"GPUIO_UINT":(0,c.isIntType)(t)?"GPUIO_INT":"GPUIO_FLOAT"]="1",a),!0);function M(e,t){return o===i.CLAMP_TO_EDGE?Math.max(0,Math.min(t-1,e)):(e+t)%t}var D=e._getVertexShader(i.DEFAULT_PROGRAM_NAME,"",{},S);if(D&&x){var B=(0,c.initGLProgram)(f,D,x,S,g);if(B){N._prepareForWrite(!1),f.viewport(0,0,3,3),f.useProgram(B),f.activeTexture(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,v),f.uniform2fv(f.getUniformLocation(B,"u_gpuio_scale"),[1,1]),f.uniform2fv(f.getUniformLocation(B,"u_gpuio_translation"),[0,0]),f.bindBuffer(f.ARRAY_BUFFER,e._getQuadPositionsBuffer()),e._setPositionAttribute(B,S),f.drawArrays(f.TRIANGLE_STRIP,0,4),f.disable(f.BLEND);for(var C=N.getValues(),V=!0,k=(0,c.isIntType)(t)?0:t===i.HALF_FLOAT?.01:1e-4,W=0;W<3;W++)for(var H=0;H<3;H++){var X=void 0;if(r===i.LINEAR)X=(O[3*H+W]+O[3*H+M(W+1,3)]+O[3*M(H+1,3)+W]+O[3*M(H+1,3)+M(W+1,3)])/4;else{var j=M(W+w,3);X=O[3*M(H+w,3)+j]}P=3*H+W;if(Math.abs((X-C[P])/X)>k){V=!1;break}}u.filterWrapSupport[m]=V,f.deleteProgram(B)}else u.filterWrapSupport[m]=!1;f.deleteShader(x)}else u.filterWrapSupport[m]=!1;return N.dispose(),f.deleteTexture(v),u.filterWrapSupport[m]}function d(e){var t=-1/0,r=1/0;switch(e){case i.UNSIGNED_BYTE:t=i.MIN_UNSIGNED_BYTE,r=i.MAX_UNSIGNED_BYTE;break;case i.BYTE:t=i.MIN_BYTE,r=i.MAX_BYTE;break;case i.UNSIGNED_SHORT:t=i.MIN_UNSIGNED_SHORT,r=i.MAX_UNSIGNED_SHORT;break;case i.SHORT:t=i.MIN_SHORT,r=i.MAX_SHORT;break;case i.UNSIGNED_INT:t=i.MIN_UNSIGNED_INT,r=i.MAX_UNSIGNED_INT;break;case i.INT:t=i.MIN_INT,r=i.MAX_INT}return{min:t,max:r}}t.initArrayForType=l,t.calcGPULayerSize=function(e,t,r){if((0,o.isNumber)(e)){if(!(0,o.isPositiveInteger)(e))throw new Error("Invalid length: ".concat(JSON.stringify(e),' for GPULayer "').concat(t,'", must be positive integer.'));for(var n=e,i=1,a=n;a>2;)i++,a/=2;var s=Math.pow(2,Math.floor(i/2)+i%2),c=Math.pow(2,Math.floor(i/2));return r&&console.log("Using [".concat(s,", ").concat(c,"] for 1D array of length ").concat(e,' in GPULayer "').concat(t,'".')),{width:s,height:c,length:n}}var u=e[0];if(!(0,o.isPositiveInteger)(u))throw new Error("Invalid width: ".concat(JSON.stringify(u),' for GPULayer "').concat(t,'", must be positive integer.'));var l=e[1];if(!(0,o.isPositiveInteger)(l))throw new Error("Invalid height: ".concat(JSON.stringify(l),' for GPULayer "').concat(t,'", must be positive integer.'));return{width:u,height:l}},t.getGPULayerInternalWrap=function(e){var t=e.composer,r=e.wrap,n=e.internalFilter,o=e.internalType;return r===i.CLAMP_TO_EDGE||h(t,o,n,r)?r:i.CLAMP_TO_EDGE},t.getGPULayerInternalFilter=function(e){var t=e.filter;if(t===i.NEAREST)return t;var r=e.composer,n=e.internalType,o=e.wrapS,s=e.wrapT,c=e.name;return n===i.HALF_FLOAT&&(((0,a.getExtension)(r,a.OES_TEXTURE_HAlF_FLOAT_LINEAR,!0)||(0,a.getExtension)(r,a.OES_TEXTURE_FLOAT_LINEAR,!0))&&h(r,n,t,o)&&h(r,n,t,s)||(console.warn("This browser does not support ".concat(t," filtering for type ").concat(n," and wrap [").concat(o,", ").concat(s,'].  Falling back to NEAREST filter for GPULayer "').concat(c,'" with ').concat(t," polyfill in fragment shader.")),t=i.NEAREST)),n===i.FLOAT&&((0,a.getExtension)(r,a.OES_TEXTURE_FLOAT_LINEAR,!0)&&h(r,n,t,o)&&h(r,n,t,s)||(console.warn("This browser does not support ".concat(t," filtering for type ").concat(n," and wrap [").concat(o,", ").concat(s,'].  Falling back to NEAREST filter for GPULayer "').concat(c,'" with ').concat(t," polyfill in fragment shader.")),t=i.NEAREST)),t},t.shouldCastIntTypeAsFloat=f,t.getGLTextureParameters=_,t.testWriteSupport=p,t.testFilterWrap=h,t.getGPULayerInternalType=function(e){var t=e.composer,r=e.writable,n=e.name,o=t.gl,s=t._errorCallback,u=e.type,l=u;if(f(t,u)&&(l===i.UNSIGNED_BYTE||l===i.BYTE?l=i.HALF_FLOAT:(console.warn("Falling back ".concat(l,' type to FLOAT type for glsl1.x support for GPULayer "').concat(n,'".\nLarge UNSIGNED_INT or INT with absolute value > 16,777,216 are not supported, on mobile UNSIGNED_INT, INT, UNSIGNED_SHORT, and SHORT with absolute value > 2,048 may not be supported.')),l=i.FLOAT)),(0,c.isWebGL2)(o)){if(r){if(l===i.FLOAT)if((0,a.getExtension)(t,a.EXT_COLOR_BUFFER_FLOAT,!0))p(t,l)||(console.warn('FLOAT not supported for writing operations in this browser, falling back to HALF_FLOAT type for GPULayer "'.concat(n,'".')),l=i.HALF_FLOAT);else console.warn('FLOAT not supported in this browser, falling back to HALF_FLOAT type for GPULayer "'.concat(n,'".')),l=i.HALF_FLOAT;if(l===i.HALF_FLOAT)(0,a.getExtension)(t,a.EXT_COLOR_BUFFER_HALF_FLOAT,!0)||(0,a.getExtension)(t,a.EXT_COLOR_BUFFER_FLOAT),p(t,l)||s("This browser does not support rendering to HALF_FLOAT textures.")}}else{if(l===i.FLOAT)if((0,a.getExtension)(t,a.OES_TEXTURE_FLOAT,!0)){if(r){p(t,l)||(console.warn('FLOAT not supported for writing operations in this browser, falling back to HALF_FLOAT type for GPULayer "'.concat(n,'".')),l=i.HALF_FLOAT)}}else console.warn('FLOAT not supported in this browser, falling back to HALF_FLOAT type for GPULayer "'.concat(n,'".')),l=i.HALF_FLOAT;if(l===i.HALF_FLOAT)if((0,a.getExtension)(t,a.OES_TEXTURE_HALF_FLOAT),r)p(t,l)||s("This browser does not support rendering to HALF_FLOAT textures.")}return l},t.minMaxValuesForType=d,t.validateGPULayerArray=function(e,t){var r=t.numComponents,o=t.width,a=t.height,s=t.name,c=t._glNumChannels,u=t._internalType,f=t.is1D()?t.length:null;if(e.length!==o*a*r&&(!f||f&&e.length!==f*r))throw new Error("Invalid data length: ".concat(e.length,' for GPULayer "').concat(s,'" of ').concat(f?"length ".concat(f," and "):"","dimensions: [").concat(o,", ").concat(a,"] and numComponents: ").concat(r,"."));var _=!1;switch(e.constructor){case Array:_=!0;break;case Float32Array:_=u!==i.FLOAT;break;case Uint8Array:_=u!==i.UNSIGNED_BYTE;break;case Int8Array:_=u!==i.BYTE;break;case Uint16Array:_=u!==i.UNSIGNED_SHORT;break;case Int16Array:_=u!==i.SHORT;break;case Uint32Array:_=u!==i.UNSIGNED_INT;break;case Int32Array:_=u!==i.INT;break;default:throw new Error("Invalid array type: ".concat(e.constructor.name,' for GPULayer "').concat(s,'", please use one of [').concat(i.validArrayTypes.map((function(e){return e.name})).join(", "),"]."))}var p=d(u),h=p.min,g=p.max,m=o*a*c,v=e.length!==m,T=e;if(_||v){T=l(u,m);for(var E=u===i.HALF_FLOAT&&_?new DataView(T.buffer):null,A=0,I=e.length/r;A<I;A++)for(var y=0;y<r;y++){var R=e[A*r+y],U=R,O=!1;U<h?(U=h,O=!0):U>g&&(U=g,O=!0),O&&console.warn("Clipping out of range value ".concat(R," to ").concat(U,' for GPULayer "').concat(s,'" with internal type ').concat(u,"."));var L=A*c+y;E?(0,n.setFloat16)(E,2*L,U,!0):T[L]=U}}return T}},664:function(e,t,r){"use strict";var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},n.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.GPUProgram=void 0;var o=r(707),i=r(601),a=r(593),s=r(360),c=function(){function e(e,t){var r=this;this._fragmentShaders={},this._defines={},this._uniforms={},this._programs={},this._programsKeyLookup=new WeakMap,this._samplerUniformsIndices=[];var i=(t||{}).name;if(!e)throw new Error('Error initing GPUProgram "'.concat(i,'": must pass GPUComposer instance to GPUProgram(composer, params).'));if(!t)throw new Error("Error initing GPUProgram: must pass params to GPUProgram(composer, params).");if(!(0,o.isObject)(t))throw new Error("Error initing GPUProgram: must pass valid params object to GPUProgram(composer, params), got ".concat(JSON.stringify(t),"."));var s=["name","fragmentShader","uniforms","defines"],c=Object.keys(t);c.forEach((function(e){if(s.indexOf(e)<0)throw new Error('Invalid params key "'.concat(e,'" passed to GPUProgram(composer, params) with name "').concat(i,'".  Valid keys are ').concat(JSON.stringify(s),"."))})),["name","fragmentShader"].forEach((function(e){if(c.indexOf(e)<0)throw new Error('Required params key "'.concat(e,'" was not passed to GPUProgram(composer, params) with name "').concat(i,'".'))}));var u=t.fragmentShader,l=t.uniforms,f=t.defines;this._composer=e,this.name=i;var _=(0,o.isString)(u)?u:u.join("\n"),p=(0,a.preprocessFragmentShader)(_,e.glslVersion,i),h=p.shaderSource,d=p.samplerUniforms;if(this._fragmentShaderSource=h,d.forEach((function(e,t){r._samplerUniformsIndices.push({name:e,inputIndex:0,shaderIndex:t})})),f&&(this._defines=n({},f)),l)for(var g=0;g<l.length;g++){var m=l[g],v=m.name,T=m.value,E=m.type;this.setUniform(v,T,E)}}return e.prototype._getFragmentShader=function(e,t){var r=this._fragmentShaders;if(r[e])return r[e];for(var n=this,o=n._composer,i=n.name,s=n._fragmentShaderSource,c=n._defines,u=o.gl,l=o._errorCallback,f=o.verboseLogging,_=o.glslVersion,p=o.floatPrecision,h=o.intPrecision,d=Object.keys(t),g=0;g<d.length;g++){var m=d[g];c[m]=t[m]}f&&console.log('Compiling fragment shader for GPUProgram "'.concat(i,'" with defines: ').concat(JSON.stringify(c)));var v=(0,a.compileShader)(u,_,h,p,s,u.FRAGMENT_SHADER,i,l,c,0===Object.keys(r).length);if(v)return r[e]=v,r[e];l('Unable to compile fragment shader for GPUProgram "'.concat(i,'".'))},e.prototype._getProgramWithName=function(e,t,r){for(var n=this._samplerUniformsIndices,o="",c={},u=0,l=n.length;u<l;u++){var f=r[n[u].inputIndex].layer,_=f.filter,p=f.wrapS,h=f.wrapT,d=f._internalFilter,g=f._internalWrapS,m=f._internalWrapT,v=p===g?0:p===i.REPEAT?1:0,T=h===m?0:h===i.REPEAT?1:0,E=_===d?0:_===i.LINEAR?1:0;o+="_IN".concat(u,"_").concat(v,"_").concat(T,"_").concat(E),c["".concat(s.SAMPLER2D_WRAP_X).concat(u)]="".concat(v),c["".concat(s.SAMPLER2D_WRAP_Y).concat(u)]="".concat(T),c["".concat(s.SAMPLER2D_FILTER).concat(u)]="".concat(E)}var A=Object.keys(t).map((function(e){return"_".concat(e,"_").concat(t[e])})).join(),I="".concat(e).concat(A).concat(o);if(this._programs[I])return this._programs[I];var y=this,R=y._composer,U=y._uniforms,O=y._programs,L=y._programsKeyLookup,P=R.gl,F=R._errorCallback,b=R._getVertexShader(e,A,t,this.name);if(void 0!==b){var N=this._getFragmentShader(o,c);if(void 0!==N){var w=(0,a.initGLProgram)(P,b,N,this.name,F);if(void 0===w)return P.deleteShader(N),void F('Unable to init program "'.concat(I,'" for GPUProgram "').concat(this.name,'".'));P.useProgram(w);var S=Object.keys(U);for(u=0;u<S.length;u++){var G=S[u],x=U[G],M=x.value,D=x.type;this._setProgramUniform(w,I,G,M,D)}return O[I]=w,L.set(w,I),w}F('Unable to init fragment shader "'.concat(o,'" for GPUProgram "').concat(this.name,'".'))}else F('Unable to init vertex shader "'.concat(e).concat(A,'" for GPUProgram "').concat(this.name,'".'))},e.prototype._setProgramUniform=function(e,t,r,n,a){var s,c=this._composer,u=this._uniforms,l=c.gl,f=c._errorCallback,_=c.glslVersion===i.GLSL3,p=null===(s=u[r])||void 0===s?void 0:s.location[t];if(void 0===p){var h=l.getUniformLocation(e,r);if(null===h)return void console.warn('Could not init uniform "'.concat(r,'" for program "').concat(this.name,'". Check that uniform is present in shader code, unused uniforms may be removed by compiler. Also check that uniform type in shader code matches type ').concat(a,". Error code: ").concat(l.getError(),"."));p=h,u[r]&&(u[r].location[t]=p);var d=l.getUniform(e,p),g=!1;if(a===i.BOOL_1D_UNIFORM||a===i.BOOL_2D_UNIFORM||a===i.BOOL_3D_UNIFORM||a===i.BOOL_4D_UNIFORM?(0,o.isBoolean)(d)||d.constructor===Array||(g=!0):a===i.FLOAT_1D_UNIFORM||a===i.FLOAT_2D_UNIFORM||a===i.FLOAT_3D_UNIFORM||a===i.FLOAT_4D_UNIFORM?(0,o.isNumber)(d)||d.constructor===Float32Array||(g=!0):a===i.INT_1D_UNIFORM||a===i.INT_2D_UNIFORM||a===i.INT_3D_UNIFORM||a===i.INT_4D_UNIFORM?(0,o.isInteger)(d)||d.constructor===Int32Array||(g=!0):a!==i.UINT_1D_UNIFORM&&a!==i.UINT_2D_UNIFORM&&a!==i.UINT_3D_UNIFORM&&a!==i.UINT_4D_UNIFORM||(_?(0,o.isNonNegativeInteger)(d)||d.constructor===Uint32Array||(g=!0):(0,o.isNonNegativeInteger)(d)||d.constructor===Int32Array||(g=!0)),g)return void f('Invalid uniform "'.concat(r,'" for program "').concat(this.name,'". Check that uniform type in shader code matches type ').concat(a,", gl.getUniform(program, location) returned type: ").concat(d.constructor.name,"."))}switch(a){case i.BOOL_1D_UNIFORM:l.uniform1i(p,n?1:0);break;case i.BOOL_2D_UNIFORM:l.uniform2i(p,n[0]?1:0,n[1]?1:0);break;case i.BOOL_3D_UNIFORM:l.uniform3i(p,n[0]?1:0,n[1]?1:0,n[2]?1:0);break;case i.BOOL_4D_UNIFORM:l.uniform4i(p,n[0]?1:0,n[1]?1:0,n[2]?1:0,n[3]?1:0);break;case i.FLOAT_1D_UNIFORM:l.uniform1f(p,n);break;case i.FLOAT_2D_UNIFORM:l.uniform2fv(p,n);break;case i.FLOAT_3D_UNIFORM:l.uniform3fv(p,n);break;case i.FLOAT_4D_UNIFORM:l.uniform4fv(p,n);break;case i.INT_1D_UNIFORM:l.uniform1i(p,n);break;case i.INT_2D_UNIFORM:l.uniform2iv(p,n);break;case i.INT_3D_UNIFORM:l.uniform3iv(p,n);break;case i.INT_4D_UNIFORM:l.uniform4iv(p,n);break;case i.UINT_1D_UNIFORM:_?l.uniform1ui(p,n):l.uniform1i(p,n);break;case i.UINT_2D_UNIFORM:_?l.uniform2uiv(p,n):l.uniform2iv(p,n);break;case i.UINT_3D_UNIFORM:_?l.uniform3uiv(p,n):l.uniform3iv(p,n);break;case i.UINT_4D_UNIFORM:_?l.uniform4uiv(p,n):l.uniform4iv(p,n);break;default:throw new Error("Unknown uniform type ".concat(a,' for GPUProgram "').concat(this.name,'".'))}},e.prototype.setUniform=function(e,t,r){var n,s=this,c=s._programs,u=s._uniforms,l=s._composer,f=s._samplerUniformsIndices,_=l.verboseLogging,p=l.gl;if((0,o.isArray)(t)&&t.length>4)throw new Error("Invalid uniform value: [".concat(t.join(", "),'] passed to GPUProgram "').concat(this.name,', uniforms must be of type number[] with length <= 4, number, or boolean."'));var h=null===(n=u[e])||void 0===n?void 0:n.type;if(r){var d=(0,a.uniformInternalTypeForValue)(t,r,e,this.name);if(void 0===h)h=d;else if(h!==d)throw new Error('Uniform "'.concat(e,'" for GPUProgram "').concat(this.name,'" cannot change from type ').concat(h," to type ").concat(d,"."))}if(void 0===h)throw new Error('Unknown type for uniform "'.concat(e,'", please pass in type to GPUProgram.setUniform(name, value, type) when initing a new uniform.'));if(u[e]){if((0,o.isArray)(t)){for(var g=!0,m=0;m<t.length;m++)if(u[e].value!==t){g=!0;break}if(!g)return}else if(u[e].value===t)return;u[e].value=t}else u[e]={type:h,location:{},value:t};var v=f.find((function(t){return t.name===e}));v&&h===i.INT_1D_UNIFORM&&(v.inputIndex=t),_&&console.log('Setting uniform "'.concat(e,'" for program "').concat(this.name,'" to value ').concat(JSON.stringify(t)," with type ").concat(h,"."));var T=Object.keys(c);for(m=0;m<T.length;m++){var E=T[m],A=c[E];p.useProgram(A),this._setProgramUniform(A,E,e,t,h)}},e.prototype._setInternalFragmentUniforms=function(e,t){if(0!==t.length){if(!e)throw new Error("Must pass in valid WebGLProgram to GPUProgram._setInternalFragmentUniforms, got undefined.");var r=this._programsKeyLookup,n=this._samplerUniformsIndices,o=r.get(e);if(!o)throw new Error('Could not find valid programName for WebGLProgram in GPUProgram "'.concat(this.name,'".'));for(var a=new Array(n.length).fill(-1),c=0,u=n.length;c<u;c++){var l=n[c],f=l.inputIndex,_=l.shaderIndex;a[f]>=0?console.warn("Found > 1 sampler2D uniforms at texture index ".concat(f,' for GPUProgram "').concat(this.name,'".')):a[f]=_}c=0;for(var p=t.length;c<p;c++){var h=t[c].layer,d=h.width,g=h.height,m=a[c];if(!(m<0)){var v=h.filter,T=h.wrapS,E=h.wrapT,A=h._internalFilter,I=h._internalWrapS,y=h._internalWrapT,R=v!==A;if(R||T!==I||E!==y){var U=[.5/d,.5/g],O="".concat(s.SAMPLER2D_HALF_PX_UNIFORM).concat(m);if(this._setProgramUniform(e,o,O,U,i.FLOAT_2D_UNIFORM),R){var L=[d,g],P="".concat(s.SAMPLER2D_DIMENSIONS_UNIFORM).concat(m);this._setProgramUniform(e,o,P,L,i.FLOAT_2D_UNIFORM)}}}}}},e.prototype._setVertexUniform=function(e,t,r,n){if(!e)throw new Error("Must pass in valid WebGLProgram to GPUProgram._setVertexUniform, got undefined.");var o=this._programsKeyLookup.get(e);if(!o)throw new Error('Could not find valid programName for WebGLProgram in GPUProgram "'.concat(this.name,'".'));var i=(0,a.uniformInternalTypeForValue)(r,n,t,this.name);this._setProgramUniform(e,o,t,r,i)},e.prototype.dispose=function(){var e=this,t=this,r=t._composer,n=t._fragmentShaders,o=t._programs,i=t._programsKeyLookup,a=r.gl;if(r.verboseLogging&&console.log('Deallocating GPUProgram "'.concat(this.name,'".')),!a)throw new Error("Must call dispose() on all GPUPrograms before calling dispose() on GPUComposer.");Object.values(o).forEach((function(e){e&&(a.deleteProgram(e),i.delete(e))})),Object.keys(o).forEach((function(t){delete e._programs[t]})),Object.values(n).forEach((function(e){a.deleteShader(e)})),delete this._fragmentShaders,delete this._composer,delete this.name,delete this._fragmentShaderSource,delete this._defines,delete this._uniforms,delete this._programs,delete this._programsKeyLookup,delete this._samplerUniformsIndices},e}();t.GPUProgram=c},404:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Vector4=void 0;var r=function(){function e(e,t,r,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=0),void 0===n&&(n=1),this.x=e,this.y=t,this.z=r,this.w=n}return Object.defineProperty(e.prototype,"width",{get:function(){return this.z},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.w},enumerable:!1,configurable:!0}),e.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},e}();t.Vector4=r},707:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isBoolean=t.isObject=t.isArray=t.isString=t.isNonNegativeInteger=t.isPositiveInteger=t.isInteger=t.isNumber=t.isNumberOfType=t.isValidClearValue=t.isValidTextureType=t.isValidTextureFormat=t.isValidWrap=t.isValidFilter=t.isValidDataType=void 0;var n=r(601);function o(e,t){switch(t){case n.HALF_FLOAT:case n.FLOAT:return i(e);case n.BYTE:return!(e<-128)&&(!(e>127)&&a(e));case n.SHORT:return!(e<-32768)&&(!(e>32767)&&a(e));case n.INT:return!(e<-2147483648)&&(!(e>2147483647)&&a(e));case n.UNSIGNED_BYTE:return!(e>255)&&s(e);case n.UNSIGNED_SHORT:return!(e>65535)&&s(e);case n.UNSIGNED_INT:return!(e>4294967295)&&s(e);default:throw new Error("Unknown type ".concat(t))}}function i(e){return!Number.isNaN(e)&&"number"==typeof e&&Number.isFinite(e)}function a(e){return i(e)&&e%1==0}function s(e){return a(e)&&e>=0}function c(e){return Array.isArray(e)}t.isValidDataType=function(e){return n.validDataTypes.indexOf(e)>-1},t.isValidFilter=function(e){return n.validFilters.indexOf(e)>-1},t.isValidWrap=function(e){return n.validWraps.indexOf(e)>-1},t.isValidTextureFormat=function(e){return n.validTextureFormats.indexOf(e)>-1},t.isValidTextureType=function(e){return n.validTextureTypes.indexOf(e)>-1},t.isValidClearValue=function(e,t,r){if(c(e)){if(e.length!==t)return!1;for(var n=0;n<e.length;n++)if(!o(e[n],r))return!1}else if(!o(e,r))return!1;return!0},t.isNumberOfType=o,t.isNumber=i,t.isInteger=a,t.isPositiveInteger=function(e){return a(e)&&e>0},t.isNonNegativeInteger=s,t.isString=function(e){return"string"==typeof e},t.isArray=c,t.isObject=function(e){return"object"==typeof e&&!c(e)&&null!==e},t.isBoolean=function(e){return"boolean"==typeof e}},601:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LAYER_LINES_PROGRAM_NAME=t.LAYER_POINTS_PROGRAM_NAME=t.SEGMENT_PROGRAM_NAME=t.DEFAULT_PROGRAM_NAME=t.BOOL_4D_UNIFORM=t.BOOL_3D_UNIFORM=t.BOOL_2D_UNIFORM=t.BOOL_1D_UNIFORM=t.UINT_4D_UNIFORM=t.UINT_3D_UNIFORM=t.UINT_2D_UNIFORM=t.UINT_1D_UNIFORM=t.INT_4D_UNIFORM=t.INT_3D_UNIFORM=t.INT_2D_UNIFORM=t.INT_1D_UNIFORM=t.FLOAT_4D_UNIFORM=t.FLOAT_3D_UNIFORM=t.FLOAT_2D_UNIFORM=t.FLOAT_1D_UNIFORM=t.PRECISION_HIGH_P=t.PRECISION_MEDIUM_P=t.PRECISION_LOW_P=t.EXPERIMENTAL_WEBGL=t.WEBGL1=t.WEBGL2=t.GLSL1=t.GLSL3=t.validTextureTypes=t.validTextureFormats=t.RGBA=t.RGB=t.validWraps=t.validFilters=t.validDataTypes=t.validArrayTypes=t.REPEAT=t.CLAMP_TO_EDGE=t.LINEAR=t.NEAREST=t.UINT=t.BOOL=t.INT=t.UNSIGNED_INT=t.SHORT=t.UNSIGNED_SHORT=t.BYTE=t.UNSIGNED_BYTE=t.FLOAT=t.HALF_FLOAT=void 0,t.MAX_FLOAT_INT=t.MIN_FLOAT_INT=t.MAX_HALF_FLOAT_INT=t.MIN_HALF_FLOAT_INT=t.MAX_INT=t.MIN_INT=t.MAX_UNSIGNED_INT=t.MIN_UNSIGNED_INT=t.MAX_SHORT=t.MIN_SHORT=t.MAX_UNSIGNED_SHORT=t.MIN_UNSIGNED_SHORT=t.MAX_BYTE=t.MIN_BYTE=t.MAX_UNSIGNED_BYTE=t.MIN_UNSIGNED_BYTE=t.DEFAULT_CIRCLE_NUM_SEGMENTS=t.DEFAULT_ERROR_CALLBACK=t.GPUIO_VS_POSITION_W_ACCUM=t.GPUIO_VS_NORMAL_ATTRIBUTE=t.GPUIO_VS_WRAP_Y=t.GPUIO_VS_WRAP_X=t.GPUIO_VS_UV_ATTRIBUTE=t.LAYER_VECTOR_FIELD_PROGRAM_NAME=void 0,t.HALF_FLOAT="HALF_FLOAT",t.FLOAT="FLOAT",t.UNSIGNED_BYTE="UNSIGNED_BYTE",t.BYTE="BYTE",t.UNSIGNED_SHORT="UNSIGNED_SHORT",t.SHORT="SHORT",t.UNSIGNED_INT="UNSIGNED_INT",t.INT="INT",t.BOOL="BOOL",t.UINT="UINT",t.NEAREST="NEAREST",t.LINEAR="LINEAR",t.CLAMP_TO_EDGE="CLAMP_TO_EDGE",t.REPEAT="REPEAT",t.validArrayTypes=[Float32Array,Uint8Array,Int8Array,Uint16Array,Int16Array,Uint32Array,Int32Array,Array],t.validDataTypes=[t.HALF_FLOAT,t.FLOAT,t.UNSIGNED_BYTE,t.BYTE,t.UNSIGNED_SHORT,t.SHORT,t.UNSIGNED_INT,t.INT],t.validFilters=[t.NEAREST,t.LINEAR],t.validWraps=[t.CLAMP_TO_EDGE,t.REPEAT],t.RGB="RGB",t.RGBA="RGBA",t.validTextureFormats=[t.RGB,t.RGBA],t.validTextureTypes=[t.UNSIGNED_BYTE],t.GLSL3="300 es",t.GLSL1="100",t.WEBGL2="webgl2",t.WEBGL1="webgl",t.EXPERIMENTAL_WEBGL="experimental-webgl",t.PRECISION_LOW_P="lowp",t.PRECISION_MEDIUM_P="mediump",t.PRECISION_HIGH_P="highp",t.FLOAT_1D_UNIFORM="FLOAT_1D_UNIFORM",t.FLOAT_2D_UNIFORM="FLOAT_2D_UNIFORM",t.FLOAT_3D_UNIFORM="FLOAT_3D_UNIFORM",t.FLOAT_4D_UNIFORM="FLOAT_4D_UNIFORM",t.INT_1D_UNIFORM="INT_1D_UNIFORM",t.INT_2D_UNIFORM="INT_2D_UNIFORM",t.INT_3D_UNIFORM="INT_3D_UNIFORM",t.INT_4D_UNIFORM="INT_4D_UNIFORM",t.UINT_1D_UNIFORM="UINT_1D_UNIFORM",t.UINT_2D_UNIFORM="UINT_2D_UNIFORM",t.UINT_3D_UNIFORM="UINT_3D_UNIFORM",t.UINT_4D_UNIFORM="UINT_4D_UNIFORM",t.BOOL_1D_UNIFORM="BOOL_1D_UNIFORM",t.BOOL_2D_UNIFORM="BOOL_2D_UNIFORM",t.BOOL_3D_UNIFORM="BOOL_3D_UNIFORM",t.BOOL_4D_UNIFORM="BOOL_4D_UNIFORM",t.DEFAULT_PROGRAM_NAME="DEFAULT",t.SEGMENT_PROGRAM_NAME="SEGMENT",t.LAYER_POINTS_PROGRAM_NAME="LAYER_POINTS",t.LAYER_LINES_PROGRAM_NAME="LAYER_LINES",t.LAYER_VECTOR_FIELD_PROGRAM_NAME="LAYER_VECTOR_FIELD",t.GPUIO_VS_UV_ATTRIBUTE="GPUIO_VS_UV_ATTRIBUTE",t.GPUIO_VS_WRAP_X="GPUIO_VS_WRAP_X",t.GPUIO_VS_WRAP_Y="GPUIO_VS_WRAP_Y",t.GPUIO_VS_NORMAL_ATTRIBUTE="GPUIO_VS_NORMAL_ATTRIBUTE",t.GPUIO_VS_POSITION_W_ACCUM="GPUIO_VS_POSITION_W_ACCUM";t.DEFAULT_ERROR_CALLBACK=function(e){throw new Error(e)},t.DEFAULT_CIRCLE_NUM_SEGMENTS=18,t.MIN_UNSIGNED_BYTE=0,t.MAX_UNSIGNED_BYTE=Math.pow(2,8)-1,t.MIN_BYTE=-Math.pow(2,7),t.MAX_BYTE=Math.pow(2,7)-1,t.MIN_UNSIGNED_SHORT=0,t.MAX_UNSIGNED_SHORT=Math.pow(2,16)-1,t.MIN_SHORT=-Math.pow(2,15),t.MAX_SHORT=Math.pow(2,15)-1,t.MIN_UNSIGNED_INT=0,t.MAX_UNSIGNED_INT=Math.pow(2,32)-1,t.MIN_INT=-Math.pow(2,31),t.MAX_INT=Math.pow(2,31)-1,t.MIN_HALF_FLOAT_INT=-2048,t.MAX_HALF_FLOAT_INT=2048,t.MIN_FLOAT_INT=-16777216,t.MAX_FLOAT_INT=16777216},581:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getExtension=t.EXT_COLOR_BUFFER_HALF_FLOAT=t.EXT_COLOR_BUFFER_FLOAT=t.WEBGL_DEPTH_TEXTURE=t.OES_TEXTURE_HAlF_FLOAT_LINEAR=t.OES_TEXTURE_FLOAT_LINEAR=t.OES_TEXTURE_HALF_FLOAT=t.OES_TEXTURE_FLOAT=void 0,t.OES_TEXTURE_FLOAT="OES_texture_float",t.OES_TEXTURE_HALF_FLOAT="OES_texture_half_float",t.OES_TEXTURE_FLOAT_LINEAR="OES_texture_float_linear",t.OES_TEXTURE_HAlF_FLOAT_LINEAR="OES_texture_half_float_linear",t.WEBGL_DEPTH_TEXTURE="WEBGL_depth_texture",t.EXT_COLOR_BUFFER_FLOAT="EXT_color_buffer_float",t.EXT_COLOR_BUFFER_HALF_FLOAT="EXT_color_buffer_half_float",t.getExtension=function(e,t,r){if(void 0===r&&(r=!1),void 0!==e._extensions[t])return e._extensions[t];var n,o=e.gl,i=e._errorCallback,a=e._extensions;e.verboseLogging;try{n=o.getExtension(t)}catch(e){}return n?(a[t]=n,e.verboseLogging&&console.log("Loaded extension: ".concat(t,"."))):(a[t]=!1,e.verboseLogging&&console.log("Unsupported ".concat(r?"optional ":"","extension: ").concat(t,"."))),n||r||i("Required extension unsupported by this device / browser: ".concat(t,".")),n}},607:function(e,t,r){"use strict";var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},n.apply(this,arguments)},o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t._testing=t.getFragmentShaderMediumpPrecision=t.getVertexShaderMediumpPrecision=t.isHighpSupportedInFragmentShader=t.isHighpSupportedInVertexShader=t.isWebGL2Supported=t.isWebGL2=t.GPUProgram=t.GPULayer=t.GPUComposer=void 0;var a=r(593),s=r(484);Object.defineProperty(t,"GPUComposer",{enumerable:!0,get:function(){return s.GPUComposer}});var c=r(355);Object.defineProperty(t,"GPULayer",{enumerable:!0,get:function(){return c.GPULayer}});var u=r(664);Object.defineProperty(t,"GPUProgram",{enumerable:!0,get:function(){return u.GPUProgram}});var l=r(707),f=r(191),_=r(126),p=r(581),h=r(360),d=n(n(n(n(n({isFloatType:a.isFloatType,isUnsignedIntType:a.isUnsignedIntType,isSignedIntType:a.isSignedIntType,isIntType:a.isIntType,makeShaderHeader:a.makeShaderHeader,compileShader:a.compileShader,initGLProgram:a.initGLProgram,readyToRead:a.readyToRead,preprocessVertexShader:a.preprocessVertexShader,preprocessFragmentShader:a.preprocessFragmentShader,isPowerOf2:a.isPowerOf2,initSequentialFloatArray:a.initSequentialFloatArray,uniformInternalTypeForValue:a.uniformInternalTypeForValue},p),_),l),f),h);t._testing=d,i(r(601),t);var g=a.isWebGL2,m=a.isWebGL2Supported,v=a.isHighpSupportedInVertexShader,T=a.isHighpSupportedInFragmentShader,E=a.getVertexShaderMediumpPrecision,A=a.getFragmentShaderMediumpPrecision;t.isWebGL2=g,t.isWebGL2Supported=m,t.isHighpSupportedInVertexShader=v,t.isHighpSupportedInFragmentShader=T,t.getVertexShaderMediumpPrecision=E,t.getFragmentShaderMediumpPrecision=A},360:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GLSL1_POLYFILLS=t.texturePolyfill=t.SAMPLER2D_DIMENSIONS_UNIFORM=t.SAMPLER2D_HALF_PX_UNIFORM=t.SAMPLER2D_FILTER=t.SAMPLER2D_WRAP_Y=t.SAMPLER2D_WRAP_X=void 0;var n=r(126);t.SAMPLER2D_WRAP_X="GPUIO_WRAP_X",t.SAMPLER2D_WRAP_Y="GPUIO_WRAP_Y",t.SAMPLER2D_FILTER="GPUIO_FILTER",t.SAMPLER2D_HALF_PX_UNIFORM="u_gpuio_half_px",t.SAMPLER2D_DIMENSIONS_UNIFORM="u_gpuio_dimensions",t.texturePolyfill=function(e){var r=e.match(/\btexture\(/g);if(!r||0===r.length)return{shaderSource:e,samplerUniforms:[]};var o=(0,n.getSampler2DsInProgram)(e);if(0===o.length)return{shaderSource:e,samplerUniforms:o};o.forEach((function(t,r){var n=new RegExp("\\btexture\\(\\s?".concat(t,"\\b"),"gs");e=e.replace(n,"GPUIO_TEXTURE_POLYFILL".concat(r,"(").concat(t))}));var i=e.match(/\btexture\(/g);(null==i?void 0:i.length)&&console.warn("Fragment shader polyfill has missed some calls to texture().",e);for(var a={},s={},c=0;c<o.length;c++)a["".concat(t.SAMPLER2D_HALF_PX_UNIFORM).concat(c)]="vec2",a["".concat(t.SAMPLER2D_DIMENSIONS_UNIFORM).concat(c)]="vec2",s["".concat(t.SAMPLER2D_WRAP_X).concat(c)]="0",s["".concat(t.SAMPLER2D_WRAP_Y).concat(c)]="0",s["".concat(t.SAMPLER2D_FILTER).concat(c)]="0";function u(e,r){return"\n".concat(r,"vec4 GPUIO_TEXTURE_POLYFILL").concat(e,"(const ").concat(r,"sampler2D sampler, vec2 uv) {\n\t#if (").concat(t.SAMPLER2D_FILTER).concat(e," == 0)\n\t\t#if (").concat(t.SAMPLER2D_WRAP_X).concat(e," == 0)\n\t\t\t#if (").concat(t.SAMPLER2D_WRAP_Y).concat(e," == 0)\n\t\t\t\treturn texture(sampler, uv);\n\t\t\t#else\n\t\t\t\treturn GPUIO_TEXTURE_WRAP_CLAMP_REPEAT(sampler, uv, ").concat(t.SAMPLER2D_HALF_PX_UNIFORM).concat(e,");\n\t\t\t#endif\n\t\t#else\n\t\t\t#if (").concat(t.SAMPLER2D_WRAP_Y).concat(e," == 0)\n\t\t\t\treturn GPUIO_TEXTURE_WRAP_REPEAT_CLAMP(sampler, uv, ").concat(t.SAMPLER2D_HALF_PX_UNIFORM).concat(e,");\n\t\t\t#else\n\t\t\t\treturn GPUIO_TEXTURE_WRAP_REPEAT_REPEAT(sampler, uv, ").concat(t.SAMPLER2D_HALF_PX_UNIFORM).concat(e,");\n\t\t\t#endif\n\t\t#endif\n\t#else\n\t\t#if (").concat(t.SAMPLER2D_WRAP_X).concat(e," == 0)\n\t\t\t#if (").concat(t.SAMPLER2D_WRAP_Y).concat(e," == 0)\n\t\t\t\treturn GPUIO_TEXTURE_BILINEAR_INTERP(sampler, uv, ").concat(t.SAMPLER2D_HALF_PX_UNIFORM).concat(e,", ").concat(t.SAMPLER2D_DIMENSIONS_UNIFORM).concat(e,");\n\t\t\t#else\n\t\t\t\treturn GPUIO_TEXTURE_BILINEAR_INTERP_WRAP_CLAMP_REPEAT(sampler, uv, ").concat(t.SAMPLER2D_HALF_PX_UNIFORM).concat(e,", ").concat(t.SAMPLER2D_DIMENSIONS_UNIFORM).concat(e,");\n\t\t\t#endif\n\t\t#else\n\t\t\t#if (").concat(t.SAMPLER2D_WRAP_Y).concat(e," == 0)\n\t\t\t\treturn GPUIO_TEXTURE_BILINEAR_INTERP_WRAP_REPEAT_CLAMP(sampler, uv, ").concat(t.SAMPLER2D_HALF_PX_UNIFORM).concat(e,", ").concat(t.SAMPLER2D_DIMENSIONS_UNIFORM).concat(e,");\n\t\t\t#else\n\t\t\t\treturn GPUIO_TEXTURE_BILINEAR_INTERP_WRAP_REPEAT_REPEAT(sampler, uv, ").concat(t.SAMPLER2D_HALF_PX_UNIFORM).concat(e,", ").concat(t.SAMPLER2D_DIMENSIONS_UNIFORM).concat(e,");\n\t\t\t#endif\n\t\t#endif\n\t#endif\n}\n")}function l(e){return"\n".concat(e,"vec4 GPUIO_TEXTURE_WRAP_REPEAT_REPEAT(const ").concat(e,"sampler2D sampler, vec2 uv, const vec2 halfPx) {\n\treturn texture(sampler, GPUIO_WRAP_REPEAT_UV(uv));\n}\n").concat(e,"vec4 GPUIO_TEXTURE_WRAP_REPEAT_CLAMP(const ").concat(e,"sampler2D sampler, vec2 uv, const vec2 halfPx) {\n\tuv.x = GPUIO_WRAP_REPEAT_UV_COORD(uv.x);\n\t// uv.y = GPUIO_WRAP_CLAMP_UV_COORD(uv.y, halfPx.y);\n\treturn texture(sampler, uv);\n}\n").concat(e,"vec4 GPUIO_TEXTURE_WRAP_CLAMP_REPEAT(const ").concat(e,"sampler2D sampler, vec2 uv, const vec2 halfPx) {\n\t// uv.x = GPUIO_WRAP_CLAMP_UV_COORD(uv.x, halfPx.x);\n\tuv.y = GPUIO_WRAP_REPEAT_UV_COORD(uv.y);\n\treturn texture(sampler, uv);\n}\n")}return{shaderSource:e="\n".concat(Object.keys(a).map((function(e){return"uniform ".concat(a[e]," ").concat(e,";")})).join("\n"),"\n\nfloat GPUIO_WRAP_REPEAT_UV_COORD(float coord) {\n\treturn fract(coord + ceil(abs(coord)));\n}\nvec2 GPUIO_WRAP_REPEAT_UV(vec2 uv) {\n\treturn fract(uv + ceil(abs(uv)));\n}\n// float GPUIO_WRAP_CLAMP_UV_COORD(float coord, const float halfPx) {\n// \treturn clamp(coord, halfPx, 1.0 - halfPx);\n// }\n\n").concat(l(""),"\n#if (__VERSION__ == 300)\n").concat(["u","i"].map((function(e){return l(e)})).join("\n"),"\n#endif\n\n").concat([null,"REPEAT_REPEAT","REPEAT_CLAMP","CLAMP_REPEAT"].map((function(e){return r=(t=e)?"GPUIO_TEXTURE_WRAP_".concat(t):"texture",n=t?", halfPx":"","\nvec4 GPUIO_TEXTURE_BILINEAR_INTERP".concat(t?"_WRAP_".concat(t):"","(const sampler2D sampler, vec2 uv, const vec2 halfPx, const vec2 dimensions) {\n\tvec2 pxFraction = fract(uv * dimensions);\n\tvec2 offset = halfPx - vec2(0.00001, 0.00001) * max(\n\t\t\tstep(abs(pxFraction.x - 0.5), 0.001),\n\t\t\tstep(abs(pxFraction.y - 0.5), 0.001)\n\t\t);\n\tvec2 baseUV = uv - offset;\n\tvec2 diagOffset = vec2(offset.x, -offset.y);\n\tvec4 minmin = ").concat(r,"(sampler, baseUV").concat(n,");\n\tvec4 maxmin = ").concat(r,"(sampler, uv + diagOffset").concat(n,");\n\tvec4 minmax = ").concat(r,"(sampler, uv - diagOffset").concat(n,");\n\tvec4 maxmax = ").concat(r,"(sampler, uv + offset").concat(n,");\n\tvec2 t = fract(baseUV * dimensions);\n\tvec4 yMin = mix(minmin, maxmin, t.x);\n\tvec4 yMax = mix(minmax, maxmax, t.x);\n\treturn mix(yMin, yMax, t.y);\n}\n");var t,r,n})).join("\n"),"\n\n").concat(o.map((function(e,t){return u(t,"")})).join("\n"),"\n#if (__VERSION__ == 300)\n").concat(["u","i"].map((function(e){return o.map((function(t,r){return u(r,e)})).join("\n")})).join("\n"),"\n#endif\n\n").concat(e),samplerUniforms:o}},t.GLSL1_POLYFILLS=function(){function e(e){switch(e){case"int":return"float";case"ivec2":return"vec2";case"ivec3":return"vec3";case"ivec4":return"vec4"}throw new Error("Unknown type ".concat(e,"."))}var t=function(t){return"".concat(t," abs(").concat(t," a) { return ").concat(t,"(abs(").concat(e(t),"(a))); }")},r=function(t){return"".concat(t," sign(").concat(t," a) { return ").concat(t,"(sign(").concat(e(t),"(a))); }")},n=function(e){return"".concat(e," round(").concat(e," a) { return floor(a + 0.5); }")},o=function(e){return"".concat(e," trunc(").concat(e," a) { return round(a - fract(a) * sign(a)); }")},i=function(e){return"".concat(e," roundEven(").concat(e," a) { return 2.0 * round(a / 2.0); }")},a=function(t,r){return"".concat(t," min(").concat(t," a, ").concat(r," b) { return ").concat(t,"(min(").concat(e(t),"(a), ").concat(e(r),"(b))); }")},s=function(t,r){return"".concat(t," max(").concat(t," a, ").concat(r," b) { return ").concat(t,"(max(").concat(e(t),"(a), ").concat(e(r),"(b))); }")},c=function(t,r){return"".concat(t," clamp(").concat(t," a, ").concat(r," min, ").concat(r," max) { return ").concat(t,"(clamp(").concat(e(t),"(a), ").concat(e(r),"(min), ").concat(e(r),"(max))); }")},u=function(e,t){return"".concat(e," mix(").concat(e," a, ").concat(e," b, ").concat(t," c) { return mix(a, b, ").concat(function(e){switch(e){case"bool":return"float";case"bvec2":return"vec2";case"bvec3":return"vec3";case"bvec4":return"vec4"}throw new Error("Unknown type ".concat(e,"."))}(t),"(c)); }")};return"\n".concat(t("int"),"\n").concat(t("ivec2"),"\n").concat(t("ivec3"),"\n").concat(t("ivec4"),"\n\n").concat(r("int"),"\n").concat(r("ivec2"),"\n").concat(r("ivec3"),"\n").concat(r("ivec4"),"\n\n").concat(n("float"),"\n").concat(n("vec2"),"\n").concat(n("vec3"),"\n").concat(n("vec4"),"\n\n").concat(o("float"),"\n").concat(o("vec2"),"\n").concat(o("vec3"),"\n").concat(o("vec4"),"\n\n").concat(i("float"),"\n").concat(i("vec2"),"\n").concat(i("vec3"),"\n").concat(i("vec4"),"\n\n").concat(a("int","int"),"\n").concat(a("ivec2","ivec2"),"\n").concat(a("ivec3","ivec3"),"\n").concat(a("ivec4","ivec4"),"\n").concat(a("ivec2","int"),"\n").concat(a("ivec3","int"),"\n").concat(a("ivec4","int"),"\n\n").concat(s("int","int"),"\n").concat(s("ivec2","ivec2"),"\n").concat(s("ivec3","ivec3"),"\n").concat(s("ivec4","ivec4"),"\n").concat(s("ivec2","int"),"\n").concat(s("ivec3","int"),"\n").concat(s("ivec4","int"),"\n\n").concat(c("int","int"),"\n").concat(c("ivec2","ivec2"),"\n").concat(c("ivec3","ivec3"),"\n").concat(c("ivec4","ivec4"),"\n").concat(c("ivec2","int"),"\n").concat(c("ivec3","int"),"\n").concat(c("ivec4","int"),"\n\n").concat(u("float","bool"),"\n").concat(u("vec2","bvec2"),"\n").concat(u("vec3","bvec3"),"\n").concat(u("vec4","bvec4"),"\n")}()},126:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSampler2DsInProgram=t.stripComments=t.stripPrecision=t.stripVersion=t.highpToMediump=t.glsl1Uint=t.glsl1Sampler2D=t.glsl1Texture=t.checkFragmentShaderForFragColor=t.glsl1FragmentOut=t.getFragmentOutType=t.glsl1FragmentIn=t.glsl1VertexOut=t.castVaryingToFloat=t.glsl1VertexIn=t.typecastVariable=void 0;var n=r(601);function o(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function i(e,t,r){var n=new RegExp("\\b".concat(o(t),"\\s*=\\s*\\S[^;]*;"),"sg"),i=e.match(n);if(i)for(var a=0;a<i.length;a++){var s=new RegExp("\\b".concat(o(t),"\\s*=\\s*(\\S[^;]*);"),"s"),c=i[a].match(s);if(c&&c[1]){var u=new RegExp("\\b".concat(o(t),"\\s*=\\s*").concat(o(c[1]),"\\s*;"),"s");e=e.replace(u,"".concat(t," = ").concat(r,"(").concat(c[1],");"))}else console.warn('Could not find value in expression: "'.concat(i[a],'"'))}else console.warn("No assignment found for shader variable ".concat(t,"."));return e}function a(e,t,r){var n=new RegExp("".concat(t,"\\s+\\S[^;]*;"),"g"),o=e.match(n);if(o){var a=new RegExp("".concat(t,"\\b"),"g");e=e.replace(a,"varying ".concat(r));for(var s=0;s<o.length;s++){var c=new RegExp("".concat(t,"\\s+(\\S[^;]*);")),u=o[s].match(c);u&&u[2]?e=i(e,u[2],r):console.warn('Could not find variable name in expression: "'.concat(o[s],'"'))}}return e}function s(e){return e=a(e,"\\bvarying\\s+(u)?int","float"),e=a(e,"\\bvarying\\s+(i|u)vec2","vec2"),e=a(e,"\\bvarying\\s+(i|u)vec3","vec3"),e=a(e,"\\bvarying\\s+(i|u)vec4","vec4")}function c(e){return!!e.match(/\bout_fragColor\b/)}function u(e,t){var r=e.match(/\bout\s+((lowp|mediump|highp)\s+)?((float|int|((i|u)?vec(2|3|4))))\s+out_fragColor;/);if(!r||!r[3])throw new Error('No type found in out_fragColor declaration for GPUProgram "'.concat(t,'".'));return r[3]}t.typecastVariable=i,t.glsl1VertexIn=function(e){return e.replace(/\bin\b/g,"attribute")},t.castVaryingToFloat=s,t.glsl1VertexOut=function(e){return e=s(e=e.replace(/(\bflat\s+)?\bout\b/g,"varying"))},t.glsl1FragmentIn=function(e){return e=s(e=e.replace(/(\bflat\s+)?\bin\b/g,"varying"))},t.getFragmentOutType=u,t.glsl1FragmentOut=function(e,t){if(c(e)){var r=u(e,t);e=e.replace(/\bout\s+((lowp|mediump|highp)\s+)?\w+\s+out_fragColor\s*;/g,"");for(var n=!1;;){var o=e.match(/\bout_fragColor\s*=\s*(\S.*);/s);if(!o||!o[1]){if(!n)throw new Error('No assignment found for out_fragColor in GPUProgram "'.concat(t,'".'));break}n=!0;var i="";switch(r){case"float":case"int":i=", 0, 0, 0";break;case"vec2":case"ivec2":case"uvec2":i=", 0, 0";break;case"vec3":case"ivec3":case"uvec3":i=", 0"}e=e.replace(/\bout_fragColor\s*=\s*.+;/s,"gl_FragColor = vec4(".concat(o[1]).concat(i,");"))}}return e},t.checkFragmentShaderForFragColor=function(e,t,r){var o=function(e){return!!e.match(/\bgl_FragColor\b/)}(e),i=c(e);if(t===n.GLSL3){if(o)throw new Error('Found "gl_FragColor" declaration in fragment shader for GPUProgram "'.concat(r,'": either init GPUComposer with glslVersion = GLSL1 or use GLSL3 syntax in your fragment shader.'));if(!i)throw new Error('Found no "out_fragColor" (GLSL3) or "gl_FragColor" (GLSL1) declarations or  in fragment shader for GPUProgram "'.concat(r,'".'))}else if(!o&&!i)throw new Error('Found no "out_fragColor" (GLSL3) or "gl_FragColor" (GLSL1) declarations or  in fragment shader for GPUProgram "'.concat(r,'".'));return!0},t.glsl1Texture=function(e){return e.replace(/\btexture\(/g,"texture2D(")},t.glsl1Sampler2D=function(e){return e.replace(/\b(i|u)sampler2D\b/g,"sampler2D")},t.glsl1Uint=function(e){return e=(e=(e=(e=(e=(e=(e=(e=e.replace(/\buint\b/g,"int")).replace(/\buvec2\b/g,"ivec2")).replace(/\buvec3\b/g,"ivec3")).replace(/\buvec4\b/g,"ivec4")).replace(/\buint\(/g,"int(")).replace(/\buvec2\(/g,"ivec2(")).replace(/\buvec3\(/g,"ivec3(")).replace(/\buvec4\(/g,"ivec4(")},t.highpToMediump=function(e){return e.replace(/\bhighp\b/,"mediump")},t.stripVersion=function(e){var t=e.length;return(e=e.replace(/^\s*\#version\s+([0-9]+(\s+(es)+)?)\s*/,"")).length!==t&&console.warn("GPUIO expects shader source that does not contain #version declarations, removing...."),e},t.stripPrecision=function(e){var t=e.length;return(e=e.replace(/\s*precision\s+((highp)|(mediump)|(lowp))\s+[a-zA-Z0-9]+\s*;/g,"")).length!==t&&console.warn("GPUIO expects shader source that does not contain precision declarations, removing...."),e},t.stripComments=function(e){return e=(e=e.replace(/\s?\/\/.*\n/g,"")).replace(/\/\*.*?\*\//gs,"")},t.getSampler2DsInProgram=function(e){var t={},r="\\buniform\\s+(((highp)|(mediump)|(lowp))\\s+)?(i|u)?sampler2D\\s+(\\w+)\\s?;",n=e.match(new RegExp(r,"g"));if(!n||0===n.length)return[];var o=new RegExp(r);return n.forEach((function(e){var r=e.match(o);r&&r[7]?t[r[7]]=!0:console.warn('Could not find sampler2D uniform name in string "'.concat(e,'".'))})),Object.keys(t)}},593:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uniformInternalTypeForValue=t.preprocessFragmentShader=t.preprocessVertexShader=t.convertFragmentShaderToGLSL1=t.initSequentialFloatArray=t.isPowerOf2=t.getFragmentShaderMediumpPrecision=t.getVertexShaderMediumpPrecision=t.isHighpSupportedInFragmentShader=t.isHighpSupportedInVertexShader=t.readyToRead=t.isWebGL2Supported=t.isWebGL2=t.initGLProgram=t.compileShader=t.makeShaderHeader=t.isIntType=t.isSignedIntType=t.isUnsignedIntType=t.isFloatType=void 0;var n=r(707),o=r(601),i=r(360),a=r(126),s=r(937),c={supportsWebGL2:void 0,supportsHighpVertex:void 0,supportsHighpFragment:void 0,mediumpVertexPrecision:void 0,mediumpFragmentPrecision:void 0};function u(e){return e===o.UNSIGNED_BYTE||e===o.UNSIGNED_SHORT||e===o.UNSIGNED_INT}function l(e){return e===o.BYTE||e===o.SHORT||e===o.INT}function f(e){if(e===o.PRECISION_HIGH_P)return 2;if(e===o.PRECISION_MEDIUM_P)return 1;if(e===o.PRECISION_LOW_P)return 0;throw new Error("Unknown shader precision value: ".concat(JSON.stringify(e),"."))}function _(e){for(var t="",r=Object.keys(e),o=0;o<r.length;o++){var i=r[o];if(!(0,n.isString)(i)||!(0,n.isString)(e[i]))throw new Error("GPUProgram defines must be passed in as key value pairs that are both strings, got key value pair of type [".concat(typeof i," : ").concat(typeof e[i],"] for key ").concat(i,"."));t+="#define ".concat(i," ").concat(e[i],"\n")}return t}function p(e,t,r,n){var i=e===o.GLSL3?"#version ".concat(o.GLSL3,"\n"):"",a=n?_(n):"",c=_({GPUIO_INT_PRECISION:"".concat(f(t)),GPUIO_FLOAT_PRECISION:"".concat(f(r))});return"".concat(i).concat(a).concat(c).concat(s)}function h(e,t,r,n,o,i,a,s,c,u){void 0===u&&(u=!1);var l=e.createShader(i);if(!l)return s("Unable to init gl shader."),null;var f=p(t,r,n,c),_="".concat(f).concat(o);if((e.shaderSource(l,_),e.compileShader(l),u)&&!e.getShaderParameter(l,e.COMPILE_STATUS))return console.log(_.split("\n").map((function(e,t){return"".concat(t,"\t").concat(e)})).join("\n")),s("Could not compile ".concat(i===e.FRAGMENT_SHADER?"fragment":"vertex",' shader for program "').concat(a,'": ').concat(e.getShaderInfoLog(l),".")),null;return l}function d(e,t,r,n,o){var i=e.createProgram();if(i){if(e.attachShader(i,t),e.attachShader(i,r),e.linkProgram(i),e.getProgramParameter(i,e.LINK_STATUS))return i;o('GPUProgram "'.concat(n,'" failed to link: ').concat(e.getProgramInfoLog(i)))}else o('Unable to init GL program for GPUProgram "'.concat(n,'", gl.createProgram() has failed.'))}function g(e){return"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext}function m(e,t){var r=document.createElement("canvas").getContext(o.WEBGL1);if(!r)throw new Error("Unable to init webgl context.");try{var n=h(r,o.GLSL1,o.PRECISION_HIGH_P,o.PRECISION_HIGH_P,e,r.VERTEX_SHADER,"highpFragmentTest",o.DEFAULT_ERROR_CALLBACK),i=h(r,o.GLSL1,o.PRECISION_HIGH_P,o.PRECISION_HIGH_P,t,r.FRAGMENT_SHADER,"highpFragmentTest",o.DEFAULT_ERROR_CALLBACK),a=d(r,n,i,"highpFragmentTest",o.DEFAULT_ERROR_CALLBACK);r.deleteProgram(a),r.deleteShader(n),r.deleteShader(i)}catch(e){return!1}return!0}function v(){if(void 0===c.supportsHighpVertex){var e=m("void main() { highp float test = 0.524; gl_Position = vec4(test, test, 0, 1); }","void main() { gl_FragColor = vec4(0); }");c.supportsHighpVertex=e}return c.supportsHighpVertex}function T(){if(void 0===c.supportsHighpFragment){var e=m("void main() { gl_Position = vec4(0.5, 0.5, 0, 1); }","void main() { highp float test = 1.35; gl_FragColor = vec4(test); }");c.supportsHighpFragment=e}return c.supportsHighpFragment}function E(e,t,r,n,i){var a=d(t,n,r,e,o.DEFAULT_ERROR_CALLBACK);if(!a)throw new Error("Unable to init WebGLProgram.");var s=t.getAttribLocation(a,"position"),c=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,c),t.bufferData(t.ARRAY_BUFFER,1,t.STATIC_DRAW),t.enableVertexAttribArray(s),t.vertexAttribPointer(s,1,t.UNSIGNED_BYTE,!1,0,0),t.viewport(0,0,1,1),t.useProgram(a),i(a),t.drawArrays(t.POINTS,0,1);var u=new Uint8Array(4);return t.readPixels(0,0,1,1,t.RGBA,t.UNSIGNED_BYTE,u),t.deleteProgram(a),t.deleteShader(n),t.deleteShader(r),t.deleteBuffer(c),u}function A(e){return e=(0,a.stripVersion)(e),e=(0,a.stripPrecision)(e),e=(0,a.stripComments)(e)}function I(e){return e=(0,a.glsl1Sampler2D)(e),e=(0,a.glsl1Uint)(e),e=(0,a.glsl1Texture)(e)}function y(e,t){return e=I(e),e=(0,a.glsl1FragmentIn)(e),e=(0,a.glsl1FragmentOut)(e,t)}t.isFloatType=function(e){return e===o.FLOAT||e===o.HALF_FLOAT},t.isUnsignedIntType=u,t.isSignedIntType=l,t.isIntType=function(e){return u(e)||l(e)},t.makeShaderHeader=p,t.compileShader=h,t.initGLProgram=d,t.isWebGL2=g,t.isWebGL2Supported=function(){if(void 0===c.supportsWebGL2){var e=document.createElement("canvas").getContext(o.WEBGL2);c.supportsWebGL2=g(e)}return c.supportsWebGL2},t.readyToRead=function(e){return e.checkFramebufferStatus(e.FRAMEBUFFER)==e.FRAMEBUFFER_COMPLETE},t.isHighpSupportedInVertexShader=v,t.isHighpSupportedInFragmentShader=T,t.getVertexShaderMediumpPrecision=function(){if(void 0===c.mediumpVertexPrecision){var e=document.createElement("canvas").getContext("webgl");if(!e)throw new Error("Unable to init webgl context.");var t=h(e,o.GLSL1,o.PRECISION_MEDIUM_P,o.PRECISION_MEDIUM_P,"\n\tattribute vec4 position;  // needed because of another bug in Safari\n\tuniform mediump vec3 v;\n\tvarying mediump vec4 v_result;\n\tvoid main() {\n\t\tgl_Position = position;\n\t\tgl_PointSize = 1.0;\n\t\tv_result = vec4(normalize(v) * 0.5 + 0.5, 1);\n\t}\n\t\t",e.VERTEX_SHADER,"mediumpPrecisionVertexTest",o.DEFAULT_ERROR_CALLBACK);if(!t)throw new Error("Unable to init vertex shader.");var r=h(e,o.GLSL1,o.PRECISION_MEDIUM_P,o.PRECISION_MEDIUM_P,"\n\tvarying mediump vec4 v_result;\n\tvoid main() {\n\t\tgl_FragColor = v_result;\n\t}\n\t\t",e.FRAGMENT_SHADER,"mediumpPrecisionVertexTest",o.DEFAULT_ERROR_CALLBACK);if(!r)throw new Error("Unable to init fragment shader.");var n=Math.pow(2,31)-1,i=Math.sqrt(n),a=255*(i/Math.sqrt(i*i*3)*.5+.5)|0,s=E("mediumpPrecisionVertexTest",e,r,t,(function(t){var r=e.getUniformLocation(t,"v");e.uniform3f(r,i,i,i)})),u=Math.abs(s[0]-a)>16;c.mediumpVertexPrecision=u?o.PRECISION_MEDIUM_P:o.PRECISION_HIGH_P}return c.mediumpVertexPrecision},t.getFragmentShaderMediumpPrecision=function(){if(void 0===c.mediumpFragmentPrecision){var e=document.createElement("canvas").getContext("webgl");if(!e)throw new Error("Unable to init webgl context.");var t=h(e,o.GLSL1,o.PRECISION_MEDIUM_P,o.PRECISION_MEDIUM_P,"\n\tattribute vec4 position;  // needed because of another bug in Safari\n\tvoid main() {\n\t\tgl_Position = position;\n\t\tgl_PointSize = 1.0;\n\t}\n\t\t",e.VERTEX_SHADER,"mediumpPrecisionFragmentTest",o.DEFAULT_ERROR_CALLBACK);if(!t)throw new Error("Unable to init vertex shader.");var r=h(e,o.GLSL1,o.PRECISION_MEDIUM_P,o.PRECISION_MEDIUM_P,"\n\tuniform mediump vec3 v;\n\tvoid main() {\n\t\tgl_FragColor = vec4(normalize(v) * 0.5 + 0.5, 1);\n\t}\n\t\t",e.FRAGMENT_SHADER,"mediumpPrecisionFragmentTest",o.DEFAULT_ERROR_CALLBACK);if(!r)throw new Error("Unable to init fragment shader.");var n=Math.pow(2,31)-1,i=Math.sqrt(n),a=255*(i/Math.sqrt(i*i*3)*.5+.5)|0,s=E("mediumpPrecisionFragmentTest",e,r,t,(function(t){var r=e.getUniformLocation(t,"v");e.uniform3f(r,i,i,i)})),u=Math.abs(s[0]-a)>16;c.mediumpFragmentPrecision=u?o.PRECISION_MEDIUM_P:o.PRECISION_HIGH_P}return c.mediumpFragmentPrecision},t.isPowerOf2=function(e){return e>0&&0==(e&e-1)},t.initSequentialFloatArray=function(e){for(var t=new Float32Array(e),r=0;r<e;r++)t[r]=r;return t},t.convertFragmentShaderToGLSL1=y,t.preprocessVertexShader=function(e,t){return e=A(e),v()||(console.warn("highp not supported in vertex shader in this browser, falling back to mediump."),e=(0,a.highpToMediump)(e)),t===o.GLSL3?e:function(e){return e=I(e),e=(0,a.glsl1VertexIn)(e),(0,a.glsl1VertexOut)(e)}(e)},t.preprocessFragmentShader=function(e,t,r){var n,s;return e=A(e),(0,a.checkFragmentShaderForFragColor)(e,t,r),T()||(console.warn("highp not supported in fragment shader in this browser, falling back to mediump."),e=(0,a.highpToMediump)(e)),e=(n=(0,i.texturePolyfill)(e)).shaderSource,s=n.samplerUniforms,t!==o.GLSL3&&(e=y(e=i.GLSL1_POLYFILLS+e,r)),{shaderSource:e,samplerUniforms:s}},t.uniformInternalTypeForValue=function(e,t,r,i){if(t===o.FLOAT){if((0,n.isArray)(e)){for(var a=0;a<e.length;a++)if(!(0,n.isNumber)(e[a]))throw new Error("Invalid value ".concat(JSON.stringify(e),' for uniform "').concat(r,'" in program "').concat(i,'", expected float or float[] of length 1-4.'))}else if(!(0,n.isNumber)(e))throw new Error("Invalid value ".concat(JSON.stringify(e),' for uniform "').concat(r,'" in program "').concat(i,'", expected float or float[] of length 1-4.'));if(!(0,n.isArray)(e)||1===e.length)return o.FLOAT_1D_UNIFORM;if(2===e.length)return o.FLOAT_2D_UNIFORM;if(3===e.length)return o.FLOAT_3D_UNIFORM;if(4===e.length)return o.FLOAT_4D_UNIFORM;throw new Error("Invalid value ".concat(JSON.stringify(e),' for uniform "').concat(r,'" in program "').concat(i,'", expected float or float[] of length 1-4.'))}if(t===o.INT){if((0,n.isArray)(e)){for(a=0;a<e.length;a++)if(!(0,n.isInteger)(e[a]))throw new Error("Invalid value ".concat(JSON.stringify(e),' for uniform "').concat(r,'" in program "').concat(i,'", expected int or int[] of length 1-4.'))}else if(!(0,n.isInteger)(e))throw new Error("Invalid value ".concat(JSON.stringify(e),' for uniform "').concat(r,'" in program "').concat(i,'", expected int or int[] of length 1-4.'));if(!(0,n.isArray)(e)||1===e.length)return o.INT_1D_UNIFORM;if(2===e.length)return o.INT_2D_UNIFORM;if(3===e.length)return o.INT_3D_UNIFORM;if(4===e.length)return o.INT_4D_UNIFORM;throw new Error("Invalid value ".concat(JSON.stringify(e),' for uniform "').concat(r,'" in program "').concat(i,'", expected int or int[] of length 1-4.'))}if(t===o.UINT){if((0,n.isArray)(e)){for(a=0;a<e.length;a++)if(!(0,n.isNonNegativeInteger)(e[a]))throw new Error("Invalid value ".concat(JSON.stringify(e),' for uniform "').concat(r,'" in program "').concat(i,'", expected uint or uint[] of length 1-4.'))}else if(!(0,n.isNonNegativeInteger)(e))throw new Error("Invalid value ".concat(JSON.stringify(e),' for uniform "').concat(r,'" in program "').concat(i,'", expected uint or uint[] of length 1-4.'));if(!(0,n.isArray)(e)||1===e.length)return o.UINT_1D_UNIFORM;if(2===e.length)return o.UINT_2D_UNIFORM;if(3===e.length)return o.UINT_3D_UNIFORM;if(4===e.length)return o.UINT_4D_UNIFORM;throw new Error("Invalid value ".concat(JSON.stringify(e),' for uniform "').concat(r,'" in program "').concat(i,'", expected uint or uint[] of length 1-4.'))}if(t===o.BOOL){if((0,n.isArray)(e)){for(a=0;a<e.length;a++)if(!(0,n.isBoolean)(e[a]))throw new Error("Invalid value ".concat(JSON.stringify(e),' for uniform "').concat(r,'" in program "').concat(i,'", expected bool or bool[] of length 1-4.'))}else if(!(0,n.isBoolean)(e))throw new Error("Invalid value ".concat(JSON.stringify(e),' for uniform "').concat(r,'" in program "').concat(i,'", expected bool or bool[] of length 1-4.'));if(!(0,n.isArray)(e)||1===e.length)return o.BOOL_1D_UNIFORM;if(2===e.length)return o.BOOL_2D_UNIFORM;if(3===e.length)return o.BOOL_3D_UNIFORM;if(4===e.length)return o.BOOL_4D_UNIFORM;throw new Error("Invalid value ".concat(JSON.stringify(e),' for uniform "').concat(r,'" in program "').concat(i,'", expected boolean.'))}throw new Error('Invalid type "'.concat(t,'" for uniform "').concat(r,'" in program "').concat(i,'", expected ').concat(o.FLOAT," or ").concat(o.INT," or ").concat(o.BOOL,"."))}},937:e=>{e.exports="#if (GPUIO_INT_PRECISION == 2)\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp int;\n#if (__VERSION__ == 300)\nprecision highp isampler2D;precision highp usampler2D;\n#endif\n#else\nprecision mediump int;\n#if (__VERSION__ == 300)\nprecision mediump isampler2D;precision mediump usampler2D;\n#endif\n#endif\n#endif\n#if (GPUIO_INT_PRECISION == 1)\nprecision mediump int;\n#if (__VERSION__ == 300)\nprecision mediump isampler2D;precision mediump usampler2D;\n#endif\n#endif\n#if (GPUIO_INT_PRECISION == 0)\nprecision lowp int;\n#if (__VERSION__ == 300)\nprecision lowp isampler2D;precision lowp usampler2D;\n#endif\n#endif\n#if (GPUIO_FLOAT_PRECISION == 2)\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;precision highp sampler2D;\n#else\nprecision mediump float;precision mediump sampler2D;\n#endif\n#endif\n#if (GPUIO_FLOAT_PRECISION == 1)\nprecision mediump float;precision mediump sampler2D;\n#endif\n#if (GPUIO_FLOAT_PRECISION == 0)\nprecision lowp float;precision lowp sampler2D;\n#endif\n"},158:e=>{e.exports="in vec2 v_uv;\n#ifdef GPUIO_FLOAT\nuniform sampler2D u_state;\n#endif\n#ifdef GPUIO_INT\nuniform isampler2D u_state;\n#endif\n#ifdef GPUIO_UINT\nuniform usampler2D u_state;\n#endif\n#ifdef GPUIO_FLOAT\nout vec4 out_fragColor;\n#endif\n#ifdef GPUIO_INT\nout ivec4 out_fragColor;\n#endif\n#ifdef GPUIO_UINT\nout uvec4 out_fragColor;\n#endif\nvoid main(){out_fragColor=texture(u_state,v_uv);}"},148:e=>{e.exports="#ifdef GPUIO_FLOAT\nuniform vec4 u_value;\n#endif\n#ifdef GPUIO_INT\nuniform ivec4 u_value;\n#endif\n#ifdef GPUIO_UINT\nuniform uvec4 u_value;\n#endif\n#ifdef GPUIO_FLOAT\nout vec4 out_fragColor;\n#endif\n#ifdef GPUIO_INT\nout ivec4 out_fragColor;\n#endif\n#ifdef GPUIO_UINT\nout uvec4 out_fragColor;\n#endif\nvoid main(){out_fragColor=u_value;}"},723:e=>{e.exports="in vec2 v_uv;uniform vec3 u_color;uniform float u_scale;\n#ifdef GPUIO_FLOAT\nuniform sampler2D u_gpuio_data;\n#endif\n#ifdef GPUIO_INT\nuniform isampler2D u_gpuio_data;\n#endif\n#ifdef GPUIO_UINT\nuniform usampler2D u_gpuio_data;\n#endif\nout vec4 out_fragColor;void main(){uvec4 value=texture(u_gpuio_data,v_uv);float mag=length(value);out_fragColor=vec4(mag*u_scale*u_color,1);}"},598:e=>{e.exports="in vec2 v_lineWrapping;uniform vec4 u_value;out vec4 out_fragColor;void main(){if((v_lineWrapping.x!=0.&&v_lineWrapping.x!=1.)||(v_lineWrapping.y!=0.&&v_lineWrapping.y!=1.)){discard;return;}out_fragColor=vec4(u_value);}"},288:e=>{e.exports="in vec2 a_gpuio_position;\n#ifdef GPUIO_VS_UV_ATTRIBUTE\nin vec2 a_gpuio_uv;\n#endif\n#ifdef GPUIO_VS_NORMAL_ATTRIBUTE\nin vec2 a_gpuio_normal;\n#endif\nuniform vec2 u_gpuio_scale;uniform vec2 u_gpuio_translation;out vec2 v_uv;out vec2 v_uv_local;\n#ifdef GPUIO_VS_NORMAL_ATTRIBUTE\nout vec2 v_normal;\n#endif\nvoid main(){\n#ifdef GPUIO_VS_UV_ATTRIBUTE\nv_uv_local=a_gpuio_uv;\n#else\nv_uv_local=0.5*(a_gpuio_position+1.);\n#endif\n#ifdef GPUIO_VS_NORMAL_ATTRIBUTE\nv_normal=a_gpuio_normal;\n#endif\nvec2 position=u_gpuio_scale*a_gpuio_position+u_gpuio_translation;v_uv=0.5*(position+1.);gl_Position=vec4(position,0,1);}"},143:e=>{e.exports="float modI(float a,float b){float m=a-floor((a+0.5)/b)*b;return floor(m+0.5);}vec2 uvFromIndex(const float index,const vec2 dimensions){return vec2(modI(index,dimensions.x),floor(floor(index+0.5)/dimensions.x))/dimensions;}in float a_gpuio_index;uniform sampler2D u_gpuio_positions;uniform vec2 u_gpuio_positionsDimensions;uniform vec2 u_gpuio_scale;out vec2 v_uv;out vec2 v_lineWrapping;out float v_index;void main(){vec2 positionUV=uvFromIndex(a_gpuio_index,u_gpuio_positionsDimensions);\n#ifdef GPUIO_VS_POSITION_W_ACCUM\nvec4 positionData=texture(u_gpuio_positions,positionUV);v_uv=(positionData.rg+positionData.ba)*u_gpuio_scale;\n#else\nv_uv=texture(u_gpuio_positions,positionUV).rg*u_gpuio_scale;\n#endif\nv_lineWrapping=vec2(0.);\n#ifdef GPUIO_VS_WRAP_X\nif(v_uv.x<0.){v_uv.x+=1.;v_lineWrapping.x=1.;}else if(v_uv.x>1.){v_uv.x-=1.;v_lineWrapping.x=1.;}\n#endif\n#ifdef GPUIO_VS_WRAP_Y\nif(v_uv.y<0.){v_uv.y+=1.;v_lineWrapping.y=1.;}else if(v_uv.y>1.){v_uv.y-=1.;v_lineWrapping.y=1.;}\n#endif\nvec2 position=v_uv*2.-1.;v_index=a_gpuio_index;gl_Position=vec4(position,0,1);}"},767:e=>{e.exports="float modI(float a,float b){float m=a-floor((a+0.5)/b)*b;return floor(m+0.5);}vec2 uvFromIndex(const float index,const vec2 dimensions){return vec2(modI(index,dimensions.x),floor(floor(index+0.5)/dimensions.x))/dimensions;}in float a_gpuio_index;uniform sampler2D u_gpuio_positions;uniform vec2 u_gpuio_positionsDimensions;uniform vec2 u_gpuio_scale;uniform float u_gpuio_pointSize;out vec2 v_uv;flat out int v_index;void main(){vec2 positionUV=uvFromIndex(a_gpuio_index,u_gpuio_positionsDimensions);\n#ifdef GPUIO_VS_POSITION_W_ACCUM\nvec4 positionData=texture(u_gpuio_positions,positionUV);v_uv=(positionData.rg+positionData.ba)*u_gpuio_scale;\n#else\nv_uv=texture(u_gpuio_positions,positionUV).rg*u_gpuio_scale;\n#endif\n#ifdef GPUIO_VS_WRAP_X\nv_uv.x=fract(v_uv.x+ceil(abs(v_uv.x)));\n#endif\n#ifdef GPUIO_VS_WRAP_Y\nv_uv.y=fract(v_uv.y+ceil(abs(v_uv.y)));\n#endif\nvec2 position=v_uv*2.-1.;v_index=int(a_gpuio_index);gl_PointSize=u_gpuio_pointSize;gl_Position=vec4(position,0,1);}"},760:e=>{e.exports="float modI(float a,float b){float m=a-floor((a+0.5)/b)*b;return floor(m+0.5);}vec2 uvFromIndex(const float index,const vec2 dimensions){return vec2(modI(index,dimensions.x),floor(floor(index+0.5)/dimensions.x))/dimensions;}in float a_gpuio_index;uniform sampler2D u_gpuio_vectors;uniform vec2 u_gpuio_dimensions;uniform vec2 u_gpuio_scale;out vec2 v_uv;out float v_index;void main(){const float index=floor((a_gpuio_index+0.5)/2.);vec2 positionUV=uvFromIndex(index,u_gpuio_dimensions);v_uv+=step(0.,modI(a_gpuio_index,2.))*texture(u_gpuio_vectors,v_uv).xy*u_gpuio_scale;vec2 position=v_uv*2.-1.;v_index=a_gpuio_index;gl_Position=vec4(position,0,1);}"},974:e=>{e.exports="in vec2 a_gpuio_position;uniform float u_gpuio_halfThickness;uniform vec2 u_gpuio_scale;uniform float u_gpuio_length;uniform float u_gpuio_rotation;uniform vec2 u_gpuio_translation;out vec2 v_uv_local;out vec2 v_uv;mat2 rotate2d(float _angle){return mat2(cos(_angle),-sin(_angle),sin(_angle),cos(_angle));}void main(){v_uv_local=0.5*(a_gpuio_position+1.);vec2 position=a_gpuio_position;position*=u_gpuio_halfThickness;float signX=sign(position.x);position.x+=signX*u_gpuio_length/2.;v_uv_local.x=(signX+1.)/2.;position=u_gpuio_scale*(rotate2d(-u_gpuio_rotation)*position)+u_gpuio_translation;v_uv=0.5*(position+1.);gl_Position=vec4(position,0,1);}"}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n].call(i.exports,i,i.exports,r),i.exports}return r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r(607)})()));
//# sourceMappingURL=gpu-io.min.js.map
{"version":3,"sources":["webpack://WebGLCompute/webpack/universalModuleDefinition","webpack://WebGLCompute/./node_modules/@petamoriken/float16/src/dataView.js","webpack://WebGLCompute/./node_modules/@petamoriken/float16/src/hfround.js","webpack://WebGLCompute/./node_modules/@petamoriken/float16/src/lib.js","webpack://WebGLCompute/./node_modules/lodash-es/_root.js","webpack://WebGLCompute/./node_modules/lodash-es/_Symbol.js","webpack://WebGLCompute/./node_modules/lodash-es/_getRawTag.js","webpack://WebGLCompute/./node_modules/lodash-es/_objectToString.js","webpack://WebGLCompute/./node_modules/lodash-es/_baseGetTag.js","webpack://WebGLCompute/./node_modules/lodash-es/isObject.js","webpack://WebGLCompute/./node_modules/lodash-es/isFunction.js","webpack://WebGLCompute/./node_modules/lodash-es/_coreJsData.js","webpack://WebGLCompute/./node_modules/lodash-es/_isMasked.js","webpack://WebGLCompute/./node_modules/lodash-es/_toSource.js","webpack://WebGLCompute/./node_modules/lodash-es/_baseIsNative.js","webpack://WebGLCompute/./node_modules/lodash-es/_getValue.js","webpack://WebGLCompute/./node_modules/lodash-es/_getNative.js","webpack://WebGLCompute/./node_modules/lodash-es/_nativeCreate.js","webpack://WebGLCompute/./node_modules/lodash-es/_hashDelete.js","webpack://WebGLCompute/./node_modules/lodash-es/_hashGet.js","webpack://WebGLCompute/./node_modules/lodash-es/_hashHas.js","webpack://WebGLCompute/./node_modules/lodash-es/_hashSet.js","webpack://WebGLCompute/./node_modules/lodash-es/_Hash.js","webpack://WebGLCompute/./node_modules/lodash-es/_hashClear.js","webpack://WebGLCompute/./node_modules/lodash-es/eq.js","webpack://WebGLCompute/./node_modules/lodash-es/_assocIndexOf.js","webpack://WebGLCompute/./node_modules/lodash-es/_listCacheDelete.js","webpack://WebGLCompute/./node_modules/lodash-es/_listCacheGet.js","webpack://WebGLCompute/./node_modules/lodash-es/_listCacheHas.js","webpack://WebGLCompute/./node_modules/lodash-es/_listCacheSet.js","webpack://WebGLCompute/./node_modules/lodash-es/_ListCache.js","webpack://WebGLCompute/./node_modules/lodash-es/_listCacheClear.js","webpack://WebGLCompute/./node_modules/lodash-es/_Map.js","webpack://WebGLCompute/./node_modules/lodash-es/_mapCacheClear.js","webpack://WebGLCompute/./node_modules/lodash-es/_isKeyable.js","webpack://WebGLCompute/./node_modules/lodash-es/_getMapData.js","webpack://WebGLCompute/./node_modules/lodash-es/_mapCacheDelete.js","webpack://WebGLCompute/./node_modules/lodash-es/_mapCacheGet.js","webpack://WebGLCompute/./node_modules/lodash-es/_mapCacheHas.js","webpack://WebGLCompute/./node_modules/lodash-es/_mapCacheSet.js","webpack://WebGLCompute/./node_modules/lodash-es/_MapCache.js","webpack://WebGLCompute/./node_modules/lodash-es/memoize.js","webpack://WebGLCompute/./node_modules/@petamoriken/float16/src/bug.js","webpack://WebGLCompute/./node_modules/@petamoriken/float16/src/spec.js","webpack://WebGLCompute/./node_modules/@petamoriken/float16/src/is.js","webpack://WebGLCompute/./node_modules/lodash-es/isObjectLike.js","webpack://WebGLCompute/./node_modules/lodash-es/_baseIsArrayBuffer.js","webpack://WebGLCompute/./node_modules/lodash-es/_baseUnary.js","webpack://WebGLCompute/./node_modules/lodash-es/isArrayBuffer.js","webpack://WebGLCompute/./node_modules/@petamoriken/float16/src/Float16Array.js","webpack://WebGLCompute/./node_modules/@petamoriken/float16/src/private.js","webpack://WebGLCompute/./node_modules/changedpi/dist/index.js","webpack://WebGLCompute/./node_modules/file-saver/dist/FileSaver.min.js","webpack://WebGLCompute/./node_modules/lodash-es/_freeGlobal.js","webpack://WebGLCompute/./node_modules/lodash-es/_nodeUtil.js","webpack://WebGLCompute/./src/Checks.ts","webpack://WebGLCompute/./src/Constants.ts","webpack://WebGLCompute/./src/DataLayer.ts","webpack://WebGLCompute/./src/GPUProgram.ts","webpack://WebGLCompute/./src/Vector4.ts","webpack://WebGLCompute/./src/WebGLCompute.ts","webpack://WebGLCompute/./src/extensions.ts","webpack://WebGLCompute/./src/index.ts","webpack://WebGLCompute/./src/utils.ts","webpack://WebGLCompute/./src/glsl/frag/CopyFloatFragShader.glsl","webpack://WebGLCompute/./src/glsl/frag/CopyIntFragShader.glsl","webpack://WebGLCompute/./src/glsl/frag/CopyUintFragShader.glsl","webpack://WebGLCompute/./src/glsl/vert/DataLayerLinesVertShader.glsl","webpack://WebGLCompute/./src/glsl/vert/DataLayerPointsVertShader.glsl","webpack://WebGLCompute/./src/glsl/vert/DataLayerVectorFieldVertShader.glsl","webpack://WebGLCompute/./src/glsl/vert/DefaultVertShader.glsl","webpack://WebGLCompute/./src/glsl/vert/SegmentVertShader.glsl","webpack://WebGLCompute/./src/glsl_3/SingleColorFragShader.glsl","webpack://WebGLCompute/./src/glsl_3/SingleColorWithWrapCheckFragShader.glsl","webpack://WebGLCompute/./src/glsl_3/VectorMagnitudeFragShader.glsl","webpack://WebGLCompute/webpack/bootstrap","webpack://WebGLCompute/webpack/runtime/define property getters","webpack://WebGLCompute/webpack/runtime/global","webpack://WebGLCompute/webpack/runtime/harmony module decorator","webpack://WebGLCompute/webpack/runtime/hasOwnProperty shorthand","webpack://WebGLCompute/webpack/runtime/make namespace object","webpack://WebGLCompute/webpack/startup"],"names":["root","factory","exports","module","define","amd","self","dataView","byteOffset","opts","isDataView","convertToNumber","getUint16","TypeError","num","Number","isFinite","x16","roundToFloat16Bits","value","setUint16","buffer","ArrayBuffer","floatView","Float32Array","uint32View","Uint32Array","baseTable","shiftTable","let","i","e","f","mantissaTable","exponentTable","offsetTable","m","float16bits","freeSelf","Object","Function","objectProto","prototype","hasOwnProperty","nativeObjectToString","toString","symToStringTag","undefined","isOwn","call","tag","unmasked","result","type","maskSrcKey","uid","exec","func","funcToString","reIsHostCtor","reIsNative","RegExp","replace","test","object","key","this","has","__data__","size","data","Hash","entries","index","length","clear","entry","set","get","other","array","splice","Array","pop","push","ListCache","map","MapCache","memoize","resolver","memoized","args","arguments","apply","cache","Cache","isTypedArrayIndexedPropertyWritable","getOwnPropertyDescriptor","Uint8Array","writable","ToInteger","target","number","isNaN","Math","trunc","defaultCompareFunction","x","y","isNaN_x","isNaN_y","isPlusZero_x","isPlusZero_y","is","view","DataView","isStringNumberKey","nodeIsArrayBuffer","_","wm","WeakMap","obj","create","createPrivateStorage","isFloat16Array","Float16Array","assertFloat16Array","copyToArray","applyHandler","thisArg","defaultFloat16ArrayMethods","Reflect","handler","wrapper","ret","proxy","Proxy","isFrozen","getPrototypeOf","setPrototypeOf","defineProperty","descriptor","deleteProperty","isExtensible","preventExtensions","ownKeys","Uint16Array","constructor","input","super","arrayLike","Symbol","iterator","src","from","mapFunc","val","keys","values","callback","l","filter","reduce","start","reduceRight","forEach","find","findIndex","every","some","offset","reverse","fill","copyWithin","sort","compareFunction","_convertToNumber","slice","uint16","subarray","indexOf","element","lastIndexOf","includes","join","toLocaleString","toStringTag","Float16Array$prototype","WeakSet","add","calcCrc","buf","c","pngDataTable","crcTable","Int32Array","n","k","createPngDataTable","changeDpiBlob","blob","dpi","headerChunk","Promise","resolve","reject","fileReader","FileReader","onload","dataArray","tail","changedArray","changeDpiOnArray","Blob","readAsArrayBuffer","changeDpiDataUrl","base64Image","dataSplitted","split","format","body","headerLength","overwritepHYs","PNG","b64Index","b64index","b64PhysSignature1","b64PhysSignature2","b64PhysSignature3","detectPhysChunkFromDataUrl","ceil","JPEG","stringHeader","substring","restOfData","headerBytes","atob","charCodeAt","finalArray","base64Header","btoa","String","fromCharCode","arr","isArray","arr2","_toConsumableArray","_P","_H","_Y","_S","physChunk","crc","crcChunk","startingIndex","searchStartOfPhys","chunkLength","finalHeader","b","a","autoBom","console","warn","d","XMLHttpRequest","open","responseType","g","response","onerror","error","send","status","dispatchEvent","MouseEvent","document","createEvent","initMouseEvent","window","global","navigator","userAgent","saveAs","HTMLAnchorElement","h","URL","webkitURL","j","createElement","name","download","rel","href","origin","location","createObjectURL","setTimeout","revokeObjectURL","msSaveOrOpenBlob","title","innerText","HTMLElement","safari","onloadend","readAsDataURL","freeExports","nodeType","freeModule","freeProcess","types","require","binding","isNumber","isInteger","validArrayTypes","Int8Array","Int16Array","validDataTypes","HALF_FLOAT","FLOAT","UNSIGNED_BYTE","BYTE","UNSIGNED_SHORT","SHORT","UNSIGNED_INT","INT","validFilters","LINEAR","NEAREST","validWraps","CLAMP_TO_EDGE","REPEAT","validTextureFormats","RGB","RGBA","validTextureTypes","clearValue","numComponents","BOOL","GLSL3","GLSL1","FLOAT_1D_UNIFORM","FLOAT_2D_UNIFORM","FLOAT_3D_UNIFORM","FLOAT_4D_UNIFORM","INT_1D_UNIFORM","INT_2D_UNIFORM","INT_3D_UNIFORM","INT_4D_UNIFORM","DEFAULT_PROGRAM_NAME","DEFAULT_W_UV_PROGRAM_NAME","DEFAULT_W_NORMAL_PROGRAM_NAME","DEFAULT_W_UV_NORMAL_PROGRAM_NAME","SEGMENT_PROGRAM_NAME","DATA_LAYER_POINTS_PROGRAM_NAME","DATA_LAYER_LINES_PROGRAM_NAME","DATA_LAYER_VECTOR_FIELD_PROGRAM_NAME","DEFAULT_CIRCLE_NUM_SEGMENTS","calcSize","width","height","isPositiveInteger","Error","exp","remainder","pow","floor","inDevMode","log","getInternalWrap","params","gl","wrap","isWebGL2","getInternalFilter","errorCallback","internalType","getExtension","OES_TEXTURE_HAlF_FLOAT_LINEAR","OES_TEXTURE_FLOAT_LINEAR","getInternalType","glslVersion","DataLayer","shouldCastIntTypeAsFloat","OES_TEXTURE_FLOAT","testFramebufferWrite","OES_TEXTURE_HALF_FLOAT","EXT_COLOR_BUFFER_FLOAT","getGLTextureParameters","glType","glFormat","glInternalFormat","glNumChannels","RED","RG","ALPHA","LUMINANCE_ALPHA","RED_INTEGER","RG_INTEGER","RGB_INTEGER","RGBA_INTEGER","R16F","RG16F","RGB16F","RGBA16F","R32F","RG32F","RGB32F","RGBA32F","R8UI","RG8UI","RGB8UI","RGBA8UI","R8I","RG8I","RGB8I","RGBA8I","R16I","RG16I","RGB16I","RGBA16I","R16UI","RG16UI","RGB16UI","RGBA16UI","R32I","RG32I","RGB32I","RGBA32I","R32UI","RG32UI","RGB32UI","RGBA32UI","HALF_FLOAT_OES","missingParams","texture","createTexture","bindTexture","TEXTURE_2D","wrapS","wrapT","texParameteri","TEXTURE_WRAP_S","TEXTURE_WRAP_T","TEXTURE_MIN_FILTER","TEXTURE_MAG_FILTER","texImage2D","framebuffer","createFramebuffer","deleteTexture","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","COLOR_ATTACHMENT0","validStatus","checkFramebufferStatus","FRAMEBUFFER_COMPLETE","deleteFramebuffer","_bufferIndex","saveCurrentStateToDataLayer","layer","numBuffers","glWrapS","glWrapT","glFilter","textureOverrides","bufferIndex","currentState","buffers","_setCurrentStateTexture","glcompute","validateDataArray","_length","shouldTypeCast","imageSize","incorrectSize","handleFloat16","validatedArray","_len","setFloat16","initBuffers","getError","getStateAtIndex","_usingTextureOverrideForCurrentBuffer","_bindOutputBufferForWrite","incrementBufferIndex","_bindOutputBuffer","setFromArray","applyToAllBuffers","endIndex","resize","dimensions","JSON","stringify","_width","_height","destroyBuffers","_clearValue","isValidClearValue","dispose","clone","cloneDataLayer","defaultFilter","isValidFilter","isValidWrap","isValidDataType","internalFilter","internalWrapS","internalWrapT","convertDefinesToString","defines","definesSource","isString","recompile","fragmentShaderSource","verboseLogging","definesNeedUpdate","fragmentShader","GPUProgram","shader","compileShader","FRAGMENT_SHADER","initProgram","vertexShader","programName","uniforms","program","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","uniformNames","uniformName","uniform","setProgramUniform","getProgramInfoLog","getProgramWithName","programs","vertexShaderSource","_preprocessVertShader","VERTEX_SHADER","uniformInternalTypeForValue","isBoolean","useProgram","_location","getUniformLocation","uniform1f","uniform2fv","uniform3fv","uniform4fv","uniform1i","uniform2iv","uniform3iv","uniform4iv","setUniform","currentType","setVertexUniform","deleteProgram","deleteShader","sourceString","z","w","copy","v","Vector4","defaultVertexShaderSource","initWithThreeRenderer","renderer","WebGLCompute","canvas","domElement","context","getContext","preprocessShader","shaderSource","_preprocessFragShader","_singleColorProgram","_singleColorWithWrapCheckProgram","_vectorMagnitudeProgram","fsQuadPositions","_quadPositionsBuffer","initVertexBuffer","boundaryPositions","_boundaryPositionsBuffer","getCirclePositionsBuffer","numSegments","_circlePositionsBuffer","unitCirclePoints","cos","PI","sin","circlePositions","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","validKeys","initDataLayer","dataLayer","getValues","step","copyProgramForType","output","initTexture","url","isValidTextureFormat","isValidTextureType","internalFormat","srcFormat","srcType","pixel","image","Image","isPowerOf2","onLoad","onResize","clientWidth","clientHeight","drawSetup","fullscreenRender","inputTextures","WebGLTexture","getCurrentStateTexture","setOutputLayer","activeTexture","TEXTURE0","copyFloatProgram","copyUintProgram","copyIntProgram","setBlendMode","shouldBlendAlpha","enable","BLEND","blendFunc","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","addLayerToInputs","_inputLayers","previous","passThroughLayerDataFromInputToOutput","state","copyProgram","viewport","setPositionAttribute","setVertexAttribute","setIndexAttribute","setUVAttribute","getAttribLocation","vertexAttribPointer","enableVertexAttribArray","errorState","quadPositionsBuffer","glProgram","defaultProgram","drawArrays","TRIANGLE_STRIP","disable","stepBoundary","boundaryPositionsBuffer","onePx","singleEdge","LINES","LINE_LOOP","stepNonBoundary","stepCircle","position","radius","TRIANGLE_FAN","stepSegment","position1","position2","thickness","segmentProgram","diffX","diffY","angle","atan2","centerX","centerY","sqrt","numCapSegments","endCaps","stepPolyline","vertices","positions","closeLoop","v2","length2","cross","halfThickness","numPositions","uvs","includeUVs","normals","includeNormals","s1","s2","n1","n2","n3","v1","length1","u","v3","v4","abs","length3","acos","defaultProgramWithUVNormal","defaultProgramWithUV","defaultProgramWithNormal","stepTriangleStrip","count","stepLines","indices","LINE_STRIP","drawLayerAsPoints","pointIndexArray","singleColorProgram","color","dataLayerPointsProgram","pointSize","positionLayerDimensions","wrapX","wrapY","pointIndexBuffer","initSequentialFloatArray","POINTS","drawLayerAsLines","singleColorWithWrapCheckProgram","dataLayerLinesProgram","indexedLinesIndexBuffer","floatArray","drawLayerAsVectorField","vectorFieldIndexArray","dataLayerVectorFieldProgram","vectorScale","vectorSpacing","spacedDimensions","vectorFieldIndexBuffer","drawLayerMagnitude","vectorMagnitudeProgram","scale","readyToRead","readPixels","OUTPUT_LENGTH","handleFloat16Conversion","index1","index2","getFloat16","savePNG","filename","imageData","getImageData","isFloat","indexFlipped","putImageData","toBlob","then","reset","attachDataLayerToThreeTexture","offsetTextureProperties","properties","__webglTexture","__webglInit","resetThreeState","getViewport","utils","setRenderTarget","resetState","_vertexShaders","message","contextID","contextOptions","DEPTH_TEST","pixelStorei","UNPACK_ALIGNMENT","maxNumTextures","getParameter","MAX_TEXTURE_IMAGE_UNITS","extensions","WEBGL_DEPTH_TEXTURE","extensionName","optional","extension","isWebGL2Supported","shaderType","createShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","WebGL2RenderingContext","WebGL2ComputeRenderingContext","__webpack_module_cache__","__webpack_require__","definition","o","enumerable","globalThis","hmd","children","id","prop","r","moduleId","cachedModule","loaded","__webpack_modules__"],"mappings":"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","file":"webgl-compute.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"WebGLCompute\"] = factory();\n\telse\n\t\troot[\"WebGLCompute\"] = factory();\n})(self, function() {\nreturn ","import { isDataView } from \"./is\";\nimport { convertToNumber, roundToFloat16Bits } from \"./lib\";\n\n/**\n * returns an unsigned 16-bit float at the specified byte offset from the start of the DataView.\n * @param {DataView} dataView\n * @param {number} byteOffset\n * @param {[boolean]} opts\n * @returns {number}\n */\nexport function getFloat16(dataView, byteOffset, ...opts) {\n    if (!isDataView(dataView)) {\n        throw new TypeError(\"First argument to getFloat16 function must be a DataView\");\n    }\n\n    return convertToNumber( dataView.getUint16(byteOffset, ...opts) );\n}\n\n/**\n * stores an unsigned 16-bit float value at the specified byte offset from the start of the DataView.\n * @param {DataView} dataView\n * @param {number} byteOffset\n * @param {number} value\n * @param {[boolean]} opts\n */\nexport function setFloat16(dataView, byteOffset, value, ...opts) {\n    if (!isDataView(dataView)) {\n        throw new TypeError(\"First argument to setFloat16 function must be a DataView\");\n    }\n\n    dataView.setUint16(byteOffset, roundToFloat16Bits(value), ...opts);\n}\n","import { convertToNumber, roundToFloat16Bits } from \"./lib\";\n\n/**\n * returns the nearest half precision float representation of a number.\n * @param {number} num\n * @returns {number}\n */\nexport default function hfround(num) {\n    num = Number(num);\n\n    // for optimization\n    if (!Number.isFinite(num) || num === 0) {\n        return num;\n    }\n\n    const x16 = roundToFloat16Bits(num);\n    return convertToNumber(x16);\n}\n","// algorithm: ftp://ftp.fox-toolkit.org/pub/fasthalffloatconversion.pdf\n\nconst buffer = new ArrayBuffer(4);\nconst floatView = new Float32Array(buffer);\nconst uint32View = new Uint32Array(buffer);\n\n\nconst baseTable = new Uint32Array(512);\nconst shiftTable = new Uint32Array(512);\n\nfor(let i = 0; i < 256; ++i) {\n    const e = i - 127;\n\n    // very small number (0, -0)\n    if (e < -27) {\n        baseTable[i | 0x000] = 0x0000;\n        baseTable[i | 0x100] = 0x8000;\n        shiftTable[i | 0x000] = 24;\n        shiftTable[i | 0x100] = 24;\n\n    // small number (denorm)\n    } else if (e < -14) {\n        baseTable[i | 0x000] =  0x0400 >> (-e - 14);\n        baseTable[i | 0x100] = (0x0400 >> (-e - 14)) | 0x8000;\n        shiftTable[i | 0x000] = -e - 1;\n        shiftTable[i | 0x100] = -e - 1;\n\n    // normal number\n    } else if (e <= 15) {\n        baseTable[i | 0x000] =  (e + 15) << 10;\n        baseTable[i | 0x100] = ((e + 15) << 10) | 0x8000;\n        shiftTable[i | 0x000] = 13;\n        shiftTable[i | 0x100] = 13;\n\n    // large number (Infinity, -Infinity)\n    } else if (e < 128) {\n        baseTable[i | 0x000] = 0x7c00;\n        baseTable[i | 0x100] = 0xfc00;\n        shiftTable[i | 0x000] = 24;\n        shiftTable[i | 0x100] = 24;\n\n    // stay (NaN, Infinity, -Infinity)\n    } else {\n        baseTable[i | 0x000] = 0x7c00;\n        baseTable[i | 0x100] = 0xfc00;\n        shiftTable[i | 0x000] = 13;\n        shiftTable[i | 0x100] = 13;\n    }\n}\n\n/**\n * round a number to a half float number bits.\n * @param {number} num - double float\n * @returns {number} half float number bits\n */\nexport function roundToFloat16Bits(num) {\n    floatView[0] = num;\n\n    const f = uint32View[0];\n    const e = (f >> 23) & 0x1ff;\n    return baseTable[e] + ((f & 0x007fffff) >> shiftTable[e]);\n}\n\n\nconst mantissaTable = new Uint32Array(2048);\nconst exponentTable = new Uint32Array(64);\nconst offsetTable = new Uint32Array(64);\n\nmantissaTable[0] = 0;\nfor(let i = 1; i < 1024; ++i) {\n    let m = i << 13;    // zero pad mantissa bits\n    let e = 0;          // zero exponent\n\n    // normalized\n    while((m & 0x00800000) === 0) {\n        e -= 0x00800000;    // decrement exponent\n        m <<= 1;\n    }\n\n    m &= ~0x00800000;   // clear leading 1 bit\n    e += 0x38800000;    // adjust bias\n\n    mantissaTable[i] = m | e;\n}\nfor(let i = 1024; i < 2048; ++i) {\n    mantissaTable[i] = 0x38000000 + ((i - 1024) << 13);\n}\n\nexponentTable[0] = 0;\nfor(let i = 1; i < 31; ++i) {\n    exponentTable[i] = i << 23;\n}\nexponentTable[31] = 0x47800000;\nexponentTable[32] = 0x80000000;\nfor(let i = 33; i < 63; ++i) {\n    exponentTable[i] = 0x80000000 + ((i - 32) << 23);\n}\nexponentTable[63] = 0xc7800000;\n\noffsetTable[0] = 0;\nfor(let i = 1; i < 64; ++i) {\n    if (i === 32) {\n        offsetTable[i] = 0;\n    } else {\n        offsetTable[i] = 1024;\n    }\n}\n\n/**\n * convert a half float number bits to a number.\n * @param {number} float16bits - half float number bits\n * @returns {number} double float\n */\nexport function convertToNumber(float16bits) {\n    const m = float16bits >> 10;\n    uint32View[0] = mantissaTable[offsetTable[m] + (float16bits & 0x3ff)] + exponentTable[m];\n    return floatView[0];\n}\n","import freeGlobal from './_freeGlobal.js';\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\nexport default root;\n","import root from './_root.js';\n\n/** Built-in value references. */\nvar Symbol = root.Symbol;\n\nexport default Symbol;\n","import Symbol from './_Symbol.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * A specialized version of `baseGetTag` which ignores `Symbol.toStringTag` values.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the raw `toStringTag`.\n */\nfunction getRawTag(value) {\n  var isOwn = hasOwnProperty.call(value, symToStringTag),\n      tag = value[symToStringTag];\n\n  try {\n    value[symToStringTag] = undefined;\n    var unmasked = true;\n  } catch (e) {}\n\n  var result = nativeObjectToString.call(value);\n  if (unmasked) {\n    if (isOwn) {\n      value[symToStringTag] = tag;\n    } else {\n      delete value[symToStringTag];\n    }\n  }\n  return result;\n}\n\nexport default getRawTag;\n","/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/**\n * Converts `value` to a string using `Object.prototype.toString`.\n *\n * @private\n * @param {*} value The value to convert.\n * @returns {string} Returns the converted string.\n */\nfunction objectToString(value) {\n  return nativeObjectToString.call(value);\n}\n\nexport default objectToString;\n","import Symbol from './_Symbol.js';\nimport getRawTag from './_getRawTag.js';\nimport objectToString from './_objectToString.js';\n\n/** `Object#toString` result references. */\nvar nullTag = '[object Null]',\n    undefinedTag = '[object Undefined]';\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * The base implementation of `getTag` without fallbacks for buggy environments.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nfunction baseGetTag(value) {\n  if (value == null) {\n    return value === undefined ? undefinedTag : nullTag;\n  }\n  return (symToStringTag && symToStringTag in Object(value))\n    ? getRawTag(value)\n    : objectToString(value);\n}\n\nexport default baseGetTag;\n","/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return value != null && (type == 'object' || type == 'function');\n}\n\nexport default isObject;\n","import baseGetTag from './_baseGetTag.js';\nimport isObject from './isObject.js';\n\n/** `Object#toString` result references. */\nvar asyncTag = '[object AsyncFunction]',\n    funcTag = '[object Function]',\n    genTag = '[object GeneratorFunction]',\n    proxyTag = '[object Proxy]';\n\n/**\n * Checks if `value` is classified as a `Function` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a function, else `false`.\n * @example\n *\n * _.isFunction(_);\n * // => true\n *\n * _.isFunction(/abc/);\n * // => false\n */\nfunction isFunction(value) {\n  if (!isObject(value)) {\n    return false;\n  }\n  // The use of `Object#toString` avoids issues with the `typeof` operator\n  // in Safari 9 which returns 'object' for typed arrays and other constructors.\n  var tag = baseGetTag(value);\n  return tag == funcTag || tag == genTag || tag == asyncTag || tag == proxyTag;\n}\n\nexport default isFunction;\n","import root from './_root.js';\n\n/** Used to detect overreaching core-js shims. */\nvar coreJsData = root['__core-js_shared__'];\n\nexport default coreJsData;\n","import coreJsData from './_coreJsData.js';\n\n/** Used to detect methods masquerading as native. */\nvar maskSrcKey = (function() {\n  var uid = /[^.]+$/.exec(coreJsData && coreJsData.keys && coreJsData.keys.IE_PROTO || '');\n  return uid ? ('Symbol(src)_1.' + uid) : '';\n}());\n\n/**\n * Checks if `func` has its source masked.\n *\n * @private\n * @param {Function} func The function to check.\n * @returns {boolean} Returns `true` if `func` is masked, else `false`.\n */\nfunction isMasked(func) {\n  return !!maskSrcKey && (maskSrcKey in func);\n}\n\nexport default isMasked;\n","/** Used for built-in method references. */\nvar funcProto = Function.prototype;\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/**\n * Converts `func` to its source code.\n *\n * @private\n * @param {Function} func The function to convert.\n * @returns {string} Returns the source code.\n */\nfunction toSource(func) {\n  if (func != null) {\n    try {\n      return funcToString.call(func);\n    } catch (e) {}\n    try {\n      return (func + '');\n    } catch (e) {}\n  }\n  return '';\n}\n\nexport default toSource;\n","import isFunction from './isFunction.js';\nimport isMasked from './_isMasked.js';\nimport isObject from './isObject.js';\nimport toSource from './_toSource.js';\n\n/**\n * Used to match `RegExp`\n * [syntax characters](http://ecma-international.org/ecma-262/7.0/#sec-patterns).\n */\nvar reRegExpChar = /[\\\\^$.*+?()[\\]{}|]/g;\n\n/** Used to detect host constructors (Safari). */\nvar reIsHostCtor = /^\\[object .+?Constructor\\]$/;\n\n/** Used for built-in method references. */\nvar funcProto = Function.prototype,\n    objectProto = Object.prototype;\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/** Used to detect if a method is native. */\nvar reIsNative = RegExp('^' +\n  funcToString.call(hasOwnProperty).replace(reRegExpChar, '\\\\$&')\n  .replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g, '$1.*?') + '$'\n);\n\n/**\n * The base implementation of `_.isNative` without bad shim checks.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a native function,\n *  else `false`.\n */\nfunction baseIsNative(value) {\n  if (!isObject(value) || isMasked(value)) {\n    return false;\n  }\n  var pattern = isFunction(value) ? reIsNative : reIsHostCtor;\n  return pattern.test(toSource(value));\n}\n\nexport default baseIsNative;\n","/**\n * Gets the value at `key` of `object`.\n *\n * @private\n * @param {Object} [object] The object to query.\n * @param {string} key The key of the property to get.\n * @returns {*} Returns the property value.\n */\nfunction getValue(object, key) {\n  return object == null ? undefined : object[key];\n}\n\nexport default getValue;\n","import baseIsNative from './_baseIsNative.js';\nimport getValue from './_getValue.js';\n\n/**\n * Gets the native function at `key` of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {string} key The key of the method to get.\n * @returns {*} Returns the function if it's native, else `undefined`.\n */\nfunction getNative(object, key) {\n  var value = getValue(object, key);\n  return baseIsNative(value) ? value : undefined;\n}\n\nexport default getNative;\n","import getNative from './_getNative.js';\n\n/* Built-in method references that are verified to be native. */\nvar nativeCreate = getNative(Object, 'create');\n\nexport default nativeCreate;\n","/**\n * Removes `key` and its value from the hash.\n *\n * @private\n * @name delete\n * @memberOf Hash\n * @param {Object} hash The hash to modify.\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction hashDelete(key) {\n  var result = this.has(key) && delete this.__data__[key];\n  this.size -= result ? 1 : 0;\n  return result;\n}\n\nexport default hashDelete;\n","import nativeCreate from './_nativeCreate.js';\n\n/** Used to stand-in for `undefined` hash values. */\nvar HASH_UNDEFINED = '__lodash_hash_undefined__';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Gets the hash value for `key`.\n *\n * @private\n * @name get\n * @memberOf Hash\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction hashGet(key) {\n  var data = this.__data__;\n  if (nativeCreate) {\n    var result = data[key];\n    return result === HASH_UNDEFINED ? undefined : result;\n  }\n  return hasOwnProperty.call(data, key) ? data[key] : undefined;\n}\n\nexport default hashGet;\n","import nativeCreate from './_nativeCreate.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Checks if a hash value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf Hash\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction hashHas(key) {\n  var data = this.__data__;\n  return nativeCreate ? (data[key] !== undefined) : hasOwnProperty.call(data, key);\n}\n\nexport default hashHas;\n","import nativeCreate from './_nativeCreate.js';\n\n/** Used to stand-in for `undefined` hash values. */\nvar HASH_UNDEFINED = '__lodash_hash_undefined__';\n\n/**\n * Sets the hash `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf Hash\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the hash instance.\n */\nfunction hashSet(key, value) {\n  var data = this.__data__;\n  this.size += this.has(key) ? 0 : 1;\n  data[key] = (nativeCreate && value === undefined) ? HASH_UNDEFINED : value;\n  return this;\n}\n\nexport default hashSet;\n","import hashClear from './_hashClear.js';\nimport hashDelete from './_hashDelete.js';\nimport hashGet from './_hashGet.js';\nimport hashHas from './_hashHas.js';\nimport hashSet from './_hashSet.js';\n\n/**\n * Creates a hash object.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction Hash(entries) {\n  var index = -1,\n      length = entries == null ? 0 : entries.length;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n// Add methods to `Hash`.\nHash.prototype.clear = hashClear;\nHash.prototype['delete'] = hashDelete;\nHash.prototype.get = hashGet;\nHash.prototype.has = hashHas;\nHash.prototype.set = hashSet;\n\nexport default Hash;\n","import nativeCreate from './_nativeCreate.js';\n\n/**\n * Removes all key-value entries from the hash.\n *\n * @private\n * @name clear\n * @memberOf Hash\n */\nfunction hashClear() {\n  this.__data__ = nativeCreate ? nativeCreate(null) : {};\n  this.size = 0;\n}\n\nexport default hashClear;\n","/**\n * Performs a\n * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n * comparison between two values to determine if they are equivalent.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to compare.\n * @param {*} other The other value to compare.\n * @returns {boolean} Returns `true` if the values are equivalent, else `false`.\n * @example\n *\n * var object = { 'a': 1 };\n * var other = { 'a': 1 };\n *\n * _.eq(object, object);\n * // => true\n *\n * _.eq(object, other);\n * // => false\n *\n * _.eq('a', 'a');\n * // => true\n *\n * _.eq('a', Object('a'));\n * // => false\n *\n * _.eq(NaN, NaN);\n * // => true\n */\nfunction eq(value, other) {\n  return value === other || (value !== value && other !== other);\n}\n\nexport default eq;\n","import eq from './eq.js';\n\n/**\n * Gets the index at which the `key` is found in `array` of key-value pairs.\n *\n * @private\n * @param {Array} array The array to inspect.\n * @param {*} key The key to search for.\n * @returns {number} Returns the index of the matched value, else `-1`.\n */\nfunction assocIndexOf(array, key) {\n  var length = array.length;\n  while (length--) {\n    if (eq(array[length][0], key)) {\n      return length;\n    }\n  }\n  return -1;\n}\n\nexport default assocIndexOf;\n","import assocIndexOf from './_assocIndexOf.js';\n\n/** Used for built-in method references. */\nvar arrayProto = Array.prototype;\n\n/** Built-in value references. */\nvar splice = arrayProto.splice;\n\n/**\n * Removes `key` and its value from the list cache.\n *\n * @private\n * @name delete\n * @memberOf ListCache\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction listCacheDelete(key) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  if (index < 0) {\n    return false;\n  }\n  var lastIndex = data.length - 1;\n  if (index == lastIndex) {\n    data.pop();\n  } else {\n    splice.call(data, index, 1);\n  }\n  --this.size;\n  return true;\n}\n\nexport default listCacheDelete;\n","import assocIndexOf from './_assocIndexOf.js';\n\n/**\n * Gets the list cache value for `key`.\n *\n * @private\n * @name get\n * @memberOf ListCache\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction listCacheGet(key) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  return index < 0 ? undefined : data[index][1];\n}\n\nexport default listCacheGet;\n","import assocIndexOf from './_assocIndexOf.js';\n\n/**\n * Checks if a list cache value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf ListCache\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction listCacheHas(key) {\n  return assocIndexOf(this.__data__, key) > -1;\n}\n\nexport default listCacheHas;\n","import assocIndexOf from './_assocIndexOf.js';\n\n/**\n * Sets the list cache `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf ListCache\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the list cache instance.\n */\nfunction listCacheSet(key, value) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  if (index < 0) {\n    ++this.size;\n    data.push([key, value]);\n  } else {\n    data[index][1] = value;\n  }\n  return this;\n}\n\nexport default listCacheSet;\n","import listCacheClear from './_listCacheClear.js';\nimport listCacheDelete from './_listCacheDelete.js';\nimport listCacheGet from './_listCacheGet.js';\nimport listCacheHas from './_listCacheHas.js';\nimport listCacheSet from './_listCacheSet.js';\n\n/**\n * Creates an list cache object.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction ListCache(entries) {\n  var index = -1,\n      length = entries == null ? 0 : entries.length;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n// Add methods to `ListCache`.\nListCache.prototype.clear = listCacheClear;\nListCache.prototype['delete'] = listCacheDelete;\nListCache.prototype.get = listCacheGet;\nListCache.prototype.has = listCacheHas;\nListCache.prototype.set = listCacheSet;\n\nexport default ListCache;\n","/**\n * Removes all key-value entries from the list cache.\n *\n * @private\n * @name clear\n * @memberOf ListCache\n */\nfunction listCacheClear() {\n  this.__data__ = [];\n  this.size = 0;\n}\n\nexport default listCacheClear;\n","import getNative from './_getNative.js';\nimport root from './_root.js';\n\n/* Built-in method references that are verified to be native. */\nvar Map = getNative(root, 'Map');\n\nexport default Map;\n","import Hash from './_Hash.js';\nimport ListCache from './_ListCache.js';\nimport Map from './_Map.js';\n\n/**\n * Removes all key-value entries from the map.\n *\n * @private\n * @name clear\n * @memberOf MapCache\n */\nfunction mapCacheClear() {\n  this.size = 0;\n  this.__data__ = {\n    'hash': new Hash,\n    'map': new (Map || ListCache),\n    'string': new Hash\n  };\n}\n\nexport default mapCacheClear;\n","/**\n * Checks if `value` is suitable for use as unique object key.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is suitable, else `false`.\n */\nfunction isKeyable(value) {\n  var type = typeof value;\n  return (type == 'string' || type == 'number' || type == 'symbol' || type == 'boolean')\n    ? (value !== '__proto__')\n    : (value === null);\n}\n\nexport default isKeyable;\n","import isKeyable from './_isKeyable.js';\n\n/**\n * Gets the data for `map`.\n *\n * @private\n * @param {Object} map The map to query.\n * @param {string} key The reference key.\n * @returns {*} Returns the map data.\n */\nfunction getMapData(map, key) {\n  var data = map.__data__;\n  return isKeyable(key)\n    ? data[typeof key == 'string' ? 'string' : 'hash']\n    : data.map;\n}\n\nexport default getMapData;\n","import getMapData from './_getMapData.js';\n\n/**\n * Removes `key` and its value from the map.\n *\n * @private\n * @name delete\n * @memberOf MapCache\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction mapCacheDelete(key) {\n  var result = getMapData(this, key)['delete'](key);\n  this.size -= result ? 1 : 0;\n  return result;\n}\n\nexport default mapCacheDelete;\n","import getMapData from './_getMapData.js';\n\n/**\n * Gets the map value for `key`.\n *\n * @private\n * @name get\n * @memberOf MapCache\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction mapCacheGet(key) {\n  return getMapData(this, key).get(key);\n}\n\nexport default mapCacheGet;\n","import getMapData from './_getMapData.js';\n\n/**\n * Checks if a map value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf MapCache\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction mapCacheHas(key) {\n  return getMapData(this, key).has(key);\n}\n\nexport default mapCacheHas;\n","import getMapData from './_getMapData.js';\n\n/**\n * Sets the map `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf MapCache\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the map cache instance.\n */\nfunction mapCacheSet(key, value) {\n  var data = getMapData(this, key),\n      size = data.size;\n\n  data.set(key, value);\n  this.size += data.size == size ? 0 : 1;\n  return this;\n}\n\nexport default mapCacheSet;\n","import mapCacheClear from './_mapCacheClear.js';\nimport mapCacheDelete from './_mapCacheDelete.js';\nimport mapCacheGet from './_mapCacheGet.js';\nimport mapCacheHas from './_mapCacheHas.js';\nimport mapCacheSet from './_mapCacheSet.js';\n\n/**\n * Creates a map cache object to store key-value pairs.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction MapCache(entries) {\n  var index = -1,\n      length = entries == null ? 0 : entries.length;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n// Add methods to `MapCache`.\nMapCache.prototype.clear = mapCacheClear;\nMapCache.prototype['delete'] = mapCacheDelete;\nMapCache.prototype.get = mapCacheGet;\nMapCache.prototype.has = mapCacheHas;\nMapCache.prototype.set = mapCacheSet;\n\nexport default MapCache;\n","import MapCache from './_MapCache.js';\n\n/** Error message constants. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/**\n * Creates a function that memoizes the result of `func`. If `resolver` is\n * provided, it determines the cache key for storing the result based on the\n * arguments provided to the memoized function. By default, the first argument\n * provided to the memoized function is used as the map cache key. The `func`\n * is invoked with the `this` binding of the memoized function.\n *\n * **Note:** The cache is exposed as the `cache` property on the memoized\n * function. Its creation may be customized by replacing the `_.memoize.Cache`\n * constructor with one whose instances implement the\n * [`Map`](http://ecma-international.org/ecma-262/7.0/#sec-properties-of-the-map-prototype-object)\n * method interface of `clear`, `delete`, `get`, `has`, and `set`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to have its output memoized.\n * @param {Function} [resolver] The function to resolve the cache key.\n * @returns {Function} Returns the new memoized function.\n * @example\n *\n * var object = { 'a': 1, 'b': 2 };\n * var other = { 'c': 3, 'd': 4 };\n *\n * var values = _.memoize(_.values);\n * values(object);\n * // => [1, 2]\n *\n * values(other);\n * // => [3, 4]\n *\n * object.a = 2;\n * values(object);\n * // => [1, 2]\n *\n * // Modify the result cache.\n * values.cache.set(object, ['a', 'b']);\n * values(object);\n * // => ['a', 'b']\n *\n * // Replace `_.memoize.Cache`.\n * _.memoize.Cache = WeakMap;\n */\nfunction memoize(func, resolver) {\n  if (typeof func != 'function' || (resolver != null && typeof resolver != 'function')) {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  var memoized = function() {\n    var args = arguments,\n        key = resolver ? resolver.apply(this, args) : args[0],\n        cache = memoized.cache;\n\n    if (cache.has(key)) {\n      return cache.get(key);\n    }\n    var result = func.apply(this, args);\n    memoized.cache = cache.set(key, result) || cache;\n    return result;\n  };\n  memoized.cache = new (memoize.Cache || MapCache);\n  return memoized;\n}\n\n// Expose `MapCache`.\nmemoize.Cache = MapCache;\n\nexport default memoize;\n","/**\n * JavaScriptCore <= 12 bug\n * @see https://bugs.webkit.org/show_bug.cgi?id=171606\n */\nexport const isTypedArrayIndexedPropertyWritable = Object.getOwnPropertyDescriptor(new Uint8Array(1), 0).writable;\n","/**\n * @param {unknown} target\n * @returns {number}\n */\nexport function ToInteger(target) {\n    let number = typeof target !== \"number\" ? Number(target) : target;\n    if (Number.isNaN(number)) {\n        number = 0;\n    }\n    return Math.trunc(number);\n}\n\n/**\n * @param {number} x\n * @param {number} y\n * @returns {-1 | 0 | 1}\n */\nexport function defaultCompareFunction(x, y) {\n    const [isNaN_x, isNaN_y] = [Number.isNaN(x), Number.isNaN(y)];\n\n    if (isNaN_x && isNaN_y) {\n        return 0;\n    }\n\n    if (isNaN_x) {\n        return 1;\n    }\n\n    if (isNaN_y) {\n        return -1;\n    }\n\n    if (x < y) {\n        return -1;\n    }\n\n    if (x > y) {\n        return 1;\n    }\n\n    if (x === 0 && y === 0) {\n        const [isPlusZero_x, isPlusZero_y] = [Object.is(x, 0), Object.is(y, 0)];\n\n        if (!isPlusZero_x && isPlusZero_y) {\n            return -1;\n        }\n\n        if (isPlusZero_x && !isPlusZero_y) {\n            return 1;\n        }\n    }\n\n    return 0;\n}\n","import { ToInteger } from \"./spec\";\n\nexport { default as isArrayBuffer } from \"lodash-es/isArrayBuffer\";\n\n/**\n * @param {unknown} view\n * @returns {boolean}\n */\nexport function isDataView(view) {\n    return view instanceof DataView;\n}\n\n/**\n * @param {unknown} key\n * @returns {boolean}\n */\nexport function isStringNumberKey(key) {\n    return typeof key === \"string\" && key === ToInteger(key) + \"\";\n}\n","/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return value != null && typeof value == 'object';\n}\n\nexport default isObjectLike;\n","import baseGetTag from './_baseGetTag.js';\nimport isObjectLike from './isObjectLike.js';\n\nvar arrayBufferTag = '[object ArrayBuffer]';\n\n/**\n * The base implementation of `_.isArrayBuffer` without Node.js optimizations.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an array buffer, else `false`.\n */\nfunction baseIsArrayBuffer(value) {\n  return isObjectLike(value) && baseGetTag(value) == arrayBufferTag;\n}\n\nexport default baseIsArrayBuffer;\n","/**\n * The base implementation of `_.unary` without support for storing metadata.\n *\n * @private\n * @param {Function} func The function to cap arguments for.\n * @returns {Function} Returns the new capped function.\n */\nfunction baseUnary(func) {\n  return function(value) {\n    return func(value);\n  };\n}\n\nexport default baseUnary;\n","import baseIsArrayBuffer from './_baseIsArrayBuffer.js';\nimport baseUnary from './_baseUnary.js';\nimport nodeUtil from './_nodeUtil.js';\n\n/* Node.js helper references. */\nvar nodeIsArrayBuffer = nodeUtil && nodeUtil.isArrayBuffer;\n\n/**\n * Checks if `value` is classified as an `ArrayBuffer` object.\n *\n * @static\n * @memberOf _\n * @since 4.3.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an array buffer, else `false`.\n * @example\n *\n * _.isArrayBuffer(new ArrayBuffer(2));\n * // => true\n *\n * _.isArrayBuffer(new Array(2));\n * // => false\n */\nvar isArrayBuffer = nodeIsArrayBuffer ? baseUnary(nodeIsArrayBuffer) : baseIsArrayBuffer;\n\nexport default isArrayBuffer;\n","import memoize from \"lodash-es/memoize\";\nimport { isTypedArrayIndexedPropertyWritable } from \"./bug\";\nimport { isArrayBuffer, isStringNumberKey } from \"./is\";\nimport { convertToNumber, roundToFloat16Bits } from \"./lib\";\nimport { createPrivateStorage } from \"./private\";\nimport { ToInteger, defaultCompareFunction } from \"./spec\";\n\nconst _ = createPrivateStorage();\n\n/**\n * @param {unknown} target\n * @returns {boolean}\n */\nfunction isFloat16Array(target) {\n    return target instanceof Float16Array;\n}\n\n/**\n * @param {unknown} target\n * @throws {TypeError}\n */\nfunction assertFloat16Array(target) {\n    if (!isFloat16Array(target)) {\n        throw new TypeError(\"This is not a Float16Array\");\n    }\n}\n\n/**\n * @param {unknown} target\n * @returns {boolean}\n */\nfunction isDefaultFloat16ArrayMethods(target) {\n    return typeof target === \"function\" && defaultFloat16ArrayMethods.has(target);\n}\n\n/**\n * @param {Float16Array} float16bits\n * @return {number[]}\n */\nfunction copyToArray(float16bits) {\n    const length = float16bits.length;\n\n    const array = new Array(length);\n    for(let i = 0; i < length; ++i) {\n        array[i] = convertToNumber(float16bits[i]);\n    }\n\n    return array;\n}\n\n/** @type {ProxyHandler<Function>} */\nconst applyHandler = {\n    apply(func, thisArg, args) {\n        // peel off proxy\n        if (isFloat16Array(thisArg) && isDefaultFloat16ArrayMethods(func)) {\n            return Reflect.apply(func, _(thisArg).target ,args);\n        }\n\n        return Reflect.apply(func, thisArg, args);\n    },\n};\n\n/** @type {ProxyHandler<Float16Array>} */\nconst handler = {\n    get(target, key) {\n        let wrapper = null;\n        if (!isTypedArrayIndexedPropertyWritable) {\n            wrapper = target;\n            target = _(wrapper).target;\n        }\n\n        if (isStringNumberKey(key)) {\n            return Reflect.has(target, key) ? convertToNumber(Reflect.get(target, key)) : undefined;\n        } else {\n            const ret = wrapper !== null && Reflect.has(wrapper, key) ? Reflect.get(wrapper, key) : Reflect.get(target, key);\n\n            if (typeof ret !== \"function\") {\n                return ret;\n            }\n\n            // TypedArray methods can't be called by Proxy Object\n            let proxy = _(ret).proxy;\n\n            if (proxy === undefined) {\n                proxy = _(ret).proxy = new Proxy(ret, applyHandler);\n            }\n\n            return proxy;\n        }\n    },\n\n    set(target, key, value) {\n        let wrapper = null;\n        if (!isTypedArrayIndexedPropertyWritable) {\n            wrapper = target;\n            target = _(wrapper).target;\n        }\n\n        if (isStringNumberKey(key)) {\n            return Reflect.set(target, key, roundToFloat16Bits(value));\n        } else {\n            // frozen object can't change prototype property\n            if (wrapper !== null && (!Reflect.has(target, key) || Object.isFrozen(wrapper))) {\n                return Reflect.set(wrapper, key, value);\n            } else {\n                return Reflect.set(target, key, value);\n            }\n        }\n    },\n};\n\nif (!isTypedArrayIndexedPropertyWritable) {\n    handler.getPrototypeOf = (wrapper) => { return Reflect.getPrototypeOf(_(wrapper).target); };\n    handler.setPrototypeOf = (wrapper, prototype) => { return Reflect.setPrototypeOf(_(wrapper).target, prototype); };\n\n    handler.defineProperty = (wrapper, key, descriptor) => {\n        const target = _(wrapper).target;\n        return !Reflect.has(target, key) || Object.isFrozen(wrapper) ? Reflect.defineProperty(wrapper, key, descriptor) : Reflect.defineProperty(target, key, descriptor);\n    };\n    handler.deleteProperty = (wrapper, key) => {\n        const target = _(wrapper).target;\n        return Reflect.has(wrapper, key) ? Reflect.deleteProperty(wrapper, key) : Reflect.deleteProperty(target, key);\n    };\n\n    handler.has = (wrapper, key) => { return Reflect.has(wrapper, key) || Reflect.has(_(wrapper).target, key); };\n\n    handler.isExtensible = (wrapper) => { return Reflect.isExtensible(wrapper); };\n    handler.preventExtensions = (wrapper) => { return Reflect.preventExtensions(wrapper); };\n\n    handler.getOwnPropertyDescriptor = (wrapper, key) => { return Reflect.getOwnPropertyDescriptor(wrapper, key); };\n    handler.ownKeys = (wrapper) => { return Reflect.ownKeys(wrapper); };\n}\n\nexport default class Float16Array extends Uint16Array {\n\n    constructor(input, byteOffset, length) {\n        // input Float16Array\n        if (isFloat16Array(input)) {\n            super(_(input).target);\n\n        // 22.2.1.3, 22.2.1.4 TypedArray, Array, ArrayLike, Iterable\n        } else if (input !== null && typeof input === \"object\" && !isArrayBuffer(input)) {\n            // if input is not ArrayLike and Iterable, get Array\n            const arrayLike = !Reflect.has(input, \"length\") && input[Symbol.iterator] !== undefined ? [...input] : input;\n\n            const length = arrayLike.length;\n            super(length);\n\n            for(let i = 0; i < length; ++i) {\n                // super (Uint16Array)\n                this[i] = roundToFloat16Bits(arrayLike[i]);\n            }\n\n        // 22.2.1.2, 22.2.1.5 primitive, ArrayBuffer\n        } else {\n            switch(arguments.length) {\n                case 0:\n                    super();\n                    break;\n\n                case 1:\n                    super(input);\n                    break;\n\n                case 2:\n                    super(input, byteOffset);\n                    break;\n\n                case 3:\n                    super(input, byteOffset, length);\n                    break;\n\n                default:\n                    // @ts-ignore\n                    super(...arguments);\n            }\n        }\n\n        let proxy;\n\n        if (isTypedArrayIndexedPropertyWritable) {\n            proxy = new Proxy(this, handler);\n        } else {\n            const wrapper = Object.create(null);\n            _(wrapper).target = this;\n            proxy = new Proxy(wrapper, handler);\n        }\n\n        // proxy private storage\n        _(proxy).target = this;\n\n        // this private storage\n        _(this).proxy = proxy;\n\n        return proxy;\n    }\n\n    // static methods\n    static from(src, ...opts) {\n        if (opts.length === 0) {\n            return new Float16Array(Uint16Array.from(src, roundToFloat16Bits).buffer);\n        }\n\n        const mapFunc = opts[0];\n        const thisArg = opts[1];\n\n        return new Float16Array(Uint16Array.from(src, function (val, ...args) {\n            return roundToFloat16Bits(mapFunc.call(this, val, ...args));\n        }, thisArg).buffer);\n    }\n\n    static of(...args) {\n        return new Float16Array(args);\n    }\n\n    // iterate methods\n    * [Symbol.iterator]() {\n        for(const val of super[Symbol.iterator]()) {\n            yield convertToNumber(val);\n        }\n    }\n\n    keys() {\n        return super.keys();\n    }\n\n    * values() {\n        for(const val of super.values()) {\n            yield convertToNumber(val);\n        }\n    }\n\n    /** @type {() => IterableIterator<[number, number]>} */\n    * entries() {\n        for(const [i, val] of super.entries()) {\n            yield [i, convertToNumber(val)];\n        }\n    }\n\n    // functional methods\n    // @ts-ignore\n    map(callback, ...opts) {\n        assertFloat16Array(this);\n\n        const thisArg = opts[0];\n\n        const array = [];\n        for(let i = 0, l = this.length; i < l; ++i) {\n            const val = convertToNumber(this[i]);\n            array.push(callback.call(thisArg, val, i, _(this).proxy));\n        }\n\n        return new Float16Array(array);\n    }\n\n    // @ts-ignore\n    filter(callback, ...opts) {\n        assertFloat16Array(this);\n\n        const thisArg = opts[0];\n\n        const array = [];\n        for(let i = 0, l = this.length; i < l; ++i) {\n            const val = convertToNumber(this[i]);\n            if (callback.call(thisArg, val, i, _(this).proxy)) {\n                array.push(val);\n            }\n        }\n\n        return new Float16Array(array);\n    }\n\n    reduce(callback, ...opts) {\n        assertFloat16Array(this);\n\n        let val, start;\n\n        if (opts.length === 0) {\n            val = convertToNumber(this[0]);\n            start = 1;\n        } else {\n            val = opts[0];\n            start = 0;\n        }\n\n        for(let i = start, l = this.length; i < l; ++i) {\n            val = callback(val, convertToNumber(this[i]), i, _(this).proxy);\n        }\n\n        return val;\n    }\n\n    reduceRight(callback, ...opts) {\n        assertFloat16Array(this);\n\n        let val, start;\n\n        const length = this.length;\n        if (opts.length === 0) {\n            val = convertToNumber(this[length - 1]);\n            start = length - 1;\n        } else {\n            val = opts[0];\n            start = length;\n        }\n\n        for(let i = start; i--;) {\n            val = callback(val, convertToNumber(this[i]), i, _(this).proxy);\n        }\n\n        return val;\n    }\n\n    forEach(callback, ...opts) {\n        assertFloat16Array(this);\n\n        const thisArg = opts[0];\n\n        for(let i = 0, l = this.length; i < l; ++i) {\n            callback.call(thisArg, convertToNumber(this[i]), i, _(this).proxy);\n        }\n    }\n\n    find(callback, ...opts) {\n        assertFloat16Array(this);\n\n        const thisArg = opts[0];\n\n        for(let i = 0, l = this.length; i < l; ++i) {\n            const value = convertToNumber(this[i]);\n            if (callback.call(thisArg, value, i, _(this).proxy)) {\n                return value;\n            }\n        }\n    }\n\n    findIndex(callback, ...opts) {\n        assertFloat16Array(this);\n\n        const thisArg = opts[0];\n\n        for(let i = 0, l = this.length; i < l; ++i) {\n            const value = convertToNumber(this[i]);\n            if (callback.call(thisArg, value, i, _(this).proxy)) {\n                return i;\n            }\n        }\n\n        return -1;\n    }\n\n    every(callback, ...opts) {\n        assertFloat16Array(this);\n\n        const thisArg = opts[0];\n\n        for(let i = 0, l = this.length; i < l; ++i) {\n            if (!callback.call(thisArg, convertToNumber(this[i]), i, _(this).proxy)) {\n                return false;\n            }\n        }\n\n        return true;\n    }\n\n    some(callback, ...opts) {\n        assertFloat16Array(this);\n\n        const thisArg = opts[0];\n\n        for(let i = 0, l = this.length; i < l; ++i) {\n            if (callback.call(thisArg, convertToNumber(this[i]), i, _(this).proxy)) {\n                return true;\n            }\n        }\n\n        return false;\n    }\n\n    // change element methods\n    set(input, ...opts) {\n        assertFloat16Array(this);\n\n        const offset = opts[0];\n\n        let float16bits;\n\n        // input Float16Array\n        if (isFloat16Array(input)) {\n            float16bits = _(input).target;\n\n        // input others\n        } else {\n            const arrayLike = !Reflect.has(input, \"length\") && input[Symbol.iterator] !== undefined ? [...input] : input;\n            const length = arrayLike.length;\n\n            float16bits = new Uint16Array(length);\n            for(let i = 0, l = arrayLike.length; i < l; ++i) {\n                float16bits[i] = roundToFloat16Bits(arrayLike[i]);\n            }\n        }\n\n        super.set(float16bits, offset);\n    }\n\n    reverse() {\n        assertFloat16Array(this);\n\n        super.reverse();\n\n        return _(this).proxy;\n    }\n\n    fill(value, ...opts) {\n        assertFloat16Array(this);\n\n        super.fill(roundToFloat16Bits(value), ...opts);\n\n        return _(this).proxy;\n    }\n\n    copyWithin(target, start, ...opts) {\n        assertFloat16Array(this);\n\n        super.copyWithin(target, start, ...opts);\n\n        return _(this).proxy;\n    }\n\n    sort(...opts) {\n        assertFloat16Array(this);\n\n        let compareFunction = opts[0];\n\n        if (compareFunction === undefined) {\n            compareFunction = defaultCompareFunction;\n        }\n\n        const _convertToNumber = memoize(convertToNumber);\n\n        super.sort((x, y) => { return compareFunction(_convertToNumber(x), _convertToNumber(y)); });\n\n        return _(this).proxy;\n    }\n\n    // copy element methods\n    // @ts-ignore\n    slice(...opts) {\n        assertFloat16Array(this);\n\n        let float16bits;\n\n        // V8, SpiderMonkey, JavaScriptCore, Chakra throw TypeError\n        try {\n            float16bits = super.slice(...opts);\n        } catch(e) {\n            if (e instanceof TypeError) {\n                const uint16 = new Uint16Array(this.buffer, this.byteOffset, this.length);\n                float16bits = uint16.slice(...opts);\n            } else {\n                throw e;\n            }\n        }\n\n        return new Float16Array(float16bits.buffer);\n    }\n\n    // @ts-ignore\n    subarray(...opts) {\n        assertFloat16Array(this);\n\n        let float16bits;\n\n        // V8, SpiderMonkey, JavaScriptCore, Chakra throw TypeError\n        try {\n            float16bits = super.subarray(...opts);\n        } catch(e) {\n            if (e instanceof TypeError) {\n                const uint16 = new Uint16Array(this.buffer, this.byteOffset, this.length);\n                float16bits = uint16.subarray(...opts);\n            } else {\n                throw e;\n            }\n        }\n\n        return new Float16Array(float16bits.buffer, float16bits.byteOffset, float16bits.length);\n    }\n\n    // contains methods\n    indexOf(element, ...opts) {\n        assertFloat16Array(this);\n\n        const length = this.length;\n\n        let from = ToInteger(opts[0]);\n\n        if (from < 0) {\n            from += length;\n            if (from < 0) {\n                from = 0;\n            }\n        }\n\n        for(let i = from, l = length; i < l; ++i) {\n            if (convertToNumber(this[i]) === element) {\n                return i;\n            }\n        }\n\n        return -1;\n    }\n\n    lastIndexOf(element, ...opts) {\n        assertFloat16Array(this);\n\n        const length = this.length;\n\n        let from = ToInteger(opts[0]);\n\n        from = from === 0 ? length : from + 1;\n\n        if (from >= 0) {\n            from = from < length ? from : length;\n        } else {\n            from += length;\n        }\n\n        for(let i = from; i--;) {\n            if (convertToNumber(this[i]) === element) {\n                return i;\n            }\n        }\n\n        return -1;\n    }\n\n    includes(element, ...opts) {\n        assertFloat16Array(this);\n\n        const length = this.length;\n\n        let from = ToInteger(opts[0]);\n\n        if (from < 0) {\n            from += length;\n            if (from < 0) {\n                from = 0;\n            }\n        }\n\n        const isNaN = Number.isNaN(element);\n        for(let i = from, l = length; i < l; ++i) {\n            const value = convertToNumber(this[i]);\n\n            if (isNaN && Number.isNaN(value)) {\n                return true;\n            }\n\n            if (value === element) {\n                return true;\n            }\n        }\n\n        return false;\n    }\n\n    // string methods\n    join(...opts) {\n        assertFloat16Array(this);\n\n        const array = copyToArray(this);\n\n        return array.join(...opts);\n    }\n\n    toLocaleString(...opts) {\n        assertFloat16Array(this);\n\n        const array = copyToArray(this);\n\n        // @ts-ignore\n        return array.toLocaleString(...opts);\n    }\n\n    // @ts-ignore\n    get [Symbol.toStringTag]() {\n        if (isFloat16Array(this)) {\n            return \"Float16Array\";\n        }\n    }\n}\n\nconst Float16Array$prototype = Float16Array.prototype;\n\nconst defaultFloat16ArrayMethods = new WeakSet();\nfor(const key of Reflect.ownKeys(Float16Array$prototype)) {\n    const val = Float16Array$prototype[key];\n    if (typeof val === \"function\") {\n        defaultFloat16ArrayMethods.add(val);\n    }\n}\n","/**\n * @returns {(self:object) => object}\n */\nexport function createPrivateStorage() {\n\tconst wm = new WeakMap();\n\treturn (self) => {\n\t\tlet obj = wm.get(self);\n\t\tif (obj) {\n\t\t\treturn obj;\n\t\t} else {\n\t\t\tobj = Object.create(null);\n\t\t\twm.set(self, obj);\n\t\t\treturn obj;\n\t\t}\n\t};\n}\n","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.changeDpiBlob = changeDpiBlob;\nexports.changeDpiDataUrl = changeDpiDataUrl;\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\nfunction createPngDataTable() {\n  /* Table of CRCs of all 8-bit messages. */\n  var crcTable = new Int32Array(256);\n  for (var n = 0; n < 256; n++) {\n    var c = n;\n    for (var k = 0; k < 8; k++) {\n      c = c & 1 ? 0xedb88320 ^ c >>> 1 : c >>> 1;\n    }\n    crcTable[n] = c;\n  }\n  return crcTable;\n}\n\nfunction calcCrc(buf) {\n  var c = -1;\n  if (!pngDataTable) pngDataTable = createPngDataTable();\n  for (var n = 0; n < buf.length; n++) {\n    c = pngDataTable[(c ^ buf[n]) & 0xFF] ^ c >>> 8;\n  }\n  return c ^ -1;\n}\n\nvar pngDataTable = void 0;\n\nvar PNG = 'image/png';\nvar JPEG = 'image/jpeg';\n\n// those are 3 possible signature of the physBlock in base64.\n// the pHYs signature block is preceed by the 4 bytes of lenght. The length of\n// the block is always 9 bytes. So a phys block has always this signature:\n// 0 0 0 9 p H Y s.\n// However the data64 encoding aligns we will always find one of those 3 strings.\n// this allow us to find this particular occurence of the pHYs block without\n// converting from b64 back to string\nvar b64PhysSignature1 = 'AAlwSFlz';\nvar b64PhysSignature2 = 'AAAJcEhZ';\nvar b64PhysSignature3 = 'AAAACXBI';\n\nvar _P = 'p'.charCodeAt(0);\nvar _H = 'H'.charCodeAt(0);\nvar _Y = 'Y'.charCodeAt(0);\nvar _S = 's'.charCodeAt(0);\n\nfunction changeDpiBlob(blob, dpi) {\n  // 33 bytes are ok for pngs and jpegs\n  // to contain the information.\n  var headerChunk = blob.slice(0, 33);\n  return new Promise(function (resolve, reject) {\n    var fileReader = new FileReader();\n    fileReader.onload = function () {\n      var dataArray = new Uint8Array(fileReader.result);\n      var tail = blob.slice(33);\n      var changedArray = changeDpiOnArray(dataArray, dpi, blob.type);\n      resolve(new Blob([changedArray, tail], { type: blob.type }));\n    };\n    fileReader.readAsArrayBuffer(headerChunk);\n  });\n}\n\nfunction changeDpiDataUrl(base64Image, dpi) {\n  var dataSplitted = base64Image.split(',');\n  var format = dataSplitted[0];\n  var body = dataSplitted[1];\n  var type = void 0;\n  var headerLength = void 0;\n  var overwritepHYs = false;\n  if (format.indexOf(PNG) !== -1) {\n    type = PNG;\n    var b64Index = detectPhysChunkFromDataUrl(body);\n    // 28 bytes in dataUrl are 21bytes, length of phys chunk with everything inside.\n    if (b64Index >= 0) {\n      headerLength = Math.ceil((b64Index + 28) / 3) * 4;\n      overwritepHYs = true;\n    } else {\n      headerLength = 33 / 3 * 4;\n    }\n  }\n  if (format.indexOf(JPEG) !== -1) {\n    type = JPEG;\n    headerLength = 18 / 3 * 4;\n  }\n  // 33 bytes are ok for pngs and jpegs\n  // to contain the information.\n  var stringHeader = body.substring(0, headerLength);\n  var restOfData = body.substring(headerLength);\n  var headerBytes = atob(stringHeader);\n  var dataArray = new Uint8Array(headerBytes.length);\n  for (var i = 0; i < dataArray.length; i++) {\n    dataArray[i] = headerBytes.charCodeAt(i);\n  }\n  var finalArray = changeDpiOnArray(dataArray, dpi, type, overwritepHYs);\n  var base64Header = btoa(String.fromCharCode.apply(String, _toConsumableArray(finalArray)));\n  return [format, ',', base64Header, restOfData].join('');\n}\n\nfunction detectPhysChunkFromDataUrl(data) {\n  var b64index = data.indexOf(b64PhysSignature1);\n  if (b64index === -1) {\n    b64index = data.indexOf(b64PhysSignature2);\n  }\n  if (b64index === -1) {\n    b64index = data.indexOf(b64PhysSignature3);\n  }\n  // if b64index === -1 chunk is not found\n  return b64index;\n}\n\nfunction searchStartOfPhys(data) {\n  var length = data.length - 1;\n  // we check from the end since we cut the string in proximity of the header\n  // the header is within 21 bytes from the end.\n  for (var i = length; i >= 4; i--) {\n    if (data[i - 4] === 9 && data[i - 3] === _P && data[i - 2] === _H && data[i - 1] === _Y && data[i] === _S) {\n      return i - 3;\n    }\n  }\n}\n\nfunction changeDpiOnArray(dataArray, dpi, format, overwritepHYs) {\n  if (format === JPEG) {\n    dataArray[13] = 1; // 1 pixel per inch or 2 pixel per cm\n    dataArray[14] = dpi >> 8; // dpiX high byte\n    dataArray[15] = dpi & 0xff; // dpiX low byte\n    dataArray[16] = dpi >> 8; // dpiY high byte\n    dataArray[17] = dpi & 0xff; // dpiY low byte\n    return dataArray;\n  }\n  if (format === PNG) {\n    var physChunk = new Uint8Array(13);\n    // chunk header pHYs\n    // 9 bytes of data\n    // 4 bytes of crc\n    // this multiplication is because the standard is dpi per meter.\n    dpi *= 39.3701;\n    physChunk[0] = _P;\n    physChunk[1] = _H;\n    physChunk[2] = _Y;\n    physChunk[3] = _S;\n    physChunk[4] = dpi >>> 24; // dpiX highest byte\n    physChunk[5] = dpi >>> 16; // dpiX veryhigh byte\n    physChunk[6] = dpi >>> 8; // dpiX high byte\n    physChunk[7] = dpi & 0xff; // dpiX low byte\n    physChunk[8] = physChunk[4]; // dpiY highest byte\n    physChunk[9] = physChunk[5]; // dpiY veryhigh byte\n    physChunk[10] = physChunk[6]; // dpiY high byte\n    physChunk[11] = physChunk[7]; // dpiY low byte\n    physChunk[12] = 1; // dot per meter....\n\n    var crc = calcCrc(physChunk);\n\n    var crcChunk = new Uint8Array(4);\n    crcChunk[0] = crc >>> 24;\n    crcChunk[1] = crc >>> 16;\n    crcChunk[2] = crc >>> 8;\n    crcChunk[3] = crc & 0xff;\n\n    if (overwritepHYs) {\n      var startingIndex = searchStartOfPhys(dataArray);\n      dataArray.set(physChunk, startingIndex);\n      dataArray.set(crcChunk, startingIndex + 13);\n      return dataArray;\n    } else {\n      // i need to give back an array of data that is divisible by 3 so that\n      // dataurl encoding gives me integers, for luck this chunk is 17 + 4 = 21\n      // if it was we could add a text chunk contaning some info, untill desired\n      // length is met.\n\n      // chunk structur 4 bytes for length is 9\n      var chunkLength = new Uint8Array(4);\n      chunkLength[0] = 0;\n      chunkLength[1] = 0;\n      chunkLength[2] = 0;\n      chunkLength[3] = 9;\n\n      var finalHeader = new Uint8Array(54);\n      finalHeader.set(dataArray, 0);\n      finalHeader.set(chunkLength, 33);\n      finalHeader.set(physChunk, 37);\n      finalHeader.set(crcChunk, 50);\n      return finalHeader;\n    }\n  }\n}","(function(a,b){if(\"function\"==typeof define&&define.amd)define([],b);else if(\"undefined\"!=typeof exports)b();else{b(),a.FileSaver={exports:{}}.exports}})(this,function(){\"use strict\";function b(a,b){return\"undefined\"==typeof b?b={autoBom:!1}:\"object\"!=typeof b&&(console.warn(\"Deprecated: Expected third argument to be a object\"),b={autoBom:!b}),b.autoBom&&/^\\s*(?:text\\/\\S*|application\\/xml|\\S*\\/\\S*\\+xml)\\s*;.*charset\\s*=\\s*utf-8/i.test(a.type)?new Blob([\"\\uFEFF\",a],{type:a.type}):a}function c(a,b,c){var d=new XMLHttpRequest;d.open(\"GET\",a),d.responseType=\"blob\",d.onload=function(){g(d.response,b,c)},d.onerror=function(){console.error(\"could not download file\")},d.send()}function d(a){var b=new XMLHttpRequest;b.open(\"HEAD\",a,!1);try{b.send()}catch(a){}return 200<=b.status&&299>=b.status}function e(a){try{a.dispatchEvent(new MouseEvent(\"click\"))}catch(c){var b=document.createEvent(\"MouseEvents\");b.initMouseEvent(\"click\",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),a.dispatchEvent(b)}}var f=\"object\"==typeof window&&window.window===window?window:\"object\"==typeof self&&self.self===self?self:\"object\"==typeof global&&global.global===global?global:void 0,a=f.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),g=f.saveAs||(\"object\"!=typeof window||window!==f?function(){}:\"download\"in HTMLAnchorElement.prototype&&!a?function(b,g,h){var i=f.URL||f.webkitURL,j=document.createElement(\"a\");g=g||b.name||\"download\",j.download=g,j.rel=\"noopener\",\"string\"==typeof b?(j.href=b,j.origin===location.origin?e(j):d(j.href)?c(b,g,h):e(j,j.target=\"_blank\")):(j.href=i.createObjectURL(b),setTimeout(function(){i.revokeObjectURL(j.href)},4E4),setTimeout(function(){e(j)},0))}:\"msSaveOrOpenBlob\"in navigator?function(f,g,h){if(g=g||f.name||\"download\",\"string\"!=typeof f)navigator.msSaveOrOpenBlob(b(f,h),g);else if(d(f))c(f,g,h);else{var i=document.createElement(\"a\");i.href=f,i.target=\"_blank\",setTimeout(function(){e(i)})}}:function(b,d,e,g){if(g=g||open(\"\",\"_blank\"),g&&(g.document.title=g.document.body.innerText=\"downloading...\"),\"string\"==typeof b)return c(b,d,e);var h=\"application/octet-stream\"===b.type,i=/constructor/i.test(f.HTMLElement)||f.safari,j=/CriOS\\/[\\d]+/.test(navigator.userAgent);if((j||h&&i||a)&&\"undefined\"!=typeof FileReader){var k=new FileReader;k.onloadend=function(){var a=k.result;a=j?a:a.replace(/^data:[^;]*;/,\"data:attachment/file;\"),g?g.location.href=a:location=a,g=null},k.readAsDataURL(b)}else{var l=f.URL||f.webkitURL,m=l.createObjectURL(b);g?g.location=m:location.href=m,g=null,setTimeout(function(){l.revokeObjectURL(m)},4E4)}});f.saveAs=g.saveAs=g,\"undefined\"!=typeof module&&(module.exports=g)});\n\n//# sourceMappingURL=FileSaver.min.js.map","/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\nexport default freeGlobal;\n","import freeGlobal from './_freeGlobal.js';\n\n/** Detect free variable `exports`. */\nvar freeExports = typeof exports == 'object' && exports && !exports.nodeType && exports;\n\n/** Detect free variable `module`. */\nvar freeModule = freeExports && typeof module == 'object' && module && !module.nodeType && module;\n\n/** Detect the popular CommonJS extension `module.exports`. */\nvar moduleExports = freeModule && freeModule.exports === freeExports;\n\n/** Detect free variable `process` from Node.js. */\nvar freeProcess = moduleExports && freeGlobal.process;\n\n/** Used to access faster Node.js helpers. */\nvar nodeUtil = (function() {\n  try {\n    // Use `util.types` for Node.js 10+.\n    var types = freeModule && freeModule.require && freeModule.require('util').types;\n\n    if (types) {\n      return types;\n    }\n\n    // Legacy `process.binding('util')` for Node.js < 10.\n    return freeProcess && freeProcess.binding && freeProcess.binding('util');\n  } catch (e) {}\n}());\n\nexport default nodeUtil;\n","import {\n\tHALF_FLOAT, FLOAT, UNSIGNED_BYTE, BYTE, UNSIGNED_SHORT, SHORT, UNSIGNED_INT, INT,\n\tLINEAR, NEAREST,\n\tREPEAT, CLAMP_TO_EDGE, RGB, RGBA,\n} from './Constants';\n\nexport const validArrayTypes = [Float32Array, Uint8Array, Int8Array, Uint16Array, Int16Array, Uint32Array, Int32Array, Array];\n\nexport const validDataTypes = [HALF_FLOAT, FLOAT, UNSIGNED_BYTE, BYTE, UNSIGNED_SHORT, SHORT, UNSIGNED_INT, INT];\nexport function isValidDataType(type: string) {\n\treturn validDataTypes.indexOf(type) > -1;\n}\n\nexport const validFilters = [LINEAR, NEAREST];\nexport function isValidFilter(type: string) {\n\treturn validFilters.indexOf(type) > -1;\n}\n\nexport const validWraps = [CLAMP_TO_EDGE, REPEAT]; // MIRRORED_REPEAT\nexport function isValidWrap(type: string) {\n\treturn validWraps.indexOf(type) > -1;\n}\n\n// For image urls that are passed in and inited as textures.\nexport const validTextureFormats = [RGB, RGBA];\nexport function isValidTextureFormat(type: string) {\n\treturn validTextureFormats.indexOf(type) > -1;\n}\n// For image urls that are passed in and inited as textures.\nexport const validTextureTypes = [UNSIGNED_BYTE];\nexport function isValidTextureType(type: string) {\n\treturn validTextureTypes.indexOf(type) > -1;\n}\n\nexport function isValidClearValue(clearValue: number | number[], numComponents: number) {\n\tif (isArray(clearValue)) {\n\t\t// Length of clearValue must match numComponents.\n\t\tif ((clearValue as number[]).length !== numComponents) {\n\t\t\treturn false;\n\t\t}\n\t\tfor (let i = 0; i < (clearValue as number[]).length; i++) {\n\t\t\tif (!isNumber((clearValue as number[])[i])) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t} else {\n\t\tif (!isNumber(clearValue)) {\n\t\t\treturn false;\n\t\t}\n\t}\n\treturn true;\n}\n\nexport function isNumber(value: any) {\n\treturn !isNaN(value);\n}\n\nexport function isInteger(value: any) {\n\treturn isNumber(value) && (value % 1 === 0);\n}\n\nexport function isPositiveInteger(value: any) {\n\treturn isInteger(value) &&  value > 0;\n}\n\nexport function isString(value: any){\n\treturn typeof value === 'string';\n}\n\nexport function isArray(value: any) {\n\treturn Array.isArray(value);\n}\n\nexport function isBoolean(value: any) {\n\treturn typeof value === 'boolean';\n}","export const HALF_FLOAT = 'HALF_FLOAT';\nexport const FLOAT = 'FLOAT';\nexport const UNSIGNED_BYTE = 'UNSIGNED_BYTE';\nexport const BYTE = 'BYTE';\nexport const UNSIGNED_SHORT = 'UNSIGNED_SHORT';\nexport const SHORT = 'SHORT';\nexport const UNSIGNED_INT = 'UNSIGNED_INT';\nexport const INT = 'INT';\nexport const BOOL = 'BOOL';\n\nexport const LINEAR = 'LINEAR';\nexport const NEAREST = 'NEAREST';\n\nexport const REPEAT = 'REPEAT';\nexport const CLAMP_TO_EDGE = 'CLAMP_TO_EDGE';\n// export const MIRRORED_REPEAT = 'MIRRORED_REPEAT';\n\nexport const RGB = 'RGB';\nexport const RGBA = 'RGBA';\n\nexport type DataLayerArrayType =  Float32Array | Uint8Array | Int8Array | Uint16Array | Int16Array | Uint32Array | Int32Array;\nexport type DataLayerType = typeof HALF_FLOAT | typeof FLOAT | typeof UNSIGNED_BYTE | typeof BYTE | typeof UNSIGNED_SHORT | typeof SHORT | typeof UNSIGNED_INT | typeof INT;\nexport type DataLayerNumComponents = 1 | 2 | 3 | 4;\nexport type DataLayerFilter = typeof LINEAR | typeof NEAREST;\nexport type DataLayerWrap = typeof REPEAT | typeof CLAMP_TO_EDGE;// | typeof MIRRORED_REPEAT;\n\nexport type TextureFormat = typeof RGB | typeof RGBA;\nexport type TextureType = typeof UNSIGNED_BYTE;\n\nexport const GLSL3 = '300 es';\nexport const GLSL1 = '100';\nexport type GLSLVersion = typeof GLSL1 | typeof GLSL3;\n\n// Uniform types.\nexport const FLOAT_1D_UNIFORM = '1f';\nexport const FLOAT_2D_UNIFORM = '2f';\nexport const FLOAT_3D_UNIFORM = '3f';\nexport const FLOAT_4D_UNIFORM = '3f';\nexport const INT_1D_UNIFORM = '1i';\nexport const INT_2D_UNIFORM = '2i';\nexport const INT_3D_UNIFORM = '3i';\nexport const INT_4D_UNIFORM = '3i';\n\nexport type UniformType = typeof FLOAT | typeof INT |  typeof BOOL;\nexport type UniformInternalType = \n\ttypeof FLOAT_1D_UNIFORM |\n\ttypeof FLOAT_2D_UNIFORM |\n\ttypeof FLOAT_3D_UNIFORM |\n\ttypeof FLOAT_4D_UNIFORM |\n\ttypeof INT_1D_UNIFORM |\n\ttypeof INT_2D_UNIFORM |\n\ttypeof INT_3D_UNIFORM |\n\ttypeof INT_4D_UNIFORM;\nexport type UniformValue = \n\tboolean |\n\tnumber |\n\t[number] |\n\t[number, number] |\n\t[number, number, number] |\n\t[number, number, number, number];\nexport type Uniform = { \n\tlocation: { [key: string]: WebGLUniformLocation },\n\ttype: UniformInternalType,\n\tvalue: UniformValue,\n};\n\n// Vertex shaders.\nexport const DEFAULT_PROGRAM_NAME = 'DEFAULT';\nexport const DEFAULT_W_UV_PROGRAM_NAME = 'DEFAULT_W_UV';\nexport const DEFAULT_W_NORMAL_PROGRAM_NAME = 'DEFAULT_W_NORMAL';\nexport const DEFAULT_W_UV_NORMAL_PROGRAM_NAME = 'DEFAULT_W_UV_NORMAL';\nexport const SEGMENT_PROGRAM_NAME = 'SEGMENT';\nexport const DATA_LAYER_POINTS_PROGRAM_NAME = 'DATA_LAYER_POINTS';\nexport const DATA_LAYER_LINES_PROGRAM_NAME = 'DATA_LAYER_LINES';\nexport const DATA_LAYER_VECTOR_FIELD_PROGRAM_NAME = 'DATA_LAYER_VECTOR_FIELD';\nexport type PROGRAM_NAME_INTERNAL =\n\ttypeof DEFAULT_PROGRAM_NAME |\n\ttypeof DEFAULT_W_UV_PROGRAM_NAME |\n\ttypeof DEFAULT_W_NORMAL_PROGRAM_NAME |\n\ttypeof DEFAULT_W_UV_NORMAL_PROGRAM_NAME |\n\ttypeof SEGMENT_PROGRAM_NAME |\n\ttypeof DATA_LAYER_POINTS_PROGRAM_NAME |\n\ttypeof DATA_LAYER_LINES_PROGRAM_NAME |\n\ttypeof DATA_LAYER_VECTOR_FIELD_PROGRAM_NAME;\n\n// Pass in #defines as strings to make it easier to control float vs int.\nexport type CompileTimeVars = { [key: string]: string };\n\nexport type DataLayerBuffer = {\n\ttexture: WebGLTexture,\n\tframebuffer?: WebGLFramebuffer,\n}\n\nexport type ErrorCallback = (message: string) => void;\n\nexport const DEFAULT_CIRCLE_NUM_SEGMENTS = 18;// Must be divisible by 6 to work with stepSegment().","import { setFloat16 } from '@petamoriken/float16';\nimport { WebGLCompute } from '.';\nimport {\n\tisPositiveInteger,\n\tisValidClearValue,\n\tisValidDataType,\n\tisValidFilter,\n\tisValidWrap,\n\tvalidArrayTypes,\n\tvalidDataTypes,\n\tvalidFilters,\n\tvalidWraps,\n} from './Checks';\nimport {\n\tHALF_FLOAT,\n\tFLOAT,\n\tUNSIGNED_BYTE,\n\tBYTE,\n\tUNSIGNED_SHORT,\n\tSHORT,\n\tUNSIGNED_INT,\n\tINT,\n\tNEAREST,\n\tLINEAR,\n\tCLAMP_TO_EDGE,\n\tDataLayerArrayType,\n\tDataLayerFilter,\n\tDataLayerNumComponents,\n\tDataLayerType,\n\tDataLayerWrap,\n\tGLSLVersion,\n\tGLSL3,\n\tGLSL1,\n\tDataLayerBuffer,\n\tErrorCallback,\n } from './Constants';\nimport {\n\tgetExtension,\n\tEXT_COLOR_BUFFER_FLOAT,\n\tOES_TEXTURE_FLOAT,\n\tOES_TEXTURE_FLOAT_LINEAR,\n\tOES_TEXTURE_HALF_FLOAT,\n\tOES_TEXTURE_HAlF_FLOAT_LINEAR,\n} from './extensions';\nimport {\n\tinDevMode,\n\tisWebGL2,\n} from './utils';\n\nexport class DataLayer {\n\tprivate readonly glcompute: WebGLCompute;\n\n\treadonly name: string;\n\treadonly type: DataLayerType; // Input type passed in during setup.\n\treadonly numComponents: DataLayerNumComponents; // Number of RGBA channels to use for this DataLayer.\n\treadonly filter: DataLayerFilter; // Interpolation filter for pixel read operations.\n\treadonly wrapS: DataLayerWrap; // Input wrap type passed in during setup.\n\treadonly wrapT: DataLayerWrap; // Input wrap type passed in during setup.\n\treadonly writable: boolean;\n\tprivate _clearValue!: number | number[]; // Value to set when clear() is called.\n\n\t// Each DataLayer may contain a number of buffers to store different instances of the state.\n\t// e.g [currentState, previousState]\n\tprivate _bufferIndex = 0;\n\treadonly numBuffers;\n\tprivate readonly buffers: DataLayerBuffer[] = [];\n\n\t// Texture sizes.\n\tprivate _length?: number; // This is only used for 1D data layers.\n\tprivate _width: number;\n\tprivate _height: number;\n\n\t// DataLayer settings.\n\t// Due to variable browser support of WebGL features, \"internal\" variables may be different\n\t// from the parameter originally passed in.  These variables are set so that they match the original\n\t// parameter as best as possible, but fragment shader polyfills may be required.\n\t// All \"gl\" variables are used to initialize internal WebGLTexture.\n\t// https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/texImage2D\n\t// https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/texParameter\n\treadonly glInternalFormat: number;\n\treadonly glFormat: number;\n\t// DataLayer.internalType corresponds to DataLayer.glType, may be different from DataLayer.type.\n\treadonly internalType: DataLayerType; \n\treadonly glType: number;\n\t// Internally, DataLayer.glNumChannels may represent a larger number of channels than DataLayer.numComponents.\n\t// For example, writable RGB textures are not supported in WebGL2, must use RGBA instead.\n\treadonly glNumChannels: number;\n\t// DataLayer.internalFilter corresponds to DataLayer.glFilter, may be different from DataLayer.filter.\n\treadonly internalFilter: DataLayerFilter;\n\treadonly glFilter: number;\n\t// DataLayer.internalWrapS corresponds to DataLayer.glWrapS, may be different from DataLayer.wrapS.\n\treadonly internalWrapS: DataLayerWrap;\n\treadonly glWrapS: number;\n\t// DataLayer.internalWrapT corresponds to DataLayer.glWrapS, may be different from DataLayer.wrapT.\n\treadonly internalWrapT: DataLayerWrap;\n\treadonly glWrapT: number;\n\t\n\t// Optimizations so that \"copying\" can happen without draw calls.\n\tprivate textureOverrides?: (WebGLTexture | undefined)[];\n\n\tconstructor(\n\t\tglcompute: WebGLCompute,\n\t\tparams: {\n\t\t\tname: string,\n\t\t\tdimensions: number | [number, number],\n\t\t\ttype: DataLayerType,\n\t\t\tnumComponents: DataLayerNumComponents,\n\t\t\tarray?: DataLayerArrayType | number[],\n\t\t\tfilter?: DataLayerFilter,\n\t\t\twrapS?: DataLayerWrap,\n\t\t\twrapT?: DataLayerWrap,\n\t\t\twritable?: boolean,\n\t\t\tnumBuffers?: number,\n\t\t\tclearValue?: number | number[],\n\t\t},\n\t) {\n\t\tconst { name, dimensions, type, numComponents, array } = params;\n\t\tconst { gl, errorCallback, glslVersion } = glcompute;\n\n\t\t// Save params.\n\t\tthis.glcompute = glcompute;\n\t\tthis.name = name;\n\n\t\t// numComponents must be between 1 and 4.\n\t\tif (!isPositiveInteger(numComponents) || numComponents > 4) {\n\t\t\tthrow new Error(`Invalid numComponents: ${numComponents} for DataLayer \"${name}\".`);\n\t\t}\n\t\tthis.numComponents = numComponents;\n\n\t\t// clearValue defaults to zero.\n\t\tconst clearValue = params.clearValue !== undefined ? params.clearValue : 0;\n\t\tthis.clearValue = clearValue; // Setter can only be called after this.numComponents has been set.\n\n\t\t// Writable defaults to false.\n\t\tconst writable = !!params.writable;\n\t\tthis.writable = writable;\n\n\t\t// Set dimensions, may be 1D or 2D.\n\t\tconst { length, width, height } = DataLayer.calcSize(dimensions, name);\n\t\tthis._length = length;\n\t\tif (!isPositiveInteger(width)) {\n\t\t\tthrow new Error(`Invalid width: ${width} for DataLayer \"${name}\".`);\n\t\t}\n\t\tthis._width = width;\n\t\tif (!isPositiveInteger(height)) {\n\t\t\tthrow new Error(`Invalid length: ${height} for DataLayer \"${name}\".`);\n\t\t}\n\t\tthis._height = height;\n\n\t\t// Set filtering - if we are processing a 1D array, default to NEAREST filtering.\n\t\t// Else default to LINEAR (interpolation) filtering for float types and NEAREST for integer types.\n\t\tconst defaultFilter = length ? NEAREST : ((type === FLOAT || type == HALF_FLOAT) ? LINEAR : NEAREST);\n\t\tconst filter = params.filter !== undefined ? params.filter : defaultFilter;\n\t\tif (!isValidFilter(filter)) {\n\t\t\tthrow new Error(`Invalid filter: ${filter} for DataLayer \"${name}\", must be one of [${validFilters.join(', ')}].`);\n\t\t}\n\t\t// Don't allow LINEAR filtering on integer types, it is not supported.\n\t\tif (filter === LINEAR && !(type === FLOAT || type == HALF_FLOAT)) {\n\t\t\tthrow new Error(`LINEAR filtering is not supported on integer types, please use NEAREST filtering for DataLayer \"${name}\" with type: ${type}.`);\n\t\t}\n\t\tthis.filter = filter;\n\n\t\t// Get wrap types, default to clamp to edge.\n\t\tconst wrapS = params.wrapS !== undefined ? params.wrapS : CLAMP_TO_EDGE;\n\t\tif (!isValidWrap(wrapS)) {\n\t\t\tthrow new Error(`Invalid wrapS: ${wrapS} for DataLayer \"${name}\", must be one of [${validWraps.join(', ')}].`);\n\t\t}\n\t\tthis.wrapS = wrapS;\n\t\tconst wrapT = params.wrapT !== undefined ? params.wrapT : CLAMP_TO_EDGE;\n\t\tif (!isValidWrap(wrapT)) {\n\t\t\tthrow new Error(`Invalid wrapT: ${wrapT} for DataLayer \"${name}\", must be one of [${validWraps.join(', ')}].`);\n\t\t}\n\t\tthis.wrapT = wrapT;\n\n\t\t// Set data type.\n\t\tif (!isValidDataType(type)) {\n\t\t\tthrow new Error(`Invalid type: ${type} for DataLayer \"${name}\", must be one of [${validDataTypes.join(', ')}].`);\n\t\t}\n\t\tthis.type = type;\n\t\tconst internalType = DataLayer.getInternalType({\n\t\t\tgl,\n\t\t\ttype,\n\t\t\tglslVersion,\n\t\t\twritable,\n\t\t\tname,\n\t\t\terrorCallback,\n\t\t});\n\t\tthis.internalType = internalType;\n\t\t// Set gl texture parameters.\n\t\tconst {\n\t\t\tglFormat,\n\t\t\tglInternalFormat,\n\t\t\tglType,\n\t\t\tglNumChannels,\n\t\t} = DataLayer.getGLTextureParameters({\n\t\t\tgl,\n\t\t\tname,\n\t\t\tnumComponents,\n\t\t\twritable,\n\t\t\tinternalType,\n\t\t\tglslVersion,\n\t\t\terrorCallback,\n\t\t});\n\t\tthis.glInternalFormat = glInternalFormat;\n\t\tthis.glFormat = glFormat;\n\t\tthis.glType = glType;\n\t\tthis.glNumChannels = glNumChannels;\n\n\t\t// Set internal filtering/wrap types.\n\t\tthis.internalFilter = DataLayer.getInternalFilter({ gl, filter, internalType, name, errorCallback });\n\t\tthis.glFilter = gl[this.internalFilter];\n\t\tthis.internalWrapS = DataLayer.getInternalWrap({ gl, wrap: wrapS, name });\n\t\tthis.glWrapS = gl[this.internalWrapS];\n\t\tthis.internalWrapT = DataLayer.getInternalWrap({ gl, wrap: wrapT, name });\n\t\tthis.glWrapT = gl[this.internalWrapT];\n\n\t\t// Num buffers is the number of states to store for this data.\n\t\tconst numBuffers = params.numBuffers !== undefined ? params.numBuffers : 1;\n\t\tif (!isPositiveInteger(numBuffers)) {\n\t\t\tthrow new Error(`Invalid numBuffers: ${numBuffers} for DataLayer \"${name}\", must be positive integer.`);\n\t\t}\n\t\tthis.numBuffers = numBuffers;\n\n\t\tthis.initBuffers(array);\n\t}\n\n\tprivate static calcSize(size: number | [number, number], name: string) {\n\t\tlet length, width, height;\n\t\tif (!isNaN(size as number)) {\n\t\t\tif (!isPositiveInteger(size)) {\n\t\t\t\tthrow new Error(`Invalid length: ${size} for DataLayer \"${name}\", must be positive integer.`);\n\t\t\t}\n\t\t\tlength = size as number;\n\t\t\t// Calc power of two width and height for length.\n\t\t\tlet exp = 1;\n\t\t\tlet remainder = length;\n\t\t\twhile (remainder > 2) {\n\t\t\t\texp++;\n\t\t\t\tremainder /= 2;\n\t\t\t}\n\t\t\twidth = Math.pow(2, Math.floor(exp / 2) + exp % 2);\n\t\t\theight = Math.pow(2, Math.floor(exp/2));\n\t\t\tif (inDevMode()) {\n\t\t\t\tconsole.log(`Using [${width}, ${height}] for 1D array of length ${size} in DataLayer \"${name}\".`);\n\t\t\t}\n\t\t} else {\n\t\t\twidth = (size as [number, number])[0];\n\t\t\tif (!isPositiveInteger(width)) {\n\t\t\t\tthrow new Error(`Invalid width: ${width} for DataLayer \"${name}\", must be positive integer.`);\n\t\t\t}\n\t\t\theight = (size as [number, number])[1];\n\t\t\tif (!isPositiveInteger(height)) {\n\t\t\t\tthrow new Error(`Invalid height: ${height} for DataLayer \"${name}\", must be positive integer.`);\n\t\t\t}\n\t\t}\n\t\treturn { width, height, length };\n\t}\n\n\tprivate static getInternalWrap(\n\t\tparams: {\n\t\t\tgl: WebGLRenderingContext | WebGL2RenderingContext,\n\t\t\twrap: DataLayerWrap,\n\t\t\tname: string,\n\t\t},\n\t) {\n\t\tconst { gl, wrap, name } = params;\n\t\t// Webgl2.0 supports all combinations of types and filtering.\n\t\tif (isWebGL2(gl)) {\n\t\t\treturn wrap;\n\t\t}\n\t\t// CLAMP_TO_EDGE is always supported.\n\t\tif (wrap === CLAMP_TO_EDGE) {\n\t\t\treturn wrap;\n\t\t}\n\t\tif (!isWebGL2(gl)) {\n\t\t\t// TODO: we may want to handle this in the frag shader.\n\t\t\t// REPEAT and MIRROR_REPEAT wrap not supported for non-power of 2 textures in safari.\n\t\t\t// I've tested this and it seems that some power of 2 textures will work (512 x 512),\n\t\t\t// but not others (1024x1024), so let's just change all WebGL 1.0 to CLAMP.\n\t\t\t// Without this, we currently get an error at drawArrays():\n\t\t\t// \"WebGL: drawArrays: texture bound to texture unit 0 is not renderable.\n\t\t\t// It maybe non-power-of-2 and have incompatible texture filtering or is not\n\t\t\t// 'texture complete', or it is a float/half-float type with linear filtering and\n\t\t\t// without the relevant float/half-float linear extension enabled.\"\n\t\t\tconsole.warn(`Falling back to CLAMP_TO_EDGE wrapping for DataLayer \"${name}\" for WebGL 1.`);\n\t\t\treturn CLAMP_TO_EDGE;\n\t\t}\n\t\treturn wrap;\n\t}\n\n\tprivate static getInternalFilter(\n\t\tparams: {\n\t\t\tgl: WebGLRenderingContext | WebGL2RenderingContext,\n\t\t\tfilter: DataLayerFilter,\n\t\t\tinternalType: DataLayerType,\n\t\t\tname: string,\n\t\t\terrorCallback: ErrorCallback,\n\t\t},\n\t) {\n\t\tconst { gl, errorCallback, internalType, name } = params;\n\t\tlet { filter } = params;\n\t\tif (filter === NEAREST) {\n\t\t\t// NEAREST filtering is always supported.\n\t\t\treturn filter;\n\t\t}\n\n\t\tif (internalType === HALF_FLOAT) {\n\t\t\t// TODO: test if float linear extension is actually working.\n\t\t\tconst extension = getExtension(gl, OES_TEXTURE_HAlF_FLOAT_LINEAR, errorCallback, true)\n\t\t\t\t|| getExtension(gl, OES_TEXTURE_FLOAT_LINEAR, errorCallback, true);\n\t\t\tif (!extension) {\n\t\t\t\tconsole.warn(`Falling back to NEAREST filter for DataLayer \"${name}\".`);\n\t\t\t\t//TODO: add a fallback that does this filtering in the frag shader?.\n\t\t\t\tfilter = NEAREST;\n\t\t\t}\n\t\t} if (internalType === FLOAT) {\n\t\t\tconst extension = getExtension(gl, OES_TEXTURE_FLOAT_LINEAR, errorCallback, true);\n\t\t\tif (!extension) {\n\t\t\t\tconsole.warn(`Falling back to NEAREST filter for DataLayer \"${name}\".`);\n\t\t\t\t//TODO: add a fallback that does this filtering in the frag shader?.\n\t\t\t\tfilter = NEAREST;\n\t\t\t}\n\t\t}\n\t\treturn filter;\n\t}\n\n\tprivate static getInternalType(\n\t\tparams: {\n\t\t\tgl: WebGLRenderingContext | WebGL2RenderingContext,\n\t\t\ttype: DataLayerType,\n\t\t\tglslVersion: GLSLVersion,\n\t\t\twritable: boolean,\n\t\t\tname: string,\n\t\t\terrorCallback: ErrorCallback,\n\t\t},\n\t) {\n\t\tconst { gl, errorCallback, writable, name, glslVersion } = params;\n\t\tconst { type } = params;\n\t\tlet internalType = type;\n\t\t// Check if int types are supported.\n\t\tconst intCast = DataLayer.shouldCastIntTypeAsFloat(params);\n\t\tif (intCast) {\n\t\t\tif (internalType === UNSIGNED_BYTE || internalType === BYTE) {\n\t\t\t\t// Integers between 0 and 2048 can be exactly represented by half float (and also between 2048 and 0)\n\t\t\t\tinternalType = HALF_FLOAT;\n\t\t\t} else {\n\t\t\t\t// Integers between 0 and 16777216 can be exactly represented by float32 (also applies for negative integers between 16777216 and 0)\n\t\t\t\t// This is sufficient for UNSIGNED_SHORT and SHORT types.\n\t\t\t\t// Large UNSIGNED_INT and INT cannot be represented by FLOAT type.\n\t\t\t\tconsole.warn(`Falling back ${internalType} type to FLOAT type for glsl1.x support for DataLayer \"${name}\".\nLarge UNSIGNED_INT or INT with absolute value > 16,777,216 are not supported, on mobile UNSIGNED_INT, INT, UNSIGNED_SHORT, and SHORT with absolute value > 2,048 may not be supported.`);\n\t\t\t\tinternalType = FLOAT;\n\t\t\t}\n\t\t}\n\t\t// Check if float32 supported.\n\t\tif (!isWebGL2(gl)) {\n\t\t\tif (internalType === FLOAT) {\n\t\t\t\tconst extension = getExtension(gl, OES_TEXTURE_FLOAT, errorCallback, true);\n\t\t\t\tif (!extension) {\n\t\t\t\t\tconsole.warn(`FLOAT not supported, falling back to HALF_FLOAT type for DataLayer \"${name}\".`);\n\t\t\t\t\tinternalType = HALF_FLOAT;\n\t\t\t\t}\n\t\t\t\t// https://stackoverflow.com/questions/17476632/webgl-extension-support-across-browsers\n\t\t\t\t// Rendering to a floating-point texture may not be supported,\n\t\t\t\t// even if the OES_texture_float extension is supported.\n\t\t\t\t// Typically, this fails on current mobile hardware.\n\t\t\t\t// To check if this is supported, you have to call the WebGL\n\t\t\t\t// checkFramebufferStatus() function.\n\t\t\t\tif (writable) {\n\t\t\t\t\tconst valid = DataLayer.testFramebufferWrite({ gl, type: internalType, glslVersion });\n\t\t\t\t\tif (!valid && internalType !== HALF_FLOAT) {\n\t\t\t\t\t\tconsole.warn(`FLOAT not supported for writing operations, falling back to HALF_FLOAT type for DataLayer \"${name}\".`);\n\t\t\t\t\t\tinternalType = HALF_FLOAT;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Must support at least half float if using a float type.\n\t\t\tif (internalType === HALF_FLOAT) {\n\t\t\t\tgetExtension(gl, OES_TEXTURE_HALF_FLOAT, errorCallback);\n\t\t\t\t// TODO: https://stackoverflow.com/questions/54248633/cannot-create-half-float-oes-texture-from-uint16array-on-ipad\n\t\t\t\tif (writable) {\n\t\t\t\t\tconst valid = DataLayer.testFramebufferWrite({ gl, type: internalType, glslVersion });\n\t\t\t\t\tif (!valid) {\n\t\t\t\t\t\terrorCallback(`This browser does not support rendering to HALF_FLOAT textures.`);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\t// Load additional extensions if needed.\n\t\tif (writable && isWebGL2(gl) && (internalType === HALF_FLOAT || internalType === FLOAT)) {\n\t\t\tgetExtension(gl, EXT_COLOR_BUFFER_FLOAT, errorCallback);\n\t\t}\n\t\treturn internalType;\n\t}\n\n\tprivate static shouldCastIntTypeAsFloat(\n\t\tparams: {\n\t\t\tgl: WebGLRenderingContext | WebGL2RenderingContext,\n\t\t\ttype: DataLayerType,\n\t\t\tglslVersion: GLSLVersion,\n\t\t}\n\t) {\n\t\tconst { gl, type, glslVersion } = params;\n\t\t// All types are supported by WebGL2 + glsl3.\n\t\tif (glslVersion === GLSL3 && isWebGL2(gl)) return false;\n\t\t// Int textures (other than UNSIGNED_BYTE) are not supported by WebGL1.0 or glsl1.x.\n\t\t// https://stackoverflow.com/questions/55803017/how-to-select-webgl-glsl-sampler-type-from-texture-format-properties\n\t\t// Use HALF_FLOAT/FLOAT instead.\n\t\t// Some large values of INT and UNSIGNED_INT are not supported unfortunately.\n\t\t// See tests for more information.\n\t\treturn type === BYTE || type === SHORT || type === INT || type === UNSIGNED_SHORT || type === UNSIGNED_INT;\n\t}\n\n\tprivate static getGLTextureParameters(\n\t\tparams: {\n\t\t\tgl: WebGLRenderingContext | WebGL2RenderingContext,\n\t\t\tname: string,\n\t\t\tnumComponents: DataLayerNumComponents,\n\t\t\tinternalType: DataLayerType,\n\t\t\twritable: boolean,\n\t\t\tglslVersion: GLSLVersion,\n\t\t\terrorCallback: ErrorCallback,\n\t\t}\n\t) {\n\t\tconst { gl, errorCallback, name, numComponents, internalType, writable, glslVersion } = params;\n\t\t// https://www.khronos.org/registry/webgl/specs/latest/2.0/#TEXTURE_TYPES_FORMATS_FROM_DOM_ELEMENTS_TABLE\n\t\tlet glType: number | undefined,\n\t\t\tglFormat: number | undefined,\n\t\t\tglInternalFormat: number | undefined,\n\t\t\tglNumChannels: number | undefined;\n\n\t\tif (isWebGL2(gl)) {\n\t\t\tglNumChannels = numComponents;\n\t\t\t// https://www.khronos.org/registry/webgl/extensions/EXT_color_buffer_float/\n\t\t\t// https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/texImage2D\n\t\t\t// The sized internal format RGBxxx are not color-renderable for some reason.\n\t\t\t// If numComponents == 3 for a writable texture, use RGBA instead.\n\t\t\t// Page 5 of https://www.khronos.org/files/webgl20-reference-guide.pdf\n\t\t\tif (numComponents === 3 && writable) {\n\t\t\t\tglNumChannels = 4;\n\t\t\t}\n\t\t\tif (internalType === FLOAT || internalType === HALF_FLOAT) {\n\t\t\t\tswitch (glNumChannels) {\n\t\t\t\t\tcase 1:\n\t\t\t\t\t\tglFormat = (gl as WebGL2RenderingContext).RED;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 2:\n\t\t\t\t\t\tglFormat = (gl as WebGL2RenderingContext).RG;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 3:\n\t\t\t\t\t\tglFormat = gl.RGB;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 4:\n\t\t\t\t\t\tglFormat = gl.RGBA;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tthrow new Error(`Unsupported glNumChannels: ${glNumChannels} for DataLayer \"${name}\".`);\n\t\t\t\t}\n\t\t\t} else if (glslVersion === GLSL1 && internalType === UNSIGNED_BYTE) {\n\t\t\t\tswitch (glNumChannels) {\n\t\t\t\t\t// For read only UNSIGNED_BYTE textures in GLSL 1, use gl.ALPHA and gl.LUMINANCE_ALPHA.\n\t\t\t\t\t// Otherwise use RGB/RGBA.\n\t\t\t\t\tcase 1:\n\t\t\t\t\t\tif (!writable) {\n\t\t\t\t\t\t\tglFormat = gl.ALPHA;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// Purposely falling to next case here.\n\t\t\t\t\tcase 2:\n\t\t\t\t\t\tif (!writable) {\n\t\t\t\t\t\t\tglFormat = gl.LUMINANCE_ALPHA;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// Purposely falling to next case here.\n\t\t\t\t\tcase 3:\n\t\t\t\t\t\tglFormat = gl.RGB;\n\t\t\t\t\t\tglNumChannels = 3;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 4:\n\t\t\t\t\t\tglFormat = gl.RGBA;\n\t\t\t\t\t\tglNumChannels = 4;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tthrow new Error(`Unsupported glNumChannels: ${glNumChannels} for DataLayer \"${name}\".`);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// This case will only be hit by GLSL 3.\n\t\t\t\t// Int textures are not supported in GLSL1.\n\t\t\t\tswitch (glNumChannels) {\n\t\t\t\t\tcase 1:\n\t\t\t\t\t\tglFormat = (gl as WebGL2RenderingContext).RED_INTEGER;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 2:\n\t\t\t\t\t\tglFormat = (gl as WebGL2RenderingContext).RG_INTEGER;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 3:\n\t\t\t\t\t\tglFormat = (gl as WebGL2RenderingContext).RGB_INTEGER;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 4:\n\t\t\t\t\t\tglFormat = (gl as WebGL2RenderingContext).RGBA_INTEGER;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tthrow new Error(`Unsupported glNumChannels: ${glNumChannels} for DataLayer \"${name}\".`);\n\t\t\t\t}\n\t\t\t}\n\t\t\tswitch (internalType) {\n\t\t\t\tcase HALF_FLOAT:\n\t\t\t\t\tglType = (gl as WebGL2RenderingContext).HALF_FLOAT;\n\t\t\t\t\tswitch (glNumChannels) {\n\t\t\t\t\t\tcase 1:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).R16F;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 2:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RG16F;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 3:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RGB16F;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 4:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RGBA16F;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tthrow new Error(`Unsupported glNumChannels: ${glNumChannels} for DataLayer \"${name}\".`);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase FLOAT:\n\t\t\t\t\tglType = (gl as WebGL2RenderingContext).FLOAT;\n\t\t\t\t\tswitch (glNumChannels) {\n\t\t\t\t\t\tcase 1:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).R32F;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 2:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RG32F;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 3:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RGB32F;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 4:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RGBA32F;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tthrow new Error(`Unsupported glNumChannels: ${glNumChannels} for DataLayer \"${name}\".`);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase UNSIGNED_BYTE:\n\t\t\t\t\tglType = gl.UNSIGNED_BYTE;\n\t\t\t\t\tif (glslVersion === GLSL1 && internalType === UNSIGNED_BYTE) {\n\t\t\t\t\t\tglInternalFormat = glFormat;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tswitch (glNumChannels) {\n\t\t\t\t\t\t\tcase 1:\n\t\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).R8UI;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 2:\n\t\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RG8UI;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 3:\n\t\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RGB8UI;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 4:\n\t\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RGBA8UI;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\tthrow new Error(`Unsupported glNumChannels: ${glNumChannels} for DataLayer \"${name}\".`);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase BYTE:\n\t\t\t\t\tglType = gl.BYTE;\n\t\t\t\t\tswitch (glNumChannels) {\n\t\t\t\t\t\tcase 1:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).R8I;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 2:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RG8I;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 3:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RGB8I;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 4:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RGBA8I;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tthrow new Error(`Unsupported glNumChannels: ${glNumChannels} for DataLayer \"${name}\".`);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase SHORT:\n\t\t\t\t\tglType = gl.SHORT;\n\t\t\t\t\tswitch (glNumChannels) {\n\t\t\t\t\t\tcase 1:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).R16I;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 2:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RG16I;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 3:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RGB16I;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 4:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RGBA16I;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tthrow new Error(`Unsupported glNumChannels: ${glNumChannels} for DataLayer \"${name}\".`);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase UNSIGNED_SHORT:\n\t\t\t\t\tglType = gl.UNSIGNED_SHORT;\n\t\t\t\t\tswitch (glNumChannels) {\n\t\t\t\t\t\tcase 1:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).R16UI;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 2:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RG16UI;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 3:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RGB16UI;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 4:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RGBA16UI;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tthrow new Error(`Unsupported glNumChannels: ${glNumChannels} for DataLayer \"${name}\".`);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase INT:\n\t\t\t\t\tglType = gl.INT;\n\t\t\t\t\tswitch (glNumChannels) {\n\t\t\t\t\t\tcase 1:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).R32I;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 2:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RG32I;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 3:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RGB32I;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 4:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RGBA32I;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tthrow new Error(`Unsupported glNumChannels: ${glNumChannels} for DataLayer \"${name}\".`);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase UNSIGNED_INT:\n\t\t\t\t\tglType = gl.UNSIGNED_INT;\n\t\t\t\t\tswitch (glNumChannels) {\n\t\t\t\t\t\tcase 1:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).R32UI;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 2:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RG32UI;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 3:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RGB32UI;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 4:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RGBA32UI;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tthrow new Error(`Unsupported glNumChannels: ${glNumChannels} for DataLayer \"${name}\".`);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tthrow new Error(`Unsupported type: ${internalType} for DataLayer \"${name}\".`);\n\t\t\t}\n\t\t} else {\n\t\t\tswitch (numComponents) {\n\t\t\t\t// For read only textures WebGL 1, use gl.ALPHA and gl.LUMINANCE_ALPHA.\n\t\t\t\t// Otherwise use RGB/RGBA.\n\t\t\t\tcase 1:\n\t\t\t\t\tif (!writable) {\n\t\t\t\t\t\tglFormat = gl.ALPHA;\n\t\t\t\t\t\t// TODO: check these:\n\t\t\t\t\t\tglInternalFormat = gl.ALPHA;\n\t\t\t\t\t\tglNumChannels = 1;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\t// Purposely falling to next case here.\n\t\t\t\tcase 2:\n\t\t\t\t\tif (!writable) {\n\t\t\t\t\t\tglFormat = gl.LUMINANCE_ALPHA;\n\t\t\t\t\t\t// TODO: check these:\n\t\t\t\t\t\tglInternalFormat = gl.LUMINANCE_ALPHA;\n\t\t\t\t\t\tglNumChannels = 2;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\t// Purposely falling to next case here.\n\t\t\t\tcase 3:\n\t\t\t\t\tglFormat = gl.RGB;\n\t\t\t\t\tglInternalFormat = gl.RGB;\n\t\t\t\t\tglNumChannels = 3;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 4:\n\t\t\t\t\tglFormat = gl.RGBA;\n\t\t\t\t\tglInternalFormat = gl.RGBA;\n\t\t\t\t\tglNumChannels = 4;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tthrow new Error(`Unsupported numComponents: ${numComponents} for DataLayer \"${name}\".`);\n\t\t\t}\n\t\t\tswitch (internalType) {\n\t\t\t\tcase FLOAT:\n\t\t\t\t\tglType = gl.FLOAT;\n\t\t\t\t\tbreak;\n\t\t\t\tcase HALF_FLOAT:\n\t\t\t\t\tglType = (gl as WebGL2RenderingContext).HALF_FLOAT || getExtension(gl, OES_TEXTURE_HALF_FLOAT, errorCallback).HALF_FLOAT_OES as number;\n\t\t\t\t\tbreak;\n\t\t\t\tcase UNSIGNED_BYTE:\n\t\t\t\t\tglType = gl.UNSIGNED_BYTE;\n\t\t\t\t\tbreak;\n\t\t\t\t// No other types are supported in glsl1.x\n\t\t\t\tdefault:\n\t\t\t\t\tthrow new Error(`Unsupported type: ${internalType} in WebGL 1.0 for DataLayer \"${name}\".`);\n\t\t\t}\n\t\t}\n\n\t\t// Check for missing params.\n\t\tif (glType === undefined || glFormat === undefined || glInternalFormat === undefined) {\n\t\t\tconst missingParams = [];\n\t\t\tif (glType === undefined) missingParams.push('glType');\n\t\t\tif (glFormat === undefined) missingParams.push('glFormat');\n\t\t\tif (glInternalFormat === undefined) missingParams.push('glInternalFormat');\n\t\t\tthrow new Error(`Invalid type: ${internalType} for numComponents: ${numComponents}, unable to init parameter${missingParams.length > 1 ? 's' : ''} ${missingParams.join(', ')} for DataLayer \"${name}\".`);\n\t\t}\n\t\tif (glNumChannels === undefined || numComponents < 1 || numComponents > 4 || glNumChannels < numComponents) {\n\t\t\tthrow new Error(`Invalid numChannels: ${glNumChannels} for numComponents: ${numComponents} for DataLayer \"${name}\".`);\n\t\t}\n\n\t\treturn {\n\t\t\tglFormat,\n\t\t\tglInternalFormat,\n\t\t\tglType,\n\t\t\tglNumChannels,\n\t\t};\n\t}\n\n\tprivate static testFramebufferWrite(\n\t\tparams: {\n\t\t\tgl: WebGLRenderingContext | WebGL2RenderingContext,\n\t\t\ttype: DataLayerType,\n\t\t\tglslVersion: GLSLVersion,\n\t\t},\n\t) {\n\t\tconst { gl, type, glslVersion } = params;\n\t\tconst texture = gl.createTexture();\n\t\tif (!texture) {\n\t\t\treturn false;\n\t\t}\n\t\tgl.bindTexture(gl.TEXTURE_2D, texture);\n\n\t\t// Default to most widely supported settings.\n\t\tconst wrapS = gl[CLAMP_TO_EDGE];\n\t\tconst wrapT = gl[CLAMP_TO_EDGE];\n\t\tconst filter = gl[NEAREST];\n\t\t// Use non-power of two dimensions to check for more universal support.\n\t\t// (In case size of DataLayer is changed at a later point).\n\t\tconst width = 100;\n\t\tconst height = 100;\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, wrapS);\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, wrapT);\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, filter);\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, filter);\n\n\t\tconst { glInternalFormat, glFormat, glType } = DataLayer.getGLTextureParameters({\n\t\t\tgl,\n\t\t\tname: 'testFramebufferWrite',\n\t\t\tnumComponents: 1,\n\t\t\twritable: true,\n\t\t\tinternalType: type,\n\t\t\tglslVersion,\n\t\t\terrorCallback: () => {},\n\t\t});\n\t\tgl.texImage2D(gl.TEXTURE_2D, 0, glInternalFormat, width, height, 0, glFormat, glType, null);\n\n\t\t// Init a framebuffer for this texture so we can write to it.\n\t\tconst framebuffer = gl.createFramebuffer();\n\t\tif (!framebuffer) {\n\t\t\t// Clear out allocated memory.\n\t\t\tgl.deleteTexture(texture);\n\t\t\treturn false;\n\t\t}\n\t\tgl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\n\t\t// https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/framebufferTexture2D\n\t\tgl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\n\n\t\tconst status = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\n\t\tconst validStatus = status === gl.FRAMEBUFFER_COMPLETE;\n\n\t\t// Clear out allocated memory.\n\t\tgl.deleteTexture(texture);\n\t\tgl.deleteFramebuffer(framebuffer);\n\n\t\treturn validStatus;\n\t}\n\n\tget bufferIndex() {\n\t\treturn this._bufferIndex;\n\t}\n\n\tsaveCurrentStateToDataLayer(layer: DataLayer) {\n\t\t// A method for saving a copy of the current state without a draw call.\n\t\t// Draw calls are expensive, this optimization helps.\n\t\tif (this.numBuffers < 2) {\n\t\t\tthrow new Error(`Can't call DataLayer.saveCurrentStateToDataLayer on DataLayer \"${this.name}\" with less than 2 buffers.`);\n\t\t}\n\t\tif (!this.writable) {\n\t\t\tthrow new Error(`Can't call DataLayer.saveCurrentStateToDataLayer on read-only DataLayer \"${this.name}\".`);\n\t\t}\n\t\tif (layer.writable) {\n\t\t\tthrow new Error(`Can't call DataLayer.saveCurrentStateToDataLayer on DataLayer \"${this.name}\" using writable DataLayer \"${layer.name}\".`)\n\t\t}\n\t\t// Check that texture params are the same.\n\t\tif (layer.glWrapS !== this.glWrapS || layer.glWrapT !== this.glWrapT ||\n\t\t\tlayer.wrapS !== this.wrapS || layer.wrapT !== this.wrapT ||\n\t\t\tlayer.width !== this.width || layer.height !== this.height ||\n\t\t\tlayer.glFilter !== this.glFilter || layer.filter !== this.filter ||\n\t\t\tlayer.glNumChannels !== this.glNumChannels || layer.numComponents !== this.numComponents ||\n\t\t\tlayer.glType !== this.glType || layer.type !== this.type ||\n\t\t\tlayer.glFormat !== this.glFormat || layer.glInternalFormat !== this.glInternalFormat) {\n\t\t\t\tthrow new Error(`Incompatible texture params between DataLayers \"${layer.name}\" and \"${this.name}\".`);\n\t\t}\n\n\t\t// If we have not already inited overrides array, do so now.\n\t\tif (!this.textureOverrides) {\n\t\t\tthis.textureOverrides = [];\n\t\t\tfor (let i = 0; i < this.numBuffers; i++) {\n\t\t\t\tthis.textureOverrides.push(undefined);\n\t\t\t}\n\t\t}\n\n\t\t// Check if we already have an override in place.\n\t\tif (this.textureOverrides[this.bufferIndex]) {\n\t\t\tthrow new Error(`Can't call DataLayer.saveCurrentStateToDataLayer on DataLayer \"${this.name}\", this DataLayer has not written new state since last call to DataLayer.saveCurrentStateToDataLayer.`);\n\t\t}\n\t\tconst { currentState } = this;\n\t\tthis.textureOverrides[this.bufferIndex] = currentState;\n\t\t// Swap textures.\n\t\tthis.buffers[this.bufferIndex].texture = layer.currentState;\n\t\tlayer._setCurrentStateTexture(currentState);\n\n\t\t// Bind swapped texture to framebuffer.\n\t\tconst { gl } = this.glcompute;\n\t\tconst { framebuffer, texture } = this.buffers[this.bufferIndex];\n\t\tif (!framebuffer) throw new Error(`No framebuffer for writable DataLayer \"${this.name}\".`);\n\t\tgl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\n\t\t// https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/framebufferTexture2D\n\t\tgl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\n\t\t// Unbind.\n\t\tgl.bindFramebuffer(gl.FRAMEBUFFER, null);\n\t}\n\n\t_setCurrentStateTexture(texture: WebGLTexture) {\n\t\tif (this.writable) {\n\t\t\tthrow new Error(`Can't call DataLayer._setCurrentStateTexture on writable texture \"${this.name}\".`);\n\t\t}\n\t\tthis.buffers[this.bufferIndex].texture = texture;\n\t}\n\n\tprivate validateDataArray(array: DataLayerArrayType | number[]) {\n\t\tconst { numComponents, glNumChannels, type, internalType, width, height } = this;\n\t\tconst length = this._length;\n\n\t\t// Check that data is correct length (user error).\n\t\tif (array.length !== width * height * numComponents) { // Either the correct length for WebGLTexture size\n\t\t\tif (!length || (length &&  array.length !== length * numComponents)) { // Of the correct length for 1D array.\n\t\t\t\tthrow new Error(`Invalid data length: ${array.length} for DataLayer \"${this.name}\" of ${length ? `length ${length} and ` : ''}dimensions: [${width}, ${height}] and numComponents: ${numComponents}.`);\n\t\t\t}\n\t\t}\n\n\t\t// Get array type to figure out if we need to type cast.\n\t\t// For webgl1.0 we may need to cast an int type to a FLOAT or HALF_FLOAT.\n\t\tlet shouldTypeCast = false;\n\t\tswitch(array.constructor) {\n\t\t\tcase Array:\n\t\t\t\tshouldTypeCast = true;\n\t\t\t\tbreak;\n\t\t\tcase Float32Array:\n\t\t\t\tshouldTypeCast = internalType !== FLOAT;\n\t\t\t\tbreak;\n\t\t\tcase Uint8Array:\n\t\t\t\tshouldTypeCast = internalType !== UNSIGNED_BYTE;\n\t\t\t\tbreak;\n\t\t\tcase Int8Array:\n\t\t\t\tshouldTypeCast = internalType !== BYTE;\n\t\t\t\tbreak;\n\t\t\tcase Uint16Array:\n\t\t\t\tshouldTypeCast = internalType !== UNSIGNED_SHORT;\n\t\t\t\tbreak;\n\t\t\tcase Int16Array:\n\t\t\t\tshouldTypeCast = internalType !== SHORT;\n\t\t\t\tbreak;\n\t\t\tcase Uint32Array:\n\t\t\t\tshouldTypeCast = internalType !== UNSIGNED_INT;\n\t\t\t\tbreak;\n\t\t\tcase Int32Array:\n\t\t\t\tshouldTypeCast = internalType !== INT;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthrow new Error(`Invalid array type: ${array.constructor.name} for DataLayer \"${this.name}\", please use one of [${validArrayTypes.map(constructor => constructor.name).join(', ')}].`);\n\t\t}\n\n\t\tconst imageSize = width * height * glNumChannels;\n\t\t// Then check if array needs to be lengthened.\n\t\t// This could be because glNumChannels !== numComponents.\n\t\t// Or because length !== width * height.\n\t\tconst incorrectSize = array.length !== imageSize;\n\t\t// We have to handle the case of Float16 specially by converting data to Uint16Array.\n\t\tconst handleFloat16 = internalType === HALF_FLOAT;\n\t\t\n\t\tlet validatedArray = array as DataLayerArrayType;\n\t\tif (shouldTypeCast || incorrectSize || handleFloat16) {\n\t\t\tswitch (internalType) {\n\t\t\t\tcase HALF_FLOAT:\n\t\t\t\t\tvalidatedArray = new Uint16Array(imageSize);\n\t\t\t\t\tbreak;\n\t\t\t\tcase FLOAT:\n\t\t\t\t\tvalidatedArray = new Float32Array(imageSize);\n\t\t\t\t\tbreak;\n\t\t\t\tcase UNSIGNED_BYTE:\n\t\t\t\t\tvalidatedArray = new Uint8Array(imageSize);\n\t\t\t\t\tbreak;\n\t\t\t\tcase BYTE:\n\t\t\t\t\tvalidatedArray = new Int8Array(imageSize);\n\t\t\t\t\tbreak;\n\t\t\t\tcase UNSIGNED_SHORT:\n\t\t\t\t\tvalidatedArray = new Uint16Array(imageSize);\n\t\t\t\t\tbreak;\n\t\t\t\tcase SHORT:\n\t\t\t\t\tvalidatedArray = new Int16Array(imageSize);\n\t\t\t\t\tbreak;\n\t\t\t\tcase UNSIGNED_INT:\n\t\t\t\t\tvalidatedArray = new Uint32Array(imageSize);\n\t\t\t\t\tbreak;\n\t\t\t\tcase INT:\n\t\t\t\t\tvalidatedArray = new Int32Array(imageSize);\n\t\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\t\tthrow new Error(`Error initing DataLayer \"${this.name}\", unsupported internalType: ${internalType}.`);\n\t\t\t}\n\t\t\t// Fill new data array with old data.\n\t\t\tconst view = handleFloat16 ? new DataView(validatedArray.buffer) : null;\n\t\t\tfor (let i = 0, _len = array.length / numComponents; i < _len; i++) {\n\t\t\t\tfor (let j = 0; j < numComponents; j++) {\n\t\t\t\t\tconst value = array[i * numComponents + j];\n\t\t\t\t\tconst index = i * glNumChannels + j;\n\t\t\t\t\tif (handleFloat16) {\n\t\t\t\t\t\tsetFloat16(view!, 2 * index, value, true);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvalidatedArray[index] = value;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn validatedArray;\n\t}\n\n\tprivate initBuffers(\n\t\tarray?: DataLayerArrayType | number[],\n\t) {\n\t\tconst {\n\t\t\tname,\n\t\t\tnumBuffers,\n\t\t\tglcompute,\n\t\t\tglInternalFormat,\n\t\t\tglFormat,\n\t\t\tglType,\n\t\t\tglFilter,\n\t\t\tglWrapS,\n\t\t\tglWrapT,\n\t\t\twritable,\n\t\t\twidth,\n\t\t\theight,\n\t\t} = this;\n\t\tconst { gl, errorCallback } = glcompute;\n\n\t\tconst validatedArray = array ? this.validateDataArray(array) : undefined;\n\n\t\t// Init a texture for each buffer.\n\t\tfor (let i = 0; i < numBuffers; i++) {\n\t\t\tconst texture = gl.createTexture();\n\t\t\tif (!texture) {\n\t\t\t\terrorCallback(`Could not init texture for DataLayer \"${name}\": ${gl.getError()}.`);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tgl.bindTexture(gl.TEXTURE_2D, texture);\n\n\t\t\t// TODO: are there other params to look into:\n\t\t\t// https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/texParameter\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, glWrapS);\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, glWrapT);\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, glFilter);\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, glFilter);\n\n\t\t\tgl.texImage2D(gl.TEXTURE_2D, 0, glInternalFormat, width, height, 0, glFormat, glType, validatedArray ? validatedArray : null);\n\t\t\t\n\t\t\tconst buffer: DataLayerBuffer = {\n\t\t\t\ttexture,\n\t\t\t};\n\n\t\t\tif (writable) {\n\t\t\t\t// Init a framebuffer for this texture so we can write to it.\n\t\t\t\tconst framebuffer = gl.createFramebuffer();\n\t\t\t\tif (!framebuffer) {\n\t\t\t\t\terrorCallback(`Could not init framebuffer for DataLayer \"${name}\": ${gl.getError()}.`);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tgl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\n\t\t\t\t// https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/framebufferTexture2D\n\t\t\t\tgl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\n\n\t\t\t\tconst status = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\n\t\t\t\tif(status != gl.FRAMEBUFFER_COMPLETE){\n\t\t\t\t\terrorCallback(`Invalid status for framebuffer for DataLayer \"${name}\": ${status}.`);\n\t\t\t\t}\n\n\t\t\t\t// Add framebuffer.\n\t\t\t\tbuffer.framebuffer = framebuffer;\n\t\t\t}\n\t\t\t\n\t\t\t// Save this buffer to the list.\n\t\t\tthis.buffers.push(buffer);\n\t\t}\n\t\t// Unbind.\n\t\tgl.bindTexture(gl.TEXTURE_2D, null);\n\t\tgl.bindFramebuffer(gl.FRAMEBUFFER, null);\n\t}\n\n\tgetStateAtIndex(index: number) {\n\t\tif (index < 0 || index >= this.numBuffers) {\n\t\t\tthrow new Error(`Invalid buffer index: ${index} for DataLayer \"${this.name}\" with ${this.numBuffers} buffer${this.numBuffers > 1 ? 's' : ''}.`)\n\t\t}\n\t\tif (this.textureOverrides && this.textureOverrides[index]) return this.textureOverrides[index]!;\n\t\treturn this.buffers[index].texture;\n\t}\n\n\tget currentState() {\n\t\treturn this.getStateAtIndex(this.bufferIndex);\n\t}\n\n\tget lastState() {\n\t\tif (this.numBuffers === 1) {\n\t\t\tthrow new Error(`Cannot access lastState on DataLayer \"${this.name}\" with only one buffer.`);\n\t\t}\n\t\treturn this.getStateAtIndex((this.bufferIndex - 1 + this.numBuffers) % this.numBuffers);\n\t}\n\n\t_usingTextureOverrideForCurrentBuffer() {\n\t\treturn this.textureOverrides && this.textureOverrides[this.bufferIndex];\n\t}\n\n\t_bindOutputBufferForWrite(\n\t\tincrementBufferIndex: boolean,\n\t) {\n\t\tif (incrementBufferIndex) {\n\t\t\t// Increment bufferIndex.\n\t\t\tthis._bufferIndex = (this.bufferIndex + 1) % this.numBuffers;\n\t\t}\n\t\tthis._bindOutputBuffer();\n\n\t\t// We are going to do a data write, if we have overrides enabled, we can remove them.\n\t\tif (this.textureOverrides) {\n\t\t\tthis.textureOverrides[this.bufferIndex] = undefined;\n\t\t}\n\t}\n\n\t_bindOutputBuffer() {\n\t\tconst { gl } = this.glcompute;\n\t\tconst { framebuffer } = this.buffers[this.bufferIndex];\n\t\tif (!framebuffer) {\n\t\t\tthrow new Error(`DataLayer \"${this.name}\" is not writable.`);\n\t\t}\n\t\tgl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\n\t}\n\n\tsetFromArray(array: DataLayerArrayType | number[], applyToAllBuffers = false) {\n\t\tconst { glcompute, glInternalFormat, glFormat, glType, numBuffers, width, height, bufferIndex } = this;\n\t\tconst { gl } = glcompute;\n\t\tconst validatedArray = this.validateDataArray(array);\n\t\t// TODO: check that this is working.\n\t\tconst startIndex = applyToAllBuffers ? 0 : bufferIndex;\n\t\tconst endIndex = applyToAllBuffers ? numBuffers : bufferIndex + 1;\n\t\tfor (let i = startIndex; i < endIndex; i++) {\n\t\t\tconst texture = this.getStateAtIndex(i);\n\t\t\tgl.bindTexture(gl.TEXTURE_2D, texture);\n\t\t\tgl.texImage2D(gl.TEXTURE_2D, 0, glInternalFormat, width, height, 0, glFormat, glType, validatedArray);\n\t\t}\n\t\t// Unbind texture.\n\t\tgl.bindTexture(gl.TEXTURE_2D, null);\n\t}\n\n\tresize(\n\t\tdimensions: number | [number, number],\n\t\tarray?: DataLayerArrayType | number[],\n\t) {\n\t\tconst { name, glcompute } = this;\n\t\tconst { verboseLogging } = glcompute;\n\t\tif (verboseLogging) console.log(`Resizing DataLayer \"${name}\" to ${JSON.stringify(dimensions)}.`);\n\t\tconst { length, width, height } = DataLayer.calcSize(dimensions, name);\n\t\tthis._length = length;\n\t\tthis._width = width;\n\t\tthis._height = height;\n\t\tthis.destroyBuffers();\n\t\tthis.initBuffers(array);\n\t}\n\n\tget clearValue() {\n\t\treturn this._clearValue;\n\t}\n\n\tset clearValue(clearValue: number | number[]) {\n\t\tconst { numComponents } = this;\n\t\tif (!isValidClearValue(clearValue, numComponents)) {\n\t\t\tthrow new Error(`Invalid clearValue: ${JSON.stringify(clearValue)} for DataLayer \"${this.name}\", expected number or array of number of length ${numComponents}.`);\n\t\t}\n\t\tthis._clearValue = clearValue;\n\t}\n\n\tclear(applyToAllBuffers = false) {\n\t\tconst { name, glcompute, clearValue, numBuffers, bufferIndex, numComponents } = this;\n\t\tconst { verboseLogging } = glcompute;\n\t\tif (verboseLogging) console.log(`Clearing DataLayer \"${name}\".`);\n\t\n\t\tconst startIndex = applyToAllBuffers ? 0 : bufferIndex;\n\t\tconst endIndex = applyToAllBuffers ? numBuffers : bufferIndex + 1;\n\t\tfor (let i = startIndex; i < endIndex; i++) {\n\t\t\tif (this.writable) {\n\t\t\t\t// TODO: finish this.\n\t\t\t\t// Write clear value to buffers.\n\t\t\t\tswitch(numComponents) {\n\t\t\t\t\tcase 1:\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 2:\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 3:\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 4:\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tthrow new Error(`Invalid numComponents: ${numComponents} for DataLayer \"${this.name}\".`);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Init a typed array containing clearValue and pass to buffers.\n\t\t\t}\n\t\t}\n\t}\n\n\tget width() {\n\t\treturn this._width;\n\t}\n\n\tget height() {\n\t\treturn this._height;\n\t}\n\n\tget length() {\n\t\tif (!this._length) {\n\t\t\tthrow new Error(`Cannot access length on 2D DataLayer \"${this.name}\".`);\n\t\t}\n\t\treturn this._length;\n\t}\n\n\tprivate destroyBuffers() {\n\t\tconst { glcompute, buffers } = this;\n\t\tconst { gl } = glcompute;\n\t\tbuffers.forEach(buffer => {\n\t\t\tconst { framebuffer, texture } = buffer;\n\t\t\tgl.deleteTexture(texture);\n\t\t\tif (framebuffer) {\n\t\t\t\tgl.deleteFramebuffer(framebuffer);\n\t\t\t}\n\t\t\t// @ts-ignore\n\t\t\tdelete buffer.texture;\n\t\t\tdelete buffer.framebuffer;\n\t\t});\n\t\tbuffers.length = 0;\n\n\t\t// These are technically owned by another DataLayer,\n\t\t// so we are not responsible for deleting them from gl context.\n\t\tdelete this.textureOverrides;\n\t}\n\n\tdispose() {\n\t\tconst { name, glcompute } = this;\n\t\tconst { verboseLogging } = glcompute;\n\t\tif (verboseLogging) console.log(`Destroying DataLayer \"${name}\".`);\n\t\n\t\tthis.destroyBuffers();\n\t\t// @ts-ignore\n\t\tdelete this.glcompute;\n\t}\n\n\tclone() {\n\t\t// Make a deep copy.\n\t\treturn this.glcompute.cloneDataLayer(this);\n\t}\n}\n","import { WebGLCompute } from './WebGLCompute';\nimport {\n\tisArray,\n\tisBoolean,\n\tisInteger,\n\tisNumber,\n\tisString,\n} from './Checks';\nimport {\n\tFLOAT,\n\tFLOAT_1D_UNIFORM,\n\tFLOAT_2D_UNIFORM,\n\tFLOAT_3D_UNIFORM,\n\tFLOAT_4D_UNIFORM,\n\tINT,\n\tBOOL,\n\tINT_1D_UNIFORM,\n\tINT_2D_UNIFORM,\n\tINT_3D_UNIFORM,\n\tINT_4D_UNIFORM,\n\tUniform,\n\tUniformType,\n\tUniformInternalType,\n\tUniformValue,\n\tCompileTimeVars,\n\tPROGRAM_NAME_INTERNAL,\n\tDEFAULT_PROGRAM_NAME,\n\tDEFAULT_W_UV_PROGRAM_NAME,\n\tDEFAULT_W_NORMAL_PROGRAM_NAME,\n\tDEFAULT_W_UV_NORMAL_PROGRAM_NAME,\n\tSEGMENT_PROGRAM_NAME,\n\tDATA_LAYER_POINTS_PROGRAM_NAME,\n\tDATA_LAYER_VECTOR_FIELD_PROGRAM_NAME,\n\tDATA_LAYER_LINES_PROGRAM_NAME,\n} from './Constants';\nimport {\n\tcompileShader,\n} from './utils';\n\nexport class GPUProgram {\n\treadonly name: string;\n\tprivate readonly glcompute: WebGLCompute;\n\tprivate readonly uniforms: { [ key: string]: Uniform } = {};\n\tprivate fragmentShader!: WebGLShader; // Compiled fragment shader.\n\tprivate readonly fragmentShaderSource?: string; // Source code for fragment shader.\n\tprivate defines: CompileTimeVars = {};\n\t// Store gl programs.\n\tprivate programs: {[key in PROGRAM_NAME_INTERNAL]?: WebGLProgram } = {};\n\n\tconstructor(\n\t\tglcompute: WebGLCompute,\n\t\tparams: {\n\t\t\tname: string,\n\t\t\t// We may want to pass in an array of shader string sources, if split across several files.\n\t\t\tfragmentShader: string | string[] | WebGLShader,\n\t\t\tuniforms?: {\n\t\t\t\tname: string,\n\t\t\t\tvalue: UniformValue,\n\t\t\t\ttype: UniformType,\n\t\t\t}[],\n\t\t\t// We'll allow some compile-time variables to be passed in as #define to the preprocessor for the fragment shader.\n\t\t\tdefines?: CompileTimeVars,\n\t\t},\n\t\t\n\t) {\n\t\tconst { name, fragmentShader, uniforms, defines } = params;\n\n\t\t// Save arguments.\n\t\tthis.glcompute = glcompute;\n\t\tthis.name = name;\n\n\t\t// Compile fragment shader.\n\t\tif (typeof(fragmentShader) === 'string' || typeof((fragmentShader as string[])[0]) === 'string') {\n\t\t\tlet sourceString = typeof(fragmentShader) === 'string' ?\n\t\t\t\tfragmentShader :\n\t\t\t\t(fragmentShader as string[]).join('\\n');\n\t\t\tthis.fragmentShaderSource = sourceString;\n\t\t} else {\n\t\t\tthis.fragmentShader = fragmentShader as WebGLShader;\n\t\t}\n\t\tthis.recompile(defines);\n\n\t\tif (uniforms) {\n\t\t\tfor (let i = 0; i < uniforms?.length; i++) {\n\t\t\t\tconst { name, value, type } = uniforms[i];\n\t\t\t\tthis.setUniform(name, value, type);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate static convertDefinesToString(defines: CompileTimeVars) {\n\t\tlet definesSource = '';\n\t\tconst keys = Object.keys(defines);\n\t\tfor (let i = 0; i < keys.length; i++) {\n\t\t\tconst key = keys[i];\n\t\t\t// Check that define is passed in as a string.\n\t\t\tif (!isString(key) || !isString(defines[key])) {\n\t\t\t\tthrow new Error(`GPUProgram defines must be passed in as key value pairs that are both strings, got key value pair of type [${typeof key} : ${typeof defines[key]}].`)\n\t\t\t}\n\t\t\tdefinesSource += `#define ${key} ${defines[key]}\\n`;\n\t\t}\n\t\treturn definesSource;\n\t}\n\n\trecompile(defines?: CompileTimeVars) {\n\t\tconst { glcompute, name, fragmentShaderSource } = this;\n\t\tconst { gl, errorCallback, verboseLogging } = glcompute;\n\n\t\t// Update this.defines if needed.\n\t\t// Passed in defines param may only be a partial list.\n\t\tlet definesNeedUpdate = false;\n\t\tif (defines) {\n\t\t\tconst keys = Object.keys(defines);\n\t\t\tfor (let i = 0; i < keys.length; i++) {\n\t\t\t\tconst key = keys[i];\n\t\t\t\tif (this.defines[key] !== defines[key]) {\n\t\t\t\t\tdefinesNeedUpdate = true;\n\t\t\t\t\tthis.defines[key] = defines[key];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tif (this.fragmentShader && !definesNeedUpdate) {\n\t\t\t// No need to recompile.\n\t\t\treturn;\n\t\t}\n\n\t\tif (!fragmentShaderSource) {\n\t\t\t// No fragment shader source available.\n\t\t\tthrow new Error(`Unable to recompile fragment shader for program \"${name}\" because fragment shader is already compiled, no source available.`);\n\t\t}\n\t\tif (verboseLogging) console.log(`Compiling fragment shader \"${name}\" with defines ${JSON.stringify(this.defines)}`);\n\t\t// TODO: defines should come after version declaration.\n\t\tconst definesSource = GPUProgram.convertDefinesToString(this.defines);\n\t\tconst shader = compileShader(gl, errorCallback, `${definesSource}${fragmentShaderSource}`, gl.FRAGMENT_SHADER, name);\n\t\tif (!shader) {\n\t\t\terrorCallback(`Unable to compile fragment shader for program \"${name}\".`);\n\t\t\treturn;\n\t\t}\n\t\tthis.fragmentShader = shader;\n\t}\n\n\tprivate initProgram(vertexShader: WebGLShader, programName: PROGRAM_NAME_INTERNAL) {\n\t\tconst { glcompute, fragmentShader, uniforms } = this;\n\t\tconst { gl, errorCallback} = glcompute;\n\t\t// Create a program.\n\t\tconst program = gl.createProgram();\n\t\tif (!program) {\n\t\t\terrorCallback(`Unable to init gl program: ${this.name}.`);\n\t\t\treturn;\n\t\t}\n\t\t// TODO: check that attachShader worked.\n\t\tgl.attachShader(program, fragmentShader);\n\t\tgl.attachShader(program, vertexShader);\n\t\t// Link the program.\n\t\tgl.linkProgram(program);\n\t\t// Check if it linked.\n\t\tconst success = gl.getProgramParameter(program, gl.LINK_STATUS);\n\t\tif (!success) {\n\t\t\t// Something went wrong with the link.\n\t\t\terrorCallback(`Program \"${this.name}\" failed to link: ${gl.getProgramInfoLog(program)}`);\n\t\t\treturn;\n\t\t}\n\t\t// If we have any uniforms set for this GPUProgram, add those to WebGLProgram we just inited.\n\t\tconst uniformNames = Object.keys(uniforms);\n\t\tfor (let i = 0; i < uniformNames.length; i++) {\n\t\t\tconst uniformName = uniformNames[i];\n\t\t\tconst uniform = uniforms[uniformName];\n\t\t\tconst { value, type } = uniform;\n\t\t\tthis.setProgramUniform(program, programName, uniformName, value, type);\n\t\t}\n\t\treturn program;\n\t}\n\n\tprivate getProgramWithName(name: PROGRAM_NAME_INTERNAL) {\n\t\tif (this.programs[name]) return this.programs[name];\n\t\tconst { glcompute } = this;\n\t\tconst { errorCallback, _vertexShaders } = glcompute;\n\t\tconst vertexShader = _vertexShaders[name];\n\t\tif (vertexShader.shader === undefined) {\n\t\t\tconst { glcompute, name } = this;\n\t\t\tconst { gl } = glcompute;\n\t\t\t// Init a vertex shader.\n\t\t\tlet vertexShaderSource = glcompute._preprocessVertShader(vertexShader.src);\n\t\t\tif (vertexShaderSource === '') {\n\t\t\t\tthrow new Error(`No source for vertex shader ${this.name} : ${name}`)\n\t\t\t}\n\t\t\tif (vertexShader.defines) {\n\t\t\t\t// TODO: defines should come after version declaration.\n\t\t\t\tvertexShaderSource = GPUProgram.convertDefinesToString(vertexShader.defines) + vertexShaderSource;\n\t\t\t}\n\t\t\tconst shader = compileShader(gl, errorCallback, vertexShaderSource, gl.VERTEX_SHADER, name);\n\t\t\tif (!shader) {\n\t\t\t\terrorCallback(`Unable to compile default vertex shader for program \"${name}\".`);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvertexShader.shader = shader;\n\t\t}\n\t\tconst program = this.initProgram(vertexShader.shader, DEFAULT_PROGRAM_NAME);\n\t\tif (program === undefined) {\n\t\t\terrorCallback(`Unable to init program \"${name}\".`);\n\t\t\treturn;\n\t\t}\n\t\tthis.programs[name] = program;\n\t\treturn program;\n\t}\n\n\tget defaultProgram() {\n\t\treturn this.getProgramWithName(DEFAULT_PROGRAM_NAME);\n\t}\n\n\tget defaultProgramWithUV() {\n\t\treturn this.getProgramWithName(DEFAULT_W_UV_PROGRAM_NAME);\n\t}\n\n\tget defaultProgramWithNormal() {\n\t\treturn this.getProgramWithName(DEFAULT_W_NORMAL_PROGRAM_NAME);\n\t}\n\n\tget defaultProgramWithUVNormal() {\n\t\treturn this.getProgramWithName(DEFAULT_W_UV_NORMAL_PROGRAM_NAME);\n\t}\n\n\tget segmentProgram() {\n\t\treturn this.getProgramWithName(SEGMENT_PROGRAM_NAME);\n\t}\n\n\tget dataLayerPointsProgram() {\n\t\treturn this.getProgramWithName(DATA_LAYER_POINTS_PROGRAM_NAME);\n\t}\n\n\tget dataLayerVectorFieldProgram() {\n\t\treturn this.getProgramWithName(DATA_LAYER_VECTOR_FIELD_PROGRAM_NAME);\n\t}\n\n\tget dataLayerLinesProgram() {\n\t\treturn this.getProgramWithName(DATA_LAYER_LINES_PROGRAM_NAME);\n\t}\n\n\tprivate uniformInternalTypeForValue(\n\t\tvalue: UniformValue,\n\t\ttype: UniformType,\n\t) {\n\t\tif (type === FLOAT) {\n\t\t\t// Check that we are dealing with a number.\n\t\t\tif (isArray(value)) {\n\t\t\t\tfor (let i = 0; i < (value as number[]).length; i++) {\n\t\t\t\t\tif (!isNumber((value as number[])[i])) {\n\t\t\t\t\t\tthrow new Error(`Invalid uniform value: ${value} for program \"${this.name}\", expected float or float[] of length 1-4.`);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (!isNumber(value)) {\n\t\t\t\t\tthrow new Error(`Invalid uniform value: ${value} for program \"${this.name}\", expected float or float[] of length 1-4.`);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!isArray(value) || (value as number[]).length === 1) {\n\t\t\t\treturn FLOAT_1D_UNIFORM;\n\t\t\t}\n\t\t\tif ((value as number[]).length === 2) {\n\t\t\t\treturn FLOAT_2D_UNIFORM;\n\t\t\t}\n\t\t\tif ((value as number[]).length === 3) {\n\t\t\t\treturn FLOAT_3D_UNIFORM;\n\t\t\t}\n\t\t\tif ((value as number[]).length === 4) {\n\t\t\t\treturn FLOAT_4D_UNIFORM;\n\t\t\t}\n\t\t\tthrow new Error(`Invalid uniform value: ${value} for program \"${this.name}\", expected float or float[] of length 1-4.`);\n\t\t} else if (type === INT) {\n\t\t\t// Check that we are dealing with an int.\n\t\t\tif (isArray(value)) {\n\t\t\t\tfor (let i = 0; i < (value as number[]).length; i++) {\n\t\t\t\t\tif (!isInteger((value as number[])[i])) {\n\t\t\t\t\t\tthrow new Error(`Invalid uniform value: ${value} for program \"${this.name}\", expected int or int[] of length 1-4.`);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (!isInteger(value)) {\n\t\t\t\t\tthrow new Error(`Invalid uniform value: ${value} for program \"${this.name}\", expected int or int[] of length 1-4.`);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!isArray(value) || (value as number[]).length === 1) {\n\t\t\t\treturn INT_1D_UNIFORM;\n\t\t\t}\n\t\t\tif ((value as number[]).length === 2) {\n\t\t\t\treturn INT_2D_UNIFORM;\n\t\t\t}\n\t\t\tif ((value as number[]).length === 3) {\n\t\t\t\treturn INT_3D_UNIFORM;\n\t\t\t}\n\t\t\tif ((value as number[]).length === 4) {\n\t\t\t\treturn INT_4D_UNIFORM;\n\t\t\t}\n\t\t\tthrow new Error(`Invalid uniform value: ${value} for program \"${this.name}\", expected int or int[] of length 1-4.`);\n\t\t} else if (type === BOOL) {\n\t\t\tif (isBoolean(value)) {\n\t\t\t\t// Boolean types are passed in as ints.\n\t\t\t\t// This suggest floats work as well, but ints seem more natural:\n\t\t\t\t// https://github.com/KhronosGroup/WebGL/blob/main/sdk/tests/conformance/uniforms/gl-uniform-bool.html\n\t\t\t\treturn INT_1D_UNIFORM;\n\t\t\t}\n\t\t\tthrow new Error(`Invalid uniform value: ${value} for program \"${this.name}\", expected boolean.`);\n\t\t} else {\n\t\t\tthrow new Error(`Invalid uniform type: ${type} for program \"${this.name}\", expected ${FLOAT} or ${INT} of ${BOOL}.`);\n\t\t}\n\t}\n\n\tprivate setProgramUniform(\n\t\tprogram: WebGLProgram,\n\t\tprogramName: string,\n\t\tname: string,\n\t\tvalue: UniformValue,\n\t\ttype: UniformInternalType,\n\t) {\n\t\tconst { glcompute, uniforms } = this;\n\t\tconst { gl, errorCallback } = glcompute;\n\t\t// Set active program.\n\t\tgl.useProgram(program);\n\n\t\tlet location = uniforms[name]?.location[programName];\n\t\t// Init a location for WebGLProgram if needed.\n\t\tif (location === undefined) {\n\t\t\tconst _location = gl.getUniformLocation(program, name);\n\t\t\tif (!_location) {\n\t\t\t\terrorCallback(`Could not init uniform \"${name}\" for program \"${this.name}\".\nCheck that uniform is present in shader code, unused uniforms may be removed by compiler.\nAlso check that uniform type in shader code matches type ${type}.\nError code: ${gl.getError()}.`);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlocation = _location;\n\t\t\t// Save location for future use.\n\t\t\tif (uniforms[name]) {\n\t\t\t\tuniforms[name].location[programName] = location;\n\t\t\t}\n\t\t}\n\n\t\t// Set uniform.\n\t\t// https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/uniform\n\t\tswitch (type) {\n\t\t\tcase FLOAT_1D_UNIFORM:\n\t\t\t\tgl.uniform1f(location, value as number);\n\t\t\t\tbreak;\n\t\t\tcase FLOAT_2D_UNIFORM:\n\t\t\t\tgl.uniform2fv(location, value as number[]);\n\t\t\t\tbreak;\n\t\t\tcase FLOAT_3D_UNIFORM:\n\t\t\t\tgl.uniform3fv(location, value as number[]);\n\t\t\t\tbreak;\n\t\t\tcase FLOAT_4D_UNIFORM:\n\t\t\t\tgl.uniform4fv(location, value as number[]);\n\t\t\t\tbreak;\n\t\t\tcase INT_1D_UNIFORM:\n\t\t\t\tif (isBoolean(value)) {\n\t\t\t\t\t// We are setting boolean uniforms with uniform1i.\n\t\t\t\t\tgl.uniform1i(location, value ? 1 : 0);\n\t\t\t\t} else {\n\t\t\t\t\tgl.uniform1i(location, value as number);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase INT_2D_UNIFORM:\n\t\t\t\tgl.uniform2iv(location, value as number[]);\n\t\t\t\tbreak;\n\t\t\tcase INT_3D_UNIFORM:\n\t\t\t\tgl.uniform3iv(location, value as number[]);\n\t\t\t\tbreak;\n\t\t\tcase INT_4D_UNIFORM:\n\t\t\t\tgl.uniform4iv(location, value as number[]);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthrow new Error(`Unknown uniform type ${type} for GPUProgram \"${this.name}\".`);\n\t\t}\n\t}\n\n\tsetUniform(\n\t\tname: string,\n\t\tvalue: UniformValue,\n\t\ttype?: UniformType,\n\t) {\n\t\tconst { programs, uniforms, glcompute } = this;\n\t\tconst { verboseLogging } = glcompute;\n\n\t\tlet currentType = uniforms[name]?.type;\n\t\tif (type) {\n\t\t\tconst internalType = this.uniformInternalTypeForValue(value, type);\n\t\t\tif (currentType === undefined) currentType = internalType;\n\t\t\telse {\n\t\t\t\t// console.warn(`Don't need to pass in type to GPUProgram.setUniform for previously inited uniform \"${uniformName}\"`);\n\t\t\t\t// Check that types match previously set uniform.\n\t\t\t\tif (currentType !== internalType) {\n\t\t\t\t\tthrow new Error(`Uniform \"${name}\" for GPUProgram \"${this.name}\" cannot change from type ${currentType} to type ${internalType}.`);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (currentType === undefined) {\n\t\t\tthrow new Error(`Unknown type for uniform \"${name}\", please pass in type to GPUProgram.setUniform(name, value, type) when initing a new uniform.`);\n\t\t}\n\n\t\tif (!uniforms[name]) {\n\t\t\t// Init uniform if needed.\n\t\t\tuniforms[name] = { type: currentType, location: {}, value };\n\t\t} else {\n\t\t\t// Update value.\n\t\t\tif (uniforms[name].value === value) {\n\t\t\t\treturn; // No change.\n\t\t\t}\n\t\t\tuniforms[name].value = value;\n\t\t}\n\n\t\tif (verboseLogging) console.log(`Setting uniform \"${name}\" for program \"${this.name}\" to value ${JSON.stringify(value)} with type ${currentType}.`)\n\n\t\t// Update any active programs.\n\t\tconst keys = Object.keys(programs);\n\t\tfor (let i = 0; i < keys.length; i++) {\n\t\t\tconst programName = keys[i] as PROGRAM_NAME_INTERNAL;\n\t\t\tthis.setProgramUniform(programs[programName]!, programName, name, value, currentType);\n\t\t}\n\t};\n\n\t// This is used internally.\n\tsetVertexUniform(\n\t\tprogram: WebGLProgram,\n\t\tuniformName: string,\n\t\tvalue: UniformValue,\n\t\ttype: UniformType,\n\t) {\n\t\tconst internalType = this.uniformInternalTypeForValue(value, type);\n\t\tif (program === undefined) {\n\t\t\tthrow new Error('Must pass in valid WebGLProgram to setVertexUniform, got undefined.');\n\t\t}\n\t\tconst programName = Object.keys(this.programs).find(key => this.programs[key as PROGRAM_NAME_INTERNAL] === program);\n\t\tif (!programName) {\n\t\t\tthrow new Error(`Could not find valid vertex programName for WebGLProgram \"${this.name}\".`);\n\t\t}\n\t\tthis.setProgramUniform(program, programName, uniformName, value, internalType);\n\t}\n\n\tdispose() {\n\t\tconst { glcompute, fragmentShader, programs } = this;\n\t\tconst { gl, verboseLogging } = glcompute;\n\t\tif (verboseLogging) console.log(`Destroying program \"${name}\".`);\n\n\t\t// Unbind all gl data before deleting.\n\t\tObject.values(programs).forEach(program => {\n\t\t\tgl.deleteProgram(program!);\n\t\t});\n\t\tObject.keys(this.programs).forEach(key => {\n\t\t\tdelete this.programs[key as PROGRAM_NAME_INTERNAL];\n\t\t});\n\n\t\t// From https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/deleteShader\n\t\t// This method has no effect if the shader has already been deleted\n\t\tgl.deleteShader(fragmentShader);\n\t\t// @ts-ignore\n\t\tdelete this.fragmentShader;\n\n\t\t// @ts-ignore\n\t\tdelete this.glcompute;\n\t}\n}\n","// These are the parts of threejs Vector4 that we need.\nexport class Vector4 {\n\tx: number;\n\ty: number;\n\tz: number;\n\tw: number;\n\tconstructor( x = 0, y = 0, z = 0, w = 1 ) {\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t\tthis.z = z;\n\t\tthis.w = w;\n\t}\n\tget width() {\n\t\treturn this.z;\n\t}\n\tget height() {\n\t\treturn this.w;\n\t}\n\tcopy(v: Vector4) {\n\t\tthis.x = v.x;\n\t\tthis.y = v.y;\n\t\tthis.z = v.z;\n\t\tthis.w = v.w;\n\t\treturn this;\n\t}\n}","import { saveAs } from 'file-saver';\n// @ts-ignore\nimport { changeDpiBlob } from 'changedpi';\nimport { DataLayer } from './DataLayer';\nimport {\n\tDataLayerArrayType,\n\tDataLayerFilter,\n\tDataLayerNumComponents,\n\tDataLayerType,\n\tDataLayerWrap,\n\tFLOAT,\n\tHALF_FLOAT,\n\tUNSIGNED_BYTE,\n\tBYTE,\n\tUNSIGNED_SHORT,\n\tSHORT,\n\tUNSIGNED_INT,\n\tINT,\n\tUniformType,\n\tUniformValue,\n\tGLSLVersion,\n\tGLSL1,\n\tGLSL3,\n\tCLAMP_TO_EDGE,\n\tTextureFormat,\n\tNEAREST,\n\tRGBA,\n\tTextureType,\n\tPROGRAM_NAME_INTERNAL,\n\tCompileTimeVars,\n\tDEFAULT_PROGRAM_NAME,\n\tDEFAULT_W_UV_PROGRAM_NAME,\n\tDEFAULT_W_NORMAL_PROGRAM_NAME,\n\tDEFAULT_W_UV_NORMAL_PROGRAM_NAME,\n\tSEGMENT_PROGRAM_NAME,\n\tDATA_LAYER_POINTS_PROGRAM_NAME,\n\tDATA_LAYER_VECTOR_FIELD_PROGRAM_NAME,\n\tDATA_LAYER_LINES_PROGRAM_NAME,\n\tErrorCallback,\n\tDEFAULT_CIRCLE_NUM_SEGMENTS,\n} from './Constants';\nimport { GPUProgram } from './GPUProgram';\n// Just importing the types here.\n// Only @types/three is installed.\nimport {\n\tWebGLRenderer,\n\tTexture,\n\tVector4,\n} from 'three';\nimport * as utils from './Vector4';\nimport {\n\tisWebGL2,\n\tisPowerOf2,\n\tinitSequentialFloatArray,\n\tinDevMode,\n} from './utils';\nimport { getFloat16 } from '@petamoriken/float16';\nimport {\n\tisArray,\n\tisString,\n\tisValidFilter,\n\tisValidTextureType,\n\tisValidTextureFormat,\n\tisValidWrap,\n\tvalidFilters,\n\tvalidTextureTypes,\n\tvalidTextureFormats,\n\tvalidWraps,\n} from './Checks';\nconst defaultVertexShaderSource = require('./glsl/vert/DefaultVertShader.glsl');\n\nexport class WebGLCompute {\n\treadonly gl!: WebGLRenderingContext | WebGL2RenderingContext;\n\treadonly glslVersion!: GLSLVersion;\n\t// These width and height are the current canvas at full res.\n\tprivate width!: number;\n\tprivate height!: number;\n\n\tprivate errorState = false;\n\treadonly errorCallback: ErrorCallback;\n\n\t// Save threejs renderer if passed in.\n\tprivate renderer?: WebGLRenderer;\n\tprivate readonly maxNumTextures!: number;\n\t\n\t// Precomputed buffers (inited as needed).\n\tprivate _quadPositionsBuffer?: WebGLBuffer;\n\tprivate _boundaryPositionsBuffer?: WebGLBuffer;\n\t// Store multiple circle positions buffers for various num segments, use numSegments as key.\n\tprivate _circlePositionsBuffer: { [key: number]: WebGLBuffer } = {};\n\n\tprivate pointIndexArray?: Float32Array;\n\tprivate pointIndexBuffer?: WebGLBuffer;\n\tprivate vectorFieldIndexArray?: Float32Array;\n\tprivate vectorFieldIndexBuffer?: WebGLBuffer;\n\tprivate indexedLinesIndexBuffer?: WebGLBuffer;\n\n\t// Programs for copying data (these are needed for rendering partial screen geometries).\n\tprivate readonly copyFloatProgram!: GPUProgram;\n\tprivate readonly copyIntProgram!: GPUProgram;\n\tprivate readonly copyUintProgram!: GPUProgram;\n\n\t// Other util programs.\n\tprivate _singleColorProgram?: GPUProgram;\n\tprivate _singleColorWithWrapCheckProgram?: GPUProgram;\n\tprivate _vectorMagnitudeProgram?: GPUProgram;\n\n\t// Vertex shaders are shared across all GPUProgram instances.\n\treadonly _vertexShaders: {[key in PROGRAM_NAME_INTERNAL]: {\n\t\tsrc: string,\n\t\tshader?: WebGLProgram,\n\t\tdefines?: CompileTimeVars,\n\t}} = {\n\t\t[DEFAULT_PROGRAM_NAME]: {\n\t\t\tsrc: defaultVertexShaderSource,\n\t\t},\n\t\t[DEFAULT_W_UV_PROGRAM_NAME]: {\n\t\t\tsrc: defaultVertexShaderSource,\n\t\t\tdefines: {\n\t\t\t\t'UV_ATTRIBUTE': '1',\n\t\t\t},\n\t\t},\n\t\t[DEFAULT_W_NORMAL_PROGRAM_NAME]: {\n\t\t\tsrc: defaultVertexShaderSource,\n\t\t\tdefines: {\n\t\t\t\t'NORMAL_ATTRIBUTE': '1',\n\t\t\t},\n\t\t},\n\t\t[DEFAULT_W_UV_NORMAL_PROGRAM_NAME]: {\n\t\t\tsrc: defaultVertexShaderSource,\n\t\t\tdefines: {\n\t\t\t\t'UV_ATTRIBUTE': '1',\n\t\t\t\t'NORMAL_ATTRIBUTE': '1',\n\t\t\t},\n\t\t},\n\t\t[SEGMENT_PROGRAM_NAME]: {\n\t\t\tsrc: require('./glsl/vert/SegmentVertShader.glsl'),\n\t\t},\n\t\t[DATA_LAYER_POINTS_PROGRAM_NAME]: {\n\t\t\tsrc: require('./glsl/vert/DataLayerPointsVertShader.glsl'),\n\t\t},\n\t\t[DATA_LAYER_VECTOR_FIELD_PROGRAM_NAME]: {\n\t\t\tsrc: require('./glsl/vert/DataLayerVectorFieldVertShader.glsl'),\n\t\t},\n\t\t[DATA_LAYER_LINES_PROGRAM_NAME]: {\n\t\t\tsrc: require('./glsl/vert/DataLayerLinesVertShader.glsl'),\n\t\t},\n\t};\n\n\tverboseLogging = false;\n\n\tstatic initWithThreeRenderer(\n\t\trenderer: WebGLRenderer,\n\t\tparams: {\n\t\t\tglslVersion?: GLSLVersion,\n\t\t\tverboseLogging?: boolean\n\t\t},\n\t\terrorCallback?: ErrorCallback,\n\t) {\n\t\treturn new WebGLCompute(\n\t\t\t{\n\t\t\t\tcanvas: renderer.domElement,\n\t\t\t\tcontext: renderer.getContext(),\n\t\t\t\t...params,\n\t\t\t},\n\t\t\terrorCallback,\n\t\t\trenderer,\n\t\t);\n\t}\n\n\tconstructor(\n\t\tparams: {\n\t\t\tcanvas: HTMLCanvasElement,\n\t\t\tcontext?: WebGLRenderingContext | WebGL2RenderingContext | null,\n\t\t\tcontextID?: 'webgl2' | 'webgl' | string,\n\t\t\tcontextOptions?: {\n\t\t\t\tantialias?: boolean,\n\t\t\t\t[key: string]: any,\n\t\t\t},\n\t\t\tglslVersion?: GLSLVersion,\n\t\t\tverboseLogging?: boolean,\n\t\t},\n\t\t// Optionally pass in an error callback in case we want to handle errors related to webgl support.\n\t\t// e.g. throw up a modal telling user this will not work on their device.\n\t\terrorCallback: ErrorCallback = (message: string) => { throw new Error(message) },\n\t\trenderer?: WebGLRenderer,\n\t) {\n\t\t// Check params.\n\t\tconst validKeys = ['canvas', 'context', 'contextID', 'contextOptions', 'glslVersion', 'verboseLogging'];\n\t\tObject.keys(params).forEach(key => {\n\t\t\tif (validKeys.indexOf(key) < 0) {\n\t\t\t\tthrow new Error(`Invalid key \"${key}\" passed to WebGLCompute.constructor.  Valid keys are ${validKeys.join(', ')}.`);\n\t\t\t}\n\t\t});\n\n\t\tif (!params.canvas) {\n\t\t\tthrow new Error(`Must init WebGLCompute with a canvas.`);\n\t\t}\n\n\t\tif (params.verboseLogging !== undefined) this.verboseLogging = params.verboseLogging;\n\n\t\t// Save callback in case we run into an error.\n\t\tconst self = this;\n\t\tthis.errorCallback = (message: string) => {\n\t\t\tif (self.errorState) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tself.errorState = true;\n\t\t\terrorCallback(message);\n\t\t}\n\n\t\tconst { canvas } = params;\n\t\tlet gl = params.context;\n\n\t\t// Init GL.\n\t\tif (!gl) {\n\t\t\t// Init a gl context if not passed in.\n\t\t\tif (params.contextID) {\n\t\t\t\tgl = canvas.getContext(params.contextID, params.contextOptions)  as WebGLRenderingContext | null;\n\t\t\t\tif (!gl) {\n\t\t\t\t\tconsole.warn(`Unable to initialize WebGL context with contextID: ${params.contextID}.`);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!gl) {\n\t\t\t\tgl = canvas.getContext('webgl2', params.contextOptions)  as WebGL2RenderingContext | null\n\t\t\t\t\t|| canvas.getContext('webgl', params.contextOptions)  as WebGLRenderingContext | null\n\t\t\t\t\t|| canvas.getContext('experimental-webgl', params.contextOptions)  as WebGLRenderingContext | null;\n\t\t\t}\n\t\t\tif (gl === null) {\n\t\t\t\tthis.errorCallback('Unable to initialize WebGL context.');\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tif (isWebGL2(gl)) {\n\t\t\tif (inDevMode()) console.log('Using WebGL 2.0 context.');\n\t\t} else {\n\t\t\tif (inDevMode()) console.log('Using WebGL 1.0 context.');\n\t\t}\n\t\tthis.gl = gl;\n\t\tthis.renderer = renderer;\n\n\t\t// Save glsl version, default to 1.x.\n\t\tconst glslVersion = params.glslVersion === undefined ? GLSL1 : params.glslVersion;\n\t\tthis.glslVersion = glslVersion;\n\t\tif (!isWebGL2(gl) && glslVersion === GLSL3) {\n\t\t\tconsole.warn('GLSL3.x is incompatible with WebGL1.0 contexts.');\n\t\t}\n\n\t\t// GL setup.\n\t\t// Disable depth testing globally.\n\t\tgl.disable(gl.DEPTH_TEST);\n\t\t// Set unpack alignment to 1 so we can have textures of arbitrary dimensions.\n\t\t// https://stackoverflow.com/questions/51582282/error-when-creating-textures-in-webgl-with-the-rgb-format\n\t\tgl.pixelStorei(gl.UNPACK_ALIGNMENT, 1);\n\t\t// TODO: look into more of these: https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/pixelStorei\n\t\t// // Some implementations of HTMLCanvasElement's or OffscreenCanvas's CanvasRenderingContext2D store color values\n\t\t// // internally in premultiplied form. If such a canvas is uploaded to a WebGL texture with the\n\t\t// // UNPACK_PREMULTIPLY_ALPHA_WEBGL pixel storage parameter set to false, the color channels will have to be un-multiplied\n\t\t// // by the alpha channel, which is a lossy operation. The WebGL implementation therefore can not guarantee that colors\n\t\t// // with alpha < 1.0 will be preserved losslessly when first drawn to a canvas via CanvasRenderingContext2D and then\n\t\t// // uploaded to a WebGL texture when the UNPACK_PREMULTIPLY_ALPHA_WEBGL pixel storage parameter is set to false.\n\t\t// gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, true);\n\n\t\t// Init programs to pass values from one texture to another.\n\t\t// Be sure that this.glslVersion has been set before reaching these lines.\n\t\tthis.copyFloatProgram = this.initProgram({\n\t\t\tname: 'copyFloat',\n\t\t\tfragmentShader: this._preprocessFragShader(require('./glsl/frag/CopyFloatFragShader.glsl')),\n\t\t\tuniforms: [\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'u_state',\n\t\t\t\t\t\tvalue: 0,\n\t\t\t\t\t\ttype: INT,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t);\n\t\tif (glslVersion === GLSL3) {\n\t\t\tthis.copyIntProgram = this.initProgram({\n\t\t\t\tname: 'copyInt',\n\t\t\t\tfragmentShader: require('./glsl/frag/CopyIntFragShader.glsl'),\n\t\t\t\tuniforms: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tname: 'u_state',\n\t\t\t\t\t\t\tvalue: 0,\n\t\t\t\t\t\t\ttype: INT,\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t);\n\t\t\tthis.copyUintProgram = this.initProgram({\n\t\t\t\tname: 'copyUint',\n\t\t\t\tfragmentShader: require('./glsl/frag/CopyUintFragShader.glsl'),\n\t\t\t\tuniforms: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tname: 'u_state',\n\t\t\t\t\t\t\tvalue: 0,\n\t\t\t\t\t\t\ttype: INT,\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t);\n\t\t} else {\n\t\t\tthis.copyIntProgram = this.copyFloatProgram;\n\t\t\tthis.copyUintProgram = this.copyFloatProgram;\n\t\t}\n\n\t\t// Unbind active buffer.\n\t\tgl.bindBuffer(gl.ARRAY_BUFFER, null);\n\n\t\t// Canvas setup.\n\t\tthis.onResize(canvas);\n\n\t\t// Log number of textures available.\n\t\tthis.maxNumTextures = this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS);\n\t\tif (inDevMode()) console.log(`${this.maxNumTextures} textures max.`);\n\t}\n\n\tprivate preprocessShader(shaderSource: string) {\n\t\t// Convert to glsl1.\n\t\t// Get rid of version declaration.\n\t\tshaderSource = shaderSource.replace('#version 300 es\\n', '');\n\t\t// Remove unnecessary precision declarations.\n\t\tshaderSource = shaderSource.replace(/precision \\w+ isampler2D;*\\n/g, '');\n\t\tshaderSource = shaderSource.replace(/precision \\w+ usampler2D;*\\n/g, '');\n\t\t// Convert types.\n\t\tshaderSource = shaderSource.replace(/uvec2/g, 'vec2');\n\t\tshaderSource = shaderSource.replace(/uvec3/g, 'vec3');\n\t\tshaderSource = shaderSource.replace(/uvec4/g, 'vec4');\n\t\tshaderSource = shaderSource.replace(/usampler2D/g, 'sampler2D');\n\t\tshaderSource = shaderSource.replace(/ivec2/g, 'vec2');\n\t\tshaderSource = shaderSource.replace(/ivec3/g, 'vec3');\n\t\tshaderSource = shaderSource.replace(/ivec4/g, 'vec4');\n\t\tshaderSource = shaderSource.replace(/isampler2D/g, 'sampler2D');\n\t\t// Convert functions.\n\t\tshaderSource = shaderSource.replace(/texture\\(/g, 'texture2D(');\n\t\treturn shaderSource;\n\t}\n\n\t_preprocessFragShader(shaderSource: string) {\n\t\tconst { glslVersion } = this;\n\t\tif (glslVersion === GLSL3) return shaderSource;\n\t\t// Convert to glsl1.\n\t\tshaderSource = this.preprocessShader(shaderSource);\n\t\t// Convert in to varying.\n\t\tshaderSource = shaderSource.replace(/\\nin\\s+/, '\\nvarying ');\n\t\t// Convert out to gl_FragColor.\n\t\tshaderSource = shaderSource.replace(/out \\w+ out_fragOut;\\n/, '');\n\t\tshaderSource = shaderSource.replace(/out_fragOut\\s+=/, 'gl_FragColor =');\n\t\treturn shaderSource;\n\t}\n\n\t_preprocessVertShader(shaderSource: string) {\n\t\tconst { glslVersion } = this;\n\t\tif (glslVersion === GLSL3) return shaderSource;\n\t\t// Convert to glsl1.\n\t\tshaderSource = this.preprocessShader(shaderSource);\n\t\t// Convert in to attribute.\n\t\tshaderSource = shaderSource.replace(/\\nin\\s+/g, '\\nattribute ');\n\t\t// Convert out to varying.\n\t\tshaderSource = shaderSource.replace(/\\nout\\s+/g, '\\nvarying ');\n\t\treturn shaderSource;\n\t}\n\n\tprivate get singleColorProgram() {\n\t\tif (this._singleColorProgram === undefined) {\n\t\t\tconst program = this.initProgram({\n\t\t\t\tname: 'singleColor',\n\t\t\t\tfragmentShader: this._preprocessFragShader(require('./glsl_3/SingleColorFragShader.glsl')),\n\t\t\t});\n\t\t\tthis._singleColorProgram = program;\n\t\t}\n\t\treturn this._singleColorProgram;\n\t}\n\n\tprivate get singleColorWithWrapCheckProgram() {\n\t\tif (this._singleColorWithWrapCheckProgram === undefined) {\n\t\t\tconst program = this.initProgram({\n\t\t\t\tname: 'singleColorWithWrapCheck',\n\t\t\t\tfragmentShader: this._preprocessFragShader(require('./glsl_3/SingleColorWithWrapCheckFragShader.glsl')),\n\t\t\t});\n\t\t\tthis._singleColorWithWrapCheckProgram = program;\n\t\t}\n\t\treturn this._singleColorWithWrapCheckProgram;\n\t}\n\n\tprivate get vectorMagnitudeProgram() {\n\t\tif (this._vectorMagnitudeProgram === undefined) {\n\t\t\tconst program = this.initProgram({\n\t\t\t\tname: 'vectorMagnitude',\n\t\t\t\tfragmentShader: this._preprocessFragShader(require('./glsl_3/VectorMagnitudeFragShader.glsl')),\n\t\t\t});\n\t\t\tthis._vectorMagnitudeProgram = program;\n\t\t}\n\t\treturn this._vectorMagnitudeProgram;\n\t}\n\n\tisWebGL2() {\n\t\treturn isWebGL2(this.gl);\n\t}\n\n\tprivate get quadPositionsBuffer() {\n\t\tif (this._quadPositionsBuffer === undefined) {\n\t\t\tconst fsQuadPositions = new Float32Array([ -1, -1, 1, -1, -1, 1, 1, 1 ]);\n\t\t\tthis._quadPositionsBuffer = this.initVertexBuffer(fsQuadPositions)!;\n\t\t}\n\t\treturn this._quadPositionsBuffer!;\n\t}\n\n\tprivate get boundaryPositionsBuffer() {\n\t\tif (this._boundaryPositionsBuffer === undefined) {\n\t\t\tconst boundaryPositions = new Float32Array([ -1, -1, 1, -1, 1, 1, -1, 1, -1, -1 ]);\n\t\t\tthis._boundaryPositionsBuffer = this.initVertexBuffer(boundaryPositions)!;\n\t\t}\n\t\treturn this._boundaryPositionsBuffer!;\n\t}\n\n\tprivate getCirclePositionsBuffer(numSegments: number) {\n\t\tif (this._circlePositionsBuffer[numSegments] == undefined) {\n\t\t\tconst unitCirclePoints = [0, 0];\n\t\t\tfor (let i = 0; i <= numSegments; i++) { // TODO: should this be just less than?\n\t\t\t\tunitCirclePoints.push(\n\t\t\t\t\tMath.cos(2 * Math.PI * i / numSegments),\n\t\t\t\t\tMath.sin(2 * Math.PI * i / numSegments),\n\t\t\t\t);\n\t\t\t}\n\t\t\tconst circlePositions = new Float32Array(unitCirclePoints);\n\t\t\tconst buffer = this.initVertexBuffer(circlePositions)!;\n\t\t\tthis._circlePositionsBuffer[numSegments] = buffer;\n\t\t}\n\t\treturn this._circlePositionsBuffer[numSegments];\n\t}\n\n\tprivate initVertexBuffer(\n\t\tdata: Float32Array,\n\t) {\n\t\tconst { errorCallback, gl } = this;\n\t\tconst buffer = gl.createBuffer();\n\t\tif (!buffer) {\n\t\t\terrorCallback('Unable to allocate gl buffer.');\n\t\t\treturn;\n\t\t}\n\t\tgl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n\t\t// Add buffer data.\n\t\tgl.bufferData(gl.ARRAY_BUFFER, data, gl.STATIC_DRAW);\n\t\treturn buffer;\n\t}\n\n\tinitProgram(\n\t\tparams: {\n\t\t\tname: string,\n\t\t\tfragmentShader: string | WebGLShader,\n\t\t\tuniforms?: {\n\t\t\t\tname: string,\n\t\t\t\tvalue: UniformValue,\n\t\t\t\ttype: UniformType,\n\t\t\t}[],\n\t\t\tdefines?: {\n\t\t\t\t[key : string]: string,\n\t\t\t},\n\t\t},\n\t) {\n\t\t// Check params.\n\t\tconst validKeys = ['name', 'fragmentShader', 'uniforms', 'defines'];\n\t\tObject.keys(params).forEach(key => {\n\t\t\tif (validKeys.indexOf(key) < 0) {\n\t\t\t\tthrow new Error(`Invalid key \"${key}\" passed to WebGLCompute.initProgram with name \"${params.name}\".  Valid keys are ${validKeys.join(', ')}.`);\n\t\t\t}\n\t\t});\n\t\treturn new GPUProgram(this, params);\n\t};\n\n\tinitDataLayer(\n\t\tparams: {\n\t\t\tname: string,\n\t\t\tdimensions: number | [number, number],\n\t\t\ttype: DataLayerType,\n\t\t\tnumComponents: DataLayerNumComponents,\n\t\t\tarray?: DataLayerArrayType | number[],\n\t\t\tfilter?: DataLayerFilter,\n\t\t\twrapS?: DataLayerWrap,\n\t\t\twrapT?: DataLayerWrap,\n\t\t\twritable?: boolean,\n\t\t\tnumBuffers?: number,\n\t\t\tclearValue?: number | number[],\n\t\t},\n\t) {\n\t\t// Check params.\n\t\tconst validKeys = ['name', 'dimensions', 'type', 'numComponents', 'array', 'filter', 'wrapS', 'wrapT', 'writable', 'numBuffers', 'clearValue'];\n\t\tObject.keys(params).forEach(key => {\n\t\t\tif (validKeys.indexOf(key) < 0) {\n\t\t\t\tthrow new Error(`Invalid key \"${key}\" passed to WebGLCompute.initDataLayer with name \"${params.name}\".  Valid keys are ${validKeys.join(', ')}.`);\n\t\t\t}\n\t\t});\n\t\treturn new DataLayer(this, params);\n\t};\n\n\tcloneDataLayer(dataLayer: DataLayer) {\n\t\tlet dimensions: number | [number, number] = 0;\n\t\ttry {\n\t\t\tdimensions = dataLayer.length;\n\t\t} catch {\n\t\t\tdimensions = [dataLayer.width, dataLayer.height];\n\t\t}\n\n\t\t// If read only, get state by reading to GPU.\n\t\tconst array = dataLayer.writable ? undefined : this.getValues(dataLayer);\n\n\t\tconst clone = this.initDataLayer({\n\t\t\tname: `${dataLayer.name}-clone`,\n\t\t\tdimensions,\n\t\t\ttype: dataLayer.type,\n\t\t\tnumComponents: dataLayer.numComponents,\n\t\t\tarray,\n\t\t\tfilter: dataLayer.filter,\n\t\t\twrapS: dataLayer.wrapS,\n\t\t\twrapT: dataLayer.wrapT,\n\t\t\twritable: dataLayer.writable,\n\t\t\tnumBuffers: dataLayer.numBuffers,\n\t\t});\n\n\t\t// If writable, copy current state with a draw call.\n\t\tif (dataLayer.writable) {\n\t\t\tfor (let i = 0; i < dataLayer.numBuffers - 1; i++) {\n\t\t\t\tthis.step({\n\t\t\t\t\tprogram: this.copyProgramForType(dataLayer.type),\n\t\t\t\t\tinput: dataLayer.getStateAtIndex((dataLayer.bufferIndex + i + 1) % dataLayer.numBuffers),\n\t\t\t\t\toutput: clone,\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.step({\n\t\t\t\tprogram: this.copyProgramForType(dataLayer.type),\n\t\t\t\tinput: dataLayer.currentState,\n\t\t\t\toutput: clone,\n\t\t\t});\n\t\t}\n\t\treturn clone;\n\t}\n\n\tinitTexture(\n\t\tparams: {\n\t\t\tname: string,\n\t\t\turl: string,\n\t\t\tfilter?: DataLayerFilter,\n\t\t\twrapS?: DataLayerWrap,\n\t\t\twrapT?: DataLayerWrap,\n\t\t\tformat?: TextureFormat,\n\t\t\ttype?: TextureType,\n\t\t\tonLoad?: (texture: WebGLTexture) => void,\n\t\t},\n\t) {\n\t\t// Check params.\n\t\tconst validKeys = ['name', 'url', 'filter', 'wrapS', 'wrapT', 'format', 'type', 'onLoad'];\n\t\tObject.keys(params).forEach(key => {\n\t\t\tif (validKeys.indexOf(key) < 0) {\n\t\t\t\tthrow new Error(`Invalid key \"${key}\" passed to WebGLCompute.initTexture with name \"${params.name}\".  Valid keys are ${validKeys.join(', ')}.`);\n\t\t\t}\n\t\t});\n\t\tconst { url, name } = params;\n\t\tif (!isString(url)) {\n\t\t\tthrow new Error(`Expected WebGLCompute.initTexture params to have url of type string, got ${url} of type ${typeof url}.`)\n\t\t}\n\t\tif (!isString(name)) {\n\t\t\tthrow new Error(`Expected WebGLCompute.initTexture params to have name of type string, got ${name} of type ${typeof name}.`)\n\t\t}\n\n\t\t// Get filter type, default to nearest.\n\t\tconst filter = params.filter !== undefined ? params.filter : NEAREST;\n\t\tif (!isValidFilter(filter)) {\n\t\t\tthrow new Error(`Invalid filter: ${filter} for DataLayer \"${name}\", must be ${validFilters.join(', ')}.`);\n\t\t}\n\n\t\t// Get wrap types, default to clamp to edge.\n\t\tconst wrapS = params.wrapS !== undefined ? params.wrapS : CLAMP_TO_EDGE;\n\t\tif (!isValidWrap(wrapS)) {\n\t\t\tthrow new Error(`Invalid wrapS: ${wrapS} for DataLayer \"${name}\", must be ${validWraps.join(', ')}.`);\n\t\t}\n\t\tconst wrapT = params.wrapT !== undefined ? params.wrapT : CLAMP_TO_EDGE;\n\t\tif (!isValidWrap(wrapT)) {\n\t\t\tthrow new Error(`Invalid wrapT: ${wrapT} for DataLayer \"${name}\", must be ${validWraps.join(', ')}.`);\n\t\t}\n\n\t\t// Get image format type, default to rgba.\n\t\tconst format = params.format !== undefined ? params.format : RGBA;\n\t\tif (!isValidTextureFormat(format)) {\n\t\t\tthrow new Error(`Invalid format: ${format} for DataLayer \"${name}\", must be ${validTextureFormats.join(', ')}.`);\n\t\t}\n\n\t\t// Get image data type, default to unsigned byte.\n\t\tconst type = params.type !== undefined ? params.type : UNSIGNED_BYTE;\n\t\tif (!isValidTextureType(type)) {\n\t\t\tthrow new Error(`Invalid type: ${type} for DataLayer \"${name}\", must be ${validTextureTypes.join(', ')}.`);\n\t\t}\n\n\t\tconst { gl, errorCallback } = this;\n\t\tconst texture = gl.createTexture();\n\t\tif (texture === null) {\n\t\t\tthrow new Error(`Unable to init glTexture.`);\n\t\t}\n\t\tgl.bindTexture(gl.TEXTURE_2D, texture);\n\t\t// Because images have to be downloaded over the internet\n\t\t// they might take a moment until they are ready.\n\t\t// Until then put a single pixel in the texture so we can\n\t\t// use it immediately. When the image has finished downloading\n\t\t// we'll update the texture with the contents of the image.\n\t\tconst level = 0;\n\t\tconst internalFormat = gl.RGBA;\n\t\tconst width = 1;\n\t\tconst height = 1;\n\t\tconst border = 0;\n\t\tconst srcFormat = gl[format];\n\t\tconst srcType = gl[type];\n\t\tconst pixel = new Uint8Array([0, 0, 0, 0]);\n\t\tgl.texImage2D(gl.TEXTURE_2D, level, internalFormat,\n\t\t\twidth, height, border, srcFormat, srcType, pixel);\n\n\t\tconst image = new Image();\n\t\timage.onload = () => {\n\t\t\tgl.bindTexture(gl.TEXTURE_2D, texture);\n\t\t\tgl.texImage2D(gl.TEXTURE_2D, level, internalFormat,\n\t\t\t\tsrcFormat, srcType, image);\n\n\t\t\t// WebGL1 has different requirements for power of 2 images\n\t\t\t// vs non power of 2 images so check if the image is a\n\t\t\t// power of 2 in both dimensions.\n\t\t\tif (isPowerOf2(image.width) && isPowerOf2(image.height)) {\n\t\t\t\t// // Yes, it's a power of 2. Generate mips.\n\t\t\t\t// gl.generateMipmap(gl.TEXTURE_2D);\n\t\t\t} else {\n\t\t\t\t// TODO: finish implementing this.\n\t\t\t\tconsole.warn(`Texture ${name} dimensions [${image.width}, ${image.height}] are not power of 2.`);\n\t\t\t\t// // No, it's not a power of 2. Turn off mips and set\n\t\t\t\t// // wrapping to clamp to edge\n\t\t\t\t// gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n\t\t\t\t// gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\t\t\t}\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl[wrapS]);\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl[wrapT]);\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl[filter]);\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl[filter]);\n\n\t\t\t// Callback when texture has loaded.\n\t\t\tif (params.onLoad) params.onLoad(texture);\n\t\t};\n\t\timage.onerror = (e) => {\n\t\t\terrorCallback(`Error loading image ${name}: ${e}`);\n\t\t}\n\t\timage.src = url;\n\n\t\treturn texture;\n\t}\n\n\tonResize(canvas: HTMLCanvasElement) {\n\t\tconst width = canvas.clientWidth;\n\t\tconst height = canvas.clientHeight;\n\t\t// Set correct canvas pixel size.\n\t\t// https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/By_example/Canvas_size_and_WebGL\n\t\tcanvas.width = width;\n\t\tcanvas.height = height;\n\t\t// Save dimensions.\n\t\tthis.width = width;\n\t\tthis.height = height;\n\t};\n\n\tprivate drawSetup(\n\t\tprogram: WebGLProgram,\n\t\tfullscreenRender: boolean,\n\t\tinput?: (DataLayer | WebGLTexture)[] | DataLayer | WebGLTexture,\n\t\toutput?: DataLayer,\n\t) {\n\t\tconst { gl } = this;\n\t\t// Check if we are in an error state.\n\t\tif (!program) {\n\t\t\treturn;\n\t\t}\n\n\t\t// CAUTION: the order of these next few lines is important.\n\n\t\t// Get a shallow copy of current textures.\n\t\t// This line must come before this.setOutput() as it depends on current internal state.\n\t\tconst inputTextures: WebGLTexture[] = [];\n\t\tif (input) {\n\t\t\tif (input.constructor === WebGLTexture) {\n\t\t\t\tinputTextures.push(input as WebGLTexture);\n\t\t\t} else if (input.constructor === DataLayer) {\n\t\t\t\tinputTextures.push((input as DataLayer).currentState);\n\t\t\t} else {\n\t\t\t\tfor (let i = 0; i < (input as (DataLayer | WebGLTexture)[]).length; i++) {\n\t\t\t\t\tconst layer = (input as (DataLayer | WebGLTexture)[])[i];\n\t\t\t\t\t// @ts-ignore\n\t\t\t\t\tinputTextures.push((layer as DataLayer).getCurrentStateTexture ? (layer as DataLayer).currentState : layer as WebGLTexture)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Set output framebuffer.\n\t\t// This may modify WebGL internal state.\n\t\tthis.setOutputLayer(fullscreenRender, input, output);\n\n\t\t// Set current program.\n\t\tgl.useProgram(program);\n\n\t\t// Set input textures.\n\t\tfor (let i = 0; i < inputTextures.length; i++) {\n\t\t\tgl.activeTexture(gl.TEXTURE0 + i);\n\t\t\tgl.bindTexture(gl.TEXTURE_2D, inputTextures[i]);\n\t\t}\n\t}\n\n\tcopyProgramForType(type: DataLayerType) {\n\t\tswitch (type) {\n\t\t\tcase HALF_FLOAT:\n\t\t\tcase FLOAT:\n\t\t\t\treturn this.copyFloatProgram;\n\t\t\tcase UNSIGNED_BYTE:\n\t\t\tcase UNSIGNED_SHORT:\n\t\t\tcase UNSIGNED_INT:\n\t\t\t\treturn this.copyUintProgram;\n\t\t\tcase BYTE:\n\t\t\tcase SHORT:\n\t\t\tcase INT:\n\t\t\t\treturn this.copyIntProgram;\n\t\t\tdefault:\n\t\t\t\tthrow new Error(`Invalid type: ${type} passed to WebGLCompute.copyProgramForType.`);\n\t\t}\n\t}\n\n\tprivate setBlendMode(shouldBlendAlpha?: boolean) {\n\t\tconst { gl } = this;\n\t\tif (shouldBlendAlpha) {\n\t\t\tgl.enable(gl.BLEND);\n\t\t\tgl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n\t\t}\n\t}\n\n\tprivate addLayerToInputs(\n\t\tlayer: DataLayer,\n\t\tinput?:  (DataLayer | WebGLTexture)[] | DataLayer | WebGLTexture,\n\t) {\n\t\t// Add layer to end of input if needed.\n\t\tlet _inputLayers = input;\n\t\tif (isArray(_inputLayers)) {\n\t\t\tconst index = (_inputLayers as (DataLayer | WebGLTexture)[]).indexOf(layer);\n\t\t\tif (index < 0) {\n\t\t\t\t(_inputLayers as (DataLayer | WebGLTexture)[]).push(layer);\n\t\t\t} \n\t\t} else {\n\t\t\tif (_inputLayers !== layer) {\n\t\t\t\tconst previous = _inputLayers;\n\t\t\t\t_inputLayers = [];\n\t\t\t\tif (previous) (_inputLayers as (DataLayer | WebGLTexture)[]).push(previous);\n\t\t\t\t(_inputLayers as (DataLayer | WebGLTexture)[]).push(layer);\n\t\t\t} else {\n\t\t\t\t_inputLayers = [_inputLayers];\n\t\t\t}\n\t\t}\n\t\treturn _inputLayers as (DataLayer | WebGLTexture)[];\n\t}\n\n\tprivate passThroughLayerDataFromInputToOutput(state: DataLayer) {\n\t\t// TODO: figure out the fastest way to copy a texture.\n\t\tconst copyProgram = this.copyProgramForType(state.internalType);\n\t\tthis.step({\n\t\t\tprogram: copyProgram,\n\t\t\tinput: state,\n\t\t\toutput: state,\n\t\t});\n\t}\n\n\tprivate setOutputLayer(\n\t\tfullscreenRender: boolean,\n\t\tinput?: (DataLayer | WebGLTexture)[] | DataLayer | WebGLTexture,\n\t\toutput?: DataLayer, // Undefined renders to screen.\n\t) {\n\t\tconst { gl } = this;\n\n\t\t// Render to screen.\n\t\tif (!output) {\n\t\t\tgl.bindFramebuffer(gl.FRAMEBUFFER, null);\n\t\t\t// Resize viewport.\n\t\t\tconst { width, height } = this;\n\t\t\tgl.viewport(0, 0, width, height);\n\t\t\treturn;\n\t\t}\n\n\t\t// Check if output is same as one of input layers.\n\t\tif (input && ((input === output) || (isArray(input) && (input as (DataLayer | WebGLTexture)[]).indexOf(output) > -1))) {\n\t\t\tif (output.numBuffers === 1) {\n\t\t\t\tthrow new Error('Cannot use same buffer for input and output of a program. Try increasing the number of buffers in your output layer to at least 2 so you can render to nextState using currentState as an input.');\n\t\t\t}\n\t\t\tif (fullscreenRender) {\n\t\t\t\t// Render and increment buffer so we are rendering to a different target\n\t\t\t\t// than the input texture.\n\t\t\t\toutput._bindOutputBufferForWrite(true);\n\t\t\t} else {\n\t\t\t\t// Pass input texture through to output.\n\t\t\t\tthis.passThroughLayerDataFromInputToOutput(output);\n\t\t\t\t// Render to output without incrementing buffer.\n\t\t\t\toutput._bindOutputBufferForWrite(false);\n\t\t\t}\n\t\t} else {\n\t\t\tif (fullscreenRender) {\n\t\t\t\t// Render to current buffer.\n\t\t\t\toutput._bindOutputBufferForWrite(false);\n\t\t\t} else {\n\t\t\t\t// If we are doing a sneaky thing with a swapped texture and are\n\t\t\t\t// only rendering part of the screen, we may need to add a copy operation.\n\t\t\t\tif (output._usingTextureOverrideForCurrentBuffer()) {\n\t\t\t\t\tthis.passThroughLayerDataFromInputToOutput(output);\n\t\t\t\t}\n\t\t\t\toutput._bindOutputBufferForWrite(false);\n\t\t\t}\n\t\t}\n\t\t\n\t\t// Resize viewport.\n\t\tconst { width, height } = output;\n\t\tgl.viewport(0, 0, width, height);\n\t};\n\n\tprivate setPositionAttribute(program: WebGLProgram, programName: string) {\n\t\tthis.setVertexAttribute(program, 'a_internal_position', 2, programName);\n\t}\n\n\tprivate setIndexAttribute(program: WebGLProgram, programName: string) {\n\t\tthis.setVertexAttribute(program, 'a_internal_index', 1, programName);\n\t}\n\n\tprivate setUVAttribute(program: WebGLProgram, programName: string) {\n\t\tthis.setVertexAttribute(program, 'a_internal_uv', 2, programName);\n\t}\n\n\tprivate setVertexAttribute(program: WebGLProgram, name: string, size: number, programName: string) {\n\t\tconst { gl } = this;\n\t\t// Point attribute to the currently bound VBO.\n\t\tconst location = gl.getAttribLocation(program, name);\n\t\tif (location < 0) {\n\t\t\tthrow new Error(`Unable to find vertex attribute \"${name}\" in program \"${programName}\".`);\n\t\t}\n\t\t// TODO: only float is supported for vertex attributes.\n\t\tgl.vertexAttribPointer(location, size, gl.FLOAT, false, 0, 0);\n\t\t// Enable the attribute.\n\t\tgl.enableVertexAttribArray(location);\n\t}\n\n\t// Step for entire fullscreen quad.\n\tstep(\n\t\tparams: {\n\t\t\tprogram: GPUProgram,\n\t\t\tinput?:  (DataLayer | WebGLTexture)[] | DataLayer | WebGLTexture,\n\t\t\toutput?: DataLayer, // Undefined renders to screen.\n\t\t\tshouldBlendAlpha?: boolean,\n\t\t},\n\t) {\n\t\tconst { gl, errorState, quadPositionsBuffer } = this;\n\t\tconst { program, input, output } = params;\n\n\t\t// Ignore if we are in error state.\n\t\tif (errorState) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst glProgram = program.defaultProgram!;\n\n\t\t// Do setup - this must come first.\n\t\tthis.drawSetup(glProgram, true, input, output);\n\n\t\t// Update uniforms and buffers.\n\t\tprogram.setVertexUniform(glProgram, 'u_internal_scale', [1, 1], FLOAT);\n\t\tprogram.setVertexUniform(glProgram, 'u_internal_translation', [0, 0], FLOAT);\n\t\tgl.bindBuffer(gl.ARRAY_BUFFER, quadPositionsBuffer);\n\t\tthis.setPositionAttribute(glProgram, program.name);\n\n\t\t// Draw.\n\t\tthis.setBlendMode(params.shouldBlendAlpha);\n\t\tgl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n\t\tgl.disable(gl.BLEND);\n\t}\n\n\t// Step program only for a strip of px along the boundary.\n\tstepBoundary(\n\t\tparams: {\n\t\t\tprogram: GPUProgram,\n\t\t\tinput?:  (DataLayer | WebGLTexture)[] | DataLayer | WebGLTexture,\n\t\t\toutput?: DataLayer, // Undefined renders to screen.\n\t\t\tsingleEdge?: 'LEFT' | 'RIGHT' | 'TOP' | 'BOTTOM';\n\t\t\tshouldBlendAlpha?: boolean,\n\t\t},\n\t) {\n\t\tconst { gl, errorState, boundaryPositionsBuffer} = this;\n\t\tconst { program, input, output } = params;\n\t\tconst width = output ? output.width : this.width;\n\t\tconst height = output ? output.height : this.height;\n\n\t\t// Ignore if we are in error state.\n\t\tif (errorState) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst glProgram = program.defaultProgram!;\n\n\t\t// Do setup - this must come first.\n\t\tthis.drawSetup(glProgram, false, input, output);\n\n\t\t// Update uniforms and buffers.\n\t\t// Frame needs to be offset and scaled so that all four sides are in viewport.\n\t\tconst onePx = [ 1 / width, 1 / height] as [number, number];\n\t\tprogram.setVertexUniform(glProgram, 'u_internal_scale', [1 - onePx[0], 1 - onePx[1]], FLOAT);\n\t\tprogram.setVertexUniform(glProgram, 'u_internal_translation', onePx, FLOAT);\n\t\tgl.bindBuffer(gl.ARRAY_BUFFER, boundaryPositionsBuffer);\n\t\tthis.setPositionAttribute(glProgram, program.name);\n\n\t\t// Draw.\n\t\tthis.setBlendMode(params.shouldBlendAlpha);\n\t\tif (params.singleEdge) {\n\t\t\tswitch(params.singleEdge) {\n\t\t\t\tcase 'LEFT':\n\t\t\t\t\tgl.drawArrays(gl.LINES, 3, 2);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'RIGHT':\n\t\t\t\t\tgl.drawArrays(gl.LINES, 1, 2);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'TOP':\n\t\t\t\t\tgl.drawArrays(gl.LINES, 2, 2);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'BOTTOM':\n\t\t\t\t\tgl.drawArrays(gl.LINES, 0, 2);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tthrow new Error(`Unknown boundary edge type: ${params.singleEdge}.`);\n\t\t\t}\n\t\t} else {\n\t\t\tgl.drawArrays(gl.LINE_LOOP, 0, 4);\n\t\t}\n\t\tgl.disable(gl.BLEND);\n\t}\n\n\t// Step program for all but a strip of px along the boundary.\n\tstepNonBoundary(\n\t\tparams: {\n\t\t\tprogram: GPUProgram,\n\t\t\tinput?:  (DataLayer | WebGLTexture)[] | DataLayer | WebGLTexture,\n\t\t\toutput?: DataLayer, // Undefined renders to screen.\n\t\t\tshouldBlendAlpha?: boolean,\n\t\t},\n\t) {\n\t\tconst { gl, errorState, quadPositionsBuffer } = this;\n\t\tconst { program, input, output } = params;\n\t\tconst width = output ? output.width : this.width;\n\t\tconst height = output ? output.height : this.height;\n\n\t\t// Ignore if we are in error state.\n\t\tif (errorState) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst glProgram = program.defaultProgram!;\n\n\t\t// Do setup - this must come first.\n\t\tthis.drawSetup(glProgram, false, input, output);\n\n\t\t// Update uniforms and buffers.\n\t\tconst onePx = [ 1 / width, 1 / height] as [number, number];\n\t\tprogram.setVertexUniform(glProgram, 'u_internal_scale', [1 - 2 * onePx[0], 1 - 2 * onePx[1]], FLOAT);\n\t\tprogram.setVertexUniform(glProgram, 'u_internal_translation', onePx, FLOAT);\n\t\tgl.bindBuffer(gl.ARRAY_BUFFER, quadPositionsBuffer);\n\t\tthis.setPositionAttribute(glProgram, program.name);\n\t\t\n\t\t// Draw.\n\t\tthis.setBlendMode(params.shouldBlendAlpha);\n\t\tgl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n\t\tgl.disable(gl.BLEND);\n\t}\n\n\t// Step program only for a circular spot.\n\tstepCircle(\n\t\tparams: {\n\t\t\tprogram: GPUProgram,\n\t\t\tposition: [number, number], // Position is in screen space coords.\n\t\t\tradius: number, // Radius is in screen space units.\n\t\t\tinput?:  (DataLayer | WebGLTexture)[] | DataLayer | WebGLTexture,\n\t\t\toutput?: DataLayer, // Undefined renders to screen.\n\t\t\tnumSegments?: number,\n\t\t\tshouldBlendAlpha?: boolean,\n\t\t},\n\t) {\n\t\tconst { gl, errorState, width, height } = this;\n\t\tconst { program, position, radius, input, output } = params;\n\n\t\t// Ignore if we are in error state.\n\t\tif (errorState) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst glProgram = program.defaultProgram!;\n\n\t\t// Do setup - this must come first.\n\t\tthis.drawSetup(glProgram, false, input, output);\n\n\t\t// Update uniforms and buffers.\n\t\tprogram.setVertexUniform(glProgram, 'u_internal_scale', [radius * 2 / width, radius * 2 / height], FLOAT);\n\t\tprogram.setVertexUniform(glProgram, 'u_internal_translation', [2 * position[0] / width - 1, 2 * position[1] / height - 1], FLOAT);\n\t\tconst numSegments = params.numSegments ? params.numSegments : DEFAULT_CIRCLE_NUM_SEGMENTS;\n\t\tif (numSegments < 3) {\n\t\t\tthrow new Error(`numSegments for WebGLCompute.stepCircle must be greater than 2, got ${numSegments}.`);\n\t\t}\n\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.getCirclePositionsBuffer(numSegments));\n\t\tthis.setPositionAttribute(glProgram, program.name);\n\t\t\n\t\t// Draw.\n\t\tthis.setBlendMode(params.shouldBlendAlpha);\n\t\tgl.drawArrays(gl.TRIANGLE_FAN, 0, numSegments + 2);\t\n\t\tgl.disable(gl.BLEND);\n\t}\n\n\t// Step program only for a thickened line segment (rounded end caps available).\n\tstepSegment(\n\t\tparams: {\n\t\t\tprogram: GPUProgram,\n\t\t\tposition1: [number, number], // Position is in screen space coords.\n\t\t\tposition2: [number, number], // Position is in screen space coords.\n\t\t\tthickness: number, // Thickness is in px.\n\t\t\tinput?:  (DataLayer | WebGLTexture)[] | DataLayer | WebGLTexture,\n\t\t\toutput?: DataLayer, // Undefined renders to screen.\n\t\t\tendCaps?: boolean,\n\t\t\tnumCapSegments?: number,\n\t\t\tshouldBlendAlpha?: boolean,\n\t\t},\n\t) {\n\t\tconst { gl, errorState } = this;\n\t\tconst { program, position1, position2, thickness, input, output } = params;\n\t\tconst width = output ? output.width : this.width;\n\t\tconst height = output ? output.height : this.height;\n\n\t\t// Ignore if we are in error state.\n\t\tif (errorState) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst glProgram = program.segmentProgram!;\n\n\t\t// Do setup - this must come first.\n\t\tthis.drawSetup(glProgram, false, input, output);\n\n\t\t// Update uniforms and buffers.\n\t\tprogram.setVertexUniform(glProgram, 'u_internal_halfThickness', thickness / 2, FLOAT);\n\t\tprogram.setVertexUniform(glProgram, 'u_internal_scale', [2 / width, 2 / height], FLOAT);\n\t\tconst diffX = position1[0] - position2[0];\n\t\tconst diffY = position1[1] - position2[1];\n\t\tconst angle = Math.atan2(diffY, diffX);\n\t\tprogram.setVertexUniform(glProgram, 'u_internal_rotation', angle, FLOAT);\n\t\tconst centerX = (position1[0] + position2[0]) / 2;\n\t\tconst centerY = (position1[1] + position2[1]) / 2;\n\t\tprogram.setVertexUniform(glProgram, 'u_internal_translation', [2 * centerX / this.width - 1, 2 * centerY / this.height - 1], FLOAT);\n\t\tconst length = Math.sqrt(diffX * diffX + diffY * diffY);\n\t\t\n\t\tconst numSegments = params.numCapSegments ? params.numCapSegments * 2 : DEFAULT_CIRCLE_NUM_SEGMENTS;\n\t\tif (params.endCaps) {\n\t\t\tif (numSegments < 6 || numSegments % 6 !== 0) {\n\t\t\t\tthrow new Error(`numSegments for WebGLCompute.stepSegment must be divisible by 6, got ${numSegments}.`);\n\t\t\t}\n\t\t\t// Have to subtract a small offset from length.\n\t\t\tprogram.setVertexUniform(glProgram, 'u_internal_length', length - thickness * Math.sin(Math.PI / numSegments), FLOAT);\n\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.getCirclePositionsBuffer(numSegments));\n\t\t} else {\n\t\t\t// Have to subtract a small offset from length.\n\t\t\tprogram.setVertexUniform(glProgram, 'u_internal_length', length - thickness, FLOAT);\n\t\t\t// Use a rectangle in case of no caps.\n\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.quadPositionsBuffer);\n\t\t}\n\n\t\tthis.setPositionAttribute(glProgram, program.name);\n\t\t\n\t\t// Draw.\n\t\tthis.setBlendMode(params.shouldBlendAlpha);\n\t\tif (params.endCaps) {\n\t\t\tgl.drawArrays(gl.TRIANGLE_FAN, 0, numSegments + 2);\n\t\t} else {\n\t\t\tgl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n\t\t}\n\t\tgl.disable(gl.BLEND);\n\t}\n\n\tstepPolyline(\n\t\tparams: {\n\t\t\tprogram: GPUProgram,\n\t\t\tpositions: [number, number][],\n\t\t\tthickness: number, // Thickness of line is in px.\n\t\t\tinput?: (DataLayer | WebGLTexture)[] | DataLayer | WebGLTexture,\n\t\t\toutput?: DataLayer, // Undefined renders to screen.\n\t\t\tcloseLoop?: boolean,\n\t\t\tincludeUVs?: boolean,\n\t\t\tincludeNormals?: boolean,\n\t\t\tshouldBlendAlpha?: boolean,\n\t\t},\n\t) {\n\t\tconst { program, input, output } = params;\n\t\tconst vertices = params.positions;\n\t\tconst closeLoop = !!params.closeLoop;\n\t\t\n\t\tconst { gl, width, height, errorState } = this;\n\n\t\t// Ignore if we are in error state.\n\t\tif (errorState) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Offset vertices.\n\t\tconst halfThickness = params.thickness / 2;\n\t\tconst numPositions = closeLoop ? vertices.length * 4 + 2 : (vertices.length - 1) * 4;\n\t\tconst positions = new Float32Array(2 * numPositions);\n\t\tconst uvs = params.includeUVs ? new Float32Array(2 * numPositions) : undefined;\n\t\tconst normals = params.includeNormals ? new Float32Array(2 * numPositions) : undefined;\n\n\t\t// tmp arrays.\n\t\tconst s1 = [0, 0];\n\t\tconst s2 = [0, 0];\n\t\tconst n1 = [0, 0];\n\t\tconst n2 = [0, 0];\n\t\tconst n3 = [0, 0];\n\t\tfor (let i = 0; i < vertices.length; i++) {\n\t\t\tif (!closeLoop && i === vertices.length - 1) continue;\n\t\t\t// Vertices on this segment.\n\t\t\tconst v1 = vertices[i];\n\t\t\tconst v2 = vertices[(i + 1) % vertices.length];\n\t\t\ts1[0] = v2[0] - v1[0];\n\t\t\ts1[1] = v2[1] - v1[1];\n\t\t\tconst length1 = Math.sqrt(s1[0] * s1[0] + s1[1] * s1[1]);\n\t\t\tn1[0] = s1[1] / length1;\n\t\t\tn1[1] = - s1[0] / length1;\n\n\t\t\tconst index = i * 4 + 2;\n\n\t\t\tif (!closeLoop && i === 0) {\n\t\t\t\t// Add starting points to positions array.\n\t\t\t\tpositions[0] = v1[0] + n1[0] * halfThickness;\n\t\t\t\tpositions[1] = v1[1] + n1[1] * halfThickness;\n\t\t\t\tpositions[2] = v1[0] - n1[0] * halfThickness;\n\t\t\t\tpositions[3] = v1[1] - n1[1] * halfThickness;\n\t\t\t\tif (uvs) {\n\t\t\t\t\tuvs[0] = 0;\n\t\t\t\t\tuvs[1] = 1;\n\t\t\t\t\tuvs[2] = 0;\n\t\t\t\t\tuvs[3] = 0;\n\t\t\t\t}\n\t\t\t\tif (normals) {\n\t\t\t\t\tnormals[0] = n1[0];\n\t\t\t\t\tnormals[1] = n1[1];\n\t\t\t\t\tnormals[2] = n1[0];\n\t\t\t\t\tnormals[3] = n1[1];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst u = (i + 1) / (vertices.length - 1);\n\n\t\t\t// Offset from v2.\n\t\t\tpositions[2 * index] = v2[0] + n1[0] * halfThickness;\n\t\t\tpositions[2 * index + 1] = v2[1] + n1[1] * halfThickness;\n\t\t\tpositions[2 * index + 2] = v2[0] - n1[0] * halfThickness;\n\t\t\tpositions[2 * index + 3] = v2[1] - n1[1] * halfThickness;\n\t\t\tif (uvs) {\n\t\t\t\tuvs[2 * index] = u;\n\t\t\t\tuvs[2 * index + 1] = 1;\n\t\t\t\tuvs[2 * index + 2] = u;\n\t\t\t\tuvs[2 * index + 3] = 0;\n\t\t\t}\n\t\t\tif (normals) {\n\t\t\t\tnormals[2 * index] = n1[0];\n\t\t\t\tnormals[2 * index + 1] = n1[1];\n\t\t\t\tnormals[2 * index + 2] = n1[0];\n\t\t\t\tnormals[2 * index + 3] = n1[1];\n\t\t\t}\n\n\t\t\tif ((i < vertices.length - 2) || closeLoop) {\n\t\t\t\t// Vertices on next segment.\n\t\t\t\tconst v3 = vertices[(i + 1) % vertices.length];\n\t\t\t\tconst v4 = vertices[(i + 2) % vertices.length];\n\t\t\t\ts2[0] = v4[0] - v3[0];\n\t\t\t\ts2[1] = v4[1] - v3[1];\n\t\t\t\tconst length2 = Math.sqrt(s2[0] * s2[0] + s2[1] * s2[1]);\n\t\t\t\tn2[0] = s2[1] / length2;\n\t\t\t\tn2[1] = - s2[0] / length2;\n\n\t\t\t\t// Offset from v3\n\t\t\t\tpositions[2 * ((index + 2) % (4 * vertices.length))] = v3[0] + n2[0] * halfThickness;\n\t\t\t\tpositions[2 * ((index + 2) % (4 * vertices.length)) + 1] = v3[1] + n2[1] * halfThickness;\n\t\t\t\tpositions[2 * ((index + 2) % (4 * vertices.length)) + 2] = v3[0] - n2[0] * halfThickness;\n\t\t\t\tpositions[2 * ((index + 2) % (4 * vertices.length)) + 3] = v3[1] - n2[1] * halfThickness;\n\t\t\t\tif (uvs) {\n\t\t\t\t\tuvs[2 * ((index + 2) % (4 * vertices.length))] = u;\n\t\t\t\t\tuvs[2 * ((index + 2) % (4 * vertices.length)) + 1] = 1;\n\t\t\t\t\tuvs[2 * ((index + 2) % (4 * vertices.length)) + 2] = u;\n\t\t\t\t\tuvs[2 * ((index + 2) % (4 * vertices.length)) + 3] = 0;\n\t\t\t\t}\n\t\t\t\tif (normals) {\n\t\t\t\t\tnormals[2 * ((index + 2) % (4 * vertices.length))] = n2[0];\n\t\t\t\t\tnormals[2 * ((index + 2) % (4 * vertices.length)) + 1] = n2[1];\n\t\t\t\t\tnormals[2 * ((index + 2) % (4 * vertices.length)) + 2] = n2[0];\n\t\t\t\t\tnormals[2 * ((index + 2) % (4 * vertices.length)) + 3] = n2[1];\n\t\t\t\t}\n\n\t\t\t\t// Check the angle between adjacent segments.\n\t\t\t\tconst cross = n1[0] * n2[1] - n1[1] * n2[0];\n\t\t\t\tif (Math.abs(cross) < 1e-6) continue;\n\t\t\t\tn3[0] = n1[0] + n2[0];\n\t\t\t\tn3[1] = n1[1] + n2[1];\n\t\t\t\tconst length3 = Math.sqrt(n3[0] * n3[0] + n3[1] * n3[1]);\n\t\t\t\tn3[0] /= length3;\n\t\t\t\tn3[1] /= length3;\n\t\t\t\t// Make adjustments to positions.\n\t\t\t\tconst angle = Math.acos(n1[0] * n2[0] + n1[1] * n2[1]);\n\t\t\t\tconst offset = halfThickness / Math.cos(angle / 2);\n\t\t\t\tif (cross < 0) {\n\t\t\t\t\tpositions[2 * index] = v2[0] + n3[0] * offset;\n\t\t\t\t\tpositions[2 * index + 1] = v2[1] + n3[1] * offset;\n\t\t\t\t\tpositions[2 * ((index + 2) % (4 * vertices.length))] = positions[2 * index];\n\t\t\t\t\tpositions[2 * ((index + 2) % (4 * vertices.length)) + 1] = positions[2 * index + 1];\n\t\t\t\t} else {\n\t\t\t\t\tpositions[2 * index + 2] = v2[0] - n3[0] * offset;\n\t\t\t\t\tpositions[2 * index + 3] = v2[1] - n3[1] * offset;\n\t\t\t\t\tpositions[2 * ((index + 2) % (4 * vertices.length)) + 2] = positions[2 * index + 2];\n\t\t\t\t\tpositions[2 * ((index + 2) % (4 * vertices.length)) + 3] = positions[2 * index + 3];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (closeLoop) {\n\t\t\t// Duplicate starting points to end of positions array.\n\t\t\tpositions[vertices.length * 8] = positions[0];\n\t\t\tpositions[vertices.length * 8 + 1] = positions[1];\n\t\t\tpositions[vertices.length * 8 + 2] = positions[2];\n\t\t\tpositions[vertices.length * 8 + 3] = positions[3];\n\t\t\tif (uvs) {\n\t\t\t\tuvs[vertices.length * 8] = uvs[0];\n\t\t\t\tuvs[vertices.length * 8 + 1] = uvs[1];\n\t\t\t\tuvs[vertices.length * 8 + 2] = uvs[2];\n\t\t\t\tuvs[vertices.length * 8 + 3] = uvs[3];\n\t\t\t}\n\t\t\tif (normals) {\n\t\t\t\tnormals[vertices.length * 8] = normals[0];\n\t\t\t\tnormals[vertices.length * 8 + 1] = normals[1];\n\t\t\t\tnormals[vertices.length * 8 + 2] = normals[2];\n\t\t\t\tnormals[vertices.length * 8 + 3] = normals[3];\n\t\t\t}\n\t\t}\n\n\t\tconst glProgram = (uvs ?\n\t\t\t(normals ? program.defaultProgramWithUVNormal : program.defaultProgramWithUV) :\n\t\t\t(normals ? program.defaultProgramWithNormal : program.defaultProgram)\n\t\t)!;\n\n\t\t// Do setup - this must come first.\n\t\tthis.drawSetup(glProgram, false, input, output);\n\n\t\t// Update uniforms and buffers.\n\t\tprogram.setVertexUniform(glProgram, 'u_internal_scale', [2 / width, 2 / height], FLOAT);\n\t\tprogram.setVertexUniform(glProgram, 'u_internal_translation', [-1, -1], FLOAT);\n\t\t// Init positions buffer.\n\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.initVertexBuffer(positions)!);\n\t\tthis.setPositionAttribute(glProgram, program.name);\n\t\tif (uvs) {\n\t\t\t// Init uv buffer.\n\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.initVertexBuffer(uvs)!);\n\t\t\tthis.setUVAttribute(glProgram, program.name);\n\t\t}\n\t\tif (normals) {\n\t\t\t// Init normals buffer.\n\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.initVertexBuffer(normals)!);\n\t\t\tthis.setVertexAttribute(glProgram, 'a_internal_normal', 2, program.name);\n\t\t}\n\n\t\t// Draw.\n\t\tthis.setBlendMode(params.shouldBlendAlpha);\n\t\tgl.drawArrays(gl.TRIANGLE_STRIP, 0, numPositions);\n\t\tgl.disable(gl.BLEND);\n\t}\n\n\tstepTriangleStrip(\n\t\tparams: {\n\t\t\tprogram: GPUProgram,\n\t\t\tpositions: Float32Array,\n\t\t\tnormals?: Float32Array,\n\t\t\tuvs?: Float32Array,\n\t\t\tinput?: (DataLayer | WebGLTexture)[] | DataLayer | WebGLTexture,\n\t\t\toutput?: DataLayer, // Undefined renders to screen.\n\t\t\tcount?: number,\n\t\t\tshouldBlendAlpha?: boolean,\n\t\t},\n\t) {\n\n\t\tconst { program, input, output, positions, uvs, normals } = params;\n\t\tconst { gl, width, height, errorState } = this;\n\n\t\t// Ignore if we are in error state.\n\t\tif (errorState) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst glProgram = (uvs ?\n\t\t\t(normals ? program.defaultProgramWithUVNormal : program.defaultProgramWithUV) :\n\t\t\t(normals ? program.defaultProgramWithNormal : program.defaultProgram)\n\t\t)!;\n\n\t\t// Do setup - this must come first.\n\t\tthis.drawSetup(glProgram, false, input, output);\n\n\t\t// Update uniforms and buffers.\n\t\tprogram.setVertexUniform(glProgram, 'u_internal_scale', [2 / width, 2 / height], FLOAT);\n\t\tprogram.setVertexUniform(glProgram, 'u_internal_translation', [-1, -1], FLOAT);\n\t\t// Init positions buffer.\n\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.initVertexBuffer(positions)!);\n\t\tthis.setPositionAttribute(glProgram, program.name);\n\t\tif (uvs) {\n\t\t\t// Init uv buffer.\n\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.initVertexBuffer(uvs)!);\n\t\t\tthis.setUVAttribute(glProgram, program.name);\n\t\t}\n\t\tif (normals) {\n\t\t\t// Init normals buffer.\n\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.initVertexBuffer(normals)!);\n\t\t\tthis.setVertexAttribute(glProgram, 'a_internal_normal', 2, program.name);\n\t\t}\n\n\t\tconst count = params.count ? params.count : positions.length / 2;\n\n\t\t// Draw.\n\t\tthis.setBlendMode(params.shouldBlendAlpha);\n\t\tgl.drawArrays(gl.TRIANGLE_STRIP, 0, count);\n\t\tgl.disable(gl.BLEND);\n\t}\n\n\tstepLines(params: {\n\t\tprogram: GPUProgram,\n\t\tpositions: Float32Array,\n\t\tindices?: Uint16Array | Uint32Array | Int16Array | Int32Array,\n\t\tnormals?: Float32Array,\n\t\tuvs?: Float32Array,\n\t\tinput?: (DataLayer | WebGLTexture)[] | DataLayer | WebGLTexture,\n\t\toutput?: DataLayer, // Undefined renders to screen.\n\t\tcount?: number,\n\t\tcloseLoop?: boolean,\n\t\tshouldBlendAlpha?: boolean,\n\t}) {\n\t\tconst { gl, errorState, width, height } = this;\n\t\tconst { indices, uvs, normals, input, output, program } = params;\n\n\t\t// Ignore if we are in error state.\n\t\tif (errorState) {\n\t\t\treturn;\n\t\t}\n\t\t// Check that params are valid.\n\t\tif (params.closeLoop && indices) {\n\t\t\tthrow new Error(`WebGLCompute.stepLines() can't be called with closeLoop == true and indices.`);\n\t\t}\n\t\t\n\t\tconst glProgram = (uvs ?\n\t\t\t(normals ? program.defaultProgramWithUVNormal : program.defaultProgramWithUV) :\n\t\t\t(normals ? program.defaultProgramWithNormal : program.defaultProgram)\n\t\t)!;\n\n\t\t// Do setup - this must come first.\n\t\tthis.drawSetup(glProgram, false, input, output);\n\n\t\tconst count = params.count ? params.count : (indices ? indices.length : (params.positions.length / 2));\n\n\t\t// Update uniforms and buffers.\n\t\tprogram.setVertexUniform(glProgram, 'u_internal_scale', [2 / width, 2 / height], FLOAT);\n\t\tprogram.setVertexUniform(glProgram, 'u_internal_translation', [-1, -1], FLOAT);\n\t\tif (indices) {\n\t\t\t// Reorder positions array to match indices.\n\t\t\tconst positions = new Float32Array(2 * count);\n\t\t\tfor (let i = 0; i < count; i++) {\n\t\t\t\tconst index = indices[i];\n\t\t\t\tpositions[2 * i] = params.positions[2 * index];\n\t\t\t\tpositions[2 * i + 1] = params.positions[2 * index + 1];\n\t\t\t}\n\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.initVertexBuffer(positions)!);\n\t\t} else {\n\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.initVertexBuffer(params.positions)!);\n\t\t}\n\t\tthis.setPositionAttribute(glProgram, program.name);\n\t\tif (uvs) {\n\t\t\t// Init uv buffer.\n\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.initVertexBuffer(uvs)!);\n\t\t\tthis.setUVAttribute(glProgram, program.name);\n\t\t}\n\t\tif (normals) {\n\t\t\t// Init normals buffer.\n\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.initVertexBuffer(normals)!);\n\t\t\tthis.setVertexAttribute(glProgram, 'a_internal_normal', 2, program.name);\n\t\t}\n\n\t\t// Draw.\n\t\tthis.setBlendMode(params.shouldBlendAlpha);\n\t\tif (params.indices) {\n\t\t\tgl.drawArrays(gl.LINES, 0, count);\n\t\t} else {\n\t\t\tif (params.closeLoop) {\n\t\t\t\tgl.drawArrays(gl.LINE_LOOP, 0, count);\n\t\t\t} else {\n\t\t\t\tgl.drawArrays(gl.LINE_STRIP, 0, count);\n\t\t\t}\n\t\t}\n\t\tgl.disable(gl.BLEND);\n\t}\n\n\tdrawLayerAsPoints(\n\t\tparams: {\n\t\t\tpositions: DataLayer, // Positions in canvas px.\n\t\t\tprogram?: GPUProgram,\n\t\t\tinput?: (DataLayer | WebGLTexture)[] | DataLayer | WebGLTexture,\n\t\t\toutput?: DataLayer,\n\t\t\tpointSize?: number,\n\t\t\tcount?: number,\n\t\t\tcolor?: [number, number, number],\n\t\t\twrapX?: boolean,\n\t\t\twrapY?: boolean,\n\t\t\tshouldBlendAlpha?: boolean,\n\t\t},\n\t) {\n\t\tconst { gl, errorState, pointIndexArray, width, height } = this;\n\t\tconst { positions, output } = params;\n\n\t\t// Ignore if we are in error state.\n\t\tif (errorState) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Check that numPoints is valid.\n\t\tif (positions.numComponents !== 2 && positions.numComponents !== 4) {\n\t\t\tthrow new Error(`WebGLCompute.drawPoints() must be passed a position DataLayer with either 2 or 4 components, got position DataLayer \"${positions.name}\" with ${positions.numComponents} components.`)\n\t\t}\n\t\tconst { length } = positions;\n\t\tconst count = params.count || length;\n\t\tif (count > length) {\n\t\t\tthrow new Error(`Invalid count ${count} for position DataLayer of length ${length}.`);\n\t\t}\n\n\t\tlet program = params.program;\n\t\tif (program === undefined) {\n\t\t\tprogram = this.singleColorProgram;\n\t\t\tconst color = params.color || [1, 0, 0]; // Default of red.\n\t\t\tprogram.setUniform('u_color', color, FLOAT);\n\t\t}\n\t\tconst glProgram = program.dataLayerPointsProgram!;\n\n\t\t// Add positions to end of input if needed.\n\t\tconst input = this.addLayerToInputs(positions, params.input);\n\n\t\t// Do setup - this must come first.\n\t\tthis.drawSetup(glProgram, false, input, output);\n\n\t\t// Update uniforms and buffers.\n\t\tprogram.setVertexUniform(glProgram, 'u_internal_positions', input.indexOf(positions), INT);\n\t\tprogram.setVertexUniform(glProgram, 'u_internal_scale', [1 / width, 1 / height], FLOAT);\n\t\t// Tell whether we are using an absolute position (2 components), or position with accumulation buffer (4 components, better floating pt accuracy).\n\t\tprogram.setVertexUniform(glProgram, 'u_internal_positionWithAccumulation', positions.numComponents === 4 ? 1 : 0, INT);\n\t\t// Set default pointSize.\n\t\tconst pointSize = params.pointSize || 1;\n\t\tprogram.setVertexUniform(glProgram, 'u_internal_pointSize', pointSize, FLOAT);\n\t\tconst positionLayerDimensions = [positions.width, positions.height] as [number, number];\n\t\tprogram.setVertexUniform(glProgram, 'u_internal_positionsDimensions', positionLayerDimensions, FLOAT);\n\t\tprogram.setVertexUniform(glProgram, 'u_internal_wrapX', params.wrapX ? 1 : 0, INT);\n\t\tprogram.setVertexUniform(glProgram, 'u_internal_wrapY', params.wrapY ? 1 : 0, INT);\n\t\tif (this.pointIndexBuffer === undefined || (pointIndexArray && pointIndexArray.length < count)) {\n\t\t\t// Have to use float32 array bc int is not supported as a vertex attribute type.\n\t\t\tconst indices = initSequentialFloatArray(length);\n\t\t\tthis.pointIndexArray = indices;\n\t\t\tthis.pointIndexBuffer = this.initVertexBuffer(indices);\n\t\t}\n\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.pointIndexBuffer!);\n\t\tthis.setIndexAttribute(glProgram, program.name);\n\n\t\t// Draw.\n\t\tthis.setBlendMode(params.shouldBlendAlpha);\n\t\tgl.drawArrays(gl.POINTS, 0, count);\n\t\tgl.disable(gl.BLEND);\n\t}\n\n\tdrawLayerAsLines(\n\t\tparams: {\n\t\t\tpositions: DataLayer,\n\t\t\tindices?: Float32Array | Uint16Array | Uint32Array | Int16Array | Int32Array,\n\t\t\tprogram?: GPUProgram,\n\t\t\tinput?: (DataLayer | WebGLTexture)[] | DataLayer | WebGLTexture,\n\t\t\toutput?: DataLayer,\n\t\t\tcount?: number,\n\t\t\tcolor?: [number, number, number],\n\t\t\twrapX?: boolean,\n\t\t\twrapY?: boolean,\n\t\t\tcloseLoop?: boolean,\n\t\t\tshouldBlendAlpha?: boolean,\n\t\t},\n\t) {\n\t\tconst { gl, errorState, width, height } = this;\n\t\tconst { positions, output } = params;\n\n\t\t// Ignore if we are in error state.\n\t\tif (errorState) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Check that positions is valid.\n\t\tif (positions.numComponents !== 2 && positions.numComponents !== 4) {\n\t\t\tthrow new Error(`WebGLCompute.drawLayerAsLines() must be passed a position DataLayer with either 2 or 4 components, got position DataLayer \"${positions.name}\" with ${positions.numComponents} components.`)\n\t\t}\n\t\t// Check that params are valid.\n\t\tif (params.closeLoop && params.indices) {\n\t\t\tthrow new Error(`WebGLCompute.drawLayerAsLines() can't be called with closeLoop == true and indices.`);\n\t\t}\n\n\t\tlet program = params.program;\n\t\tif (program === undefined) {\n\t\t\tprogram = params.wrapX || params.wrapY ? this.singleColorWithWrapCheckProgram : this.singleColorProgram;\n\t\t\tconst color = params.color || [1, 0, 0]; // Default to red.\n\t\t\tprogram.setUniform('u_color', color, FLOAT);\n\t\t}\n\t\tconst glProgram = program.dataLayerLinesProgram!;\n\n\t\t// Add positionLayer to end of input if needed.\n\t\tconst input = this.addLayerToInputs(positions, params.input);\n\n\t\t// Do setup - this must come first.\n\t\tthis.drawSetup(glProgram, false, input, output);\n\n\t\t// TODO: cache indexArray if no indices passed in.\n\t\tconst indices = params.indices ? params.indices : initSequentialFloatArray(params.count || positions.length);\n\t\tconst count = params.count ? params.count : indices.length;\n\n\t\t// Update uniforms and buffers.\n\t\tprogram.setVertexUniform(glProgram, 'u_internal_positions', input.indexOf(positions), INT);\n\t\tprogram.setVertexUniform(glProgram, 'u_internal_scale', [1 / width, 1 / height], FLOAT);\n\t\t// Tell whether we are using an absolute position (2 components), or position with accumulation buffer (4 components, better floating pt accuracy).\n\t\tprogram.setVertexUniform(glProgram, 'u_internal_positionWithAccumulation', positions.numComponents === 4 ? 1 : 0, INT);\n\t\tconst positionLayerDimensions = [positions.width, positions.height] as [number, number];\n\t\tprogram.setVertexUniform(glProgram, 'u_internal_positionsDimensions', positionLayerDimensions, FLOAT);\n\t\tprogram.setVertexUniform(glProgram, 'u_internal_wrapX', params.wrapX ? 1 : 0, INT);\n\t\tprogram.setVertexUniform(glProgram, 'u_internal_wrapY', params.wrapY ? 1 : 0, INT);\n\t\tif (this.indexedLinesIndexBuffer === undefined) {\n\t\t\t// Have to use float32 array bc int is not supported as a vertex attribute type.\n\t\t\tlet floatArray: Float32Array;\n\t\t\tif (indices.constructor !== Float32Array) {\n\t\t\t\t// Have to use float32 array bc int is not supported as a vertex attribute type.\n\t\t\t\tfloatArray = new Float32Array(indices.length);\n\t\t\t\tfor (let i = 0; i < count; i++) {\n\t\t\t\t\tfloatArray[i] = indices[i];\n\t\t\t\t}\n\t\t\t\tconsole.warn(`Converting indices array of type ${indices.constructor} to Float32Array in WebGLCompute.drawIndexedLines for WebGL compatibility, you may want to use a Float32Array to store this information so the conversion is not required.`);\n\t\t\t} else {\n\t\t\t\tfloatArray = indices as Float32Array;\n\t\t\t}\n\t\t\tthis.indexedLinesIndexBuffer = this.initVertexBuffer(floatArray);\n\t\t} else {\n\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.indexedLinesIndexBuffer!);\n\t\t\t// Copy buffer data.\n\t\t\tgl.bufferData(gl.ARRAY_BUFFER, indices, gl.STATIC_DRAW);\n\t\t}\n\t\tthis.setIndexAttribute(glProgram, program.name);\n\n\t\t// Draw.\n\t\tthis.setBlendMode(params.shouldBlendAlpha);\n\t\tif (params.indices) {\n\t\t\tgl.drawArrays(gl.LINES, 0, count);\n\t\t} else {\n\t\t\tif (params.closeLoop) {\n\t\t\t\tgl.drawArrays(gl.LINE_LOOP, 0, count);\n\t\t\t} else {\n\t\t\t\tgl.drawArrays(gl.LINE_STRIP, 0, count);\n\t\t\t}\n\t\t}\n\t\tgl.disable(gl.BLEND);\n\t}\n\n\tdrawLayerAsVectorField(\n\t\tparams: {\n\t\t\tdata: DataLayer,\n\t\t\tprogram?: GPUProgram,\n\t\t\tinput?: (DataLayer | WebGLTexture)[] | DataLayer | WebGLTexture,\n\t\t\toutput?: DataLayer,\n\t\t\tvectorSpacing?: number,\n\t\t\tvectorScale?: number,\n\t\t\tcolor?: [number, number, number],\n\t\t\tshouldBlendAlpha?: boolean,\n\t\t},\n\t) {\n\t\tconst { gl, errorState, vectorFieldIndexArray, width, height } = this;\n\t\tconst { data, output } = params;\n\n\t\t// Ignore if we are in error state.\n\t\tif (errorState) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Check that field is valid.\n\t\tif (data.numComponents !== 2) {\n\t\t\tthrow new Error(`WebGLCompute.drawLayerAsVectorField() must be passed a fieldLayer with 2 components, got fieldLayer \"${data.name}\" with ${data.numComponents} components.`)\n\t\t}\n\t\t// Check aspect ratio.\n\t\t// const dimensions = [vectorLayer.width, vectorLayer.height];\n\t\t// if (Math.abs(dimensions[0] / dimensions[1] - width / height) > 0.01) {\n\t\t// \tthrow new Error(`Invalid aspect ratio ${(dimensions[0] / dimensions[1]).toFixed(3)} vector DataLayer with dimensions [${dimensions[0]}, ${dimensions[1]}], expected ${(width / height).toFixed(3)}.`);\n\t\t// }\n\n\t\tlet program = params.program;\n\t\tif (program === undefined) {\n\t\t\tprogram = this.singleColorProgram;\n\t\t\tconst color = params.color || [1, 0, 0]; // Default to red.\n\t\t\tprogram.setUniform('u_color', color, FLOAT);\n\t\t}\n\t\tconst glProgram = program.dataLayerVectorFieldProgram!;\n\n\t\t// Add data to end of input if needed.\n\t\tconst input = this.addLayerToInputs(data, params.input);\n\n\t\t// Do setup - this must come first.\n\t\tthis.drawSetup(glProgram, false, input, output);\n\n\t\t// Update uniforms and buffers.\n\t\tprogram.setVertexUniform(glProgram, 'u_internal_vectors', input.indexOf(data), INT);\n\t\t// Set default scale.\n\t\tconst vectorScale = params.vectorScale || 1;\n\t\tprogram.setVertexUniform(glProgram, 'u_internal_scale', [vectorScale / width, vectorScale / height], FLOAT);\n\t\tconst vectorSpacing = params.vectorSpacing || 10;\n\t\tconst spacedDimensions = [Math.floor(width / vectorSpacing), Math.floor(height / vectorSpacing)] as [number, number];\n\t\tprogram.setVertexUniform(glProgram, 'u_internal_dimensions', spacedDimensions, FLOAT);\n\t\tconst length = 2 * spacedDimensions[0] * spacedDimensions[1];\n\t\tif (this.vectorFieldIndexBuffer === undefined || (vectorFieldIndexArray && vectorFieldIndexArray.length < length)) {\n\t\t\t// Have to use float32 array bc int is not supported as a vertex attribute type.\n\t\t\tconst indices = initSequentialFloatArray(length);\n\t\t\tthis.vectorFieldIndexArray = indices;\n\t\t\tthis.vectorFieldIndexBuffer = this.initVertexBuffer(indices);\n\t\t}\n\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.vectorFieldIndexBuffer!);\n\t\tthis.setIndexAttribute(glProgram, program.name);\n\n\t\t// Draw.\n\t\tthis.setBlendMode(params.shouldBlendAlpha);\n\t\tgl.drawArrays(gl.LINES, 0, length);\n\t\tgl.disable(gl.BLEND);\n\t}\n\n\tdrawLayerMagnitude(\n\t\tparams: {\n\t\t\tdata: DataLayer,\n\t\t\tinput?: (DataLayer | WebGLTexture)[] | DataLayer | WebGLTexture,\n\t\t\toutput?: DataLayer,\n\t\t\tscale?: number,\n\t\t\tcolor?: [number, number, number],\n\t\t\tshouldBlendAlpha?: boolean,\n\t\t},\n\t) {\n\t\tconst { gl, errorState, quadPositionsBuffer } = this;\n\t\tconst { data, output } = params;\n\n\t\t// Ignore if we are in error state.\n\t\tif (errorState) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst program = this.vectorMagnitudeProgram;\n\t\tconst color = params.color || [1, 0, 0]; // Default to red.\n\t\tprogram.setUniform('u_color', color, FLOAT);\n\t\tconst scale = params.scale || 1;\n\t\tprogram.setUniform('u_scale', scale, FLOAT);\n\t\tprogram.setUniform('u_internal_numDimensions', data.numComponents, INT);\n\n\t\tconst glProgram = program.defaultProgram!;\n\n\t\t// Add data to end of input if needed.\n\t\tconst input = this.addLayerToInputs(data, params.input);\n\t\t// Do setup - this must come first.\n\t\tthis.drawSetup(glProgram, true, input, output);\n\n\t\t// Update uniforms and buffers.\n\t\tprogram.setVertexUniform(glProgram, 'u_internal_data', input.indexOf(data), INT);\n\t\tprogram.setVertexUniform(glProgram, 'u_internal_scale', [1, 1], FLOAT);\n\t\tprogram.setVertexUniform(glProgram, 'u_internal_translation', [0, 0], FLOAT);\n\t\tgl.bindBuffer(gl.ARRAY_BUFFER, quadPositionsBuffer);\n\t\tthis.setPositionAttribute(glProgram, program.name);\n\n\t\t// Draw.\n\t\tthis.setBlendMode(params.shouldBlendAlpha);\n\t\tgl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n\t\tgl.disable(gl.BLEND);\n\t}\n\t\n\tgetContext() {\n\t\treturn this.gl;\n\t}\n\n\tgetValues(dataLayer: DataLayer) {\n\t\tconst { gl, glslVersion } = this;\n\n\t\t// In case dataLayer was not the last output written to.\n\t\tdataLayer._bindOutputBuffer();\n\n\t\tconst { width, height } = dataLayer;\n\t\tlet { glNumChannels, glType, glFormat, internalType } = dataLayer;\n\t\tlet values;\n\t\tswitch (internalType) {\n\t\t\tcase HALF_FLOAT:\n\t\t\t\tif (gl.FLOAT !== undefined) {\n\t\t\t\t\t// Firefox requires that RGBA/FLOAT is used for readPixels of float16 types.\n\t\t\t\t\tglNumChannels = 4;\n\t\t\t\t\tglFormat = gl.RGBA;\n\t\t\t\t\tglType = gl.FLOAT;\n\t\t\t\t\tvalues = new Float32Array(width * height * glNumChannels);\n\t\t\t\t} else {\n\t\t\t\t\tvalues = new Uint16Array(width * height * glNumChannels);\n\t\t\t\t}\n\t\t\t\t// // The following works in Chrome.\n\t\t\t\t// values = new Uint16Array(width * height * glNumChannels);\n\t\t\t\tbreak\n\t\t\tcase FLOAT:\n\t\t\t\t// Chrome and Firefox require that RGBA/FLOAT is used for readPixels of float32 types.\n\t\t\t\t// https://github.com/KhronosGroup/WebGL/issues/2747\n\t\t\t\tglNumChannels = 4;\n\t\t\t\tglFormat = gl.RGBA;\n\t\t\t\tvalues = new Float32Array(width * height * glNumChannels);\n\t\t\t\tbreak;\n\t\t\tcase UNSIGNED_BYTE:\n\t\t\t\tif (glslVersion === GLSL1) {\n\t\t\t\t\t// Firefox requires that RGBA/UNSIGNED_BYTE is used for readPixels of unsigned byte types.\n\t\t\t\t\tglNumChannels = 4;\n\t\t\t\t\tglFormat = gl.RGBA;\n\t\t\t\t\tvalues = new Uint8Array(width * height * glNumChannels);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\t// Firefox requires that RGBA_INTEGER/UNSIGNED_INT is used for readPixels of unsigned int types.\n\t\t\t\tglNumChannels = 4;\n\t\t\t\tglFormat = (gl as WebGL2RenderingContext).RGBA_INTEGER;\n\t\t\t\tglType = gl.UNSIGNED_INT;\n\t\t\t\tvalues = new Uint32Array(width * height * glNumChannels);\n\t\t\t\t// // The following works in Chrome.\n\t\t\t\t// values = new Uint8Array(width * height * glNumChannels);\n\t\t\t\tbreak;\n\t\t\tcase UNSIGNED_SHORT:\n\t\t\t\t// Firefox requires that RGBA_INTEGER/UNSIGNED_INT is used for readPixels of unsigned int types.\n\t\t\t\tglNumChannels = 4;\n\t\t\t\tglFormat = (gl as WebGL2RenderingContext).RGBA_INTEGER;\n\t\t\t\tglType = gl.UNSIGNED_INT;\n\t\t\t\tvalues = new Uint32Array(width * height * glNumChannels);\n\t\t\t\t// // The following works in Chrome.\n\t\t\t\t// values = new Uint16Array(width * height * glNumChannels);\n\t\t\t\tbreak;\n\t\t\tcase UNSIGNED_INT:\n\t\t\t\t// Firefox requires that RGBA_INTEGER/UNSIGNED_INT is used for readPixels of unsigned int types.\n\t\t\t\tglNumChannels = 4;\n\t\t\t\tglFormat = (gl as WebGL2RenderingContext).RGBA_INTEGER;\n\t\t\t\tvalues = new Uint32Array(width * height * glNumChannels);\n\t\t\t\t// // The following works in Chrome.\n\t\t\t\t// values = new Uint32Array(width * height * glNumChannels);\n\t\t\t\tbreak;\n\t\t\tcase BYTE:\n\t\t\t\t// Firefox requires that RGBA_INTEGER/INT is used for readPixels of int types.\n\t\t\t\tglNumChannels = 4;\n\t\t\t\tglFormat = (gl as WebGL2RenderingContext).RGBA_INTEGER;\n\t\t\t\tglType = gl.INT;\n\t\t\t\tvalues = new Int32Array(width * height * glNumChannels);\n\t\t\t\t// // The following works in Chrome.\n\t\t\t\t// values = new Int8Array(width * height * glNumChannels);\n\t\t\t\tbreak;\n\t\t\tcase SHORT:\n\t\t\t\t// Firefox requires that RGBA_INTEGER/INT is used for readPixels of int types.\n\t\t\t\tglNumChannels = 4;\n\t\t\t\tglFormat = (gl as WebGL2RenderingContext).RGBA_INTEGER;\n\t\t\t\tglType = gl.INT;\n\t\t\t\tvalues = new Int32Array(width * height * glNumChannels);\n\t\t\t\t// // The following works in Chrome.\n\t\t\t\t// values = new Int16Array(width * height * glNumChannels);\n\t\t\t\tbreak;\n\t\t\tcase INT:\n\t\t\t\t// Firefox requires that RGBA_INTEGER/INT is used for readPixels of int types.\n\t\t\t\tglNumChannels = 4;\n\t\t\t\tglFormat = (gl as WebGL2RenderingContext).RGBA_INTEGER;\n\t\t\t\tvalues = new Int32Array(width * height * glNumChannels);\n\t\t\t\t// // The following works in Chrome.\n\t\t\t\t// values = new Int32Array(width * height * glNumChannels);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthrow new Error(`Unsupported internalType ${internalType} for getValues().`);\n\t\t}\n\n\t\tif (this.readyToRead()) {\n\t\t\t// https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/readPixels\n\t\t\tgl.readPixels(0, 0, width, height, glFormat, glType, values);\n\t\t\tconst { numComponents, type } = dataLayer;\n\t\t\tconst OUTPUT_LENGTH = width * height * numComponents;\n\n\t\t\t// Convert uint16 to float32 if needed.\n\t\t\tconst handleFloat16Conversion = internalType === HALF_FLOAT && values.constructor === Uint16Array;\n\t\t\t// @ts-ignore\n\t\t\tconst view = handleFloat16Conversion ? new DataView((values as Uint16Array).buffer) : undefined;\n\n\t\t\tlet output: DataLayerArrayType = values;\n\t\t\t\n\t\t\t// We may use a different internal type than the assigned type of the DataLayer.\n\t\t\tif (internalType !== type) {\n\t\t\t\tswitch (type) {\n\t\t\t\t\tcase HALF_FLOAT:\n\t\t\t\t\tcase FLOAT:\n\t\t\t\t\t\toutput = new Float32Array(OUTPUT_LENGTH);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase UNSIGNED_BYTE:\n\t\t\t\t\t\toutput = new Uint8Array(OUTPUT_LENGTH);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase BYTE:\n\t\t\t\t\t\toutput = new Int8Array(OUTPUT_LENGTH);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase UNSIGNED_SHORT:\n\t\t\t\t\t\toutput = new Uint16Array(OUTPUT_LENGTH);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase SHORT:\n\t\t\t\t\t\toutput = new Int16Array(OUTPUT_LENGTH);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase UNSIGNED_INT:\n\t\t\t\t\t\toutput = new Uint32Array(OUTPUT_LENGTH);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase INT:\n\t\t\t\t\t\toutput = new Int32Array(OUTPUT_LENGTH);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tthrow new Error(`Unsupported type ${type} for getValues().`);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// In some cases glNumChannels may be > numComponents.\n\t\t\tif (handleFloat16Conversion || output !== values || numComponents !== glNumChannels) {\n\t\t\t\tfor (let i = 0, length = width * height; i < length; i++) {\n\t\t\t\t\tconst index1 = i * glNumChannels;\n\t\t\t\t\tconst index2 = i * numComponents;\n\t\t\t\t\tfor (let j = 0; j < numComponents; j++) {\n\t\t\t\t\t\tif (handleFloat16Conversion) {\n\t\t\t\t\t\t\toutput[index2 + j] = getFloat16(view!, 2 * (index1 + j), true);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\toutput[index2 + j] = values[index1 + j];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (output.length !== OUTPUT_LENGTH) {\n\t\t\t\toutput = output.slice(0, OUTPUT_LENGTH);\n\t\t\t}\n\t\t\treturn output;\n\t\t} else {\n\t\t\tthrow new Error(`Unable to read values from Buffer with status: ${gl.checkFramebufferStatus(gl.FRAMEBUFFER)}.`);\n\t\t}\n\t}\n\n\tprivate readyToRead() {\n\t\tconst { gl } = this;\n\t\treturn gl.checkFramebufferStatus(gl.FRAMEBUFFER) == gl.FRAMEBUFFER_COMPLETE;\n\t};\n\n\tsavePNG(dataLayer: DataLayer, filename = dataLayer.name, dpi?: number) {\n\t\tconst values = this.getValues(dataLayer);\n\t\tconst { width, height } = dataLayer;\n\n\t\tconst canvas = document.createElement('canvas');\n\t\tcanvas.width = width;\n    \tcanvas.height = height;\n\t\tconst context = canvas.getContext('2d')!;\n\t\tconst imageData = context.getImageData(0, 0, width, height);\n\t\tconst buffer = imageData.data;\n\t\t// TODO: this isn't working for UNSIGNED_BYTE types?\n\t\tconst isFloat = dataLayer.type === FLOAT || dataLayer.type === HALF_FLOAT;\n\t\t// Have to flip the y axis since PNGs are written top to bottom.\n\t\tfor (let y = 0; y < height; y++) {\n\t\t\tfor (let x = 0; x < width; x++) {\n\t\t\t\tconst index = y * width + x;\n\t\t\t\tconst indexFlipped = (height - 1 - y) * width + x;\n\t\t\t\tfor (let i = 0; i < dataLayer.numComponents; i++) {\n\t\t\t\t\tbuffer[4 * indexFlipped + i] = values[dataLayer.numComponents * index + i] * (isFloat ? 255 : 1);\n\t\t\t\t}\n\t\t\t\tif (dataLayer.numComponents < 4) {\n\t\t\t\t\tbuffer[4 * indexFlipped + 3] = 255;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t// console.log(values, buffer);\n\t\tcontext.putImageData(imageData, 0, 0);\n\n\t\tcanvas!.toBlob((blob) => {\n\t\t\tif (!blob) {\n\t\t\t\tconsole.warn('Problem saving PNG, unable to init blob.');\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (dpi) {\n\t\t\t\tchangeDpiBlob(blob, dpi).then((blob: Blob) =>{\n\t\t\t\t\tsaveAs(blob, `${filename}.png`);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tsaveAs(blob, `${filename}.png`);\n\t\t\t}\n\t\t\t\n\t\t}, 'image/png');\n\t}\n\n    reset() {\n\t\t// TODO: implement this.\n\t\tthrow new Error('WebGLCompute.reset() not implemented.');\n\t};\n\n\tattachDataLayerToThreeTexture(dataLayer: DataLayer, texture: Texture) {\n\t\tif (!this.renderer) {\n\t\t\tthrow new Error('WebGLCompute was not inited with a renderer.');\n\t\t}\n\t\t// Link webgl texture to threejs object.\n\t\t// This is not officially supported.\n\t\tif (dataLayer.numBuffers > 1) {\n\t\t\tthrow new Error(`DataLayer \"${dataLayer.name}\" contains multiple WebGL textures (one for each buffer) that are flip-flopped during compute cycles, please choose a DataLayer with one buffer.`);\n\t\t}\n\t\tconst offsetTextureProperties = this.renderer.properties.get(texture);\n\t\toffsetTextureProperties.__webglTexture = dataLayer.currentState;\n\t\toffsetTextureProperties.__webglInit = true;\n\t}\n\n\tresetThreeState() {\n\t\tif (!this.renderer) {\n\t\t\tthrow new Error('WebGLCompute was not inited with a renderer.');\n\t\t}\n\t\tconst { gl } = this;\n\t\t// Reset viewport.\n\t\tconst viewport = this.renderer.getViewport(new utils.Vector4() as Vector4);\n\t\tgl.viewport(viewport.x, viewport.y, viewport.width, viewport.height);\n\t\t// Unbind framebuffer (render to screen).\n\t\tthis.renderer.setRenderTarget(null);\n\t\t// Reset texture bindings.\n\t\tthis.renderer.resetState();\n\t}\n\t\n\tdispose() {\n\t\t// TODO: Need to implement this.\n\t\tdelete this.renderer;\n\t\t// Delete vertex shaders.\n\t\tObject.values(this._vertexShaders).forEach(vertexShader => {\n\t\t\tif (vertexShader.shader) {\n\t\t\t\tthis.gl.deleteShader(vertexShader.shader);\n\t\t\t\tdelete vertexShader.shader;\n\t\t\t}\n\t\t});\n\t}\n}","const extensions: { [key: string]: any } = {};\n\n// https://developer.mozilla.org/en-US/docs/Web/API/OES_texture_float\n// Float is provided by default in WebGL2 contexts.\n// This extension implicitly enables the WEBGL_color_buffer_float extension (if supported), which allows rendering to 32-bit floating-point color buffers.\nexport const OES_TEXTURE_FLOAT = 'OES_texture_float';\n// https://developer.mozilla.org/en-US/docs/Web/API/OES_texture_half_float\n// Half float is supported by modern mobile browsers, float not yet supported.\n// Half float is provided by default for Webgl2 contexts.\n// This extension implicitly enables the EXT_color_buffer_half_float extension (if supported), which allows rendering to 16-bit floating point formats.\nexport const OES_TEXTURE_HALF_FLOAT = 'OES_texture_half_float';\n// TODO: Seems like linear filtering of floats may be supported in some browsers without these extensions?\n// https://www.khronos.org/registry/OpenGL/extensions/OES/OES_texture_float_linear.txt\nexport const OES_TEXTURE_FLOAT_LINEAR = 'OES_texture_float_linear';\nexport const OES_TEXTURE_HAlF_FLOAT_LINEAR = 'OES_texture_half_float_linear';\n// https://developer.mozilla.org/en-US/docs/Web/API/WEBGL_depth_texture\n// Adds gl.UNSIGNED_SHORT, gl.UNSIGNED_INT types to textImage2D in WebGL1.0\nexport const WEBGL_DEPTH_TEXTURE = 'WEBGL_depth_texture';\n// EXT_COLOR_BUFFER_FLOAT adds ability to render to a variety of floating pt textures.\n// This is needed for the WebGL2 contexts that do not support OES_TEXTURE_FLOAT / OES_TEXTURE_HALF_FLOAT extensions.\n// https://developer.mozilla.org/en-US/docs/Web/API/EXT_color_buffer_float\n// https://stackoverflow.com/questions/34262493/framebuffer-incomplete-attachment-for-texture-with-internal-format\n// https://stackoverflow.com/questions/36109347/framebuffer-incomplete-attachment-only-happens-on-android-w-firefox\nexport const EXT_COLOR_BUFFER_FLOAT = 'EXT_color_buffer_float';\n\nexport function getExtension(\n\tgl: WebGLRenderingContext | WebGL2RenderingContext,\n\textensionName: string,\n\terrorCallback: (message: string) => void,\n\toptional = false,\n) {\n\t// Check if we've already loaded the extension.\n\tif (extensions[extensionName] !== undefined) return extensions[extensionName];\n\n\tlet extension;\n\ttry {\n\t\textension = gl.getExtension(extensionName);\n\t} catch (e) {}\n\tif (extension) {\n\t\t// Cache this extension.\n\t\textensions[extensionName] = extension;\n\t\tconsole.log(`Loaded extension: ${extensionName}.`);\n\t} else {\n\t\textensions[extensionName] = false; // Cache the bad extension lookup.\n\t\tconsole.warn(`Unsupported ${optional ? 'optional ' : ''}extension: ${extensionName}.`);\n\t}\n\t// If the extension is not optional, throw error.\n\tif (!extension && !optional) {\n\t\terrorCallback(`Required extension unsupported by this device / browser: ${extensionName}.`);\n\t}\n\treturn extension;\n}","import { inDevMode, isWebGL2Supported } from './utils';\nimport { WebGLCompute } from './WebGLCompute';\n\nif (inDevMode()) {\n\tconsole.log('Running in development mode.');\n}\n\nexport * from './Constants';\nexport {\n\tWebGLCompute,\n\tisWebGL2Supported,\n};","// Copied from http://webglfundamentals.org/webgl/lessons/webgl-boilerplate.html\nexport function compileShader(\n\tgl: WebGLRenderingContext | WebGL2RenderingContext,\n\terrorCallback: (message: string) => void,\n\tshaderSource: string,\n\tshaderType: number,\n\tprogramName?: string,\n) {\n\t// Create the shader object\n\tconst shader = gl.createShader(shaderType);\n\tif (!shader) {\n\t\terrorCallback('Unable to init gl shader.');\n\t\treturn null;\n\t}\n\n\t// Set the shader source code.\n\tgl.shaderSource(shader, shaderSource);\n\n\t// Compile the shader\n\tgl.compileShader(shader);\n\n\t// Check if it compiled\n\tconst success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\n\tif (!success) {\n\t\t// Something went wrong during compilation - print the error.\n\t\terrorCallback(`Could not compile ${shaderType === gl.FRAGMENT_SHADER ? 'fragment' : 'vertex'}\n\t\t\t shader${programName ? ` for program \"${programName}\"` : ''}: ${gl.getShaderInfoLog(shader)}.`);\n\t\treturn null;\n\t}\n\treturn shader;\n}\n\nexport function isWebGL2(gl: WebGLRenderingContext | WebGL2RenderingContext) {\n\t// This code is pulled from https://github.com/mrdoob/three.js/blob/master/src/renderers/webgl/WebGLCapabilities.js\n\t// @ts-ignore\n\treturn (typeof WebGL2RenderingContext !== 'undefined' && gl instanceof WebGL2RenderingContext) || (typeof WebGL2ComputeRenderingContext !== 'undefined' && gl instanceof WebGL2ComputeRenderingContext);\n\t// return !!(gl as WebGL2RenderingContext).HALF_FLOAT;\n}\n\nexport function isWebGL2Supported() {\n\tconst gl = document.createElement('canvas').getContext('webgl2');\n\tif (!gl) {\n\t\treturn false;\n\t}\n\treturn true;\n}\n\nexport function isPowerOf2(value: number) {\n\treturn (value & (value - 1)) == 0;\n}\n\nexport function initSequentialFloatArray(length: number) {\n\tconst array = new Float32Array(length);\n\tfor (let i = 0; i < length; i++) {\n\t\tarray[i] = i;\n\t}\n\treturn array;\n}\n\nexport function inDevMode() {\n\treturn process.env.NODE_ENV === 'development';\n}","module.exports = \"#version 300 es\\n// These precision definitions are applied to all internal\\n// vertex and fragment shaders in this library.\\nprecision highp int;\\nprecision highp float;\\nprecision lowp sampler2D;\\nprecision lowp isampler2D;\\nprecision lowp usampler2D;\\n\\nin vec2 v_UV;\\n\\nuniform sampler2D u_state;\\n\\nout vec4 out_fragOut;\\n\\nvoid main() {\\n\\tout_fragOut = texture(u_state, v_UV);\\n}\"","module.exports = \"#version 300 es\\n// These precision definitions are applied to all internal\\n// vertex and fragment shaders in this library.\\nprecision highp int;\\nprecision highp float;\\nprecision lowp sampler2D;\\nprecision lowp isampler2D;\\nprecision lowp usampler2D;\\n\\nin vec2 v_UV;\\n\\nuniform isampler2D u_state;\\n\\nout ivec4 out_fragOut;\\n\\nvoid main() {\\n\\tout_fragOut = texture(u_state, v_UV);\\n}\"","module.exports = \"#version 300 es\\n// These precision definitions are applied to all internal\\n// vertex and fragment shaders in this library.\\nprecision highp int;\\nprecision highp float;\\nprecision lowp sampler2D;\\nprecision lowp isampler2D;\\nprecision lowp usampler2D;\\n\\nin vec2 v_UV;\\n\\nuniform usampler2D u_state;\\n\\nout uvec4 out_fragOut;\\n\\nvoid main() {\\n\\tout_fragOut = texture(u_state, v_UV);\\n}\"","module.exports = \"#version 300 es\\n// These precision definitions are applied to all internal\\n// vertex and fragment shaders in this library.\\nprecision highp int;\\nprecision highp float;\\nprecision lowp sampler2D;\\nprecision lowp isampler2D;\\nprecision lowp usampler2D;\\n/**\\n * Returns accurate MOD when arguments are approximate integers.\\n */\\nfloat modI(float a, float b) {\\n    float m = a - floor((a + 0.5) / b) * b;\\n    return floor(m + 0.5);\\n}\\n\\n// Cannot use int vertex attributes: https://stackoverflow.com/questions/27874983/webgl-how-to-use-integer-attributes-in-glsl\\nin float a_internal_index; // Index of point.\\n\\nuniform sampler2D u_internal_positions; // Texture lookup with position data.\\nuniform vec2 u_internal_positionsDimensions;\\nuniform vec2 u_internal_scale;\\n// TODO: remove branching, do these as defines and make separate vert shaders.\\nuniform bool u_internal_positionWithAccumulation;\\nuniform bool u_internal_wrapX;\\nuniform bool u_internal_wrapY;\\n\\nout vec2 v_UV;\\nout vec2 v_lineWrapping; // Use this to test if line is only half wrapped and should not be rendered.\\nout float v_index;\\n\\nvoid main() {\\n\\t// Calculate a uv based on the point's index attribute.\\n\\tvec2 particleUV = vec2(\\n\\t\\tmodI(a_internal_index, u_internal_positionsDimensions.x),\\n\\t\\tfloor(floor(a_internal_index + 0.5) / u_internal_positionsDimensions.x)\\n\\t) / u_internal_positionsDimensions;\\n\\n\\t// Calculate a global uv for the viewport.\\n\\t// Lookup vertex position and scale to [0, 1] range.\\n\\t// We have packed a 2D displacement with the position.\\n\\tvec4 positionData = texture2D(u_internal_positions, particleUV);\\n\\t// position = first two components plus last two components (optional accumulation buffer).\\n\\tvec2 positionAbsolute = positionData.rg;\\n\\tif (u_internal_positionWithAccumulation) positionAbsolute += positionData.ba;\\n\\tv_UV = positionAbsolute * u_internal_scale;\\n\\n\\t// Wrap if needed.\\n\\tv_lineWrapping = vec2(0.0);\\n\\tif (u_internal_wrapX) {\\n\\t\\tif (v_UV.x < 0.0) {\\n\\t\\t\\tv_UV.x += 1.0;\\n\\t\\t\\tv_lineWrapping.x = 1.0;\\n\\t\\t} else if (v_UV.x > 1.0) {\\n\\t\\t\\tv_UV.x -= 1.0;\\n\\t\\t\\tv_lineWrapping.x = 1.0;\\n\\t\\t}\\n\\t}\\n\\tif (u_internal_wrapY) {\\n\\t\\tif (v_UV.y < 0.0) {\\n\\t\\t\\tv_UV.y += 1.0;\\n\\t\\t\\tv_lineWrapping.y = 1.0;\\n\\t\\t} else if (v_UV.y > 1.0) {\\n\\t\\t\\tv_UV.y -= 1.0;\\n\\t\\t\\tv_lineWrapping.y = 1.0;\\n\\t\\t}\\n\\t}\\n\\n\\t// Calculate position in [-1, 1] range.\\n\\tvec2 position = v_UV * 2.0 - 1.0;\\n\\n\\tv_index = a_internal_index;\\n\\tgl_Position = vec4(position, 0, 1);\\n}\"","module.exports = \"#version 300 es\\n// These precision definitions are applied to all internal\\n// vertex and fragment shaders in this library.\\nprecision highp int;\\nprecision highp float;\\nprecision lowp sampler2D;\\nprecision lowp isampler2D;\\nprecision lowp usampler2D;\\n/**\\n * Returns accurate MOD when arguments are approximate integers.\\n */\\nfloat modI(float a, float b) {\\n    float m = a - floor((a + 0.5) / b) * b;\\n    return floor(m + 0.5);\\n}\\n\\n// Cannot use int vertex attributes: https://stackoverflow.com/questions/27874983/webgl-how-to-use-integer-attributes-in-glsl\\nin float a_internal_index; // Index of point.\\n\\nuniform sampler2D u_internal_positions; // Texture lookup with position data.\\nuniform vec2 u_internal_positionsDimensions;\\nuniform vec2 u_internal_scale;\\nuniform float u_internal_pointSize;\\nuniform bool u_internal_positionWithAccumulation;\\nuniform bool u_internal_wrapX;\\nuniform bool u_internal_wrapY;\\n\\nout vec2 v_UV;\\nout float v_index;\\n\\nvoid main() {\\n\\t// Calculate a uv based on the point's index attribute.\\n\\tvec2 particleUV = vec2(\\n\\t\\tmodI(a_internal_index, u_internal_positionsDimensions.x),\\n\\t\\tfloor(floor(a_internal_index + 0.5) / u_internal_positionsDimensions.x)\\n\\t) / u_internal_positionsDimensions;\\n\\n\\t// Calculate a global uv for the viewport.\\n\\t// Lookup vertex position and scale to [0, 1] range.\\n\\t// We have packed a 2D displacement with the position.\\n\\tvec4 positionData = texture2D(u_internal_positions, particleUV);\\n\\t// position = first two components plus last two components (optional accumulation buffer).\\n\\tvec2 positionAbsolute = positionData.rg;\\n\\tif (u_internal_positionWithAccumulation) positionAbsolute += positionData.ba;\\n\\tv_UV = positionAbsolute * u_internal_scale;\\n\\n\\t// Wrap if needed.\\n\\tif (u_internal_wrapX) {\\n\\t\\tif (v_UV.x < 0.0) v_UV.x += 1.0;\\n\\t\\tif (v_UV.x > 1.0) v_UV.x -= 1.0;\\n\\t}\\n\\tif (u_internal_wrapY) {\\n\\t\\tif (v_UV.y < 0.0) v_UV.y += 1.0;\\n\\t\\tif (v_UV.y > 1.0) v_UV.y -= 1.0;\\n\\t}\\n\\n\\t// Calculate position in [-1, 1] range.\\n\\tvec2 position = v_UV * 2.0 - 1.0;\\n\\n\\tv_index = a_internal_index;\\n\\tgl_PointSize = u_internal_pointSize;\\n\\tgl_Position = vec4(position, 0, 1);\\n}\"","module.exports = \"#version 300 es\\n// These precision definitions are applied to all internal\\n// vertex and fragment shaders in this library.\\nprecision highp int;\\nprecision highp float;\\nprecision lowp sampler2D;\\nprecision lowp isampler2D;\\nprecision lowp usampler2D;\\n/**\\n * Returns accurate MOD when arguments are approximate integers.\\n */\\nfloat modI(float a, float b) {\\n    float m = a - floor((a + 0.5) / b) * b;\\n    return floor(m + 0.5);\\n}\\n\\n// Cannot use int vertex attributes: https://stackoverflow.com/questions/27874983/webgl-how-to-use-integer-attributes-in-glsl\\nint float a_internal_index; // Index of point.\\n\\nuniform sampler2D u_internal_vectors; // Texture lookup with vector data.\\nuniform vec2 u_internal_dimensions;\\nuniform vec2 u_internal_scale;\\n\\nout vec2 v_UV;\\nout float v_index;\\n\\nvoid main() {\\n\\t// Divide index by 2.\\n\\tfloat index = floor((a_internal_index + 0.5) / 2.0);\\n\\t// Calculate a uv based on the vertex index attribute.\\n\\tv_UV = vec2(\\n\\t\\tmodI(index, u_internal_dimensions.x),\\n\\t\\tfloor(floor(index + 0.5) / u_internal_dimensions.x)\\n\\t) / u_internal_dimensions;\\n\\n\\t// Add vector displacement if needed.\\n\\tif (modI(a_internal_index, 2.0) > 0.0) {\\n\\t\\t// Lookup vectorData at current UV.\\n\\t\\tvec2 vectorData = texture2D(u_internal_vectors, v_UV).xy;\\n\\t\\tv_UV += vectorData * u_internal_scale;\\n\\t}\\n\\n\\t// Calculate position in [-1, 1] range.\\n\\tvec2 position = v_UV * 2.0 - 1.0;\\n\\n\\tv_index = a_internal_index;\\n\\tgl_Position = vec4(position, 0, 1);\\n}\"","module.exports = \"#version 300 es\\n// These precision definitions are applied to all internal\\n// vertex and fragment shaders in this library.\\nprecision highp int;\\nprecision highp float;\\nprecision lowp sampler2D;\\nprecision lowp isampler2D;\\nprecision lowp usampler2D;\\n\\nin vec2 a_internal_position;\\n#ifdef UV_ATTRIBUTE\\nin vec2 a_internal_uv;\\n#endif\\n#ifdef NORMAL_ATTRIBUTE\\nin vec2 a_internal_normal;\\n#endif\\n\\nuniform vec2 u_internal_scale;\\nuniform vec2 u_internal_translation;\\n\\nout vec2 v_UV;\\nout vec2 v_UV_local;\\n#ifdef NORMAL_ATTRIBUTE\\nout vec2 v_normal;\\n#endif\\n\\nvoid main() {\\n\\t// Optional varyings.\\n\\t#ifdef UV_ATTRIBUTE\\n\\tv_UV_local = a_internal_uv;\\n\\t#else\\n\\tv_UV_local = a_internal_position;\\n\\t#endif\\n\\t#ifdef NORMAL_ATTRIBUTE\\n\\tv_normal = a_internal_normal;\\n\\t#endif\\n\\n\\t// Apply transformations.\\n\\tvec2 position = u_internal_scale * a_internal_position + u_internal_translation;\\n\\n\\t// Calculate a global uv for the viewport.\\n\\tv_UV = 0.5 * (position + 1.0);\\n\\n\\t// Calculate vertex position.\\n\\tgl_Position = vec4(position, 0, 1);\\n}\"","module.exports = \"#version 300 es\\n// These precision definitions are applied to all internal\\n// vertex and fragment shaders in this library.\\nprecision highp int;\\nprecision highp float;\\nprecision lowp sampler2D;\\nprecision lowp isampler2D;\\nprecision lowp usampler2D;\\n\\nin vec2 a_internal_position;\\n\\nuniform float u_internal_halfThickness;\\nuniform vec2 u_internal_scale;\\nuniform float u_internal_length;\\nuniform float u_internal_rotation;\\nuniform vec2 u_internal_translation;\\n\\nout vec2 v_UV_local;\\nout vec2 v_UV;\\n\\nmat2 rotate2d(float _angle){\\n\\treturn mat2(cos(_angle), -sin(_angle), sin(_angle), cos(_angle));\\n}\\n\\nvoid main() {\\n\\t// Calculate UV coordinates of current rendered object.\\n\\tv_UV_local = 0.5 * (a_internal_position + 1.0);\\n\\n\\tvec2 position = a_internal_position;\\n\\n\\t// Apply thickness / radius.\\n\\tposition *= u_internal_halfThickness;\\n\\n\\t// Stretch center of shape to form a round-capped line segment.\\n\\tif (position.x < 0.0) {\\n\\t\\tposition.x -= u_internal_length / 2.0;\\n\\t\\tv_UV_local.x = 0.0; // Set entire cap UV.x to 0.\\n\\t} else if (position.x > 0.0) {\\n\\t\\tposition.x += u_internal_length / 2.0;\\n\\t\\tv_UV_local.x = 1.0; // Set entire cap UV.x to 1.\\n\\t}\\n\\n\\t// Apply transformations.\\n\\tposition = u_internal_scale * (rotate2d(-u_internal_rotation) * position) + u_internal_translation;\\n\\n\\t// Calculate a global uv for the viewport.\\n\\tv_UV = 0.5 * (position + 1.0);\\n\\n\\t// Calculate vertex position.\\n\\tgl_Position = vec4(position, 0, 1);\\n}\"","module.exports = \"// Fragment shader that draws a single color.\\nprecision highp float;\\n\\nuniform vec3 u_color;\\n\\nvoid main() {\\n\\tgl_FragColor = vec4(u_color, 1);\\n}\"","module.exports = \"// Fragment shader that draws a single color.\\nprecision highp float;\\n\\nuniform vec3 u_color;\\nvarying vec2 v_lineWrapping;\\n\\nvoid main() {\\n\\t// check if this line has wrapped.\\n\\tif ((v_lineWrapping.x != 0.0 && v_lineWrapping.x != 1.0) || (v_lineWrapping.y != 0.0 && v_lineWrapping.y != 1.0)) {\\n\\t\\t// Render nothing.\\n\\t\\tdiscard;\\n\\t\\treturn;\\n\\t}\\n\\tgl_FragColor = vec4(u_color, 1);\\n}\"","module.exports = \"// Fragment shader that draws the magnitude of a DataLayer.\\nprecision highp float;\\n\\nvarying vec2 v_UV;\\n\\nuniform vec3 u_color;\\nuniform float u_scale;\\nuniform sampler2D u_internal_data;\\n\\nvoid main() {\\n\\tvec4 value = texture2D(u_internal_data, v_UV);\\n\\tfloat mag = length(value);\\n\\tgl_FragColor = vec4(mag * u_scale * u_color, 1);\\n}\"","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\tloaded: false,\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Flag the module as loaded\n\tmodule.loaded = true;\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.hmd = (module) => {\n\tmodule = Object.create(module);\n\tif (!module.children) module.children = [];\n\tObject.defineProperty(module, 'exports', {\n\t\tenumerable: true,\n\t\tset: () => {\n\t\t\tthrow new Error('ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: ' + module.id);\n\t\t}\n\t});\n\treturn module;\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(607);\n"],"sourceRoot":""}
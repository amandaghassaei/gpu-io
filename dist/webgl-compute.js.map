{"version":3,"sources":["webpack://WebGLCompute/webpack/universalModuleDefinition","webpack://WebGLCompute/./node_modules/@petamoriken/float16/src/lib.js","webpack://WebGLCompute/./node_modules/@petamoriken/float16/src/hfround.js","webpack://WebGLCompute/./node_modules/lodash-es/_root.js","webpack://WebGLCompute/./node_modules/lodash-es/_Symbol.js","webpack://WebGLCompute/./node_modules/lodash-es/_getRawTag.js","webpack://WebGLCompute/./node_modules/lodash-es/_objectToString.js","webpack://WebGLCompute/./node_modules/lodash-es/_baseGetTag.js","webpack://WebGLCompute/./node_modules/lodash-es/isObject.js","webpack://WebGLCompute/./node_modules/lodash-es/isFunction.js","webpack://WebGLCompute/./node_modules/lodash-es/_coreJsData.js","webpack://WebGLCompute/./node_modules/lodash-es/_isMasked.js","webpack://WebGLCompute/./node_modules/lodash-es/_toSource.js","webpack://WebGLCompute/./node_modules/lodash-es/_baseIsNative.js","webpack://WebGLCompute/./node_modules/lodash-es/_getValue.js","webpack://WebGLCompute/./node_modules/lodash-es/_getNative.js","webpack://WebGLCompute/./node_modules/lodash-es/_nativeCreate.js","webpack://WebGLCompute/./node_modules/lodash-es/_hashClear.js","webpack://WebGLCompute/./node_modules/lodash-es/_hashDelete.js","webpack://WebGLCompute/./node_modules/lodash-es/_hashGet.js","webpack://WebGLCompute/./node_modules/lodash-es/_hashHas.js","webpack://WebGLCompute/./node_modules/lodash-es/_hashSet.js","webpack://WebGLCompute/./node_modules/lodash-es/_Hash.js","webpack://WebGLCompute/./node_modules/lodash-es/_listCacheClear.js","webpack://WebGLCompute/./node_modules/lodash-es/eq.js","webpack://WebGLCompute/./node_modules/lodash-es/_assocIndexOf.js","webpack://WebGLCompute/./node_modules/lodash-es/_listCacheDelete.js","webpack://WebGLCompute/./node_modules/lodash-es/_listCacheGet.js","webpack://WebGLCompute/./node_modules/lodash-es/_listCacheHas.js","webpack://WebGLCompute/./node_modules/lodash-es/_listCacheSet.js","webpack://WebGLCompute/./node_modules/lodash-es/_ListCache.js","webpack://WebGLCompute/./node_modules/lodash-es/_Map.js","webpack://WebGLCompute/./node_modules/lodash-es/_mapCacheClear.js","webpack://WebGLCompute/./node_modules/lodash-es/_isKeyable.js","webpack://WebGLCompute/./node_modules/lodash-es/_getMapData.js","webpack://WebGLCompute/./node_modules/lodash-es/_mapCacheDelete.js","webpack://WebGLCompute/./node_modules/lodash-es/_mapCacheGet.js","webpack://WebGLCompute/./node_modules/lodash-es/_mapCacheHas.js","webpack://WebGLCompute/./node_modules/lodash-es/_mapCacheSet.js","webpack://WebGLCompute/./node_modules/lodash-es/_MapCache.js","webpack://WebGLCompute/./node_modules/lodash-es/memoize.js","webpack://WebGLCompute/./node_modules/@petamoriken/float16/src/bug.js","webpack://WebGLCompute/./node_modules/@petamoriken/float16/src/spec.js","webpack://WebGLCompute/./node_modules/@petamoriken/float16/src/is.js","webpack://WebGLCompute/./node_modules/lodash-es/isObjectLike.js","webpack://WebGLCompute/./node_modules/lodash-es/_baseIsArrayBuffer.js","webpack://WebGLCompute/./node_modules/lodash-es/_baseUnary.js","webpack://WebGLCompute/./node_modules/lodash-es/isArrayBuffer.js","webpack://WebGLCompute/./node_modules/@petamoriken/float16/src/private.js","webpack://WebGLCompute/./node_modules/@petamoriken/float16/src/Float16Array.js","webpack://WebGLCompute/./node_modules/@petamoriken/float16/src/dataView.js","webpack://WebGLCompute/./node_modules/@petamoriken/float16/src/index.js","webpack://WebGLCompute/./node_modules/changedpi/dist/index.js","webpack://WebGLCompute/./node_modules/file-saver/dist/FileSaver.min.js","webpack://WebGLCompute/./node_modules/lodash-es/_freeGlobal.js","webpack://WebGLCompute/./node_modules/lodash-es/_nodeUtil.js","webpack://WebGLCompute/./src/Checks.ts","webpack://WebGLCompute/./src/Constants.ts","webpack://WebGLCompute/./src/DataLayer.ts","webpack://WebGLCompute/./src/GPUProgram.ts","webpack://WebGLCompute/./src/Vector4.ts","webpack://WebGLCompute/./src/WebGLCompute.ts","webpack://WebGLCompute/./src/extensions.ts","webpack://WebGLCompute/./src/index.ts","webpack://WebGLCompute/./src/utils.ts","webpack://WebGLCompute/./src/glsl/frag/CopyFragShader.glsl","webpack://WebGLCompute/./src/glsl/frag/SetValueFragShader.glsl","webpack://WebGLCompute/./src/glsl/frag/VectorMagnitudeFragShader.glsl","webpack://WebGLCompute/./src/glsl/frag/WrappedLineColorFragShader.glsl","webpack://WebGLCompute/./src/glsl/vert/DataLayerLinesVertShader.glsl","webpack://WebGLCompute/./src/glsl/vert/DataLayerPointsVertShader.glsl","webpack://WebGLCompute/./src/glsl/vert/DataLayerVectorFieldVertShader.glsl","webpack://WebGLCompute/./src/glsl/vert/DefaultVertShader.glsl","webpack://WebGLCompute/./src/glsl/vert/SegmentVertShader.glsl","webpack://WebGLCompute/webpack/bootstrap","webpack://WebGLCompute/webpack/runtime/define property getters","webpack://WebGLCompute/webpack/runtime/global","webpack://WebGLCompute/webpack/runtime/harmony module decorator","webpack://WebGLCompute/webpack/runtime/hasOwnProperty shorthand","webpack://WebGLCompute/webpack/runtime/make namespace object","webpack://WebGLCompute/webpack/startup"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;;;;;;;;;;;;;;;;;;;ACVA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA,cAAc,SAAS;AACvB;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,WAAW,OAAO;AAClB,aAAa,OAAO;AACpB;AACO;AACP;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA,cAAc,UAAU;AACxB,oBAAoB;AACpB,cAAc;;AAEd;AACA;AACA,wBAAwB;AACxB;AACA;;AAEA,qBAAqB;AACrB,oBAAoB;;AAEpB;AACA;AACA,iBAAiB,UAAU;AAC3B;AACA;;AAEA;AACA,cAAc,QAAQ;AACtB;AACA;AACA;AACA;AACA,eAAe,QAAQ;AACvB;AACA;AACA;;AAEA;AACA,cAAc,QAAQ;AACtB;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA,WAAW,OAAO;AAClB,aAAa,OAAO;AACpB;AACO;AACP;AACA;AACA;AACA;;;ACrH4D;;AAE5D;AACA;AACA,WAAW,OAAO;AAClB,aAAa;AACb;AACe;AACf;;AAEA;AACA;AACA;AACA;;AAEA,gBAAgB,kBAAkB;AAClC,WAAW,eAAe;AAC1B;;;;;ACjB0C;;AAE1C;AACA;;AAEA;AACA,WAAW,0BAAU;;AAErB,4CAAe,IAAI,EAAC;;;ACRU;;AAE9B;AACA,IAAI,cAAM,GAAG,YAAW;;AAExB,8CAAe,cAAM,EAAC;;;ACLY;;AAElC;AACA;;AAEA;AACA,IAAI,yBAAc;;AAElB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,qBAAqB,OAAM,GAAG,mBAAkB;;AAEhD;AACA;AACA;AACA;AACA,WAAW,EAAE;AACb,aAAa,OAAO;AACpB;AACA;AACA,cAAc,yBAAc;AAC5B;;AAEA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;;AAEA,iDAAe,SAAS,EAAC;;;AC7CzB;AACA,IAAI,2BAAW;;AAEf;AACA;AACA;AACA;AACA;AACA,IAAI,oCAAoB,GAAG,2BAAW;;AAEtC;AACA;AACA;AACA;AACA,WAAW,EAAE;AACb,aAAa,OAAO;AACpB;AACA;AACA,SAAS,oCAAoB;AAC7B;;AAEA,sDAAe,cAAc,EAAC;;;ACrBI;AACM;AACU;;AAElD;AACA;AACA;;AAEA;AACA,IAAI,0BAAc,GAAG,OAAM,GAAG,mBAAkB;;AAEhD;AACA;AACA;AACA;AACA,WAAW,EAAE;AACb,aAAa,OAAO;AACpB;AACA;AACA;AACA;AACA;AACA,UAAU,0BAAc,IAAI,0BAAc;AAC1C,MAAM,UAAS;AACf,MAAM,eAAc;AACpB;;AAEA,kDAAe,UAAU,EAAC;;;AC3B1B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,EAAE;AACb,aAAa,QAAQ;AACrB;AACA;AACA,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,yDAAe,QAAQ,EAAC;;;AC9BkB;AACL;;AAErC;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,EAAE;AACb,aAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,kBAAQ;AACf;AACA;AACA;AACA;AACA,YAAY,WAAU;AACtB;AACA;;AAEA,2DAAe,UAAU,EAAC;;;ACpCI;;AAE9B;AACA,iBAAiB,2BAA0B;;AAE3C,kDAAe,UAAU,EAAC;;;ACLgB;;AAE1C;AACA;AACA,0BAA0B,WAAU,IAAI,gBAAe,IAAI,yBAAwB;AACnF;AACA,CAAC;;AAED;AACA;AACA;AACA;AACA,WAAW,SAAS;AACpB,aAAa,QAAQ;AACrB;AACA;AACA;AACA;;AAEA,gDAAe,QAAQ,EAAC;;;ACnBxB;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,SAAS;AACpB,aAAa,OAAO;AACpB;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA,gDAAe,QAAQ,EAAC;;;ACzBiB;AACH;AACD;AACC;;AAEtC;AACA;AACA;AACA;AACA,oCAAoC;;AAEpC;AACA;;AAEA;AACA,IAAI,uBAAS;AACb,IAAI,yBAAW;;AAEf;AACA,IAAI,0BAAY,GAAG,uBAAS;;AAE5B;AACA,IAAI,4BAAc,GAAG,yBAAW;;AAEhC;AACA;AACA,EAAE,0BAAY,MAAM,4BAAc;AAClC;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,EAAE;AACb,aAAa,QAAQ;AACrB;AACA;AACA;AACA,OAAO,kBAAQ,WAAW,SAAQ;AAClC;AACA;AACA,gBAAgB,oBAAU;AAC1B,sBAAsB,SAAQ;AAC9B;;AAEA,oDAAe,YAAY,EAAC;;;AC9C5B;AACA;AACA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB,aAAa,EAAE;AACf;AACA;AACA;AACA;;AAEA,gDAAe,QAAQ,EAAC;;;ACZsB;AACR;;AAEtC;AACA;AACA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB,aAAa,EAAE;AACf;AACA;AACA,cAAc,SAAQ;AACtB,SAAS,aAAY;AACrB;;AAEA,iDAAe,SAAS,EAAC;;;AChBe;;AAExC;AACA,mBAAmB,UAAS;;AAE5B,oDAAe,YAAY,EAAC;;;ACLkB;;AAE9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAkB,aAAY,GAAG,aAAY;AAC7C;AACA;;AAEA,iDAAe,SAAS,EAAC;;;ACdzB;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB,aAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;AACA;;AAEA,kDAAe,UAAU,EAAC;;;AChBoB;;AAE9C;AACA;;AAEA;AACA,IAAI,oBAAW;;AAEf;AACA,IAAI,uBAAc,GAAG,oBAAW;;AAEhC;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,OAAO;AAClB,aAAa,EAAE;AACf;AACA;AACA;AACA,MAAM,aAAY;AAClB;AACA;AACA;AACA,SAAS,uBAAc;AACvB;;AAEA,+CAAe,OAAO,EAAC;;;AC7BuB;;AAE9C;AACA,IAAI,oBAAW;;AAEf;AACA,IAAI,uBAAc,GAAG,oBAAW;;AAEhC;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,OAAO;AAClB,aAAa,QAAQ;AACrB;AACA;AACA;AACA,SAAS,aAAY,+BAA+B,uBAAc;AAClE;;AAEA,+CAAe,OAAO,EAAC;;;ACtBuB;;AAE9C;AACA,IAAI,uBAAc;;AAElB;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,EAAE;AACb,aAAa,OAAO;AACpB;AACA;AACA;AACA;AACA,eAAe,aAAY,2BAA2B,uBAAc;AACpE;AACA;;AAEA,+CAAe,OAAO,EAAC;;;ACtBiB;AACE;AACN;AACA;AACA;;AAEpC;AACA;AACA;AACA;AACA;AACA,WAAW,MAAM;AACjB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,uBAAuB,UAAS;AAChC,2BAA2B,WAAU;AACrC,qBAAqB,QAAO;AAC5B,qBAAqB,QAAO;AAC5B,qBAAqB,QAAO;;AAE5B,4CAAe,IAAI,EAAC;;;AC/BpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,sDAAe,cAAc,EAAC;;;ACZ9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,EAAE;AACb,WAAW,EAAE;AACb,aAAa,QAAQ;AACrB;AACA;AACA,iBAAiB;AACjB,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,mDAAe,EAAE,EAAC;;;ACpCO;;AAEzB;AACA;AACA;AACA;AACA,WAAW,MAAM;AACjB,WAAW,EAAE;AACb,aAAa,OAAO;AACpB;AACA;AACA;AACA;AACA,QAAQ,YAAE;AACV;AACA;AACA;AACA;AACA;;AAEA,oDAAe,YAAY,EAAC;;;ACpBkB;;AAE9C;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,OAAO;AAClB,aAAa,QAAQ;AACrB;AACA;AACA;AACA,cAAc,aAAY;;AAE1B;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;;AAEA,uDAAe,eAAe,EAAC;;;AClCe;;AAE9C;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,OAAO;AAClB,aAAa,EAAE;AACf;AACA;AACA;AACA,cAAc,aAAY;;AAE1B;AACA;;AAEA,oDAAe,YAAY,EAAC;;;AClBkB;;AAE9C;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,OAAO;AAClB,aAAa,QAAQ;AACrB;AACA;AACA,SAAS,aAAY;AACrB;;AAEA,oDAAe,YAAY,EAAC;;;ACfkB;;AAE9C;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,EAAE;AACb,aAAa,OAAO;AACpB;AACA;AACA;AACA,cAAc,aAAY;;AAE1B;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;;AAEA,oDAAe,YAAY,EAAC;;;ACzBsB;AACE;AACN;AACA;AACA;;AAE9C;AACA;AACA;AACA;AACA;AACA,WAAW,MAAM;AACjB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,4BAA4B,eAAc;AAC1C,gCAAgC,gBAAe;AAC/C,0BAA0B,aAAY;AACtC,0BAA0B,aAAY;AACtC,0BAA0B,aAAY;;AAEtC,iDAAe,SAAS,EAAC;;;AC/Be;AACV;;AAE9B;AACA,UAAU,UAAS,CAAC,KAAI;;AAExB,2CAAe,GAAG,EAAC;;;ACNW;AACU;AACZ;;AAE5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,KAAI;AACpB,gBAAgB,IAAG,IAAI,UAAS;AAChC,kBAAkB,KAAI;AACtB;AACA;;AAEA,qDAAe,aAAa,EAAC;;;ACpB7B;AACA;AACA;AACA;AACA,WAAW,EAAE;AACb,aAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,iDAAe,SAAS,EAAC;;;ACde;;AAExC;AACA;AACA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB,aAAa,EAAE;AACf;AACA;AACA;AACA,SAAS,UAAS;AAClB;AACA;AACA;;AAEA,kDAAe,UAAU,EAAC;;;ACjBgB;;AAE1C;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,OAAO;AAClB,aAAa,QAAQ;AACrB;AACA;AACA,eAAe,WAAU;AACzB;AACA;AACA;;AAEA,sDAAe,cAAc,EAAC;;;ACjBY;;AAE1C;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,OAAO;AAClB,aAAa,EAAE;AACf;AACA;AACA,SAAS,WAAU;AACnB;;AAEA,mDAAe,WAAW,EAAC;;;ACfe;;AAE1C;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,OAAO;AAClB,aAAa,QAAQ;AACrB;AACA;AACA,SAAS,WAAU;AACnB;;AAEA,mDAAe,WAAW,EAAC;;;ACfe;;AAE1C;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,EAAE;AACb,aAAa,OAAO;AACpB;AACA;AACA,aAAa,WAAU;AACvB;;AAEA;AACA;AACA;AACA;;AAEA,mDAAe,WAAW,EAAC;;;ACrBqB;AACE;AACN;AACA;AACA;;AAE5C;AACA;AACA;AACA;AACA;AACA,WAAW,MAAM;AACjB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,2BAA2B,cAAa;AACxC,+BAA+B,eAAc;AAC7C,yBAAyB,YAAW;AACpC,yBAAyB,YAAW;AACpC,yBAAyB,YAAW;;AAEpC,gDAAe,QAAQ,EAAC;;;AC/Bc;;AAEtC;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,SAAS;AACpB,WAAW,SAAS;AACpB,aAAa,SAAS;AACtB;AACA;AACA,iBAAiB;AACjB,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yCAAyC,SAAQ;AACjD;AACA;;AAEA;AACA,gBAAgB,SAAQ;;AAExB,wDAAe,OAAO,EAAC;;;ACxEvB;AACA;AACA;AACA;AACO;;;ACJP;AACA,WAAW,QAAQ;AACnB,aAAa;AACb;AACO;AACP;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB,aAAa;AACb;AACO;AACP;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;;ACrDmC;;AAEgC;;AAEnE;AACA,WAAW,QAAQ;AACnB,aAAa;AACb;AACO;AACP;AACA;;AAEA;AACA,WAAW,QAAQ;AACnB,aAAa;AACb;AACO;AACP,8CAA8C,SAAS;AACvD;;;AClBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,EAAE;AACb,aAAa,QAAQ;AACrB;AACA;AACA,oBAAoB;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,6DAAe,YAAY,EAAC;;;AC5Bc;AACG;;AAE7C;;AAEA;AACA;AACA;AACA;AACA,WAAW,EAAE;AACb,aAAa,QAAQ;AACrB;AACA;AACA,SAAS,sBAAY,WAAW,WAAU;AAC1C;;AAEA,yDAAe,iBAAiB,EAAC;;;AChBjC;AACA;AACA;AACA;AACA,WAAW,SAAS;AACpB,aAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;AACA;;AAEA,iDAAe,SAAS,EAAC;;;;;ACb+B;AAChB;AACF;;AAE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CA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACxlBkC;AAC0B;;AAE5D;AACA;AACA,WAAW,SAAS;AACpB,WAAW,OAAO;AAClB,WAAW,UAAU;AACrB,aAAa;AACb;AACO;AACP,SAAS,UAAU;AACnB;AACA;;AAEA,WAAW,eAAe;AAC1B;;AAEA;AACA;AACA,WAAW,SAAS;AACpB,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB,WAAW,UAAU;AACrB;AACO;AACP,SAAS,UAAU;AACnB;AACA;;AAEA,mCAAmC,kBAAkB;AACrD;;;AC/B+C;AACU;AACF;;;;;;;;;ACF1C;;AAEb,8CAA6C;AAC7C;AACA,CAAC,EAAC;AACF,qBAAqB;AACrB,wBAAwB;;AAExB,kCAAkC,0BAA0B,0CAA0C,gBAAgB,OAAO,kBAAkB,EAAE,aAAa,EAAE,OAAO,wBAAwB,EAAE;;AAEjM;AACA;AACA;AACA,iBAAiB,SAAS;AAC1B;AACA,mBAAmB,OAAO;AAC1B;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,iBAAiB,gBAAgB;AACjC;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C,kBAAkB;AAChE;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB,sBAAsB;AACvC;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA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","file":"webgl-compute.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"WebGLCompute\"] = factory();\n\telse\n\t\troot[\"WebGLCompute\"] = factory();\n})(self, function() {\nreturn ","// algorithm: ftp://ftp.fox-toolkit.org/pub/fasthalffloatconversion.pdf\n\nconst buffer = new ArrayBuffer(4);\nconst floatView = new Float32Array(buffer);\nconst uint32View = new Uint32Array(buffer);\n\n\nconst baseTable = new Uint32Array(512);\nconst shiftTable = new Uint32Array(512);\n\nfor(let i = 0; i < 256; ++i) {\n    const e = i - 127;\n\n    // very small number (0, -0)\n    if (e < -27) {\n        baseTable[i | 0x000] = 0x0000;\n        baseTable[i | 0x100] = 0x8000;\n        shiftTable[i | 0x000] = 24;\n        shiftTable[i | 0x100] = 24;\n\n    // small number (denorm)\n    } else if (e < -14) {\n        baseTable[i | 0x000] =  0x0400 >> (-e - 14);\n        baseTable[i | 0x100] = (0x0400 >> (-e - 14)) | 0x8000;\n        shiftTable[i | 0x000] = -e - 1;\n        shiftTable[i | 0x100] = -e - 1;\n\n    // normal number\n    } else if (e <= 15) {\n        baseTable[i | 0x000] =  (e + 15) << 10;\n        baseTable[i | 0x100] = ((e + 15) << 10) | 0x8000;\n        shiftTable[i | 0x000] = 13;\n        shiftTable[i | 0x100] = 13;\n\n    // large number (Infinity, -Infinity)\n    } else if (e < 128) {\n        baseTable[i | 0x000] = 0x7c00;\n        baseTable[i | 0x100] = 0xfc00;\n        shiftTable[i | 0x000] = 24;\n        shiftTable[i | 0x100] = 24;\n\n    // stay (NaN, Infinity, -Infinity)\n    } else {\n        baseTable[i | 0x000] = 0x7c00;\n        baseTable[i | 0x100] = 0xfc00;\n        shiftTable[i | 0x000] = 13;\n        shiftTable[i | 0x100] = 13;\n    }\n}\n\n/**\n * round a number to a half float number bits.\n * @param {number} num - double float\n * @returns {number} half float number bits\n */\nexport function roundToFloat16Bits(num) {\n    floatView[0] = num;\n\n    const f = uint32View[0];\n    const e = (f >> 23) & 0x1ff;\n    return baseTable[e] + ((f & 0x007fffff) >> shiftTable[e]);\n}\n\n\nconst mantissaTable = new Uint32Array(2048);\nconst exponentTable = new Uint32Array(64);\nconst offsetTable = new Uint32Array(64);\n\nmantissaTable[0] = 0;\nfor(let i = 1; i < 1024; ++i) {\n    let m = i << 13;    // zero pad mantissa bits\n    let e = 0;          // zero exponent\n\n    // normalized\n    while((m & 0x00800000) === 0) {\n        e -= 0x00800000;    // decrement exponent\n        m <<= 1;\n    }\n\n    m &= ~0x00800000;   // clear leading 1 bit\n    e += 0x38800000;    // adjust bias\n\n    mantissaTable[i] = m | e;\n}\nfor(let i = 1024; i < 2048; ++i) {\n    mantissaTable[i] = 0x38000000 + ((i - 1024) << 13);\n}\n\nexponentTable[0] = 0;\nfor(let i = 1; i < 31; ++i) {\n    exponentTable[i] = i << 23;\n}\nexponentTable[31] = 0x47800000;\nexponentTable[32] = 0x80000000;\nfor(let i = 33; i < 63; ++i) {\n    exponentTable[i] = 0x80000000 + ((i - 32) << 23);\n}\nexponentTable[63] = 0xc7800000;\n\noffsetTable[0] = 0;\nfor(let i = 1; i < 64; ++i) {\n    if (i === 32) {\n        offsetTable[i] = 0;\n    } else {\n        offsetTable[i] = 1024;\n    }\n}\n\n/**\n * convert a half float number bits to a number.\n * @param {number} float16bits - half float number bits\n * @returns {number} double float\n */\nexport function convertToNumber(float16bits) {\n    const m = float16bits >> 10;\n    uint32View[0] = mantissaTable[offsetTable[m] + (float16bits & 0x3ff)] + exponentTable[m];\n    return floatView[0];\n}\n","import { convertToNumber, roundToFloat16Bits } from \"./lib\";\n\n/**\n * returns the nearest half precision float representation of a number.\n * @param {number} num\n * @returns {number}\n */\nexport default function hfround(num) {\n    num = Number(num);\n\n    // for optimization\n    if (!Number.isFinite(num) || num === 0) {\n        return num;\n    }\n\n    const x16 = roundToFloat16Bits(num);\n    return convertToNumber(x16);\n}\n","import freeGlobal from './_freeGlobal.js';\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\nexport default root;\n","import root from './_root.js';\n\n/** Built-in value references. */\nvar Symbol = root.Symbol;\n\nexport default Symbol;\n","import Symbol from './_Symbol.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * A specialized version of `baseGetTag` which ignores `Symbol.toStringTag` values.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the raw `toStringTag`.\n */\nfunction getRawTag(value) {\n  var isOwn = hasOwnProperty.call(value, symToStringTag),\n      tag = value[symToStringTag];\n\n  try {\n    value[symToStringTag] = undefined;\n    var unmasked = true;\n  } catch (e) {}\n\n  var result = nativeObjectToString.call(value);\n  if (unmasked) {\n    if (isOwn) {\n      value[symToStringTag] = tag;\n    } else {\n      delete value[symToStringTag];\n    }\n  }\n  return result;\n}\n\nexport default getRawTag;\n","/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/**\n * Converts `value` to a string using `Object.prototype.toString`.\n *\n * @private\n * @param {*} value The value to convert.\n * @returns {string} Returns the converted string.\n */\nfunction objectToString(value) {\n  return nativeObjectToString.call(value);\n}\n\nexport default objectToString;\n","import Symbol from './_Symbol.js';\nimport getRawTag from './_getRawTag.js';\nimport objectToString from './_objectToString.js';\n\n/** `Object#toString` result references. */\nvar nullTag = '[object Null]',\n    undefinedTag = '[object Undefined]';\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * The base implementation of `getTag` without fallbacks for buggy environments.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nfunction baseGetTag(value) {\n  if (value == null) {\n    return value === undefined ? undefinedTag : nullTag;\n  }\n  return (symToStringTag && symToStringTag in Object(value))\n    ? getRawTag(value)\n    : objectToString(value);\n}\n\nexport default baseGetTag;\n","/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return value != null && (type == 'object' || type == 'function');\n}\n\nexport default isObject;\n","import baseGetTag from './_baseGetTag.js';\nimport isObject from './isObject.js';\n\n/** `Object#toString` result references. */\nvar asyncTag = '[object AsyncFunction]',\n    funcTag = '[object Function]',\n    genTag = '[object GeneratorFunction]',\n    proxyTag = '[object Proxy]';\n\n/**\n * Checks if `value` is classified as a `Function` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a function, else `false`.\n * @example\n *\n * _.isFunction(_);\n * // => true\n *\n * _.isFunction(/abc/);\n * // => false\n */\nfunction isFunction(value) {\n  if (!isObject(value)) {\n    return false;\n  }\n  // The use of `Object#toString` avoids issues with the `typeof` operator\n  // in Safari 9 which returns 'object' for typed arrays and other constructors.\n  var tag = baseGetTag(value);\n  return tag == funcTag || tag == genTag || tag == asyncTag || tag == proxyTag;\n}\n\nexport default isFunction;\n","import root from './_root.js';\n\n/** Used to detect overreaching core-js shims. */\nvar coreJsData = root['__core-js_shared__'];\n\nexport default coreJsData;\n","import coreJsData from './_coreJsData.js';\n\n/** Used to detect methods masquerading as native. */\nvar maskSrcKey = (function() {\n  var uid = /[^.]+$/.exec(coreJsData && coreJsData.keys && coreJsData.keys.IE_PROTO || '');\n  return uid ? ('Symbol(src)_1.' + uid) : '';\n}());\n\n/**\n * Checks if `func` has its source masked.\n *\n * @private\n * @param {Function} func The function to check.\n * @returns {boolean} Returns `true` if `func` is masked, else `false`.\n */\nfunction isMasked(func) {\n  return !!maskSrcKey && (maskSrcKey in func);\n}\n\nexport default isMasked;\n","/** Used for built-in method references. */\nvar funcProto = Function.prototype;\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/**\n * Converts `func` to its source code.\n *\n * @private\n * @param {Function} func The function to convert.\n * @returns {string} Returns the source code.\n */\nfunction toSource(func) {\n  if (func != null) {\n    try {\n      return funcToString.call(func);\n    } catch (e) {}\n    try {\n      return (func + '');\n    } catch (e) {}\n  }\n  return '';\n}\n\nexport default toSource;\n","import isFunction from './isFunction.js';\nimport isMasked from './_isMasked.js';\nimport isObject from './isObject.js';\nimport toSource from './_toSource.js';\n\n/**\n * Used to match `RegExp`\n * [syntax characters](http://ecma-international.org/ecma-262/7.0/#sec-patterns).\n */\nvar reRegExpChar = /[\\\\^$.*+?()[\\]{}|]/g;\n\n/** Used to detect host constructors (Safari). */\nvar reIsHostCtor = /^\\[object .+?Constructor\\]$/;\n\n/** Used for built-in method references. */\nvar funcProto = Function.prototype,\n    objectProto = Object.prototype;\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/** Used to detect if a method is native. */\nvar reIsNative = RegExp('^' +\n  funcToString.call(hasOwnProperty).replace(reRegExpChar, '\\\\$&')\n  .replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g, '$1.*?') + '$'\n);\n\n/**\n * The base implementation of `_.isNative` without bad shim checks.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a native function,\n *  else `false`.\n */\nfunction baseIsNative(value) {\n  if (!isObject(value) || isMasked(value)) {\n    return false;\n  }\n  var pattern = isFunction(value) ? reIsNative : reIsHostCtor;\n  return pattern.test(toSource(value));\n}\n\nexport default baseIsNative;\n","/**\n * Gets the value at `key` of `object`.\n *\n * @private\n * @param {Object} [object] The object to query.\n * @param {string} key The key of the property to get.\n * @returns {*} Returns the property value.\n */\nfunction getValue(object, key) {\n  return object == null ? undefined : object[key];\n}\n\nexport default getValue;\n","import baseIsNative from './_baseIsNative.js';\nimport getValue from './_getValue.js';\n\n/**\n * Gets the native function at `key` of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {string} key The key of the method to get.\n * @returns {*} Returns the function if it's native, else `undefined`.\n */\nfunction getNative(object, key) {\n  var value = getValue(object, key);\n  return baseIsNative(value) ? value : undefined;\n}\n\nexport default getNative;\n","import getNative from './_getNative.js';\n\n/* Built-in method references that are verified to be native. */\nvar nativeCreate = getNative(Object, 'create');\n\nexport default nativeCreate;\n","import nativeCreate from './_nativeCreate.js';\n\n/**\n * Removes all key-value entries from the hash.\n *\n * @private\n * @name clear\n * @memberOf Hash\n */\nfunction hashClear() {\n  this.__data__ = nativeCreate ? nativeCreate(null) : {};\n  this.size = 0;\n}\n\nexport default hashClear;\n","/**\n * Removes `key` and its value from the hash.\n *\n * @private\n * @name delete\n * @memberOf Hash\n * @param {Object} hash The hash to modify.\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction hashDelete(key) {\n  var result = this.has(key) && delete this.__data__[key];\n  this.size -= result ? 1 : 0;\n  return result;\n}\n\nexport default hashDelete;\n","import nativeCreate from './_nativeCreate.js';\n\n/** Used to stand-in for `undefined` hash values. */\nvar HASH_UNDEFINED = '__lodash_hash_undefined__';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Gets the hash value for `key`.\n *\n * @private\n * @name get\n * @memberOf Hash\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction hashGet(key) {\n  var data = this.__data__;\n  if (nativeCreate) {\n    var result = data[key];\n    return result === HASH_UNDEFINED ? undefined : result;\n  }\n  return hasOwnProperty.call(data, key) ? data[key] : undefined;\n}\n\nexport default hashGet;\n","import nativeCreate from './_nativeCreate.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Checks if a hash value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf Hash\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction hashHas(key) {\n  var data = this.__data__;\n  return nativeCreate ? (data[key] !== undefined) : hasOwnProperty.call(data, key);\n}\n\nexport default hashHas;\n","import nativeCreate from './_nativeCreate.js';\n\n/** Used to stand-in for `undefined` hash values. */\nvar HASH_UNDEFINED = '__lodash_hash_undefined__';\n\n/**\n * Sets the hash `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf Hash\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the hash instance.\n */\nfunction hashSet(key, value) {\n  var data = this.__data__;\n  this.size += this.has(key) ? 0 : 1;\n  data[key] = (nativeCreate && value === undefined) ? HASH_UNDEFINED : value;\n  return this;\n}\n\nexport default hashSet;\n","import hashClear from './_hashClear.js';\nimport hashDelete from './_hashDelete.js';\nimport hashGet from './_hashGet.js';\nimport hashHas from './_hashHas.js';\nimport hashSet from './_hashSet.js';\n\n/**\n * Creates a hash object.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction Hash(entries) {\n  var index = -1,\n      length = entries == null ? 0 : entries.length;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n// Add methods to `Hash`.\nHash.prototype.clear = hashClear;\nHash.prototype['delete'] = hashDelete;\nHash.prototype.get = hashGet;\nHash.prototype.has = hashHas;\nHash.prototype.set = hashSet;\n\nexport default Hash;\n","/**\n * Removes all key-value entries from the list cache.\n *\n * @private\n * @name clear\n * @memberOf ListCache\n */\nfunction listCacheClear() {\n  this.__data__ = [];\n  this.size = 0;\n}\n\nexport default listCacheClear;\n","/**\n * Performs a\n * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n * comparison between two values to determine if they are equivalent.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to compare.\n * @param {*} other The other value to compare.\n * @returns {boolean} Returns `true` if the values are equivalent, else `false`.\n * @example\n *\n * var object = { 'a': 1 };\n * var other = { 'a': 1 };\n *\n * _.eq(object, object);\n * // => true\n *\n * _.eq(object, other);\n * // => false\n *\n * _.eq('a', 'a');\n * // => true\n *\n * _.eq('a', Object('a'));\n * // => false\n *\n * _.eq(NaN, NaN);\n * // => true\n */\nfunction eq(value, other) {\n  return value === other || (value !== value && other !== other);\n}\n\nexport default eq;\n","import eq from './eq.js';\n\n/**\n * Gets the index at which the `key` is found in `array` of key-value pairs.\n *\n * @private\n * @param {Array} array The array to inspect.\n * @param {*} key The key to search for.\n * @returns {number} Returns the index of the matched value, else `-1`.\n */\nfunction assocIndexOf(array, key) {\n  var length = array.length;\n  while (length--) {\n    if (eq(array[length][0], key)) {\n      return length;\n    }\n  }\n  return -1;\n}\n\nexport default assocIndexOf;\n","import assocIndexOf from './_assocIndexOf.js';\n\n/** Used for built-in method references. */\nvar arrayProto = Array.prototype;\n\n/** Built-in value references. */\nvar splice = arrayProto.splice;\n\n/**\n * Removes `key` and its value from the list cache.\n *\n * @private\n * @name delete\n * @memberOf ListCache\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction listCacheDelete(key) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  if (index < 0) {\n    return false;\n  }\n  var lastIndex = data.length - 1;\n  if (index == lastIndex) {\n    data.pop();\n  } else {\n    splice.call(data, index, 1);\n  }\n  --this.size;\n  return true;\n}\n\nexport default listCacheDelete;\n","import assocIndexOf from './_assocIndexOf.js';\n\n/**\n * Gets the list cache value for `key`.\n *\n * @private\n * @name get\n * @memberOf ListCache\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction listCacheGet(key) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  return index < 0 ? undefined : data[index][1];\n}\n\nexport default listCacheGet;\n","import assocIndexOf from './_assocIndexOf.js';\n\n/**\n * Checks if a list cache value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf ListCache\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction listCacheHas(key) {\n  return assocIndexOf(this.__data__, key) > -1;\n}\n\nexport default listCacheHas;\n","import assocIndexOf from './_assocIndexOf.js';\n\n/**\n * Sets the list cache `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf ListCache\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the list cache instance.\n */\nfunction listCacheSet(key, value) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  if (index < 0) {\n    ++this.size;\n    data.push([key, value]);\n  } else {\n    data[index][1] = value;\n  }\n  return this;\n}\n\nexport default listCacheSet;\n","import listCacheClear from './_listCacheClear.js';\nimport listCacheDelete from './_listCacheDelete.js';\nimport listCacheGet from './_listCacheGet.js';\nimport listCacheHas from './_listCacheHas.js';\nimport listCacheSet from './_listCacheSet.js';\n\n/**\n * Creates an list cache object.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction ListCache(entries) {\n  var index = -1,\n      length = entries == null ? 0 : entries.length;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n// Add methods to `ListCache`.\nListCache.prototype.clear = listCacheClear;\nListCache.prototype['delete'] = listCacheDelete;\nListCache.prototype.get = listCacheGet;\nListCache.prototype.has = listCacheHas;\nListCache.prototype.set = listCacheSet;\n\nexport default ListCache;\n","import getNative from './_getNative.js';\nimport root from './_root.js';\n\n/* Built-in method references that are verified to be native. */\nvar Map = getNative(root, 'Map');\n\nexport default Map;\n","import Hash from './_Hash.js';\nimport ListCache from './_ListCache.js';\nimport Map from './_Map.js';\n\n/**\n * Removes all key-value entries from the map.\n *\n * @private\n * @name clear\n * @memberOf MapCache\n */\nfunction mapCacheClear() {\n  this.size = 0;\n  this.__data__ = {\n    'hash': new Hash,\n    'map': new (Map || ListCache),\n    'string': new Hash\n  };\n}\n\nexport default mapCacheClear;\n","/**\n * Checks if `value` is suitable for use as unique object key.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is suitable, else `false`.\n */\nfunction isKeyable(value) {\n  var type = typeof value;\n  return (type == 'string' || type == 'number' || type == 'symbol' || type == 'boolean')\n    ? (value !== '__proto__')\n    : (value === null);\n}\n\nexport default isKeyable;\n","import isKeyable from './_isKeyable.js';\n\n/**\n * Gets the data for `map`.\n *\n * @private\n * @param {Object} map The map to query.\n * @param {string} key The reference key.\n * @returns {*} Returns the map data.\n */\nfunction getMapData(map, key) {\n  var data = map.__data__;\n  return isKeyable(key)\n    ? data[typeof key == 'string' ? 'string' : 'hash']\n    : data.map;\n}\n\nexport default getMapData;\n","import getMapData from './_getMapData.js';\n\n/**\n * Removes `key` and its value from the map.\n *\n * @private\n * @name delete\n * @memberOf MapCache\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction mapCacheDelete(key) {\n  var result = getMapData(this, key)['delete'](key);\n  this.size -= result ? 1 : 0;\n  return result;\n}\n\nexport default mapCacheDelete;\n","import getMapData from './_getMapData.js';\n\n/**\n * Gets the map value for `key`.\n *\n * @private\n * @name get\n * @memberOf MapCache\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction mapCacheGet(key) {\n  return getMapData(this, key).get(key);\n}\n\nexport default mapCacheGet;\n","import getMapData from './_getMapData.js';\n\n/**\n * Checks if a map value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf MapCache\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction mapCacheHas(key) {\n  return getMapData(this, key).has(key);\n}\n\nexport default mapCacheHas;\n","import getMapData from './_getMapData.js';\n\n/**\n * Sets the map `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf MapCache\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the map cache instance.\n */\nfunction mapCacheSet(key, value) {\n  var data = getMapData(this, key),\n      size = data.size;\n\n  data.set(key, value);\n  this.size += data.size == size ? 0 : 1;\n  return this;\n}\n\nexport default mapCacheSet;\n","import mapCacheClear from './_mapCacheClear.js';\nimport mapCacheDelete from './_mapCacheDelete.js';\nimport mapCacheGet from './_mapCacheGet.js';\nimport mapCacheHas from './_mapCacheHas.js';\nimport mapCacheSet from './_mapCacheSet.js';\n\n/**\n * Creates a map cache object to store key-value pairs.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction MapCache(entries) {\n  var index = -1,\n      length = entries == null ? 0 : entries.length;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n// Add methods to `MapCache`.\nMapCache.prototype.clear = mapCacheClear;\nMapCache.prototype['delete'] = mapCacheDelete;\nMapCache.prototype.get = mapCacheGet;\nMapCache.prototype.has = mapCacheHas;\nMapCache.prototype.set = mapCacheSet;\n\nexport default MapCache;\n","import MapCache from './_MapCache.js';\n\n/** Error message constants. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/**\n * Creates a function that memoizes the result of `func`. If `resolver` is\n * provided, it determines the cache key for storing the result based on the\n * arguments provided to the memoized function. By default, the first argument\n * provided to the memoized function is used as the map cache key. The `func`\n * is invoked with the `this` binding of the memoized function.\n *\n * **Note:** The cache is exposed as the `cache` property on the memoized\n * function. Its creation may be customized by replacing the `_.memoize.Cache`\n * constructor with one whose instances implement the\n * [`Map`](http://ecma-international.org/ecma-262/7.0/#sec-properties-of-the-map-prototype-object)\n * method interface of `clear`, `delete`, `get`, `has`, and `set`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to have its output memoized.\n * @param {Function} [resolver] The function to resolve the cache key.\n * @returns {Function} Returns the new memoized function.\n * @example\n *\n * var object = { 'a': 1, 'b': 2 };\n * var other = { 'c': 3, 'd': 4 };\n *\n * var values = _.memoize(_.values);\n * values(object);\n * // => [1, 2]\n *\n * values(other);\n * // => [3, 4]\n *\n * object.a = 2;\n * values(object);\n * // => [1, 2]\n *\n * // Modify the result cache.\n * values.cache.set(object, ['a', 'b']);\n * values(object);\n * // => ['a', 'b']\n *\n * // Replace `_.memoize.Cache`.\n * _.memoize.Cache = WeakMap;\n */\nfunction memoize(func, resolver) {\n  if (typeof func != 'function' || (resolver != null && typeof resolver != 'function')) {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  var memoized = function() {\n    var args = arguments,\n        key = resolver ? resolver.apply(this, args) : args[0],\n        cache = memoized.cache;\n\n    if (cache.has(key)) {\n      return cache.get(key);\n    }\n    var result = func.apply(this, args);\n    memoized.cache = cache.set(key, result) || cache;\n    return result;\n  };\n  memoized.cache = new (memoize.Cache || MapCache);\n  return memoized;\n}\n\n// Expose `MapCache`.\nmemoize.Cache = MapCache;\n\nexport default memoize;\n","/**\n * JavaScriptCore <= 12 bug\n * @see https://bugs.webkit.org/show_bug.cgi?id=171606\n */\nexport const isTypedArrayIndexedPropertyWritable = Object.getOwnPropertyDescriptor(new Uint8Array(1), 0).writable;\n","/**\n * @param {unknown} target\n * @returns {number}\n */\nexport function ToInteger(target) {\n    let number = typeof target !== \"number\" ? Number(target) : target;\n    if (Number.isNaN(number)) {\n        number = 0;\n    }\n    return Math.trunc(number);\n}\n\n/**\n * @param {number} x\n * @param {number} y\n * @returns {-1 | 0 | 1}\n */\nexport function defaultCompareFunction(x, y) {\n    const [isNaN_x, isNaN_y] = [Number.isNaN(x), Number.isNaN(y)];\n\n    if (isNaN_x && isNaN_y) {\n        return 0;\n    }\n\n    if (isNaN_x) {\n        return 1;\n    }\n\n    if (isNaN_y) {\n        return -1;\n    }\n\n    if (x < y) {\n        return -1;\n    }\n\n    if (x > y) {\n        return 1;\n    }\n\n    if (x === 0 && y === 0) {\n        const [isPlusZero_x, isPlusZero_y] = [Object.is(x, 0), Object.is(y, 0)];\n\n        if (!isPlusZero_x && isPlusZero_y) {\n            return -1;\n        }\n\n        if (isPlusZero_x && !isPlusZero_y) {\n            return 1;\n        }\n    }\n\n    return 0;\n}\n","import { ToInteger } from \"./spec\";\n\nexport { default as isArrayBuffer } from \"lodash-es/isArrayBuffer\";\n\n/**\n * @param {unknown} view\n * @returns {boolean}\n */\nexport function isDataView(view) {\n    return view instanceof DataView;\n}\n\n/**\n * @param {unknown} key\n * @returns {boolean}\n */\nexport function isStringNumberKey(key) {\n    return typeof key === \"string\" && key === ToInteger(key) + \"\";\n}\n","/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return value != null && typeof value == 'object';\n}\n\nexport default isObjectLike;\n","import baseGetTag from './_baseGetTag.js';\nimport isObjectLike from './isObjectLike.js';\n\nvar arrayBufferTag = '[object ArrayBuffer]';\n\n/**\n * The base implementation of `_.isArrayBuffer` without Node.js optimizations.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an array buffer, else `false`.\n */\nfunction baseIsArrayBuffer(value) {\n  return isObjectLike(value) && baseGetTag(value) == arrayBufferTag;\n}\n\nexport default baseIsArrayBuffer;\n","/**\n * The base implementation of `_.unary` without support for storing metadata.\n *\n * @private\n * @param {Function} func The function to cap arguments for.\n * @returns {Function} Returns the new capped function.\n */\nfunction baseUnary(func) {\n  return function(value) {\n    return func(value);\n  };\n}\n\nexport default baseUnary;\n","import baseIsArrayBuffer from './_baseIsArrayBuffer.js';\nimport baseUnary from './_baseUnary.js';\nimport nodeUtil from './_nodeUtil.js';\n\n/* Node.js helper references. */\nvar nodeIsArrayBuffer = nodeUtil && nodeUtil.isArrayBuffer;\n\n/**\n * Checks if `value` is classified as an `ArrayBuffer` object.\n *\n * @static\n * @memberOf _\n * @since 4.3.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an array buffer, else `false`.\n * @example\n *\n * _.isArrayBuffer(new ArrayBuffer(2));\n * // => true\n *\n * _.isArrayBuffer(new Array(2));\n * // => false\n */\nvar isArrayBuffer = nodeIsArrayBuffer ? baseUnary(nodeIsArrayBuffer) : baseIsArrayBuffer;\n\nexport default isArrayBuffer;\n","/**\n * @returns {(self:object) => object}\n */\nexport function createPrivateStorage() {\n\tconst wm = new WeakMap();\n\treturn (self) => {\n\t\tlet obj = wm.get(self);\n\t\tif (obj) {\n\t\t\treturn obj;\n\t\t} else {\n\t\t\tobj = Object.create(null);\n\t\t\twm.set(self, obj);\n\t\t\treturn obj;\n\t\t}\n\t};\n}\n","import memoize from \"lodash-es/memoize\";\nimport { isTypedArrayIndexedPropertyWritable } from \"./bug\";\nimport { isArrayBuffer, isStringNumberKey } from \"./is\";\nimport { convertToNumber, roundToFloat16Bits } from \"./lib\";\nimport { createPrivateStorage } from \"./private\";\nimport { ToInteger, defaultCompareFunction } from \"./spec\";\n\nconst _ = createPrivateStorage();\n\n/**\n * @param {unknown} target\n * @returns {boolean}\n */\nfunction isFloat16Array(target) {\n    return target instanceof Float16Array;\n}\n\n/**\n * @param {unknown} target\n * @throws {TypeError}\n */\nfunction assertFloat16Array(target) {\n    if (!isFloat16Array(target)) {\n        throw new TypeError(\"This is not a Float16Array\");\n    }\n}\n\n/**\n * @param {unknown} target\n * @returns {boolean}\n */\nfunction isDefaultFloat16ArrayMethods(target) {\n    return typeof target === \"function\" && defaultFloat16ArrayMethods.has(target);\n}\n\n/**\n * @param {Float16Array} float16bits\n * @return {number[]}\n */\nfunction copyToArray(float16bits) {\n    const length = float16bits.length;\n\n    const array = new Array(length);\n    for(let i = 0; i < length; ++i) {\n        array[i] = convertToNumber(float16bits[i]);\n    }\n\n    return array;\n}\n\n/** @type {ProxyHandler<Function>} */\nconst applyHandler = {\n    apply(func, thisArg, args) {\n        // peel off proxy\n        if (isFloat16Array(thisArg) && isDefaultFloat16ArrayMethods(func)) {\n            return Reflect.apply(func, _(thisArg).target ,args);\n        }\n\n        return Reflect.apply(func, thisArg, args);\n    },\n};\n\n/** @type {ProxyHandler<Float16Array>} */\nconst handler = {\n    get(target, key) {\n        let wrapper = null;\n        if (!isTypedArrayIndexedPropertyWritable) {\n            wrapper = target;\n            target = _(wrapper).target;\n        }\n\n        if (isStringNumberKey(key)) {\n            return Reflect.has(target, key) ? convertToNumber(Reflect.get(target, key)) : undefined;\n        } else {\n            const ret = wrapper !== null && Reflect.has(wrapper, key) ? Reflect.get(wrapper, key) : Reflect.get(target, key);\n\n            if (typeof ret !== \"function\") {\n                return ret;\n            }\n\n            // TypedArray methods can't be called by Proxy Object\n            let proxy = _(ret).proxy;\n\n            if (proxy === undefined) {\n                proxy = _(ret).proxy = new Proxy(ret, applyHandler);\n            }\n\n            return proxy;\n        }\n    },\n\n    set(target, key, value) {\n        let wrapper = null;\n        if (!isTypedArrayIndexedPropertyWritable) {\n            wrapper = target;\n            target = _(wrapper).target;\n        }\n\n        if (isStringNumberKey(key)) {\n            return Reflect.set(target, key, roundToFloat16Bits(value));\n        } else {\n            // frozen object can't change prototype property\n            if (wrapper !== null && (!Reflect.has(target, key) || Object.isFrozen(wrapper))) {\n                return Reflect.set(wrapper, key, value);\n            } else {\n                return Reflect.set(target, key, value);\n            }\n        }\n    },\n};\n\nif (!isTypedArrayIndexedPropertyWritable) {\n    handler.getPrototypeOf = (wrapper) => { return Reflect.getPrototypeOf(_(wrapper).target); };\n    handler.setPrototypeOf = (wrapper, prototype) => { return Reflect.setPrototypeOf(_(wrapper).target, prototype); };\n\n    handler.defineProperty = (wrapper, key, descriptor) => {\n        const target = _(wrapper).target;\n        return !Reflect.has(target, key) || Object.isFrozen(wrapper) ? Reflect.defineProperty(wrapper, key, descriptor) : Reflect.defineProperty(target, key, descriptor);\n    };\n    handler.deleteProperty = (wrapper, key) => {\n        const target = _(wrapper).target;\n        return Reflect.has(wrapper, key) ? Reflect.deleteProperty(wrapper, key) : Reflect.deleteProperty(target, key);\n    };\n\n    handler.has = (wrapper, key) => { return Reflect.has(wrapper, key) || Reflect.has(_(wrapper).target, key); };\n\n    handler.isExtensible = (wrapper) => { return Reflect.isExtensible(wrapper); };\n    handler.preventExtensions = (wrapper) => { return Reflect.preventExtensions(wrapper); };\n\n    handler.getOwnPropertyDescriptor = (wrapper, key) => { return Reflect.getOwnPropertyDescriptor(wrapper, key); };\n    handler.ownKeys = (wrapper) => { return Reflect.ownKeys(wrapper); };\n}\n\nexport default class Float16Array extends Uint16Array {\n\n    constructor(input, byteOffset, length) {\n        // input Float16Array\n        if (isFloat16Array(input)) {\n            super(_(input).target);\n\n        // 22.2.1.3, 22.2.1.4 TypedArray, Array, ArrayLike, Iterable\n        } else if (input !== null && typeof input === \"object\" && !isArrayBuffer(input)) {\n            // if input is not ArrayLike and Iterable, get Array\n            const arrayLike = !Reflect.has(input, \"length\") && input[Symbol.iterator] !== undefined ? [...input] : input;\n\n            const length = arrayLike.length;\n            super(length);\n\n            for(let i = 0; i < length; ++i) {\n                // super (Uint16Array)\n                this[i] = roundToFloat16Bits(arrayLike[i]);\n            }\n\n        // 22.2.1.2, 22.2.1.5 primitive, ArrayBuffer\n        } else {\n            switch(arguments.length) {\n                case 0:\n                    super();\n                    break;\n\n                case 1:\n                    super(input);\n                    break;\n\n                case 2:\n                    super(input, byteOffset);\n                    break;\n\n                case 3:\n                    super(input, byteOffset, length);\n                    break;\n\n                default:\n                    // @ts-ignore\n                    super(...arguments);\n            }\n        }\n\n        let proxy;\n\n        if (isTypedArrayIndexedPropertyWritable) {\n            proxy = new Proxy(this, handler);\n        } else {\n            const wrapper = Object.create(null);\n            _(wrapper).target = this;\n            proxy = new Proxy(wrapper, handler);\n        }\n\n        // proxy private storage\n        _(proxy).target = this;\n\n        // this private storage\n        _(this).proxy = proxy;\n\n        return proxy;\n    }\n\n    // static methods\n    static from(src, ...opts) {\n        if (opts.length === 0) {\n            return new Float16Array(Uint16Array.from(src, roundToFloat16Bits).buffer);\n        }\n\n        const mapFunc = opts[0];\n        const thisArg = opts[1];\n\n        return new Float16Array(Uint16Array.from(src, function (val, ...args) {\n            return roundToFloat16Bits(mapFunc.call(this, val, ...args));\n        }, thisArg).buffer);\n    }\n\n    static of(...args) {\n        return new Float16Array(args);\n    }\n\n    // iterate methods\n    * [Symbol.iterator]() {\n        for(const val of super[Symbol.iterator]()) {\n            yield convertToNumber(val);\n        }\n    }\n\n    keys() {\n        return super.keys();\n    }\n\n    * values() {\n        for(const val of super.values()) {\n            yield convertToNumber(val);\n        }\n    }\n\n    /** @type {() => IterableIterator<[number, number]>} */\n    * entries() {\n        for(const [i, val] of super.entries()) {\n            yield [i, convertToNumber(val)];\n        }\n    }\n\n    // functional methods\n    // @ts-ignore\n    map(callback, ...opts) {\n        assertFloat16Array(this);\n\n        const thisArg = opts[0];\n\n        const array = [];\n        for(let i = 0, l = this.length; i < l; ++i) {\n            const val = convertToNumber(this[i]);\n            array.push(callback.call(thisArg, val, i, _(this).proxy));\n        }\n\n        return new Float16Array(array);\n    }\n\n    // @ts-ignore\n    filter(callback, ...opts) {\n        assertFloat16Array(this);\n\n        const thisArg = opts[0];\n\n        const array = [];\n        for(let i = 0, l = this.length; i < l; ++i) {\n            const val = convertToNumber(this[i]);\n            if (callback.call(thisArg, val, i, _(this).proxy)) {\n                array.push(val);\n            }\n        }\n\n        return new Float16Array(array);\n    }\n\n    reduce(callback, ...opts) {\n        assertFloat16Array(this);\n\n        let val, start;\n\n        if (opts.length === 0) {\n            val = convertToNumber(this[0]);\n            start = 1;\n        } else {\n            val = opts[0];\n            start = 0;\n        }\n\n        for(let i = start, l = this.length; i < l; ++i) {\n            val = callback(val, convertToNumber(this[i]), i, _(this).proxy);\n        }\n\n        return val;\n    }\n\n    reduceRight(callback, ...opts) {\n        assertFloat16Array(this);\n\n        let val, start;\n\n        const length = this.length;\n        if (opts.length === 0) {\n            val = convertToNumber(this[length - 1]);\n            start = length - 1;\n        } else {\n            val = opts[0];\n            start = length;\n        }\n\n        for(let i = start; i--;) {\n            val = callback(val, convertToNumber(this[i]), i, _(this).proxy);\n        }\n\n        return val;\n    }\n\n    forEach(callback, ...opts) {\n        assertFloat16Array(this);\n\n        const thisArg = opts[0];\n\n        for(let i = 0, l = this.length; i < l; ++i) {\n            callback.call(thisArg, convertToNumber(this[i]), i, _(this).proxy);\n        }\n    }\n\n    find(callback, ...opts) {\n        assertFloat16Array(this);\n\n        const thisArg = opts[0];\n\n        for(let i = 0, l = this.length; i < l; ++i) {\n            const value = convertToNumber(this[i]);\n            if (callback.call(thisArg, value, i, _(this).proxy)) {\n                return value;\n            }\n        }\n    }\n\n    findIndex(callback, ...opts) {\n        assertFloat16Array(this);\n\n        const thisArg = opts[0];\n\n        for(let i = 0, l = this.length; i < l; ++i) {\n            const value = convertToNumber(this[i]);\n            if (callback.call(thisArg, value, i, _(this).proxy)) {\n                return i;\n            }\n        }\n\n        return -1;\n    }\n\n    every(callback, ...opts) {\n        assertFloat16Array(this);\n\n        const thisArg = opts[0];\n\n        for(let i = 0, l = this.length; i < l; ++i) {\n            if (!callback.call(thisArg, convertToNumber(this[i]), i, _(this).proxy)) {\n                return false;\n            }\n        }\n\n        return true;\n    }\n\n    some(callback, ...opts) {\n        assertFloat16Array(this);\n\n        const thisArg = opts[0];\n\n        for(let i = 0, l = this.length; i < l; ++i) {\n            if (callback.call(thisArg, convertToNumber(this[i]), i, _(this).proxy)) {\n                return true;\n            }\n        }\n\n        return false;\n    }\n\n    // change element methods\n    set(input, ...opts) {\n        assertFloat16Array(this);\n\n        const offset = opts[0];\n\n        let float16bits;\n\n        // input Float16Array\n        if (isFloat16Array(input)) {\n            float16bits = _(input).target;\n\n        // input others\n        } else {\n            const arrayLike = !Reflect.has(input, \"length\") && input[Symbol.iterator] !== undefined ? [...input] : input;\n            const length = arrayLike.length;\n\n            float16bits = new Uint16Array(length);\n            for(let i = 0, l = arrayLike.length; i < l; ++i) {\n                float16bits[i] = roundToFloat16Bits(arrayLike[i]);\n            }\n        }\n\n        super.set(float16bits, offset);\n    }\n\n    reverse() {\n        assertFloat16Array(this);\n\n        super.reverse();\n\n        return _(this).proxy;\n    }\n\n    fill(value, ...opts) {\n        assertFloat16Array(this);\n\n        super.fill(roundToFloat16Bits(value), ...opts);\n\n        return _(this).proxy;\n    }\n\n    copyWithin(target, start, ...opts) {\n        assertFloat16Array(this);\n\n        super.copyWithin(target, start, ...opts);\n\n        return _(this).proxy;\n    }\n\n    sort(...opts) {\n        assertFloat16Array(this);\n\n        let compareFunction = opts[0];\n\n        if (compareFunction === undefined) {\n            compareFunction = defaultCompareFunction;\n        }\n\n        const _convertToNumber = memoize(convertToNumber);\n\n        super.sort((x, y) => { return compareFunction(_convertToNumber(x), _convertToNumber(y)); });\n\n        return _(this).proxy;\n    }\n\n    // copy element methods\n    // @ts-ignore\n    slice(...opts) {\n        assertFloat16Array(this);\n\n        let float16bits;\n\n        // V8, SpiderMonkey, JavaScriptCore, Chakra throw TypeError\n        try {\n            float16bits = super.slice(...opts);\n        } catch(e) {\n            if (e instanceof TypeError) {\n                const uint16 = new Uint16Array(this.buffer, this.byteOffset, this.length);\n                float16bits = uint16.slice(...opts);\n            } else {\n                throw e;\n            }\n        }\n\n        return new Float16Array(float16bits.buffer);\n    }\n\n    // @ts-ignore\n    subarray(...opts) {\n        assertFloat16Array(this);\n\n        let float16bits;\n\n        // V8, SpiderMonkey, JavaScriptCore, Chakra throw TypeError\n        try {\n            float16bits = super.subarray(...opts);\n        } catch(e) {\n            if (e instanceof TypeError) {\n                const uint16 = new Uint16Array(this.buffer, this.byteOffset, this.length);\n                float16bits = uint16.subarray(...opts);\n            } else {\n                throw e;\n            }\n        }\n\n        return new Float16Array(float16bits.buffer, float16bits.byteOffset, float16bits.length);\n    }\n\n    // contains methods\n    indexOf(element, ...opts) {\n        assertFloat16Array(this);\n\n        const length = this.length;\n\n        let from = ToInteger(opts[0]);\n\n        if (from < 0) {\n            from += length;\n            if (from < 0) {\n                from = 0;\n            }\n        }\n\n        for(let i = from, l = length; i < l; ++i) {\n            if (convertToNumber(this[i]) === element) {\n                return i;\n            }\n        }\n\n        return -1;\n    }\n\n    lastIndexOf(element, ...opts) {\n        assertFloat16Array(this);\n\n        const length = this.length;\n\n        let from = ToInteger(opts[0]);\n\n        from = from === 0 ? length : from + 1;\n\n        if (from >= 0) {\n            from = from < length ? from : length;\n        } else {\n            from += length;\n        }\n\n        for(let i = from; i--;) {\n            if (convertToNumber(this[i]) === element) {\n                return i;\n            }\n        }\n\n        return -1;\n    }\n\n    includes(element, ...opts) {\n        assertFloat16Array(this);\n\n        const length = this.length;\n\n        let from = ToInteger(opts[0]);\n\n        if (from < 0) {\n            from += length;\n            if (from < 0) {\n                from = 0;\n            }\n        }\n\n        const isNaN = Number.isNaN(element);\n        for(let i = from, l = length; i < l; ++i) {\n            const value = convertToNumber(this[i]);\n\n            if (isNaN && Number.isNaN(value)) {\n                return true;\n            }\n\n            if (value === element) {\n                return true;\n            }\n        }\n\n        return false;\n    }\n\n    // string methods\n    join(...opts) {\n        assertFloat16Array(this);\n\n        const array = copyToArray(this);\n\n        return array.join(...opts);\n    }\n\n    toLocaleString(...opts) {\n        assertFloat16Array(this);\n\n        const array = copyToArray(this);\n\n        // @ts-ignore\n        return array.toLocaleString(...opts);\n    }\n\n    // @ts-ignore\n    get [Symbol.toStringTag]() {\n        if (isFloat16Array(this)) {\n            return \"Float16Array\";\n        }\n    }\n}\n\nconst Float16Array$prototype = Float16Array.prototype;\n\nconst defaultFloat16ArrayMethods = new WeakSet();\nfor(const key of Reflect.ownKeys(Float16Array$prototype)) {\n    const val = Float16Array$prototype[key];\n    if (typeof val === \"function\") {\n        defaultFloat16ArrayMethods.add(val);\n    }\n}\n","import { isDataView } from \"./is\";\nimport { convertToNumber, roundToFloat16Bits } from \"./lib\";\n\n/**\n * returns an unsigned 16-bit float at the specified byte offset from the start of the DataView.\n * @param {DataView} dataView\n * @param {number} byteOffset\n * @param {[boolean]} opts\n * @returns {number}\n */\nexport function getFloat16(dataView, byteOffset, ...opts) {\n    if (!isDataView(dataView)) {\n        throw new TypeError(\"First argument to getFloat16 function must be a DataView\");\n    }\n\n    return convertToNumber( dataView.getUint16(byteOffset, ...opts) );\n}\n\n/**\n * stores an unsigned 16-bit float value at the specified byte offset from the start of the DataView.\n * @param {DataView} dataView\n * @param {number} byteOffset\n * @param {number} value\n * @param {[boolean]} opts\n */\nexport function setFloat16(dataView, byteOffset, value, ...opts) {\n    if (!isDataView(dataView)) {\n        throw new TypeError(\"First argument to setFloat16 function must be a DataView\");\n    }\n\n    dataView.setUint16(byteOffset, roundToFloat16Bits(value), ...opts);\n}\n","export { default as hfround } from \"./hfround\";\nexport { default as Float16Array } from \"./Float16Array\";\nexport { getFloat16, setFloat16 } from \"./dataView.js\";\n","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.changeDpiBlob = changeDpiBlob;\nexports.changeDpiDataUrl = changeDpiDataUrl;\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\nfunction createPngDataTable() {\n  /* Table of CRCs of all 8-bit messages. */\n  var crcTable = new Int32Array(256);\n  for (var n = 0; n < 256; n++) {\n    var c = n;\n    for (var k = 0; k < 8; k++) {\n      c = c & 1 ? 0xedb88320 ^ c >>> 1 : c >>> 1;\n    }\n    crcTable[n] = c;\n  }\n  return crcTable;\n}\n\nfunction calcCrc(buf) {\n  var c = -1;\n  if (!pngDataTable) pngDataTable = createPngDataTable();\n  for (var n = 0; n < buf.length; n++) {\n    c = pngDataTable[(c ^ buf[n]) & 0xFF] ^ c >>> 8;\n  }\n  return c ^ -1;\n}\n\nvar pngDataTable = void 0;\n\nvar PNG = 'image/png';\nvar JPEG = 'image/jpeg';\n\n// those are 3 possible signature of the physBlock in base64.\n// the pHYs signature block is preceed by the 4 bytes of lenght. The length of\n// the block is always 9 bytes. So a phys block has always this signature:\n// 0 0 0 9 p H Y s.\n// However the data64 encoding aligns we will always find one of those 3 strings.\n// this allow us to find this particular occurence of the pHYs block without\n// converting from b64 back to string\nvar b64PhysSignature1 = 'AAlwSFlz';\nvar b64PhysSignature2 = 'AAAJcEhZ';\nvar b64PhysSignature3 = 'AAAACXBI';\n\nvar _P = 'p'.charCodeAt(0);\nvar _H = 'H'.charCodeAt(0);\nvar _Y = 'Y'.charCodeAt(0);\nvar _S = 's'.charCodeAt(0);\n\nfunction changeDpiBlob(blob, dpi) {\n  // 33 bytes are ok for pngs and jpegs\n  // to contain the information.\n  var headerChunk = blob.slice(0, 33);\n  return new Promise(function (resolve, reject) {\n    var fileReader = new FileReader();\n    fileReader.onload = function () {\n      var dataArray = new Uint8Array(fileReader.result);\n      var tail = blob.slice(33);\n      var changedArray = changeDpiOnArray(dataArray, dpi, blob.type);\n      resolve(new Blob([changedArray, tail], { type: blob.type }));\n    };\n    fileReader.readAsArrayBuffer(headerChunk);\n  });\n}\n\nfunction changeDpiDataUrl(base64Image, dpi) {\n  var dataSplitted = base64Image.split(',');\n  var format = dataSplitted[0];\n  var body = dataSplitted[1];\n  var type = void 0;\n  var headerLength = void 0;\n  var overwritepHYs = false;\n  if (format.indexOf(PNG) !== -1) {\n    type = PNG;\n    var b64Index = detectPhysChunkFromDataUrl(body);\n    // 28 bytes in dataUrl are 21bytes, length of phys chunk with everything inside.\n    if (b64Index >= 0) {\n      headerLength = Math.ceil((b64Index + 28) / 3) * 4;\n      overwritepHYs = true;\n    } else {\n      headerLength = 33 / 3 * 4;\n    }\n  }\n  if (format.indexOf(JPEG) !== -1) {\n    type = JPEG;\n    headerLength = 18 / 3 * 4;\n  }\n  // 33 bytes are ok for pngs and jpegs\n  // to contain the information.\n  var stringHeader = body.substring(0, headerLength);\n  var restOfData = body.substring(headerLength);\n  var headerBytes = atob(stringHeader);\n  var dataArray = new Uint8Array(headerBytes.length);\n  for (var i = 0; i < dataArray.length; i++) {\n    dataArray[i] = headerBytes.charCodeAt(i);\n  }\n  var finalArray = changeDpiOnArray(dataArray, dpi, type, overwritepHYs);\n  var base64Header = btoa(String.fromCharCode.apply(String, _toConsumableArray(finalArray)));\n  return [format, ',', base64Header, restOfData].join('');\n}\n\nfunction detectPhysChunkFromDataUrl(data) {\n  var b64index = data.indexOf(b64PhysSignature1);\n  if (b64index === -1) {\n    b64index = data.indexOf(b64PhysSignature2);\n  }\n  if (b64index === -1) {\n    b64index = data.indexOf(b64PhysSignature3);\n  }\n  // if b64index === -1 chunk is not found\n  return b64index;\n}\n\nfunction searchStartOfPhys(data) {\n  var length = data.length - 1;\n  // we check from the end since we cut the string in proximity of the header\n  // the header is within 21 bytes from the end.\n  for (var i = length; i >= 4; i--) {\n    if (data[i - 4] === 9 && data[i - 3] === _P && data[i - 2] === _H && data[i - 1] === _Y && data[i] === _S) {\n      return i - 3;\n    }\n  }\n}\n\nfunction changeDpiOnArray(dataArray, dpi, format, overwritepHYs) {\n  if (format === JPEG) {\n    dataArray[13] = 1; // 1 pixel per inch or 2 pixel per cm\n    dataArray[14] = dpi >> 8; // dpiX high byte\n    dataArray[15] = dpi & 0xff; // dpiX low byte\n    dataArray[16] = dpi >> 8; // dpiY high byte\n    dataArray[17] = dpi & 0xff; // dpiY low byte\n    return dataArray;\n  }\n  if (format === PNG) {\n    var physChunk = new Uint8Array(13);\n    // chunk header pHYs\n    // 9 bytes of data\n    // 4 bytes of crc\n    // this multiplication is because the standard is dpi per meter.\n    dpi *= 39.3701;\n    physChunk[0] = _P;\n    physChunk[1] = _H;\n    physChunk[2] = _Y;\n    physChunk[3] = _S;\n    physChunk[4] = dpi >>> 24; // dpiX highest byte\n    physChunk[5] = dpi >>> 16; // dpiX veryhigh byte\n    physChunk[6] = dpi >>> 8; // dpiX high byte\n    physChunk[7] = dpi & 0xff; // dpiX low byte\n    physChunk[8] = physChunk[4]; // dpiY highest byte\n    physChunk[9] = physChunk[5]; // dpiY veryhigh byte\n    physChunk[10] = physChunk[6]; // dpiY high byte\n    physChunk[11] = physChunk[7]; // dpiY low byte\n    physChunk[12] = 1; // dot per meter....\n\n    var crc = calcCrc(physChunk);\n\n    var crcChunk = new Uint8Array(4);\n    crcChunk[0] = crc >>> 24;\n    crcChunk[1] = crc >>> 16;\n    crcChunk[2] = crc >>> 8;\n    crcChunk[3] = crc & 0xff;\n\n    if (overwritepHYs) {\n      var startingIndex = searchStartOfPhys(dataArray);\n      dataArray.set(physChunk, startingIndex);\n      dataArray.set(crcChunk, startingIndex + 13);\n      return dataArray;\n    } else {\n      // i need to give back an array of data that is divisible by 3 so that\n      // dataurl encoding gives me integers, for luck this chunk is 17 + 4 = 21\n      // if it was we could add a text chunk contaning some info, untill desired\n      // length is met.\n\n      // chunk structur 4 bytes for length is 9\n      var chunkLength = new Uint8Array(4);\n      chunkLength[0] = 0;\n      chunkLength[1] = 0;\n      chunkLength[2] = 0;\n      chunkLength[3] = 9;\n\n      var finalHeader = new Uint8Array(54);\n      finalHeader.set(dataArray, 0);\n      finalHeader.set(chunkLength, 33);\n      finalHeader.set(physChunk, 37);\n      finalHeader.set(crcChunk, 50);\n      return finalHeader;\n    }\n  }\n}","(function(a,b){if(\"function\"==typeof define&&define.amd)define([],b);else if(\"undefined\"!=typeof exports)b();else{b(),a.FileSaver={exports:{}}.exports}})(this,function(){\"use strict\";function b(a,b){return\"undefined\"==typeof b?b={autoBom:!1}:\"object\"!=typeof b&&(console.warn(\"Deprecated: Expected third argument to be a object\"),b={autoBom:!b}),b.autoBom&&/^\\s*(?:text\\/\\S*|application\\/xml|\\S*\\/\\S*\\+xml)\\s*;.*charset\\s*=\\s*utf-8/i.test(a.type)?new Blob([\"\\uFEFF\",a],{type:a.type}):a}function c(a,b,c){var d=new XMLHttpRequest;d.open(\"GET\",a),d.responseType=\"blob\",d.onload=function(){g(d.response,b,c)},d.onerror=function(){console.error(\"could not download file\")},d.send()}function d(a){var b=new XMLHttpRequest;b.open(\"HEAD\",a,!1);try{b.send()}catch(a){}return 200<=b.status&&299>=b.status}function e(a){try{a.dispatchEvent(new MouseEvent(\"click\"))}catch(c){var b=document.createEvent(\"MouseEvents\");b.initMouseEvent(\"click\",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),a.dispatchEvent(b)}}var f=\"object\"==typeof window&&window.window===window?window:\"object\"==typeof self&&self.self===self?self:\"object\"==typeof global&&global.global===global?global:void 0,a=f.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),g=f.saveAs||(\"object\"!=typeof window||window!==f?function(){}:\"download\"in HTMLAnchorElement.prototype&&!a?function(b,g,h){var i=f.URL||f.webkitURL,j=document.createElement(\"a\");g=g||b.name||\"download\",j.download=g,j.rel=\"noopener\",\"string\"==typeof b?(j.href=b,j.origin===location.origin?e(j):d(j.href)?c(b,g,h):e(j,j.target=\"_blank\")):(j.href=i.createObjectURL(b),setTimeout(function(){i.revokeObjectURL(j.href)},4E4),setTimeout(function(){e(j)},0))}:\"msSaveOrOpenBlob\"in navigator?function(f,g,h){if(g=g||f.name||\"download\",\"string\"!=typeof f)navigator.msSaveOrOpenBlob(b(f,h),g);else if(d(f))c(f,g,h);else{var i=document.createElement(\"a\");i.href=f,i.target=\"_blank\",setTimeout(function(){e(i)})}}:function(b,d,e,g){if(g=g||open(\"\",\"_blank\"),g&&(g.document.title=g.document.body.innerText=\"downloading...\"),\"string\"==typeof b)return c(b,d,e);var h=\"application/octet-stream\"===b.type,i=/constructor/i.test(f.HTMLElement)||f.safari,j=/CriOS\\/[\\d]+/.test(navigator.userAgent);if((j||h&&i||a)&&\"undefined\"!=typeof FileReader){var k=new FileReader;k.onloadend=function(){var a=k.result;a=j?a:a.replace(/^data:[^;]*;/,\"data:attachment/file;\"),g?g.location.href=a:location=a,g=null},k.readAsDataURL(b)}else{var l=f.URL||f.webkitURL,m=l.createObjectURL(b);g?g.location=m:location.href=m,g=null,setTimeout(function(){l.revokeObjectURL(m)},4E4)}});f.saveAs=g.saveAs=g,\"undefined\"!=typeof module&&(module.exports=g)});\n\n//# sourceMappingURL=FileSaver.min.js.map","/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\nexport default freeGlobal;\n","import freeGlobal from './_freeGlobal.js';\n\n/** Detect free variable `exports`. */\nvar freeExports = typeof exports == 'object' && exports && !exports.nodeType && exports;\n\n/** Detect free variable `module`. */\nvar freeModule = freeExports && typeof module == 'object' && module && !module.nodeType && module;\n\n/** Detect the popular CommonJS extension `module.exports`. */\nvar moduleExports = freeModule && freeModule.exports === freeExports;\n\n/** Detect free variable `process` from Node.js. */\nvar freeProcess = moduleExports && freeGlobal.process;\n\n/** Used to access faster Node.js helpers. */\nvar nodeUtil = (function() {\n  try {\n    // Use `util.types` for Node.js 10+.\n    var types = freeModule && freeModule.require && freeModule.require('util').types;\n\n    if (types) {\n      return types;\n    }\n\n    // Legacy `process.binding('util')` for Node.js < 10.\n    return freeProcess && freeProcess.binding && freeProcess.binding('util');\n  } catch (e) {}\n}());\n\nexport default nodeUtil;\n","import {\n\tvalidDataTypes,\n\tvalidFilters,\n\tvalidWraps,\n\tvalidTextureFormats,\n\tvalidTextureTypes,\n\tDataLayerType,\n\tHALF_FLOAT,\n\tFLOAT,\n\tBYTE,\n\tSHORT,\n\tINT,\n\tUNSIGNED_BYTE,\n\tUNSIGNED_SHORT,\n\tUNSIGNED_INT,\n} from './Constants';\n\nexport function isValidDataType(type: string) {\n\treturn validDataTypes.indexOf(type) > -1;\n}\n\nexport function isValidFilter(type: string) {\n\treturn validFilters.indexOf(type) > -1;\n}\n\nexport function isValidWrap(type: string) {\n\treturn validWraps.indexOf(type) > -1;\n}\n\n// For image urls that are passed in and inited as textures.\nexport function isValidTextureFormat(type: string) {\n\treturn validTextureFormats.indexOf(type) > -1;\n}\nexport function isValidTextureType(type: string) {\n\treturn validTextureTypes.indexOf(type) > -1;\n}\n\nexport function isValidClearValue(clearValue: number | number[], numComponents: number, type: DataLayerType) {\n\tif (isArray(clearValue)) {\n\t\t// Length of clearValue must match numComponents.\n\t\tif ((clearValue as number[]).length !== numComponents) {\n\t\t\treturn false;\n\t\t}\n\t\tfor (let i = 0; i < (clearValue as number[]).length; i++) {\n\t\t\tif (!isNumberOfType((clearValue as number[])[i], type)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t} else {\n\t\tif (!isNumberOfType(clearValue, type)) {\n\t\t\treturn false;\n\t\t}\n\t}\n\treturn true;\n}\n\nexport function isNumberOfType(value: any, type: DataLayerType) {\n\tswitch (type) {\n\t\tcase HALF_FLOAT:\n\t\tcase FLOAT:\n\t\t\treturn isNumber(value);\n\t\tcase BYTE:\n\t\tcase SHORT:\n\t\tcase INT:\n\t\t\treturn isInteger(value);\n\t\tcase UNSIGNED_BYTE:\n\t\tcase UNSIGNED_SHORT:\n\t\tcase UNSIGNED_INT:\n\t\t\treturn isNonNegativeInteger(value);\n\t\tdefault:\n\t\t\tthrow new Error(`Unknown type ${type}`);\n\t}\n}\n\nexport function isNumber(value: any) {\n\treturn !isNaN(value);\n}\n\nexport function isInteger(value: any) {\n\treturn isNumber(value) && (value % 1 === 0);\n}\n\nexport function isPositiveInteger(value: any) {\n\treturn isInteger(value) &&  value > 0;\n}\n\nexport function isNonNegativeInteger(value: any) {\n\treturn isInteger(value) &&  value >= 0;\n}\n\nexport function isString(value: any){\n\treturn typeof value === 'string';\n}\n\nexport function isArray(value: any) {\n\treturn Array.isArray(value);\n}\n\nexport function isBoolean(value: any) {\n\treturn typeof value === 'boolean';\n}","export const HALF_FLOAT = 'HALF_FLOAT';\nexport const FLOAT = 'FLOAT';\nexport const UNSIGNED_BYTE = 'UNSIGNED_BYTE';\nexport const BYTE = 'BYTE';\nexport const UNSIGNED_SHORT = 'UNSIGNED_SHORT';\nexport const SHORT = 'SHORT';\nexport const UNSIGNED_INT = 'UNSIGNED_INT';\nexport const INT = 'INT';\nexport const BOOL = 'BOOL';\nexport const UINT = 'UINT';\n\nexport const LINEAR = 'LINEAR';\nexport const NEAREST = 'NEAREST';\n\nexport const REPEAT = 'REPEAT';\nexport const CLAMP_TO_EDGE = 'CLAMP_TO_EDGE';\n// export const MIRRORED_REPEAT = 'MIRRORED_REPEAT';\n\nexport const RGB = 'RGB';\nexport const RGBA = 'RGBA';\n\nexport type DataLayerArray =  Float32Array | Uint8Array | Int8Array | Uint16Array | Int16Array | Uint32Array | Int32Array;\nexport const validArrayTypes = [Float32Array, Uint8Array, Int8Array, Uint16Array, Int16Array, Uint32Array, Int32Array, Array];\nexport type DataLayerType = typeof HALF_FLOAT | typeof FLOAT | typeof UNSIGNED_BYTE | typeof BYTE | typeof UNSIGNED_SHORT | typeof SHORT | typeof UNSIGNED_INT | typeof INT;\nexport const validDataTypes = [HALF_FLOAT, FLOAT, UNSIGNED_BYTE, BYTE, UNSIGNED_SHORT, SHORT, UNSIGNED_INT, INT];\nexport type DataLayerNumComponents = 1 | 2 | 3 | 4;\nexport type DataLayerFilter = typeof LINEAR | typeof NEAREST;\nexport const validFilters = [LINEAR, NEAREST];\nexport const validWraps = [CLAMP_TO_EDGE, REPEAT]; // MIRRORED_REPEAT\nexport type DataLayerWrap = typeof REPEAT | typeof CLAMP_TO_EDGE;// | typeof MIRRORED_REPEAT;\n\n// For image urls that are passed in and inited as textures.\nexport type TextureFormat = typeof RGB | typeof RGBA;\nexport const validTextureFormats = [RGB, RGBA];\nexport type TextureType = typeof UNSIGNED_BYTE;\nexport const validTextureTypes = [UNSIGNED_BYTE];\n\nexport const GLSL3 = '300 es';\nexport const GLSL1 = '100';\nexport type GLSLVersion = typeof GLSL1 | typeof GLSL3;\n\n// Uniform types.\nexport const FLOAT_1D_UNIFORM = '1f';\nexport const FLOAT_2D_UNIFORM = '2f';\nexport const FLOAT_3D_UNIFORM = '3f';\nexport const FLOAT_4D_UNIFORM = '3f';\nexport const INT_1D_UNIFORM = '1i';\nexport const INT_2D_UNIFORM = '2i';\nexport const INT_3D_UNIFORM = '3i';\nexport const INT_4D_UNIFORM = '3i';\n\nexport type UniformType = typeof FLOAT | typeof INT |  typeof BOOL;\nexport type UniformInternalType = \n\ttypeof FLOAT_1D_UNIFORM |\n\ttypeof FLOAT_2D_UNIFORM |\n\ttypeof FLOAT_3D_UNIFORM |\n\ttypeof FLOAT_4D_UNIFORM |\n\ttypeof INT_1D_UNIFORM |\n\ttypeof INT_2D_UNIFORM |\n\ttypeof INT_3D_UNIFORM |\n\ttypeof INT_4D_UNIFORM;\nexport type UniformValue = boolean | number | number[];\nexport type Uniform = { \n\tlocation: { [key: string]: WebGLUniformLocation },\n\ttype: UniformInternalType,\n\tvalue: UniformValue,\n};\n\n// Vertex shaders.\nexport const DEFAULT_PROGRAM_NAME = 'DEFAULT';\nexport const DEFAULT_W_UV_PROGRAM_NAME = 'DEFAULT_W_UV';\nexport const DEFAULT_W_NORMAL_PROGRAM_NAME = 'DEFAULT_W_NORMAL';\nexport const DEFAULT_W_UV_NORMAL_PROGRAM_NAME = 'DEFAULT_W_UV_NORMAL';\nexport const SEGMENT_PROGRAM_NAME = 'SEGMENT';\nexport const DATA_LAYER_POINTS_PROGRAM_NAME = 'DATA_LAYER_POINTS';\nexport const DATA_LAYER_LINES_PROGRAM_NAME = 'DATA_LAYER_LINES';\nexport const DATA_LAYER_VECTOR_FIELD_PROGRAM_NAME = 'DATA_LAYER_VECTOR_FIELD';\nexport type PROGRAM_NAME_INTERNAL =\n\ttypeof DEFAULT_PROGRAM_NAME |\n\ttypeof DEFAULT_W_UV_PROGRAM_NAME |\n\ttypeof DEFAULT_W_NORMAL_PROGRAM_NAME |\n\ttypeof DEFAULT_W_UV_NORMAL_PROGRAM_NAME |\n\ttypeof SEGMENT_PROGRAM_NAME |\n\ttypeof DATA_LAYER_POINTS_PROGRAM_NAME |\n\ttypeof DATA_LAYER_LINES_PROGRAM_NAME |\n\ttypeof DATA_LAYER_VECTOR_FIELD_PROGRAM_NAME;\n\n// Pass in #defines as strings to make it easier to control float vs int.\nexport type CompileTimeVars = { [key: string]: string };\n\nexport type DataLayerBuffer = {\n\ttexture: WebGLTexture,\n\tframebuffer?: WebGLFramebuffer,\n}\n\nexport type ErrorCallback = (message: string) => void;\n\nexport const DEFAULT_CIRCLE_NUM_SEGMENTS = 18;// Must be divisible by 6 to work with stepSegment().","import { setFloat16 } from '@petamoriken/float16';\nimport { WebGLCompute } from '.';\nimport {\n\tisNumber,\n\tisPositiveInteger,\n\tisValidClearValue,\n\tisValidDataType,\n\tisValidFilter,\n\tisValidWrap,\n} from './Checks';\nimport {\n\tHALF_FLOAT,\n\tFLOAT,\n\tUNSIGNED_BYTE,\n\tBYTE,\n\tUNSIGNED_SHORT,\n\tSHORT,\n\tUNSIGNED_INT,\n\tINT,\n\tNEAREST,\n\tLINEAR,\n\tCLAMP_TO_EDGE,\n\tDataLayerArray,\n\tDataLayerFilter,\n\tDataLayerNumComponents,\n\tDataLayerType,\n\tDataLayerWrap,\n\tGLSLVersion,\n\tGLSL3,\n\tGLSL1,\n\tDataLayerBuffer,\n\tErrorCallback,\n\tvalidArrayTypes,\n\tvalidFilters,\n\tvalidWraps,\n\tvalidDataTypes,\n } from './Constants';\nimport {\n\tgetExtension,\n\tEXT_COLOR_BUFFER_FLOAT,\n\tOES_TEXTURE_FLOAT,\n\tOES_TEXTURE_FLOAT_LINEAR,\n\tOES_TEXTURE_HALF_FLOAT,\n\tOES_TEXTURE_HAlF_FLOAT_LINEAR,\n} from './extensions';\nimport {\n\tinDevMode,\n\tisWebGL2,\n} from './utils';\n\nexport class DataLayer {\n\t// Keep a reference to WebGLCompute.\n\tprivate readonly glcompute: WebGLCompute;\n\n\treadonly name: string; // Name of DataLayer, used for error logging.\n\treadonly type: DataLayerType; // Input type passed in during setup.\n\treadonly numComponents: DataLayerNumComponents; // Number of RGBA channels to use for this DataLayer.\n\treadonly filter: DataLayerFilter; // Interpolation filter for pixel read operations.\n\treadonly wrapS: DataLayerWrap; // Input wrap type passed in during setup.\n\treadonly wrapT: DataLayerWrap; // Input wrap type passed in during setup.\n\treadonly writable: boolean;\n\tprivate _clearValue!: number | number[]; // Value to set when clear() is called.\n\n\t// Each DataLayer may contain a number of buffers to store different instances of the state.\n\t// e.g [currentState, previousState]\n\tprivate _bufferIndex = 0;\n\treadonly numBuffers;\n\tprivate readonly buffers: DataLayerBuffer[] = [];\n\n\t// Texture sizes.\n\t_length?: number; // This is only used for 1D data layers, _length is used internally, access with DataLayer.length.\n\tprivate _width: number; // Access with DataLayer.width.\n\tprivate _height: number; // Access with DataLayer.height.\n\n\t// DataLayer settings.\n\t// Due to variable browser support of WebGL features, \"internal\" variables may be different\n\t// from the parameter originally passed in.  These variables are set so that they match the original\n\t// parameter as best as possible, but fragment shader polyfills may be required.\n\t// All \"gl\" variables are used to initialize internal WebGLTexture.\n\t// https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/texImage2D\n\t// https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/texParameter\n\treadonly glInternalFormat: number;\n\treadonly glFormat: number;\n\t// DataLayer.internalType corresponds to DataLayer.glType, may be different from DataLayer.type.\n\treadonly internalType: DataLayerType; \n\treadonly glType: number;\n\t// Internally, DataLayer.glNumChannels may represent a larger number of channels than DataLayer.numComponents.\n\t// For example, writable RGB textures are not supported in WebGL2, must use RGBA instead.\n\treadonly glNumChannels: number;\n\t// DataLayer.internalFilter corresponds to DataLayer.glFilter, may be different from DataLayer.filter.\n\treadonly internalFilter: DataLayerFilter;\n\treadonly glFilter: number;\n\t// DataLayer.internalWrapS corresponds to DataLayer.glWrapS, may be different from DataLayer.wrapS.\n\treadonly internalWrapS: DataLayerWrap;\n\treadonly glWrapS: number;\n\t// DataLayer.internalWrapT corresponds to DataLayer.glWrapS, may be different from DataLayer.wrapT.\n\treadonly internalWrapT: DataLayerWrap;\n\treadonly glWrapT: number;\n\t\n\t// Optimizations so that \"copying\" can happen without draw calls.\n\tprivate textureOverrides?: (WebGLTexture | undefined)[];\n\n\tconstructor(\n\t\tglcompute: WebGLCompute,\n\t\tparams: {\n\t\t\tname: string,\n\t\t\tdimensions: number | [number, number],\n\t\t\ttype: DataLayerType,\n\t\t\tnumComponents: DataLayerNumComponents,\n\t\t\tarray?: DataLayerArray | number[],\n\t\t\tfilter?: DataLayerFilter,\n\t\t\twrapS?: DataLayerWrap,\n\t\t\twrapT?: DataLayerWrap,\n\t\t\twritable?: boolean,\n\t\t\tnumBuffers?: number,\n\t\t\tclearValue?: number | number[],\n\t\t},\n\t) {\n\t\tconst { name, dimensions, type, numComponents, array } = params;\n\t\tconst { gl, _errorCallback, glslVersion } = glcompute;\n\n\t\t// Save params.\n\t\tthis.glcompute = glcompute;\n\t\tthis.name = name;\n\n\t\t// numComponents must be between 1 and 4.\n\t\tif (!isPositiveInteger(numComponents) || numComponents > 4) {\n\t\t\tthrow new Error(`Invalid numComponents: ${numComponents} for DataLayer \"${name}\".`);\n\t\t}\n\t\tthis.numComponents = numComponents;\n\n\t\t// Writable defaults to false.\n\t\tconst writable = !!params.writable;\n\t\tthis.writable = writable;\n\n\t\t// Set dimensions, may be 1D or 2D.\n\t\tconst { length, width, height } = DataLayer.calcSize(dimensions, name);\n\t\tthis._length = length;\n\t\tif (!isPositiveInteger(width)) {\n\t\t\tthrow new Error(`Invalid width: ${width} for DataLayer \"${name}\".`);\n\t\t}\n\t\tthis._width = width;\n\t\tif (!isPositiveInteger(height)) {\n\t\t\tthrow new Error(`Invalid length: ${height} for DataLayer \"${name}\".`);\n\t\t}\n\t\tthis._height = height;\n\n\t\t// Set filtering - if we are processing a 1D array, default to NEAREST filtering.\n\t\t// Else default to LINEAR (interpolation) filtering for float types and NEAREST for integer types.\n\t\tconst defaultFilter = length ? NEAREST : ((type === FLOAT || type == HALF_FLOAT) ? LINEAR : NEAREST);\n\t\tconst filter = params.filter !== undefined ? params.filter : defaultFilter;\n\t\tif (!isValidFilter(filter)) {\n\t\t\tthrow new Error(`Invalid filter: ${filter} for DataLayer \"${name}\", must be one of [${validFilters.join(', ')}].`);\n\t\t}\n\t\t// Don't allow LINEAR filtering on integer types, it is not supported.\n\t\tif (filter === LINEAR && !(type === FLOAT || type == HALF_FLOAT)) {\n\t\t\tthrow new Error(`LINEAR filtering is not supported on integer types, please use NEAREST filtering for DataLayer \"${name}\" with type: ${type}.`);\n\t\t}\n\t\tthis.filter = filter;\n\n\t\t// Get wrap types, default to clamp to edge.\n\t\tconst wrapS = params.wrapS !== undefined ? params.wrapS : CLAMP_TO_EDGE;\n\t\tif (!isValidWrap(wrapS)) {\n\t\t\tthrow new Error(`Invalid wrapS: ${wrapS} for DataLayer \"${name}\", must be one of [${validWraps.join(', ')}].`);\n\t\t}\n\t\tthis.wrapS = wrapS;\n\t\tconst wrapT = params.wrapT !== undefined ? params.wrapT : CLAMP_TO_EDGE;\n\t\tif (!isValidWrap(wrapT)) {\n\t\t\tthrow new Error(`Invalid wrapT: ${wrapT} for DataLayer \"${name}\", must be one of [${validWraps.join(', ')}].`);\n\t\t}\n\t\tthis.wrapT = wrapT;\n\n\t\t// Set data type.\n\t\tif (!isValidDataType(type)) {\n\t\t\tthrow new Error(`Invalid type: ${type} for DataLayer \"${name}\", must be one of [${validDataTypes.join(', ')}].`);\n\t\t}\n\t\tthis.type = type;\n\t\tconst internalType = DataLayer.getInternalType({\n\t\t\tgl,\n\t\t\ttype,\n\t\t\tglslVersion,\n\t\t\twritable,\n\t\t\tname,\n\t\t\terrorCallback: _errorCallback,\n\t\t});\n\t\tthis.internalType = internalType;\n\t\t// Set gl texture parameters.\n\t\tconst {\n\t\t\tglFormat,\n\t\t\tglInternalFormat,\n\t\t\tglType,\n\t\t\tglNumChannels,\n\t\t} = DataLayer.getGLTextureParameters({\n\t\t\tgl,\n\t\t\tname,\n\t\t\tnumComponents,\n\t\t\twritable,\n\t\t\tinternalType,\n\t\t\tglslVersion,\n\t\t\terrorCallback: _errorCallback,\n\t\t});\n\t\tthis.glInternalFormat = glInternalFormat;\n\t\tthis.glFormat = glFormat;\n\t\tthis.glType = glType;\n\t\tthis.glNumChannels = glNumChannels;\n\n\t\t// Set internal filtering/wrap types.\n\t\tthis.internalFilter = DataLayer.getInternalFilter({ gl, filter, internalType, name, errorCallback: _errorCallback });\n\t\tthis.glFilter = gl[this.internalFilter];\n\t\tthis.internalWrapS = DataLayer.getInternalWrap({ gl, wrap: wrapS, name });\n\t\tthis.glWrapS = gl[this.internalWrapS];\n\t\tthis.internalWrapT = DataLayer.getInternalWrap({ gl, wrap: wrapT, name });\n\t\tthis.glWrapT = gl[this.internalWrapT];\n\n\t\t// Num buffers is the number of states to store for this data.\n\t\tconst numBuffers = params.numBuffers !== undefined ? params.numBuffers : 1;\n\t\tif (!isPositiveInteger(numBuffers)) {\n\t\t\tthrow new Error(`Invalid numBuffers: ${numBuffers} for DataLayer \"${name}\", must be positive integer.`);\n\t\t}\n\t\tthis.numBuffers = numBuffers;\n\n\t\t// clearValue defaults to zero.\n\t\t// Wait until after type has been set to set clearValue.\n\t\tconst clearValue = params.clearValue !== undefined ? params.clearValue : 0;\n\t\tthis.clearValue = clearValue; // Setter can only be called after this.numComponents has been set.\n\n\t\tthis.initBuffers(array);\n\t}\n\n\tprivate static calcSize(size: number | [number, number], name: string) {\n\t\tlet length, width, height;\n\t\tif (!isNaN(size as number)) {\n\t\t\tif (!isPositiveInteger(size)) {\n\t\t\t\tthrow new Error(`Invalid length: ${size} for DataLayer \"${name}\", must be positive integer.`);\n\t\t\t}\n\t\t\tlength = size as number;\n\t\t\t// Calc power of two width and height for length.\n\t\t\tlet exp = 1;\n\t\t\tlet remainder = length;\n\t\t\twhile (remainder > 2) {\n\t\t\t\texp++;\n\t\t\t\tremainder /= 2;\n\t\t\t}\n\t\t\twidth = Math.pow(2, Math.floor(exp / 2) + exp % 2);\n\t\t\theight = Math.pow(2, Math.floor(exp/2));\n\t\t\tif (inDevMode()) {\n\t\t\t\tconsole.log(`Using [${width}, ${height}] for 1D array of length ${size} in DataLayer \"${name}\".`);\n\t\t\t}\n\t\t} else {\n\t\t\twidth = (size as [number, number])[0];\n\t\t\tif (!isPositiveInteger(width)) {\n\t\t\t\tthrow new Error(`Invalid width: ${width} for DataLayer \"${name}\", must be positive integer.`);\n\t\t\t}\n\t\t\theight = (size as [number, number])[1];\n\t\t\tif (!isPositiveInteger(height)) {\n\t\t\t\tthrow new Error(`Invalid height: ${height} for DataLayer \"${name}\", must be positive integer.`);\n\t\t\t}\n\t\t}\n\t\treturn { width, height, length };\n\t}\n\n\tprivate static getInternalWrap(\n\t\tparams: {\n\t\t\tgl: WebGLRenderingContext | WebGL2RenderingContext,\n\t\t\twrap: DataLayerWrap,\n\t\t\tname: string,\n\t\t},\n\t) {\n\t\tconst { gl, wrap, name } = params;\n\t\t// Webgl2.0 supports all combinations of types and filtering.\n\t\tif (isWebGL2(gl)) {\n\t\t\treturn wrap;\n\t\t}\n\t\t// CLAMP_TO_EDGE is always supported.\n\t\tif (wrap === CLAMP_TO_EDGE) {\n\t\t\treturn wrap;\n\t\t}\n\t\tif (!isWebGL2(gl)) {\n\t\t\t// TODO: we may want to handle this in the frag shader.\n\t\t\t// REPEAT and MIRROR_REPEAT wrap not supported for non-power of 2 textures in safari.\n\t\t\t// I've tested this and it seems that some power of 2 textures will work (512 x 512),\n\t\t\t// but not others (1024x1024), so let's just change all WebGL 1.0 to CLAMP.\n\t\t\t// Without this, we currently get an error at drawArrays():\n\t\t\t// \"WebGL: drawArrays: texture bound to texture unit 0 is not renderable.\n\t\t\t// It maybe non-power-of-2 and have incompatible texture filtering or is not\n\t\t\t// 'texture complete', or it is a float/half-float type with linear filtering and\n\t\t\t// without the relevant float/half-float linear extension enabled.\"\n\t\t\tconsole.warn(`Falling back to CLAMP_TO_EDGE wrapping for DataLayer \"${name}\" for WebGL 1.`);\n\t\t\treturn CLAMP_TO_EDGE;\n\t\t}\n\t\treturn wrap;\n\t}\n\n\tprivate static getInternalFilter(\n\t\tparams: {\n\t\t\tgl: WebGLRenderingContext | WebGL2RenderingContext,\n\t\t\tfilter: DataLayerFilter,\n\t\t\tinternalType: DataLayerType,\n\t\t\tname: string,\n\t\t\terrorCallback: ErrorCallback,\n\t\t},\n\t) {\n\t\tconst { gl, errorCallback, internalType, name } = params;\n\t\tlet { filter } = params;\n\t\tif (filter === NEAREST) {\n\t\t\t// NEAREST filtering is always supported.\n\t\t\treturn filter;\n\t\t}\n\n\t\tif (internalType === HALF_FLOAT) {\n\t\t\t// TODO: test if float linear extension is actually working.\n\t\t\tconst extension = getExtension(gl, OES_TEXTURE_HAlF_FLOAT_LINEAR, errorCallback, true)\n\t\t\t\t|| getExtension(gl, OES_TEXTURE_FLOAT_LINEAR, errorCallback, true);\n\t\t\tif (!extension) {\n\t\t\t\tconsole.warn(`Falling back to NEAREST filter for DataLayer \"${name}\".`);\n\t\t\t\t//TODO: add a fallback that does this filtering in the frag shader?.\n\t\t\t\tfilter = NEAREST;\n\t\t\t}\n\t\t} if (internalType === FLOAT) {\n\t\t\tconst extension = getExtension(gl, OES_TEXTURE_FLOAT_LINEAR, errorCallback, true);\n\t\t\tif (!extension) {\n\t\t\t\tconsole.warn(`Falling back to NEAREST filter for DataLayer \"${name}\".`);\n\t\t\t\t//TODO: add a fallback that does this filtering in the frag shader?.\n\t\t\t\tfilter = NEAREST;\n\t\t\t}\n\t\t}\n\t\treturn filter;\n\t}\n\n\tprivate static getInternalType(\n\t\tparams: {\n\t\t\tgl: WebGLRenderingContext | WebGL2RenderingContext,\n\t\t\ttype: DataLayerType,\n\t\t\tglslVersion: GLSLVersion,\n\t\t\twritable: boolean,\n\t\t\tname: string,\n\t\t\terrorCallback: ErrorCallback,\n\t\t},\n\t) {\n\t\tconst { gl, errorCallback, writable, name, glslVersion } = params;\n\t\tconst { type } = params;\n\t\tlet internalType = type;\n\t\t// Check if int types are supported.\n\t\tconst intCast = DataLayer.shouldCastIntTypeAsFloat(params);\n\t\tif (intCast) {\n\t\t\tif (internalType === UNSIGNED_BYTE || internalType === BYTE) {\n\t\t\t\t// Integers between 0 and 2048 can be exactly represented by half float (and also between −2048 and 0)\n\t\t\t\tinternalType = HALF_FLOAT;\n\t\t\t} else {\n\t\t\t\t// Integers between 0 and 16777216 can be exactly represented by float32 (also applies for negative integers between −16777216 and 0)\n\t\t\t\t// This is sufficient for UNSIGNED_SHORT and SHORT types.\n\t\t\t\t// Large UNSIGNED_INT and INT cannot be represented by FLOAT type.\n\t\t\t\tconsole.warn(`Falling back ${internalType} type to FLOAT type for glsl1.x support for DataLayer \"${name}\".\nLarge UNSIGNED_INT or INT with absolute value > 16,777,216 are not supported, on mobile UNSIGNED_INT, INT, UNSIGNED_SHORT, and SHORT with absolute value > 2,048 may not be supported.`);\n\t\t\t\tinternalType = FLOAT;\n\t\t\t}\n\t\t}\n\t\t// Check if float32 supported.\n\t\tif (!isWebGL2(gl)) {\n\t\t\tif (internalType === FLOAT) {\n\t\t\t\tconst extension = getExtension(gl, OES_TEXTURE_FLOAT, errorCallback, true);\n\t\t\t\tif (!extension) {\n\t\t\t\t\tconsole.warn(`FLOAT not supported, falling back to HALF_FLOAT type for DataLayer \"${name}\".`);\n\t\t\t\t\tinternalType = HALF_FLOAT;\n\t\t\t\t}\n\t\t\t\t// https://stackoverflow.com/questions/17476632/webgl-extension-support-across-browsers\n\t\t\t\t// Rendering to a floating-point texture may not be supported,\n\t\t\t\t// even if the OES_texture_float extension is supported.\n\t\t\t\t// Typically, this fails on current mobile hardware.\n\t\t\t\t// To check if this is supported, you have to call the WebGL\n\t\t\t\t// checkFramebufferStatus() function.\n\t\t\t\tif (writable) {\n\t\t\t\t\tconst valid = DataLayer.testFramebufferWrite({ gl, type: internalType, glslVersion });\n\t\t\t\t\tif (!valid && internalType !== HALF_FLOAT) {\n\t\t\t\t\t\tconsole.warn(`FLOAT not supported for writing operations, falling back to HALF_FLOAT type for DataLayer \"${name}\".`);\n\t\t\t\t\t\tinternalType = HALF_FLOAT;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Must support at least half float if using a float type.\n\t\t\tif (internalType === HALF_FLOAT) {\n\t\t\t\tgetExtension(gl, OES_TEXTURE_HALF_FLOAT, errorCallback);\n\t\t\t\t// TODO: https://stackoverflow.com/questions/54248633/cannot-create-half-float-oes-texture-from-uint16array-on-ipad\n\t\t\t\tif (writable) {\n\t\t\t\t\tconst valid = DataLayer.testFramebufferWrite({ gl, type: internalType, glslVersion });\n\t\t\t\t\tif (!valid) {\n\t\t\t\t\t\terrorCallback(`This browser does not support rendering to HALF_FLOAT textures.`);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\t// Load additional extensions if needed.\n\t\tif (writable && isWebGL2(gl) && (internalType === HALF_FLOAT || internalType === FLOAT)) {\n\t\t\tgetExtension(gl, EXT_COLOR_BUFFER_FLOAT, errorCallback);\n\t\t}\n\t\treturn internalType;\n\t}\n\n\tprivate static shouldCastIntTypeAsFloat(\n\t\tparams: {\n\t\t\tgl: WebGLRenderingContext | WebGL2RenderingContext,\n\t\t\ttype: DataLayerType,\n\t\t\tglslVersion: GLSLVersion,\n\t\t}\n\t) {\n\t\tconst { gl, type, glslVersion } = params;\n\t\t// All types are supported by WebGL2 + glsl3.\n\t\tif (glslVersion === GLSL3 && isWebGL2(gl)) return false;\n\t\t// Int textures (other than UNSIGNED_BYTE) are not supported by WebGL1.0 or glsl1.x.\n\t\t// https://stackoverflow.com/questions/55803017/how-to-select-webgl-glsl-sampler-type-from-texture-format-properties\n\t\t// Use HALF_FLOAT/FLOAT instead.\n\t\t// Some large values of INT and UNSIGNED_INT are not supported unfortunately.\n\t\t// See tests for more information.\n\t\treturn type === BYTE || type === SHORT || type === INT || type === UNSIGNED_SHORT || type === UNSIGNED_INT;\n\t}\n\n\tprivate static getGLTextureParameters(\n\t\tparams: {\n\t\t\tgl: WebGLRenderingContext | WebGL2RenderingContext,\n\t\t\tname: string,\n\t\t\tnumComponents: DataLayerNumComponents,\n\t\t\tinternalType: DataLayerType,\n\t\t\twritable: boolean,\n\t\t\tglslVersion: GLSLVersion,\n\t\t\terrorCallback: ErrorCallback,\n\t\t}\n\t) {\n\t\tconst { gl, errorCallback, name, numComponents, internalType, writable, glslVersion } = params;\n\t\t// https://www.khronos.org/registry/webgl/specs/latest/2.0/#TEXTURE_TYPES_FORMATS_FROM_DOM_ELEMENTS_TABLE\n\t\tlet glType: number | undefined,\n\t\t\tglFormat: number | undefined,\n\t\t\tglInternalFormat: number | undefined,\n\t\t\tglNumChannels: number | undefined;\n\n\t\tif (isWebGL2(gl)) {\n\t\t\tglNumChannels = numComponents;\n\t\t\t// https://www.khronos.org/registry/webgl/extensions/EXT_color_buffer_float/\n\t\t\t// https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/texImage2D\n\t\t\t// The sized internal format RGBxxx are not color-renderable for some reason.\n\t\t\t// If numComponents == 3 for a writable texture, use RGBA instead.\n\t\t\t// Page 5 of https://www.khronos.org/files/webgl20-reference-guide.pdf\n\t\t\tif (numComponents === 3 && writable) {\n\t\t\t\tglNumChannels = 4;\n\t\t\t}\n\t\t\tif (internalType === FLOAT || internalType === HALF_FLOAT) {\n\t\t\t\tswitch (glNumChannels) {\n\t\t\t\t\tcase 1:\n\t\t\t\t\t\tglFormat = (gl as WebGL2RenderingContext).RED;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 2:\n\t\t\t\t\t\tglFormat = (gl as WebGL2RenderingContext).RG;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 3:\n\t\t\t\t\t\tglFormat = gl.RGB;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 4:\n\t\t\t\t\t\tglFormat = gl.RGBA;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tthrow new Error(`Unsupported glNumChannels: ${glNumChannels} for DataLayer \"${name}\".`);\n\t\t\t\t}\n\t\t\t} else if (glslVersion === GLSL1 && internalType === UNSIGNED_BYTE) {\n\t\t\t\tswitch (glNumChannels) {\n\t\t\t\t\t// For read only UNSIGNED_BYTE textures in GLSL 1, use gl.ALPHA and gl.LUMINANCE_ALPHA.\n\t\t\t\t\t// Otherwise use RGB/RGBA.\n\t\t\t\t\tcase 1:\n\t\t\t\t\t\tif (!writable) {\n\t\t\t\t\t\t\tglFormat = gl.ALPHA;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// Purposely falling to next case here.\n\t\t\t\t\tcase 2:\n\t\t\t\t\t\tif (!writable) {\n\t\t\t\t\t\t\tglFormat = gl.LUMINANCE_ALPHA;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// Purposely falling to next case here.\n\t\t\t\t\tcase 3:\n\t\t\t\t\t\tglFormat = gl.RGB;\n\t\t\t\t\t\tglNumChannels = 3;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 4:\n\t\t\t\t\t\tglFormat = gl.RGBA;\n\t\t\t\t\t\tglNumChannels = 4;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tthrow new Error(`Unsupported glNumChannels: ${glNumChannels} for DataLayer \"${name}\".`);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// This case will only be hit by GLSL 3.\n\t\t\t\t// Int textures are not supported in GLSL1.\n\t\t\t\tswitch (glNumChannels) {\n\t\t\t\t\tcase 1:\n\t\t\t\t\t\tglFormat = (gl as WebGL2RenderingContext).RED_INTEGER;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 2:\n\t\t\t\t\t\tglFormat = (gl as WebGL2RenderingContext).RG_INTEGER;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 3:\n\t\t\t\t\t\tglFormat = (gl as WebGL2RenderingContext).RGB_INTEGER;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 4:\n\t\t\t\t\t\tglFormat = (gl as WebGL2RenderingContext).RGBA_INTEGER;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tthrow new Error(`Unsupported glNumChannels: ${glNumChannels} for DataLayer \"${name}\".`);\n\t\t\t\t}\n\t\t\t}\n\t\t\tswitch (internalType) {\n\t\t\t\tcase HALF_FLOAT:\n\t\t\t\t\tglType = (gl as WebGL2RenderingContext).HALF_FLOAT;\n\t\t\t\t\tswitch (glNumChannels) {\n\t\t\t\t\t\tcase 1:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).R16F;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 2:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RG16F;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 3:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RGB16F;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 4:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RGBA16F;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tthrow new Error(`Unsupported glNumChannels: ${glNumChannels} for DataLayer \"${name}\".`);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase FLOAT:\n\t\t\t\t\tglType = (gl as WebGL2RenderingContext).FLOAT;\n\t\t\t\t\tswitch (glNumChannels) {\n\t\t\t\t\t\tcase 1:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).R32F;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 2:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RG32F;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 3:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RGB32F;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 4:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RGBA32F;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tthrow new Error(`Unsupported glNumChannels: ${glNumChannels} for DataLayer \"${name}\".`);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase UNSIGNED_BYTE:\n\t\t\t\t\tglType = gl.UNSIGNED_BYTE;\n\t\t\t\t\tif (glslVersion === GLSL1 && internalType === UNSIGNED_BYTE) {\n\t\t\t\t\t\tglInternalFormat = glFormat;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tswitch (glNumChannels) {\n\t\t\t\t\t\t\tcase 1:\n\t\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).R8UI;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 2:\n\t\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RG8UI;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 3:\n\t\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RGB8UI;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 4:\n\t\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RGBA8UI;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\tthrow new Error(`Unsupported glNumChannels: ${glNumChannels} for DataLayer \"${name}\".`);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase BYTE:\n\t\t\t\t\tglType = gl.BYTE;\n\t\t\t\t\tswitch (glNumChannels) {\n\t\t\t\t\t\tcase 1:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).R8I;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 2:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RG8I;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 3:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RGB8I;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 4:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RGBA8I;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tthrow new Error(`Unsupported glNumChannels: ${glNumChannels} for DataLayer \"${name}\".`);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase SHORT:\n\t\t\t\t\tglType = gl.SHORT;\n\t\t\t\t\tswitch (glNumChannels) {\n\t\t\t\t\t\tcase 1:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).R16I;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 2:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RG16I;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 3:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RGB16I;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 4:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RGBA16I;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tthrow new Error(`Unsupported glNumChannels: ${glNumChannels} for DataLayer \"${name}\".`);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase UNSIGNED_SHORT:\n\t\t\t\t\tglType = gl.UNSIGNED_SHORT;\n\t\t\t\t\tswitch (glNumChannels) {\n\t\t\t\t\t\tcase 1:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).R16UI;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 2:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RG16UI;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 3:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RGB16UI;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 4:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RGBA16UI;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tthrow new Error(`Unsupported glNumChannels: ${glNumChannels} for DataLayer \"${name}\".`);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase INT:\n\t\t\t\t\tglType = gl.INT;\n\t\t\t\t\tswitch (glNumChannels) {\n\t\t\t\t\t\tcase 1:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).R32I;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 2:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RG32I;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 3:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RGB32I;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 4:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RGBA32I;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tthrow new Error(`Unsupported glNumChannels: ${glNumChannels} for DataLayer \"${name}\".`);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase UNSIGNED_INT:\n\t\t\t\t\tglType = gl.UNSIGNED_INT;\n\t\t\t\t\tswitch (glNumChannels) {\n\t\t\t\t\t\tcase 1:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).R32UI;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 2:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RG32UI;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 3:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RGB32UI;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 4:\n\t\t\t\t\t\t\tglInternalFormat = (gl as WebGL2RenderingContext).RGBA32UI;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tthrow new Error(`Unsupported glNumChannels: ${glNumChannels} for DataLayer \"${name}\".`);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tthrow new Error(`Unsupported type: ${internalType} for DataLayer \"${name}\".`);\n\t\t\t}\n\t\t} else {\n\t\t\tswitch (numComponents) {\n\t\t\t\t// For read only textures WebGL 1, use gl.ALPHA and gl.LUMINANCE_ALPHA.\n\t\t\t\t// Otherwise use RGB/RGBA.\n\t\t\t\tcase 1:\n\t\t\t\t\tif (!writable) {\n\t\t\t\t\t\tglFormat = gl.ALPHA;\n\t\t\t\t\t\t// TODO: check these:\n\t\t\t\t\t\tglInternalFormat = gl.ALPHA;\n\t\t\t\t\t\tglNumChannels = 1;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\t// Purposely falling to next case here.\n\t\t\t\tcase 2:\n\t\t\t\t\tif (!writable) {\n\t\t\t\t\t\tglFormat = gl.LUMINANCE_ALPHA;\n\t\t\t\t\t\t// TODO: check these:\n\t\t\t\t\t\tglInternalFormat = gl.LUMINANCE_ALPHA;\n\t\t\t\t\t\tglNumChannels = 2;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\t// Purposely falling to next case here.\n\t\t\t\tcase 3:\n\t\t\t\t\tglFormat = gl.RGB;\n\t\t\t\t\tglInternalFormat = gl.RGB;\n\t\t\t\t\tglNumChannels = 3;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 4:\n\t\t\t\t\tglFormat = gl.RGBA;\n\t\t\t\t\tglInternalFormat = gl.RGBA;\n\t\t\t\t\tglNumChannels = 4;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tthrow new Error(`Unsupported numComponents: ${numComponents} for DataLayer \"${name}\".`);\n\t\t\t}\n\t\t\tswitch (internalType) {\n\t\t\t\tcase FLOAT:\n\t\t\t\t\tglType = gl.FLOAT;\n\t\t\t\t\tbreak;\n\t\t\t\tcase HALF_FLOAT:\n\t\t\t\t\tglType = (gl as WebGL2RenderingContext).HALF_FLOAT || getExtension(gl, OES_TEXTURE_HALF_FLOAT, errorCallback).HALF_FLOAT_OES as number;\n\t\t\t\t\tbreak;\n\t\t\t\tcase UNSIGNED_BYTE:\n\t\t\t\t\tglType = gl.UNSIGNED_BYTE;\n\t\t\t\t\tbreak;\n\t\t\t\t// No other types are supported in glsl1.x\n\t\t\t\tdefault:\n\t\t\t\t\tthrow new Error(`Unsupported type: ${internalType} in WebGL 1.0 for DataLayer \"${name}\".`);\n\t\t\t}\n\t\t}\n\n\t\t// Check for missing params.\n\t\tif (glType === undefined || glFormat === undefined || glInternalFormat === undefined) {\n\t\t\tconst missingParams = [];\n\t\t\tif (glType === undefined) missingParams.push('glType');\n\t\t\tif (glFormat === undefined) missingParams.push('glFormat');\n\t\t\tif (glInternalFormat === undefined) missingParams.push('glInternalFormat');\n\t\t\tthrow new Error(`Invalid type: ${internalType} for numComponents: ${numComponents}, unable to init parameter${missingParams.length > 1 ? 's' : ''} ${missingParams.join(', ')} for DataLayer \"${name}\".`);\n\t\t}\n\t\tif (glNumChannels === undefined || numComponents < 1 || numComponents > 4 || glNumChannels < numComponents) {\n\t\t\tthrow new Error(`Invalid numChannels: ${glNumChannels} for numComponents: ${numComponents} for DataLayer \"${name}\".`);\n\t\t}\n\n\t\treturn {\n\t\t\tglFormat,\n\t\t\tglInternalFormat,\n\t\t\tglType,\n\t\t\tglNumChannels,\n\t\t};\n\t}\n\n\tprivate static testFramebufferWrite(\n\t\tparams: {\n\t\t\tgl: WebGLRenderingContext | WebGL2RenderingContext,\n\t\t\ttype: DataLayerType,\n\t\t\tglslVersion: GLSLVersion,\n\t\t},\n\t) {\n\t\tconst { gl, type, glslVersion } = params;\n\t\tconst texture = gl.createTexture();\n\t\tif (!texture) {\n\t\t\treturn false;\n\t\t}\n\t\tgl.bindTexture(gl.TEXTURE_2D, texture);\n\n\t\t// Default to most widely supported settings.\n\t\tconst wrapS = gl[CLAMP_TO_EDGE];\n\t\tconst wrapT = gl[CLAMP_TO_EDGE];\n\t\tconst filter = gl[NEAREST];\n\t\t// Use non-power of two dimensions to check for more universal support.\n\t\t// (In case size of DataLayer is changed at a later point).\n\t\tconst width = 100;\n\t\tconst height = 100;\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, wrapS);\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, wrapT);\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, filter);\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, filter);\n\n\t\tconst { glInternalFormat, glFormat, glType } = DataLayer.getGLTextureParameters({\n\t\t\tgl,\n\t\t\tname: 'testFramebufferWrite',\n\t\t\tnumComponents: 1,\n\t\t\twritable: true,\n\t\t\tinternalType: type,\n\t\t\tglslVersion,\n\t\t\terrorCallback: () => {},\n\t\t});\n\t\tgl.texImage2D(gl.TEXTURE_2D, 0, glInternalFormat, width, height, 0, glFormat, glType, null);\n\n\t\t// Init a framebuffer for this texture so we can write to it.\n\t\tconst framebuffer = gl.createFramebuffer();\n\t\tif (!framebuffer) {\n\t\t\t// Clear out allocated memory.\n\t\t\tgl.deleteTexture(texture);\n\t\t\treturn false;\n\t\t}\n\t\tgl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\n\t\t// https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/framebufferTexture2D\n\t\tgl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\n\n\t\tconst status = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\n\t\tconst validStatus = status === gl.FRAMEBUFFER_COMPLETE;\n\n\t\t// Clear out allocated memory.\n\t\tgl.deleteTexture(texture);\n\t\tgl.deleteFramebuffer(framebuffer);\n\n\t\treturn validStatus;\n\t}\n\n\tget bufferIndex() {\n\t\treturn this._bufferIndex;\n\t}\n\n\tsaveCurrentStateToDataLayer(layer: DataLayer) {\n\t\t// A method for saving a copy of the current state without a draw call.\n\t\t// Draw calls are expensive, this optimization helps.\n\t\tif (this.numBuffers < 2) {\n\t\t\tthrow new Error(`Can't call DataLayer.saveCurrentStateToDataLayer on DataLayer \"${this.name}\" with less than 2 buffers.`);\n\t\t}\n\t\tif (!this.writable) {\n\t\t\tthrow new Error(`Can't call DataLayer.saveCurrentStateToDataLayer on read-only DataLayer \"${this.name}\".`);\n\t\t}\n\t\tif (layer.writable) {\n\t\t\tthrow new Error(`Can't call DataLayer.saveCurrentStateToDataLayer on DataLayer \"${this.name}\" using writable DataLayer \"${layer.name}\".`)\n\t\t}\n\t\t// Check that texture params are the same.\n\t\tif (layer.glWrapS !== this.glWrapS || layer.glWrapT !== this.glWrapT ||\n\t\t\tlayer.wrapS !== this.wrapS || layer.wrapT !== this.wrapT ||\n\t\t\tlayer.width !== this.width || layer.height !== this.height ||\n\t\t\tlayer.glFilter !== this.glFilter || layer.filter !== this.filter ||\n\t\t\tlayer.glNumChannels !== this.glNumChannels || layer.numComponents !== this.numComponents ||\n\t\t\tlayer.glType !== this.glType || layer.type !== this.type ||\n\t\t\tlayer.glFormat !== this.glFormat || layer.glInternalFormat !== this.glInternalFormat) {\n\t\t\t\tthrow new Error(`Incompatible texture params between DataLayers \"${layer.name}\" and \"${this.name}\".`);\n\t\t}\n\n\t\t// If we have not already inited overrides array, do so now.\n\t\tif (!this.textureOverrides) {\n\t\t\tthis.textureOverrides = [];\n\t\t\tfor (let i = 0; i < this.numBuffers; i++) {\n\t\t\t\tthis.textureOverrides.push(undefined);\n\t\t\t}\n\t\t}\n\n\t\t// Check if we already have an override in place.\n\t\tif (this.textureOverrides[this.bufferIndex]) {\n\t\t\tthrow new Error(`Can't call DataLayer.saveCurrentStateToDataLayer on DataLayer \"${this.name}\", this DataLayer has not written new state since last call to DataLayer.saveCurrentStateToDataLayer.`);\n\t\t}\n\t\tconst { currentState } = this;\n\t\tthis.textureOverrides[this.bufferIndex] = currentState;\n\t\t// Swap textures.\n\t\tthis.buffers[this.bufferIndex].texture = layer.currentState;\n\t\tlayer._setCurrentStateTexture(currentState);\n\n\t\t// Bind swapped texture to framebuffer.\n\t\tconst { gl } = this.glcompute;\n\t\tconst { framebuffer, texture } = this.buffers[this.bufferIndex];\n\t\tif (!framebuffer) throw new Error(`No framebuffer for writable DataLayer \"${this.name}\".`);\n\t\tgl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\n\t\t// https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/framebufferTexture2D\n\t\tgl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\n\t\t// Unbind.\n\t\tgl.bindFramebuffer(gl.FRAMEBUFFER, null);\n\t}\n\n\t// This is used internally.\n\t_setCurrentStateTexture(texture: WebGLTexture) {\n\t\tif (this.writable) {\n\t\t\tthrow new Error(`Can't call DataLayer._setCurrentStateTexture on writable texture \"${this.name}\".`);\n\t\t}\n\t\tthis.buffers[this.bufferIndex].texture = texture;\n\t}\n\n\tprivate static initArrayForInternalType(internalType: DataLayerType, length: number) {\n\t\tswitch (internalType) {\n\t\t\tcase HALF_FLOAT:\n\t\t\t\treturn new Uint16Array(length);\n\t\t\tcase FLOAT:\n\t\t\t\treturn new Float32Array(length);\n\t\t\tcase UNSIGNED_BYTE:\n\t\t\t\treturn new Uint8Array(length);\n\t\t\tcase BYTE:\n\t\t\t\treturn new Int8Array(length);\n\t\t\tcase UNSIGNED_SHORT:\n\t\t\t\treturn new Uint16Array(length);\n\t\t\tcase SHORT:\n\t\t\t\treturn new Int16Array(length);\n\t\t\tcase UNSIGNED_INT:\n\t\t\t\treturn new Uint32Array(length);\n\t\t\tcase INT:\n\t\t\t\treturn new Int32Array(length);\n\t\t\tdefault:\n\t\t\t\tthrow new Error(`Unsupported internalType: ${internalType}.`);\n\t\t}\n\t}\n\n\tprivate validateDataArray(array: DataLayerArray | number[]) {\n\t\tconst { numComponents, glNumChannels, type, internalType, width, height } = this;\n\t\tconst length = this._length;\n\n\t\t// Check that data is correct length (user error).\n\t\tif (array.length !== width * height * numComponents) { // Either the correct length for WebGLTexture size\n\t\t\tif (!length || (length &&  array.length !== length * numComponents)) { // Of the correct length for 1D array.\n\t\t\t\tthrow new Error(`Invalid data length: ${array.length} for DataLayer \"${this.name}\" of ${length ? `length ${length} and ` : ''}dimensions: [${width}, ${height}] and numComponents: ${numComponents}.`);\n\t\t\t}\n\t\t}\n\n\t\t// Get array type to figure out if we need to type cast.\n\t\t// For webgl1.0 we may need to cast an int type to a FLOAT or HALF_FLOAT.\n\t\tlet shouldTypeCast = false;\n\t\tswitch(array.constructor) {\n\t\t\tcase Array:\n\t\t\t\tshouldTypeCast = true;\n\t\t\t\tbreak;\n\t\t\tcase Float32Array:\n\t\t\t\tshouldTypeCast = internalType !== FLOAT;\n\t\t\t\tbreak;\n\t\t\tcase Uint8Array:\n\t\t\t\tshouldTypeCast = internalType !== UNSIGNED_BYTE;\n\t\t\t\tbreak;\n\t\t\tcase Int8Array:\n\t\t\t\tshouldTypeCast = internalType !== BYTE;\n\t\t\t\tbreak;\n\t\t\tcase Uint16Array:\n\t\t\t\tshouldTypeCast = internalType !== UNSIGNED_SHORT;\n\t\t\t\tbreak;\n\t\t\tcase Int16Array:\n\t\t\t\tshouldTypeCast = internalType !== SHORT;\n\t\t\t\tbreak;\n\t\t\tcase Uint32Array:\n\t\t\t\tshouldTypeCast = internalType !== UNSIGNED_INT;\n\t\t\t\tbreak;\n\t\t\tcase Int32Array:\n\t\t\t\tshouldTypeCast = internalType !== INT;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthrow new Error(`Invalid array type: ${array.constructor.name} for DataLayer \"${this.name}\", please use one of [${validArrayTypes.map(constructor => constructor.name).join(', ')}].`);\n\t\t}\n\n\t\tconst imageSize = width * height * glNumChannels;\n\t\t// Then check if array needs to be lengthened.\n\t\t// This could be because glNumChannels !== numComponents.\n\t\t// Or because length !== width * height.\n\t\tconst incorrectSize = array.length !== imageSize;\n\t\t// We have to handle the case of Float16 specially by converting data to Uint16Array.\n\t\tconst handleFloat16 = internalType === HALF_FLOAT;\n\t\t\n\t\tlet validatedArray = array as DataLayerArray;\n\t\tif (shouldTypeCast || incorrectSize || handleFloat16) {\n\t\t\tvalidatedArray = DataLayer.initArrayForInternalType(internalType, imageSize);\n\t\t\t// Fill new data array with old data.\n\t\t\tconst view = handleFloat16 ? new DataView(validatedArray.buffer) : null;\n\t\t\tfor (let i = 0, _len = array.length / numComponents; i < _len; i++) {\n\t\t\t\tfor (let j = 0; j < numComponents; j++) {\n\t\t\t\t\tconst value = array[i * numComponents + j];\n\t\t\t\t\tconst index = i * glNumChannels + j;\n\t\t\t\t\tif (handleFloat16) {\n\t\t\t\t\t\tsetFloat16(view!, 2 * index, value, true);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvalidatedArray[index] = value;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn validatedArray;\n\t}\n\n\tprivate initBuffers(\n\t\tarray?: DataLayerArray | number[],\n\t) {\n\t\tconst {\n\t\t\tname,\n\t\t\tnumBuffers,\n\t\t\tglcompute,\n\t\t\tglInternalFormat,\n\t\t\tglFormat,\n\t\t\tglType,\n\t\t\tglFilter,\n\t\t\tglWrapS,\n\t\t\tglWrapT,\n\t\t\twritable,\n\t\t\twidth,\n\t\t\theight,\n\t\t} = this;\n\t\tconst { gl, _errorCallback } = glcompute;\n\n\t\tconst validatedArray = array ? this.validateDataArray(array) : undefined;\n\n\t\t// Init a texture for each buffer.\n\t\tfor (let i = 0; i < numBuffers; i++) {\n\t\t\tconst texture = gl.createTexture();\n\t\t\tif (!texture) {\n\t\t\t\t_errorCallback(`Could not init texture for DataLayer \"${name}\": ${gl.getError()}.`);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tgl.bindTexture(gl.TEXTURE_2D, texture);\n\n\t\t\t// TODO: are there other params to look into:\n\t\t\t// https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/texParameter\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, glWrapS);\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, glWrapT);\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, glFilter);\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, glFilter);\n\n\t\t\tgl.texImage2D(gl.TEXTURE_2D, 0, glInternalFormat, width, height, 0, glFormat, glType, validatedArray ? validatedArray : null);\n\t\t\t\n\t\t\tconst buffer: DataLayerBuffer = {\n\t\t\t\ttexture,\n\t\t\t};\n\n\t\t\tif (writable) {\n\t\t\t\t// Init a framebuffer for this texture so we can write to it.\n\t\t\t\tconst framebuffer = gl.createFramebuffer();\n\t\t\t\tif (!framebuffer) {\n\t\t\t\t\t_errorCallback(`Could not init framebuffer for DataLayer \"${name}\": ${gl.getError()}.`);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tgl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\n\t\t\t\t// https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/framebufferTexture2D\n\t\t\t\tgl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\n\n\t\t\t\tconst status = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\n\t\t\t\tif(status != gl.FRAMEBUFFER_COMPLETE){\n\t\t\t\t\t_errorCallback(`Invalid status for framebuffer for DataLayer \"${name}\": ${status}.`);\n\t\t\t\t}\n\n\t\t\t\t// Add framebuffer.\n\t\t\t\tbuffer.framebuffer = framebuffer;\n\t\t\t}\n\t\t\t\n\t\t\t// Save this buffer to the list.\n\t\t\tthis.buffers.push(buffer);\n\t\t}\n\t\t// Unbind.\n\t\tgl.bindTexture(gl.TEXTURE_2D, null);\n\t\tgl.bindFramebuffer(gl.FRAMEBUFFER, null);\n\t}\n\n\tgetStateAtIndex(index: number) {\n\t\tif (index < 0 || index >= this.numBuffers) {\n\t\t\tthrow new Error(`Invalid buffer index: ${index} for DataLayer \"${this.name}\" with ${this.numBuffers} buffer${this.numBuffers > 1 ? 's' : ''}.`)\n\t\t}\n\t\tif (this.textureOverrides && this.textureOverrides[index]) return this.textureOverrides[index]!;\n\t\treturn this.buffers[index].texture;\n\t}\n\n\tget currentState() {\n\t\treturn this.getStateAtIndex(this.bufferIndex);\n\t}\n\n\tget lastState() {\n\t\tif (this.numBuffers === 1) {\n\t\t\tthrow new Error(`Cannot access lastState on DataLayer \"${this.name}\" with only one buffer.`);\n\t\t}\n\t\treturn this.getStateAtIndex((this.bufferIndex - 1 + this.numBuffers) % this.numBuffers);\n\t}\n\n\t// This is used internally.\n\t_usingTextureOverrideForCurrentBuffer() {\n\t\treturn this.textureOverrides && this.textureOverrides[this.bufferIndex];\n\t}\n\n\t// This is used internally.\n\t_bindOutputBufferForWrite(\n\t\tincrementBufferIndex: boolean,\n\t) {\n\t\tif (incrementBufferIndex) {\n\t\t\t// Increment bufferIndex.\n\t\t\tthis._bufferIndex = (this.bufferIndex + 1) % this.numBuffers;\n\t\t}\n\t\tthis._bindOutputBuffer();\n\n\t\t// We are going to do a data write, if we have overrides enabled, we can remove them.\n\t\tif (this.textureOverrides) {\n\t\t\tthis.textureOverrides[this.bufferIndex] = undefined;\n\t\t}\n\t}\n\n\t// This is used internally.\n\t_bindOutputBuffer() {\n\t\tconst { gl } = this.glcompute;\n\t\tconst { framebuffer } = this.buffers[this.bufferIndex];\n\t\tif (!framebuffer) {\n\t\t\tthrow new Error(`DataLayer \"${this.name}\" is not writable.`);\n\t\t}\n\t\tgl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\n\t}\n\n\tsetFromArray(array: DataLayerArray | number[], applyToAllBuffers = false) {\n\t\tconst { glcompute, glInternalFormat, glFormat, glType, numBuffers, width, height, bufferIndex } = this;\n\t\tconst { gl } = glcompute;\n\t\tconst validatedArray = this.validateDataArray(array);\n\t\t// TODO: check that this is working.\n\t\tconst startIndex = applyToAllBuffers ? 0 : bufferIndex;\n\t\tconst endIndex = applyToAllBuffers ? numBuffers : bufferIndex + 1;\n\t\tfor (let i = startIndex; i < endIndex; i++) {\n\t\t\tconst texture = this.getStateAtIndex(i);\n\t\t\tgl.bindTexture(gl.TEXTURE_2D, texture);\n\t\t\tgl.texImage2D(gl.TEXTURE_2D, 0, glInternalFormat, width, height, 0, glFormat, glType, validatedArray);\n\t\t}\n\t\t// Unbind texture.\n\t\tgl.bindTexture(gl.TEXTURE_2D, null);\n\t}\n\n\tresize(\n\t\tdimensions: number | [number, number],\n\t\tarray?: DataLayerArray | number[],\n\t) {\n\t\tconst { name, glcompute } = this;\n\t\tconst { verboseLogging } = glcompute;\n\t\tif (verboseLogging) console.log(`Resizing DataLayer \"${name}\" to ${JSON.stringify(dimensions)}.`);\n\t\tconst { length, width, height } = DataLayer.calcSize(dimensions, name);\n\t\tthis._length = length;\n\t\tthis._width = width;\n\t\tthis._height = height;\n\t\tthis.destroyBuffers();\n\t\tthis.initBuffers(array);\n\t}\n\n\tget clearValue() {\n\t\treturn this._clearValue;\n\t}\n\n\tset clearValue(clearValue: number | number[]) {\n\t\tconst { numComponents, type } = this;\n\t\tif (!isValidClearValue(clearValue, numComponents, type)) {\n\t\t\tthrow new Error(`Invalid clearValue: ${JSON.stringify(clearValue)} for DataLayer \"${this.name}\", expected ${type} or array of ${type} of length ${numComponents}.`);\n\t\t}\n\t\tthis._clearValue = clearValue;\n\t}\n\n\tclear(applyToAllBuffers = false) {\n\t\tconst { name, glcompute, clearValue, numBuffers, bufferIndex, type } = this;\n\t\tconst { verboseLogging } = glcompute;\n\t\tif (verboseLogging) console.log(`Clearing DataLayer \"${name}\".`);\n\n\t\tconst value: number[] = [];\n\t\tif (isNumber(clearValue)) {\n\t\t\tvalue.push(clearValue as number, clearValue as number, clearValue as number, clearValue as number);\n\t\t} else {\n\t\t\tvalue.push(...clearValue as number[]);\n\t\t\tfor (let j = value.length; j < 4; j++) {\n\t\t\t\tvalue.push(0);\n\t\t\t}\n\t\t}\n\t\n\t\tconst startIndex = applyToAllBuffers ? 0 : bufferIndex;\n\t\tconst endIndex = applyToAllBuffers ? numBuffers : bufferIndex + 1;\n\t\tif (this.writable) {\n\t\t\tconst program = glcompute._setValueProgramForType(type);\n\t\t\tprogram.setUniform('u_value', value as [number, number, number, number]);\n\t\t\tfor (let i = startIndex; i < endIndex; i++) {\n\t\t\t\t// Write clear value to buffers.\n\t\t\t\tglcompute.step({\n\t\t\t\t\tprogram,\n\t\t\t\t\toutput: this,\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\t// Init a typed array containing clearValue and pass to buffers.\n\t\t\tconst {\n\t\t\t\twidth, height, glNumChannels, internalType,\n\t\t\t\tglInternalFormat, glFormat, glType,\n\t\t\t} = this;\n\t\t\tconst { gl } = glcompute;\n\t\t\tconst fillLength = this._length ? this._length : width * height;\n\t\t\tconst array = DataLayer.initArrayForInternalType(internalType, width * height * glNumChannels);\n\t\t\tconst float16View = internalType === HALF_FLOAT ? new DataView(array.buffer) : null;\n\t\t\tfor (let j = 0; j < fillLength; j++) {\n\t\t\t\tfor (let k = 0; k < glNumChannels; k++) {\n\t\t\t\t\tconst index = j * glNumChannels + k;\n\t\t\t\t\tif (internalType === HALF_FLOAT) {\n\t\t\t\t\t\t// Float16s need to be handled separately.\n\t\t\t\t\t\tsetFloat16(float16View!, 2 * index, value[k], true);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tarray[index] = value[k];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (let i = startIndex; i < endIndex; i++) {\n\t\t\t\tconst texture = this.getStateAtIndex(i);\n\t\t\t\tgl.bindTexture(gl.TEXTURE_2D, texture);\n\t\t\t\tgl.texImage2D(gl.TEXTURE_2D, 0, glInternalFormat, width, height, 0, glFormat, glType, array);\n\t\t\t}\n\t\t\t// Unbind texture.\n\t\t\tgl.bindTexture(gl.TEXTURE_2D, null);\n\t\t}\n\t}\n\n\tget width() {\n\t\treturn this._width;\n\t}\n\n\tget height() {\n\t\treturn this._height;\n\t}\n\n\tget length() {\n\t\tif (!this._length) {\n\t\t\tthrow new Error(`Cannot access length on 2D DataLayer \"${this.name}\".`);\n\t\t}\n\t\treturn this._length;\n\t}\n\n\tprivate destroyBuffers() {\n\t\tconst { glcompute, buffers } = this;\n\t\tconst { gl } = glcompute;\n\t\tbuffers.forEach(buffer => {\n\t\t\tconst { framebuffer, texture } = buffer;\n\t\t\tgl.deleteTexture(texture);\n\t\t\tif (framebuffer) {\n\t\t\t\tgl.deleteFramebuffer(framebuffer);\n\t\t\t}\n\t\t\t// @ts-ignore\n\t\t\tdelete buffer.texture;\n\t\t\tdelete buffer.framebuffer;\n\t\t});\n\t\tbuffers.length = 0;\n\n\t\t// These are technically owned by another DataLayer,\n\t\t// so we are not responsible for deleting them from gl context.\n\t\tdelete this.textureOverrides;\n\t}\n\n\tdispose() {\n\t\tconst { name, glcompute } = this;\n\t\tconst { verboseLogging } = glcompute;\n\t\tif (verboseLogging) console.log(`Deallocating DataLayer \"${name}\".`);\n\t\n\t\tthis.destroyBuffers();\n\t\t// @ts-ignore\n\t\tdelete this.glcompute;\n\t}\n\n\tclone(name?: string) {\n\t\t// Make a deep copy.\n\t\treturn this.glcompute._cloneDataLayer(this, name);\n\t}\n}\n","import { WebGLCompute } from './WebGLCompute';\nimport {\n\tisArray,\n\tisBoolean,\n\tisInteger,\n\tisNumber,\n} from './Checks';\nimport {\n\tFLOAT,\n\tFLOAT_1D_UNIFORM,\n\tFLOAT_2D_UNIFORM,\n\tFLOAT_3D_UNIFORM,\n\tFLOAT_4D_UNIFORM,\n\tINT,\n\tBOOL,\n\tINT_1D_UNIFORM,\n\tINT_2D_UNIFORM,\n\tINT_3D_UNIFORM,\n\tINT_4D_UNIFORM,\n\tUniform,\n\tUniformType,\n\tUniformInternalType,\n\tUniformValue,\n\tCompileTimeVars,\n\tPROGRAM_NAME_INTERNAL,\n\tDEFAULT_PROGRAM_NAME,\n\tDEFAULT_W_UV_PROGRAM_NAME,\n\tDEFAULT_W_NORMAL_PROGRAM_NAME,\n\tDEFAULT_W_UV_NORMAL_PROGRAM_NAME,\n\tSEGMENT_PROGRAM_NAME,\n\tDATA_LAYER_POINTS_PROGRAM_NAME,\n\tDATA_LAYER_VECTOR_FIELD_PROGRAM_NAME,\n\tDATA_LAYER_LINES_PROGRAM_NAME,\n} from './Constants';\nimport {\n\tcompileShader,\n} from './utils';\n\nexport class GPUProgram {\n\t// Keep a reference to WebGLCompute.\n\tprivate readonly glcompute: WebGLCompute;\n\n\treadonly name: string; // Name of DataLayer, used for error logging.\n\n\tprivate fragmentShader!: WebGLShader; // Compiled fragment shader.\n\n\t// Source code for fragment shader.\n\t// Hold onto this in case we need to recompile with different #defines.\n\tprivate readonly fragmentShaderSource: string;\n\t\n\tprivate defines: CompileTimeVars = {}; // #define variables for fragment shader program.\n\tprivate readonly uniforms: { [ key: string]: Uniform } = {}; // Uniform locations, values, and types.\n\n\t// Store WebGLPrograms programs - we need to compile several WebGLPrograms of GPUProgram.fragmentShader + various vertex shaders.\n\t// Each combination of vertex + fragment shader requires a separate WebGLProgram.\n\t// These programs are compiled as needed.\n\tprivate programs: {[key in PROGRAM_NAME_INTERNAL]?: WebGLProgram } = {};\n\n\tconstructor(\n\t\tglcompute: WebGLCompute,\n\t\tparams: {\n\t\t\tname: string,\n\t\t\t// We may want to pass in an array of shader string sources, if split across several files.\n\t\t\tfragmentShader: string | string[],\n\t\t\tuniforms?: {\n\t\t\t\tname: string,\n\t\t\t\tvalue: UniformValue,\n\t\t\t\ttype: UniformType,\n\t\t\t}[],\n\t\t\t// We'll allow some compile-time variables to be passed in as #define to the preprocessor for the fragment shader.\n\t\t\tdefines?: CompileTimeVars,\n\t\t},\n\t\t\n\t) {\n\t\tconst { name, fragmentShader, uniforms, defines } = params;\n\n\t\t// Save arguments.\n\t\tthis.glcompute = glcompute;\n\t\tthis.name = name;\n\n\t\t// Compile fragment shader.\n\t\tlet sourceString = typeof(fragmentShader) === 'string' ?\n\t\t\tfragmentShader :\n\t\t\t(fragmentShader as string[]).join('\\n');\n\t\tthis.fragmentShaderSource = sourceString;\n\t\tthis.recompile(defines || this.defines);\n\n\t\tif (uniforms) {\n\t\t\tfor (let i = 0; i < uniforms?.length; i++) {\n\t\t\t\tconst { name, value, type } = uniforms[i];\n\t\t\t\tthis.setUniform(name, value, type);\n\t\t\t}\n\t\t}\n\t}\n\n\trecompile(defines: CompileTimeVars) {\n\t\tconst { glcompute, name, fragmentShaderSource } = this;\n\t\tconst { gl, _errorCallback, verboseLogging } = glcompute;\n\n\t\t// Update this.defines if needed.\n\t\t// Passed in defines param may only be a partial list.\n\t\tlet definesNeedUpdate = false;\n\t\tconst keys = Object.keys(defines);\n\t\tfor (let i = 0; i < keys.length; i++) {\n\t\t\tconst key = keys[i];\n\t\t\tif (this.defines[key] !== defines[key]) {\n\t\t\t\tdefinesNeedUpdate = true;\n\t\t\t\tthis.defines[key] = defines[key];\n\t\t\t}\n\t\t}\n\t\t\n\t\tif (this.fragmentShader && !definesNeedUpdate) {\n\t\t\t// No need to recompile.\n\t\t\treturn;\n\t\t}\n\n\t\tif (verboseLogging) console.log(`Compiling fragment shader for GPUProgram \"${name}\" with defines: ${JSON.stringify(this.defines)}`);\n\t\tconst shader = compileShader(glcompute, fragmentShaderSource, gl.FRAGMENT_SHADER, name, this.defines);\n\t\tif (!shader) {\n\t\t\t_errorCallback(`Unable to compile fragment shader for GPUProgram \"${name}\".`);\n\t\t\treturn;\n\t\t}\n\t\tthis.fragmentShader = shader;\n\t}\n\n\tprivate initProgram(vertexShader: WebGLShader, programName: PROGRAM_NAME_INTERNAL) {\n\t\tconst { glcompute, fragmentShader, uniforms } = this;\n\t\tconst { gl, _errorCallback} = glcompute;\n\t\t// Create a program.\n\t\tconst program = gl.createProgram();\n\t\tif (!program) {\n\t\t\t_errorCallback(`Unable to init gl program, gl.createProgram() has failed.`);\n\t\t\treturn;\n\t\t}\n\t\t// TODO: check that attachShader worked.\n\t\tgl.attachShader(program, fragmentShader);\n\t\tgl.attachShader(program, vertexShader);\n\t\t// Link the program.\n\t\tgl.linkProgram(program);\n\t\t// Check if it linked.\n\t\tconst success = gl.getProgramParameter(program, gl.LINK_STATUS);\n\t\tif (!success) {\n\t\t\t// Something went wrong with the link.\n\t\t\t_errorCallback(`Program \"${this.name}\" failed to link: ${gl.getProgramInfoLog(program)}`);\n\t\t\treturn;\n\t\t}\n\t\t// If we have any uniforms set for this GPUProgram, add those to WebGLProgram we just inited.\n\t\tconst uniformNames = Object.keys(uniforms);\n\t\tfor (let i = 0; i < uniformNames.length; i++) {\n\t\t\tconst uniformName = uniformNames[i];\n\t\t\tconst uniform = uniforms[uniformName];\n\t\t\tconst { value, type } = uniform;\n\t\t\tthis.setProgramUniform(program, programName, uniformName, value, type);\n\t\t}\n\t\treturn program;\n\t}\n\n\tprivate getProgramWithName(name: PROGRAM_NAME_INTERNAL) {\n\t\tif (this.programs[name]) return this.programs[name];\n\t\tconst { glcompute } = this;\n\t\tconst { _errorCallback, _vertexShaders } = glcompute;\n\t\tconst vertexShader = _vertexShaders[name];\n\t\tif (vertexShader.shader === undefined) {\n\t\t\tconst { glcompute } = this;\n\t\t\tconst { gl } = glcompute;\n\t\t\t// Init a vertex shader.\n\t\t\tlet vertexShaderSource = glcompute._preprocessVertShader(vertexShader.src);\n\t\t\tif (vertexShaderSource === '') {\n\t\t\t\tthrow new Error(`No source for vertex shader ${this.name} : ${name}`)\n\t\t\t}\n\t\t\tconst shader = compileShader(glcompute, vertexShaderSource, gl.VERTEX_SHADER, this.name, vertexShader.defines);\n\t\t\tif (!shader) {\n\t\t\t\t_errorCallback(`Unable to compile \"${name}\" vertex shader for GPUProgram \"${this.name}\".`);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvertexShader.shader = shader;\n\t\t}\n\t\tconst program = this.initProgram(vertexShader.shader, DEFAULT_PROGRAM_NAME);\n\t\tif (program === undefined) {\n\t\t\t_errorCallback(`Unable to init program \"${name}\" for GPUProgram \"${this.name}\".`);\n\t\t\treturn;\n\t\t}\n\t\tthis.programs[name] = program;\n\t\treturn program;\n\t}\n\n\t// These getters are used internally.\n\tget _defaultProgram() {\n\t\treturn this.getProgramWithName(DEFAULT_PROGRAM_NAME);\n\t}\n\tget _defaultProgramWithUV() {\n\t\treturn this.getProgramWithName(DEFAULT_W_UV_PROGRAM_NAME);\n\t}\n\tget _defaultProgramWithNormal() {\n\t\treturn this.getProgramWithName(DEFAULT_W_NORMAL_PROGRAM_NAME);\n\t}\n\tget _defaultProgramWithUVNormal() {\n\t\treturn this.getProgramWithName(DEFAULT_W_UV_NORMAL_PROGRAM_NAME);\n\t}\n\tget _segmentProgram() {\n\t\treturn this.getProgramWithName(SEGMENT_PROGRAM_NAME);\n\t}\n\tget _dataLayerPointsProgram() {\n\t\treturn this.getProgramWithName(DATA_LAYER_POINTS_PROGRAM_NAME);\n\t}\n\tget _dataLayerVectorFieldProgram() {\n\t\treturn this.getProgramWithName(DATA_LAYER_VECTOR_FIELD_PROGRAM_NAME);\n\t}\n\tget _dataLayerLinesProgram() {\n\t\treturn this.getProgramWithName(DATA_LAYER_LINES_PROGRAM_NAME);\n\t}\n\n\tprivate uniformInternalTypeForValue(\n\t\tvalue: UniformValue,\n\t\ttype: UniformType,\n\t) {\n\t\tif (type === FLOAT) {\n\t\t\t// Check that we are dealing with a number.\n\t\t\tif (isArray(value)) {\n\t\t\t\tfor (let i = 0; i < (value as number[]).length; i++) {\n\t\t\t\t\tif (!isNumber((value as number[])[i])) {\n\t\t\t\t\t\tthrow new Error(`Invalid uniform value: ${value} for program \"${this.name}\", expected float or float[] of length 1-4.`);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (!isNumber(value)) {\n\t\t\t\t\tthrow new Error(`Invalid uniform value: ${value} for program \"${this.name}\", expected float or float[] of length 1-4.`);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!isArray(value) || (value as number[]).length === 1) {\n\t\t\t\treturn FLOAT_1D_UNIFORM;\n\t\t\t}\n\t\t\tif ((value as number[]).length === 2) {\n\t\t\t\treturn FLOAT_2D_UNIFORM;\n\t\t\t}\n\t\t\tif ((value as number[]).length === 3) {\n\t\t\t\treturn FLOAT_3D_UNIFORM;\n\t\t\t}\n\t\t\tif ((value as number[]).length === 4) {\n\t\t\t\treturn FLOAT_4D_UNIFORM;\n\t\t\t}\n\t\t\tthrow new Error(`Invalid uniform value: ${value} for program \"${this.name}\", expected float or float[] of length 1-4.`);\n\t\t} else if (type === INT) {\n\t\t\t// Check that we are dealing with an int.\n\t\t\tif (isArray(value)) {\n\t\t\t\tfor (let i = 0; i < (value as number[]).length; i++) {\n\t\t\t\t\tif (!isInteger((value as number[])[i])) {\n\t\t\t\t\t\tthrow new Error(`Invalid uniform value: ${value} for program \"${this.name}\", expected int or int[] of length 1-4.`);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (!isInteger(value)) {\n\t\t\t\t\tthrow new Error(`Invalid uniform value: ${value} for program \"${this.name}\", expected int or int[] of length 1-4.`);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!isArray(value) || (value as number[]).length === 1) {\n\t\t\t\treturn INT_1D_UNIFORM;\n\t\t\t}\n\t\t\tif ((value as number[]).length === 2) {\n\t\t\t\treturn INT_2D_UNIFORM;\n\t\t\t}\n\t\t\tif ((value as number[]).length === 3) {\n\t\t\t\treturn INT_3D_UNIFORM;\n\t\t\t}\n\t\t\tif ((value as number[]).length === 4) {\n\t\t\t\treturn INT_4D_UNIFORM;\n\t\t\t}\n\t\t\tthrow new Error(`Invalid uniform value: ${value} for program \"${this.name}\", expected int or int[] of length 1-4.`);\n\t\t} else if (type === BOOL) {\n\t\t\tif (isBoolean(value)) {\n\t\t\t\t// Boolean types are passed in as ints.\n\t\t\t\t// This suggest floats work as well, but ints seem more natural:\n\t\t\t\t// https://github.com/KhronosGroup/WebGL/blob/main/sdk/tests/conformance/uniforms/gl-uniform-bool.html\n\t\t\t\treturn INT_1D_UNIFORM;\n\t\t\t}\n\t\t\tthrow new Error(`Invalid uniform value: ${value} for program \"${this.name}\", expected boolean.`);\n\t\t} else {\n\t\t\tthrow new Error(`Invalid uniform type: ${type} for program \"${this.name}\", expected ${FLOAT} or ${INT} of ${BOOL}.`);\n\t\t}\n\t}\n\n\tprivate setProgramUniform(\n\t\tprogram: WebGLProgram,\n\t\tprogramName: string,\n\t\tname: string,\n\t\tvalue: UniformValue,\n\t\ttype: UniformInternalType,\n\t) {\n\t\tconst { glcompute, uniforms } = this;\n\t\tconst { gl, _errorCallback } = glcompute;\n\t\t// Set active program.\n\t\tgl.useProgram(program);\n\n\t\tlet location = uniforms[name]?.location[programName];\n\t\t// Init a location for WebGLProgram if needed.\n\t\tif (location === undefined) {\n\t\t\tconst _location = gl.getUniformLocation(program, name);\n\t\t\tif (!_location) {\n\t\t\t\t_errorCallback(`Could not init uniform \"${name}\" for program \"${this.name}\".\nCheck that uniform is present in shader code, unused uniforms may be removed by compiler.\nAlso check that uniform type in shader code matches type ${type}.\nError code: ${gl.getError()}.`);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlocation = _location;\n\t\t\t// Save location for future use.\n\t\t\tif (uniforms[name]) {\n\t\t\t\tuniforms[name].location[programName] = location;\n\t\t\t}\n\t\t}\n\n\t\t// Set uniform.\n\t\t// https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/uniform\n\t\tswitch (type) {\n\t\t\tcase FLOAT_1D_UNIFORM:\n\t\t\t\tgl.uniform1f(location, value as number);\n\t\t\t\tbreak;\n\t\t\tcase FLOAT_2D_UNIFORM:\n\t\t\t\tgl.uniform2fv(location, value as number[]);\n\t\t\t\tbreak;\n\t\t\tcase FLOAT_3D_UNIFORM:\n\t\t\t\tgl.uniform3fv(location, value as number[]);\n\t\t\t\tbreak;\n\t\t\tcase FLOAT_4D_UNIFORM:\n\t\t\t\tgl.uniform4fv(location, value as number[]);\n\t\t\t\tbreak;\n\t\t\tcase INT_1D_UNIFORM:\n\t\t\t\tif (isBoolean(value)) {\n\t\t\t\t\t// We are setting boolean uniforms with uniform1i.\n\t\t\t\t\tgl.uniform1i(location, value ? 1 : 0);\n\t\t\t\t} else {\n\t\t\t\t\tgl.uniform1i(location, value as number);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase INT_2D_UNIFORM:\n\t\t\t\tgl.uniform2iv(location, value as number[]);\n\t\t\t\tbreak;\n\t\t\tcase INT_3D_UNIFORM:\n\t\t\t\tgl.uniform3iv(location, value as number[]);\n\t\t\t\tbreak;\n\t\t\tcase INT_4D_UNIFORM:\n\t\t\t\tgl.uniform4iv(location, value as number[]);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthrow new Error(`Unknown uniform type ${type} for GPUProgram \"${this.name}\".`);\n\t\t}\n\t}\n\n\tsetUniform(\n\t\tname: string,\n\t\tvalue: UniformValue,\n\t\ttype?: UniformType,\n\t) {\n\t\tconst { programs, uniforms, glcompute } = this;\n\t\tconst { verboseLogging } = glcompute;\n\n\t\t// Check that length of value is correct.\n\t\tif (isArray(value)) {\n\t\t\tconst length = (value as number[]).length;\n\t\t\tif (length > 4) throw new Error(`Invalid uniform value: [${(value as number[]).join(', ')}] passed to GPUProgram \"${this.name}, uniforms must be of type number[] with length <= 4, number, or boolean.\"`)\n\t\t}\n\n\t\tlet currentType = uniforms[name]?.type;\n\t\tif (type) {\n\t\t\tconst internalType = this.uniformInternalTypeForValue(value, type);\n\t\t\tif (currentType === undefined) currentType = internalType;\n\t\t\telse {\n\t\t\t\t// console.warn(`Don't need to pass in type to GPUProgram.setUniform for previously inited uniform \"${uniformName}\"`);\n\t\t\t\t// Check that types match previously set uniform.\n\t\t\t\tif (currentType !== internalType) {\n\t\t\t\t\tthrow new Error(`Uniform \"${name}\" for GPUProgram \"${this.name}\" cannot change from type ${currentType} to type ${internalType}.`);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (currentType === undefined) {\n\t\t\tthrow new Error(`Unknown type for uniform \"${name}\", please pass in type to GPUProgram.setUniform(name, value, type) when initing a new uniform.`);\n\t\t}\n\n\t\tif (!uniforms[name]) {\n\t\t\t// Init uniform if needed.\n\t\t\tuniforms[name] = { type: currentType, location: {}, value };\n\t\t} else {\n\t\t\t// Deep check is value has changed.\n\t\t\tif (isArray(value)) {\n\t\t\t\tlet isChanged = true;\n\t\t\t\tfor (let i = 0; i < (value as number[]).length; i++) {\n\t\t\t\t\tif (uniforms[name].value !== value) {\n\t\t\t\t\t\tisChanged = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!isChanged) return; // No change.\n\t\t\t} else if (uniforms[name].value === value) {\n\t\t\t\treturn; // No change.\n\t\t\t}\n\t\t\t// Update value.\n\t\t\tuniforms[name].value = value;\n\t\t}\n\n\t\tif (verboseLogging) console.log(`Setting uniform \"${name}\" for program \"${this.name}\" to value ${JSON.stringify(value)} with type ${currentType}.`)\n\n\t\t// Update any active programs.\n\t\tconst keys = Object.keys(programs);\n\t\tfor (let i = 0; i < keys.length; i++) {\n\t\t\tconst programName = keys[i] as PROGRAM_NAME_INTERNAL;\n\t\t\tthis.setProgramUniform(programs[programName]!, programName, name, value, currentType);\n\t\t}\n\t};\n\n\t// This is used internally.\n\t_setVertexUniform(\n\t\tprogram: WebGLProgram,\n\t\tuniformName: string,\n\t\tvalue: UniformValue,\n\t\ttype: UniformType,\n\t) {\n\t\tconst internalType = this.uniformInternalTypeForValue(value, type);\n\t\tif (program === undefined) {\n\t\t\tthrow new Error('Must pass in valid WebGLProgram to setVertexUniform, got undefined.');\n\t\t}\n\t\tconst programName = Object.keys(this.programs).find(key => this.programs[key as PROGRAM_NAME_INTERNAL] === program);\n\t\tif (!programName) {\n\t\t\tthrow new Error(`Could not find valid vertex programName for WebGLProgram \"${this.name}\".`);\n\t\t}\n\t\tthis.setProgramUniform(program, programName, uniformName, value, internalType);\n\t}\n\n\tdispose() {\n\t\tconst { glcompute, fragmentShader, programs } = this;\n\t\tconst { gl, verboseLogging } = glcompute;\n\n\t\tif (verboseLogging) console.log(`Deallocating GPUProgram \"${this.name}\".`);\n\n\t\t// Unbind all gl data before deleting.\n\t\tObject.values(programs).forEach(program => {\n\t\t\tgl.deleteProgram(program!);\n\t\t});\n\t\tObject.keys(this.programs).forEach(key => {\n\t\t\tdelete this.programs[key as PROGRAM_NAME_INTERNAL];\n\t\t});\n\n\t\t// Delete fragment shader.\n\t\tgl.deleteShader(fragmentShader);\n\t\t// @ts-ignore\n\t\tdelete this.fragmentShader;\n\n\t\t// @ts-ignore\n\t\tdelete this.glcompute;\n\t}\n}\n","// These are the parts of threejs Vector4 that we need.\nexport class Vector4 {\n\tx: number;\n\ty: number;\n\tz: number;\n\tw: number;\n\tconstructor( x = 0, y = 0, z = 0, w = 1 ) {\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t\tthis.z = z;\n\t\tthis.w = w;\n\t}\n\tget width() {\n\t\treturn this.z;\n\t}\n\tget height() {\n\t\treturn this.w;\n\t}\n\tcopy(v: Vector4) {\n\t\tthis.x = v.x;\n\t\tthis.y = v.y;\n\t\tthis.z = v.z;\n\t\tthis.w = v.w;\n\t\treturn this;\n\t}\n}","import { saveAs } from 'file-saver';\n// @ts-ignore\nimport { changeDpiBlob } from 'changedpi';\nimport { DataLayer } from './DataLayer';\nimport {\n\tDataLayerArray,\n\tDataLayerFilter,\n\tDataLayerNumComponents,\n\tDataLayerType,\n\tDataLayerWrap,\n\tFLOAT,\n\tHALF_FLOAT,\n\tUNSIGNED_BYTE,\n\tBYTE,\n\tUNSIGNED_SHORT,\n\tSHORT,\n\tUNSIGNED_INT,\n\tINT,\n\tUniformType,\n\tUniformValue,\n\tGLSLVersion,\n\tGLSL1,\n\tGLSL3,\n\tCLAMP_TO_EDGE,\n\tTextureFormat,\n\tNEAREST,\n\tRGBA,\n\tTextureType,\n\tPROGRAM_NAME_INTERNAL,\n\tCompileTimeVars,\n\tDEFAULT_PROGRAM_NAME,\n\tDEFAULT_W_UV_PROGRAM_NAME,\n\tDEFAULT_W_NORMAL_PROGRAM_NAME,\n\tDEFAULT_W_UV_NORMAL_PROGRAM_NAME,\n\tSEGMENT_PROGRAM_NAME,\n\tDATA_LAYER_POINTS_PROGRAM_NAME,\n\tDATA_LAYER_VECTOR_FIELD_PROGRAM_NAME,\n\tDATA_LAYER_LINES_PROGRAM_NAME,\n\tErrorCallback,\n\tDEFAULT_CIRCLE_NUM_SEGMENTS,\n\tvalidFilters,\n\tvalidWraps,\n\tvalidTextureFormats,\n\tvalidTextureTypes,\n\tUINT,\n} from './Constants';\nimport { GPUProgram } from './GPUProgram';\n// Just importing the types here.\n// Only @types/three is installed as dev dependency.\nimport {\n\tWebGLRenderer,\n\tTexture,\n\tVector4,\n} from 'three';\nimport * as utils from './Vector4';\nimport {\n\tisWebGL2,\n\tisPowerOf2,\n\tinitSequentialFloatArray,\n\tinDevMode,\n} from './utils';\nimport { getFloat16 } from '@petamoriken/float16';\nimport {\n\tisArray,\n\tisString,\n\tisValidFilter,\n\tisValidTextureType,\n\tisValidTextureFormat,\n\tisValidWrap,\n} from './Checks';\nconst defaultVertexShaderSource = require('./glsl/vert/DefaultVertShader.glsl');\n\nexport class WebGLCompute {\n\treadonly gl!: WebGLRenderingContext | WebGL2RenderingContext;\n\treadonly glslVersion!: GLSLVersion;\n\t// These width and height are the current canvas at full res.\n\tprivate width!: number;\n\tprivate height!: number;\n\n\tprivate errorState = false;\n\t// For internal use only.\n\treadonly _errorCallback: ErrorCallback;\n\n\t// Save threejs renderer if passed in.\n\tprivate renderer?: WebGLRenderer;\n\tprivate readonly maxNumTextures!: number;\n\t\n\t// Precomputed buffers (inited as needed).\n\tprivate _quadPositionsBuffer?: WebGLBuffer;\n\tprivate _boundaryPositionsBuffer?: WebGLBuffer;\n\t// Store multiple circle positions buffers for various num segments, use numSegments as key.\n\tprivate _circlePositionsBuffer: { [key: number]: WebGLBuffer } = {};\n\n\tprivate pointIndexArray?: Float32Array;\n\tprivate pointIndexBuffer?: WebGLBuffer;\n\tprivate vectorFieldIndexArray?: Float32Array;\n\tprivate vectorFieldIndexBuffer?: WebGLBuffer;\n\tprivate indexedLinesIndexBuffer?: WebGLBuffer;\n\n\t// Programs for copying data (these are needed for rendering partial screen geometries).\n\tprivate readonly copyPrograms: {\n\t\tsrc: string,\n\t\t[FLOAT]?: GPUProgram,\n\t\t[INT]?: GPUProgram,\n\t\t[UINT]?: GPUProgram,\n\t} = {\n\t\tsrc: require('./glsl/frag/CopyFragShader.glsl'),\n\t};\n\n\t// Other util programs.\n\tprivate readonly setValuePrograms: {\n\t\tsrc: string,\n\t\t[FLOAT]?: GPUProgram,\n\t\t[INT]?: GPUProgram,\n\t\t[UINT]?: GPUProgram,\n\t} = {\n\t\tsrc: require('./glsl/frag/SetValueFragShader.glsl'),\n\t};\n\tprivate _wrappedLineColorProgram?: GPUProgram; // We only need a FLOAT version of this.\n\tprivate readonly vectorMagnitudePrograms: {\n\t\tsrc: string,\n\t\t[FLOAT]?: GPUProgram,\n\t\t[INT]?: GPUProgram,\n\t\t[UINT]?: GPUProgram,\n\t} = {\n\t\tsrc: require('./glsl/frag/VectorMagnitudeFragShader.glsl'),\n\t};\n\n\t// Vertex shaders are shared across all GPUProgram instances.\n\treadonly _vertexShaders: {[key in PROGRAM_NAME_INTERNAL]: {\n\t\tsrc: string,\n\t\tshader?: WebGLProgram,\n\t\tdefines?: CompileTimeVars,\n\t}} = {\n\t\t[DEFAULT_PROGRAM_NAME]: {\n\t\t\tsrc: defaultVertexShaderSource,\n\t\t},\n\t\t[DEFAULT_W_UV_PROGRAM_NAME]: {\n\t\t\tsrc: defaultVertexShaderSource,\n\t\t\tdefines: {\n\t\t\t\t'UV_ATTRIBUTE': '1',\n\t\t\t},\n\t\t},\n\t\t[DEFAULT_W_NORMAL_PROGRAM_NAME]: {\n\t\t\tsrc: defaultVertexShaderSource,\n\t\t\tdefines: {\n\t\t\t\t'NORMAL_ATTRIBUTE': '1',\n\t\t\t},\n\t\t},\n\t\t[DEFAULT_W_UV_NORMAL_PROGRAM_NAME]: {\n\t\t\tsrc: defaultVertexShaderSource,\n\t\t\tdefines: {\n\t\t\t\t'UV_ATTRIBUTE': '1',\n\t\t\t\t'NORMAL_ATTRIBUTE': '1',\n\t\t\t},\n\t\t},\n\t\t[SEGMENT_PROGRAM_NAME]: {\n\t\t\tsrc: require('./glsl/vert/SegmentVertShader.glsl'),\n\t\t},\n\t\t[DATA_LAYER_POINTS_PROGRAM_NAME]: {\n\t\t\tsrc: require('./glsl/vert/DataLayerPointsVertShader.glsl'),\n\t\t},\n\t\t[DATA_LAYER_VECTOR_FIELD_PROGRAM_NAME]: {\n\t\t\tsrc: require('./glsl/vert/DataLayerVectorFieldVertShader.glsl'),\n\t\t},\n\t\t[DATA_LAYER_LINES_PROGRAM_NAME]: {\n\t\t\tsrc: require('./glsl/vert/DataLayerLinesVertShader.glsl'),\n\t\t},\n\t};\n\n\tverboseLogging = false;\n\n\tstatic initWithThreeRenderer(\n\t\trenderer: WebGLRenderer,\n\t\tparams?: {\n\t\t\tglslVersion?: GLSLVersion,\n\t\t\tverboseLogging?: boolean\n\t\t},\n\t\terrorCallback?: ErrorCallback,\n\t) {\n\t\treturn new WebGLCompute(\n\t\t\t{\n\t\t\t\tcanvas: renderer.domElement,\n\t\t\t\tcontext: renderer.getContext(),\n\t\t\t\t...params,\n\t\t\t},\n\t\t\terrorCallback,\n\t\t\trenderer,\n\t\t);\n\t}\n\n\tconstructor(\n\t\tparams: {\n\t\t\tcanvas: HTMLCanvasElement,\n\t\t\tcontext?: WebGLRenderingContext | WebGL2RenderingContext | null,\n\t\t\tcontextID?: 'webgl2' | 'webgl' | string,\n\t\t\tcontextOptions?: {\n\t\t\t\tantialias?: boolean,\n\t\t\t\t[key: string]: any,\n\t\t\t},\n\t\t\tglslVersion?: GLSLVersion,\n\t\t\tverboseLogging?: boolean,\n\t\t},\n\t\t// Optionally pass in an error callback in case we want to handle errors related to webgl support.\n\t\t// e.g. throw up a modal telling user this will not work on their device.\n\t\terrorCallback: ErrorCallback = (message: string) => { throw new Error(message) },\n\t\trenderer?: WebGLRenderer,\n\t) {\n\t\t// Check params.\n\t\tconst validKeys = ['canvas', 'context', 'contextID', 'contextOptions', 'glslVersion', 'verboseLogging'];\n\t\tObject.keys(params).forEach(key => {\n\t\t\tif (validKeys.indexOf(key) < 0) {\n\t\t\t\tthrow new Error(`Invalid key \"${key}\" passed to WebGLCompute.constructor.  Valid keys are ${validKeys.join(', ')}.`);\n\t\t\t}\n\t\t});\n\n\t\tif (!params.canvas) {\n\t\t\tthrow new Error(`Must init WebGLCompute with a canvas.`);\n\t\t}\n\n\t\tif (params.verboseLogging !== undefined) this.verboseLogging = params.verboseLogging;\n\n\t\t// Save callback in case we run into an error.\n\t\tconst self = this;\n\t\tthis._errorCallback = (message: string) => {\n\t\t\tif (self.errorState) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tself.errorState = true;\n\t\t\terrorCallback(message);\n\t\t}\n\n\t\tconst { canvas } = params;\n\t\tlet gl = params.context;\n\n\t\t// Init GL.\n\t\tif (!gl) {\n\t\t\t// Init a gl context if not passed in.\n\t\t\tif (params.contextID) {\n\t\t\t\tgl = canvas.getContext(params.contextID, params.contextOptions)  as WebGLRenderingContext | null;\n\t\t\t\tif (!gl) {\n\t\t\t\t\tconsole.warn(`Unable to initialize WebGL context with contextID: ${params.contextID}.`);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!gl) {\n\t\t\t\tgl = canvas.getContext('webgl2', params.contextOptions)  as WebGL2RenderingContext | null\n\t\t\t\t\t|| canvas.getContext('webgl', params.contextOptions)  as WebGLRenderingContext | null\n\t\t\t\t\t|| canvas.getContext('experimental-webgl', params.contextOptions)  as WebGLRenderingContext | null;\n\t\t\t}\n\t\t\tif (gl === null) {\n\t\t\t\tthis._errorCallback('Unable to initialize WebGL context.');\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tif (isWebGL2(gl)) {\n\t\t\tif (inDevMode()) console.log('Using WebGL 2.0 context.');\n\t\t} else {\n\t\t\tif (inDevMode()) console.log('Using WebGL 1.0 context.');\n\t\t}\n\t\tthis.gl = gl;\n\t\tthis.renderer = renderer;\n\n\t\t// Save glsl version, default to 1.x.\n\t\tlet glslVersion = params.glslVersion === undefined ? GLSL1 : params.glslVersion;\n\t\tif (!isWebGL2(gl) && glslVersion === GLSL3) {\n\t\t\tconsole.warn('GLSL3.x is incompatible with WebGL1.0 contexts, falling back to GLSL1.');\n\t\t\tglslVersion = GLSL1; // Fall back to GLSL1 in these cases.\n\t\t}\n\t\tthis.glslVersion = glslVersion;\n\n\t\t// GL setup.\n\t\t// Disable depth testing globally.\n\t\tgl.disable(gl.DEPTH_TEST);\n\t\t// Set unpack alignment to 1 so we can have textures of arbitrary dimensions.\n\t\t// https://stackoverflow.com/questions/51582282/error-when-creating-textures-in-webgl-with-the-rgb-format\n\t\tgl.pixelStorei(gl.UNPACK_ALIGNMENT, 1);\n\t\t// TODO: look into more of these: https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/pixelStorei\n\t\t// // Some implementations of HTMLCanvasElement's or OffscreenCanvas's CanvasRenderingContext2D store color values\n\t\t// // internally in premultiplied form. If such a canvas is uploaded to a WebGL texture with the\n\t\t// // UNPACK_PREMULTIPLY_ALPHA_WEBGL pixel storage parameter set to false, the color channels will have to be un-multiplied\n\t\t// // by the alpha channel, which is a lossy operation. The WebGL implementation therefore can not guarantee that colors\n\t\t// // with alpha < 1.0 will be preserved losslessly when first drawn to a canvas via CanvasRenderingContext2D and then\n\t\t// // uploaded to a WebGL texture when the UNPACK_PREMULTIPLY_ALPHA_WEBGL pixel storage parameter is set to false.\n\t\t// gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, true);\n\n\t\t// Unbind active buffer.\n\t\tgl.bindBuffer(gl.ARRAY_BUFFER, null);\n\n\t\t// Canvas setup.\n\t\tthis.onResize(canvas);\n\n\t\t// Log number of textures available.\n\t\tthis.maxNumTextures = this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS);\n\t\tif (inDevMode()) console.log(`${this.maxNumTextures} textures max.`);\n\t}\n\n\tprivate preprocessShader(shaderSource: string) {\n\t\t// Convert to glsl1.\n\t\t// Get rid of version declaration.\n\t\tshaderSource = shaderSource.replace('#version 300 es', '');\n\t\t// Remove unnecessary precision declarations.\n\t\tshaderSource = shaderSource.replace(/precision \\w+ isampler2D;/g, '');\n\t\tshaderSource = shaderSource.replace(/precision \\w+ usampler2D;/g, '');\n\t\t// Convert types.\n\t\tshaderSource = shaderSource.replace(/uvec2/g, 'vec2');\n\t\tshaderSource = shaderSource.replace(/uvec3/g, 'vec3');\n\t\tshaderSource = shaderSource.replace(/uvec4/g, 'vec4');\n\t\tshaderSource = shaderSource.replace(/usampler2D/g, 'sampler2D');\n\t\tshaderSource = shaderSource.replace(/ivec2/g, 'vec2');\n\t\tshaderSource = shaderSource.replace(/ivec3/g, 'vec3');\n\t\tshaderSource = shaderSource.replace(/ivec4/g, 'vec4');\n\t\tshaderSource = shaderSource.replace(/isampler2D/g, 'sampler2D');\n\t\t// Convert functions.\n\t\tshaderSource = shaderSource.replace(/texture\\(/g, 'texture2D(');\n\t\treturn shaderSource;\n\t}\n\n\t// Used internally.\n\t_preprocessFragShader(shaderSource: string) {\n\t\tconst { glslVersion } = this;\n\t\tif (glslVersion === GLSL3) return shaderSource;\n\t\t// Convert to glsl1.\n\t\tshaderSource = this.preprocessShader(shaderSource);\n\t\t// Convert in to varying.\n\t\tshaderSource = shaderSource.replace(/\\n\\s*in\\s+/g, '\\nvarying ');\n\t\tshaderSource = shaderSource.replace(/;\\s*in\\s+/g, ';varying ');\n\t\t// Convert out to gl_FragColor.\n\t\tshaderSource = shaderSource.replace(/out \\w+ out_fragOut;/g, '');\n\t\tshaderSource = shaderSource.replace(/out_fragOut\\s+=/, 'gl_FragColor =');\n\t\treturn shaderSource;\n\t}\n\n\t// Used internally.\n\t_preprocessVertShader(shaderSource: string) {\n\t\tconst { glslVersion } = this;\n\t\tif (glslVersion === GLSL3) return shaderSource;\n\t\t// Convert to glsl1.\n\t\tshaderSource = this.preprocessShader(shaderSource);\n\t\t// Convert in to attribute.\n\t\tshaderSource = shaderSource.replace(/\\n\\s*in\\s+/g, '\\nattribute ');\n\t\tshaderSource = shaderSource.replace(/;\\s*in\\s+/g, ';attribute ');\n\t\t// Convert out to varying.\n\t\tshaderSource = shaderSource.replace(/\\n\\s*out\\s+/g, '\\nvarying ');\n\t\tshaderSource = shaderSource.replace(/;\\s*out\\s+/g, ';varying ');\n\t\treturn shaderSource;\n\t}\n\n\tprivate glslKeyForType(type: DataLayerType) {\n\t\tif (this.glslVersion === GLSL1) return FLOAT;\n\t\tswitch (type) {\n\t\t\tcase HALF_FLOAT:\n\t\t\tcase FLOAT:\n\t\t\t\treturn FLOAT;\n\t\t\tcase UNSIGNED_BYTE:\n\t\t\tcase UNSIGNED_SHORT:\n\t\t\tcase UNSIGNED_INT:\n\t\t\t\treturn UINT;\n\t\t\tcase BYTE:\n\t\t\tcase SHORT:\n\t\t\tcase INT:\n\t\t\t\treturn INT;\n\t\t\tdefault:\n\t\t\t\tthrow new Error(`Invalid type: ${type} passed to WebGLCompute.copyProgramForType.`);\n\t\t}\n\t}\n\n\t// Used internally.\n\t_setValueProgramForType(type: DataLayerType) {\n\t\tconst key = this.glslKeyForType(type);\n\t\tif (this.setValuePrograms[key] === undefined) {\n\t\t\tconst program = this.initProgram({\n\t\t\t\tname: `setValue-${key}`,\n\t\t\t\tfragmentShader: this._preprocessFragShader(this.setValuePrograms.src),\n\t\t\t\tuniforms: [\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'u_value',\n\t\t\t\t\t\tvalue: [0, 0, 0, 0],\n\t\t\t\t\t\ttype: key === UINT ? INT : key, // TODO: is there a uint type?\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tdefines: {\n\t\t\t\t\t[key]: '1',\n\t\t\t\t},\n\t\t\t});\n\t\t\tthis.setValuePrograms[key] = program;\n\t\t}\n\t\treturn this.setValuePrograms[key]!;\n\t}\n\n\tprivate copyProgramForType(type: DataLayerType) {\n\t\tconst key = this.glslKeyForType(type);\n\t\tif (this.copyPrograms[key] === undefined) {\n\t\t\tconst program = this.initProgram({\n\t\t\t\tname: `copy-${key}`,\n\t\t\t\tfragmentShader: this._preprocessFragShader(this.copyPrograms.src),\n\t\t\t\tuniforms: [\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'u_state',\n\t\t\t\t\t\tvalue: 0,\n\t\t\t\t\t\ttype: INT,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tdefines: {\n\t\t\t\t\t[key]: '1',\n\t\t\t\t},\n\t\t\t});\n\t\t\tthis.copyPrograms[key] = program;\n\t\t}\n\t\treturn this.copyPrograms[key]!;\n\t}\n\n\tprivate get wrappedLineColorProgram() {\n\t\tif (this._wrappedLineColorProgram === undefined) {\n\t\t\tconst program = this.initProgram({\n\t\t\t\tname: 'wrappedLineColor',\n\t\t\t\tfragmentShader: this._preprocessFragShader(require('./glsl/frag/WrappedLineColorFragShader.glsl')),\n\t\t\t});\n\t\t\tthis._wrappedLineColorProgram = program;\n\t\t}\n\t\treturn this._wrappedLineColorProgram;\n\t}\n\n\tprivate vectorMagnitudeProgramForType(type: DataLayerType) {\n\t\tconst key = this.glslKeyForType(type);\n\t\tif (this.vectorMagnitudePrograms[key] === undefined) {\n\t\t\tconst program = this.initProgram({\n\t\t\t\tname: `vectorMagnitude-${key}`,\n\t\t\t\tfragmentShader: this._preprocessFragShader(this.vectorMagnitudePrograms.src),\n\t\t\t\tdefines: {\n\t\t\t\t\t[key]: '1',\n\t\t\t\t},\n\t\t\t});\n\t\t\tthis.vectorMagnitudePrograms[key] = program;\n\t\t}\n\t\treturn this.vectorMagnitudePrograms[key]!;\n\t}\n\n\tisWebGL2() {\n\t\treturn isWebGL2(this.gl);\n\t}\n\n\tprivate get quadPositionsBuffer() {\n\t\tif (this._quadPositionsBuffer === undefined) {\n\t\t\tconst fsQuadPositions = new Float32Array([ -1, -1, 1, -1, -1, 1, 1, 1 ]);\n\t\t\tthis._quadPositionsBuffer = this.initVertexBuffer(fsQuadPositions)!;\n\t\t}\n\t\treturn this._quadPositionsBuffer!;\n\t}\n\n\tprivate get boundaryPositionsBuffer() {\n\t\tif (this._boundaryPositionsBuffer === undefined) {\n\t\t\tconst boundaryPositions = new Float32Array([ -1, -1, 1, -1, 1, 1, -1, 1, -1, -1 ]);\n\t\t\tthis._boundaryPositionsBuffer = this.initVertexBuffer(boundaryPositions)!;\n\t\t}\n\t\treturn this._boundaryPositionsBuffer!;\n\t}\n\n\tprivate getCirclePositionsBuffer(numSegments: number) {\n\t\tif (this._circlePositionsBuffer[numSegments] == undefined) {\n\t\t\tconst unitCirclePoints = [0, 0];\n\t\t\tfor (let i = 0; i <= numSegments; i++) { // TODO: should this be just less than?\n\t\t\t\tunitCirclePoints.push(\n\t\t\t\t\tMath.cos(2 * Math.PI * i / numSegments),\n\t\t\t\t\tMath.sin(2 * Math.PI * i / numSegments),\n\t\t\t\t);\n\t\t\t}\n\t\t\tconst circlePositions = new Float32Array(unitCirclePoints);\n\t\t\tconst buffer = this.initVertexBuffer(circlePositions)!;\n\t\t\tthis._circlePositionsBuffer[numSegments] = buffer;\n\t\t}\n\t\treturn this._circlePositionsBuffer[numSegments];\n\t}\n\n\tprivate initVertexBuffer(\n\t\tdata: Float32Array,\n\t) {\n\t\tconst { _errorCallback, gl } = this;\n\t\tconst buffer = gl.createBuffer();\n\t\tif (!buffer) {\n\t\t\t_errorCallback('Unable to allocate gl buffer.');\n\t\t\treturn;\n\t\t}\n\t\tgl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n\t\t// Add buffer data.\n\t\tgl.bufferData(gl.ARRAY_BUFFER, data, gl.STATIC_DRAW);\n\t\treturn buffer;\n\t}\n\n\tinitDataLayer(\n\t\tparams: {\n\t\t\tname: string,\n\t\t\tdimensions: number | [number, number],\n\t\t\ttype: DataLayerType,\n\t\t\tnumComponents: DataLayerNumComponents,\n\t\t\tarray?: DataLayerArray | number[],\n\t\t\tfilter?: DataLayerFilter,\n\t\t\twrapS?: DataLayerWrap,\n\t\t\twrapT?: DataLayerWrap,\n\t\t\twritable?: boolean,\n\t\t\tnumBuffers?: number,\n\t\t\tclearValue?: number | number[],\n\t\t},\n\t) {\n\t\t// Check params.\n\t\tconst validKeys = ['name', 'dimensions', 'type', 'numComponents', 'array', 'filter', 'wrapS', 'wrapT', 'writable', 'numBuffers', 'clearValue'];\n\t\tObject.keys(params).forEach(key => {\n\t\t\tif (validKeys.indexOf(key) < 0) {\n\t\t\t\tthrow new Error(`Invalid key \"${key}\" passed to WebGLCompute.initDataLayer with name \"${params.name}\".  Valid keys are ${validKeys.join(', ')}.`);\n\t\t\t}\n\t\t});\n\t\treturn new DataLayer(this, params);\n\t};\n\n\tinitProgram(\n\t\tparams: {\n\t\t\tname: string,\n\t\t\tfragmentShader: string | string[],\n\t\t\tuniforms?: {\n\t\t\t\tname: string,\n\t\t\t\tvalue: UniformValue,\n\t\t\t\ttype: UniformType,\n\t\t\t}[],\n\t\t\tdefines?: {\n\t\t\t\t[key : string]: string,\n\t\t\t},\n\t\t},\n\t) {\n\t\t// Check params.\n\t\tconst validKeys = ['name', 'fragmentShader', 'uniforms', 'defines'];\n\t\tObject.keys(params).forEach(key => {\n\t\t\tif (validKeys.indexOf(key) < 0) {\n\t\t\t\tthrow new Error(`Invalid key \"${key}\" passed to WebGLCompute.initProgram with name \"${params.name}\".  Valid keys are ${validKeys.join(', ')}.`);\n\t\t\t}\n\t\t});\n\t\treturn new GPUProgram(this, params);\n\t};\n\n\t// Used internally, see DataLayer.clone() for public API.\n\t_cloneDataLayer(dataLayer: DataLayer, name?: string) {\n\t\tlet dimensions: number | [number, number] = 0;\n\t\ttry {\n\t\t\tdimensions = dataLayer.length;\n\t\t} catch {\n\t\t\tdimensions = [dataLayer.width, dataLayer.height];\n\t\t}\n\n\t\t// If read only, get state by reading to GPU.\n\t\tconst array = dataLayer.writable ? undefined : this.getValues(dataLayer);\n\n\t\tconst clone = this.initDataLayer({\n\t\t\tname: name || `${dataLayer.name}-clone`,\n\t\t\tdimensions,\n\t\t\ttype: dataLayer.type,\n\t\t\tnumComponents: dataLayer.numComponents,\n\t\t\tarray,\n\t\t\tfilter: dataLayer.filter,\n\t\t\twrapS: dataLayer.wrapS,\n\t\t\twrapT: dataLayer.wrapT,\n\t\t\twritable: dataLayer.writable,\n\t\t\tnumBuffers: dataLayer.numBuffers,\n\t\t});\n\n\t\t// If writable, copy current state with a draw call.\n\t\tif (dataLayer.writable) {\n\t\t\tfor (let i = 0; i < dataLayer.numBuffers - 1; i++) {\n\t\t\t\tthis.step({\n\t\t\t\t\tprogram: this.copyProgramForType(dataLayer.type),\n\t\t\t\t\tinput: dataLayer.getStateAtIndex((dataLayer.bufferIndex + i + 1) % dataLayer.numBuffers),\n\t\t\t\t\toutput: clone,\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.step({\n\t\t\t\tprogram: this.copyProgramForType(dataLayer.type),\n\t\t\t\tinput: dataLayer.currentState,\n\t\t\t\toutput: clone,\n\t\t\t});\n\t\t}\n\t\treturn clone;\n\t}\n\n\tinitTexture(\n\t\tparams: {\n\t\t\tname: string,\n\t\t\turl: string,\n\t\t\tfilter?: DataLayerFilter,\n\t\t\twrapS?: DataLayerWrap,\n\t\t\twrapT?: DataLayerWrap,\n\t\t\tformat?: TextureFormat,\n\t\t\ttype?: TextureType,\n\t\t\tonLoad?: (texture: WebGLTexture) => void,\n\t\t},\n\t) {\n\t\t// Check params.\n\t\tconst validKeys = ['name', 'url', 'filter', 'wrapS', 'wrapT', 'format', 'type', 'onLoad'];\n\t\tObject.keys(params).forEach(key => {\n\t\t\tif (validKeys.indexOf(key) < 0) {\n\t\t\t\tthrow new Error(`Invalid key \"${key}\" passed to WebGLCompute.initTexture with name \"${params.name}\".  Valid keys are ${validKeys.join(', ')}.`);\n\t\t\t}\n\t\t});\n\t\tconst { url, name } = params;\n\t\tif (!isString(url)) {\n\t\t\tthrow new Error(`Expected WebGLCompute.initTexture params to have url of type string, got ${url} of type ${typeof url}.`)\n\t\t}\n\t\tif (!isString(name)) {\n\t\t\tthrow new Error(`Expected WebGLCompute.initTexture params to have name of type string, got ${name} of type ${typeof name}.`)\n\t\t}\n\n\t\t// Get filter type, default to nearest.\n\t\tconst filter = params.filter !== undefined ? params.filter : NEAREST;\n\t\tif (!isValidFilter(filter)) {\n\t\t\tthrow new Error(`Invalid filter: ${filter} for DataLayer \"${name}\", must be ${validFilters.join(', ')}.`);\n\t\t}\n\n\t\t// Get wrap types, default to clamp to edge.\n\t\tconst wrapS = params.wrapS !== undefined ? params.wrapS : CLAMP_TO_EDGE;\n\t\tif (!isValidWrap(wrapS)) {\n\t\t\tthrow new Error(`Invalid wrapS: ${wrapS} for DataLayer \"${name}\", must be ${validWraps.join(', ')}.`);\n\t\t}\n\t\tconst wrapT = params.wrapT !== undefined ? params.wrapT : CLAMP_TO_EDGE;\n\t\tif (!isValidWrap(wrapT)) {\n\t\t\tthrow new Error(`Invalid wrapT: ${wrapT} for DataLayer \"${name}\", must be ${validWraps.join(', ')}.`);\n\t\t}\n\n\t\t// Get image format type, default to rgba.\n\t\tconst format = params.format !== undefined ? params.format : RGBA;\n\t\tif (!isValidTextureFormat(format)) {\n\t\t\tthrow new Error(`Invalid format: ${format} for DataLayer \"${name}\", must be ${validTextureFormats.join(', ')}.`);\n\t\t}\n\n\t\t// Get image data type, default to unsigned byte.\n\t\tconst type = params.type !== undefined ? params.type : UNSIGNED_BYTE;\n\t\tif (!isValidTextureType(type)) {\n\t\t\tthrow new Error(`Invalid type: ${type} for DataLayer \"${name}\", must be ${validTextureTypes.join(', ')}.`);\n\t\t}\n\n\t\tconst { gl, _errorCallback } = this;\n\t\tconst texture = gl.createTexture();\n\t\tif (texture === null) {\n\t\t\tthrow new Error(`Unable to init glTexture.`);\n\t\t}\n\t\tgl.bindTexture(gl.TEXTURE_2D, texture);\n\t\t// Because images have to be downloaded over the internet\n\t\t// they might take a moment until they are ready.\n\t\t// Until then put a single pixel in the texture so we can\n\t\t// use it immediately. When the image has finished downloading\n\t\t// we'll update the texture with the contents of the image.\n\t\tconst level = 0;\n\t\tconst internalFormat = gl.RGBA;\n\t\tconst width = 1;\n\t\tconst height = 1;\n\t\tconst border = 0;\n\t\tconst srcFormat = gl[format];\n\t\tconst srcType = gl[type];\n\t\tconst pixel = new Uint8Array([0, 0, 0, 0]);\n\t\tgl.texImage2D(gl.TEXTURE_2D, level, internalFormat,\n\t\t\twidth, height, border, srcFormat, srcType, pixel);\n\n\t\tconst image = new Image();\n\t\timage.onload = () => {\n\t\t\tgl.bindTexture(gl.TEXTURE_2D, texture);\n\t\t\tgl.texImage2D(gl.TEXTURE_2D, level, internalFormat,\n\t\t\t\tsrcFormat, srcType, image);\n\n\t\t\t// WebGL1 has different requirements for power of 2 images\n\t\t\t// vs non power of 2 images so check if the image is a\n\t\t\t// power of 2 in both dimensions.\n\t\t\tif (isPowerOf2(image.width) && isPowerOf2(image.height)) {\n\t\t\t\t// // Yes, it's a power of 2. Generate mips.\n\t\t\t\t// gl.generateMipmap(gl.TEXTURE_2D);\n\t\t\t} else {\n\t\t\t\t// TODO: finish implementing this.\n\t\t\t\tconsole.warn(`Texture ${name} dimensions [${image.width}, ${image.height}] are not power of 2.`);\n\t\t\t\t// // No, it's not a power of 2. Turn off mips and set\n\t\t\t\t// // wrapping to clamp to edge\n\t\t\t\t// gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n\t\t\t\t// gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\t\t\t}\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl[wrapS]);\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl[wrapT]);\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl[filter]);\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl[filter]);\n\n\t\t\t// Callback when texture has loaded.\n\t\t\tif (params.onLoad) params.onLoad(texture);\n\t\t};\n\t\timage.onerror = (e) => {\n\t\t\t_errorCallback(`Error loading image ${name}: ${e}`);\n\t\t}\n\t\timage.src = url;\n\n\t\treturn texture;\n\t}\n\n\tonResize(canvas: HTMLCanvasElement) {\n\t\tconst width = canvas.clientWidth;\n\t\tconst height = canvas.clientHeight;\n\t\t// Set correct canvas pixel size.\n\t\t// https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/By_example/Canvas_size_and_WebGL\n\t\tcanvas.width = width;\n\t\tcanvas.height = height;\n\t\t// Save dimensions.\n\t\tthis.width = width;\n\t\tthis.height = height;\n\t};\n\n\tprivate drawSetup(\n\t\tprogram: WebGLProgram,\n\t\tfullscreenRender: boolean,\n\t\tinput?: (DataLayer | WebGLTexture)[] | DataLayer | WebGLTexture,\n\t\toutput?: DataLayer,\n\t) {\n\t\tconst { gl } = this;\n\t\t// Check if we are in an error state.\n\t\tif (!program) {\n\t\t\treturn;\n\t\t}\n\n\t\t// CAUTION: the order of these next few lines is important.\n\n\t\t// Get a shallow copy of current textures.\n\t\t// This line must come before this.setOutput() as it depends on current internal state.\n\t\tconst inputTextures: WebGLTexture[] = [];\n\t\tif (input) {\n\t\t\tif (input.constructor === WebGLTexture) {\n\t\t\t\tinputTextures.push(input as WebGLTexture);\n\t\t\t} else if (input.constructor === DataLayer) {\n\t\t\t\tinputTextures.push((input as DataLayer).currentState);\n\t\t\t} else {\n\t\t\t\tfor (let i = 0; i < (input as (DataLayer | WebGLTexture)[]).length; i++) {\n\t\t\t\t\tconst layer = (input as (DataLayer | WebGLTexture)[])[i];\n\t\t\t\t\tinputTextures.push((layer as DataLayer).currentState ? (layer as DataLayer).currentState : layer as WebGLTexture)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Set output framebuffer.\n\t\t// This may modify WebGL internal state.\n\t\tthis.setOutputLayer(fullscreenRender, input, output);\n\n\t\t// Set current program.\n\t\tgl.useProgram(program);\n\n\t\t// Set input textures.\n\t\tfor (let i = 0; i < inputTextures.length; i++) {\n\t\t\tgl.activeTexture(gl.TEXTURE0 + i);\n\t\t\tgl.bindTexture(gl.TEXTURE_2D, inputTextures[i]);\n\t\t}\n\t}\n\n\tprivate setBlendMode(shouldBlendAlpha?: boolean) {\n\t\tconst { gl } = this;\n\t\tif (shouldBlendAlpha) {\n\t\t\tgl.enable(gl.BLEND);\n\t\t\tgl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n\t\t}\n\t}\n\n\tprivate addLayerToInputs(\n\t\tlayer: DataLayer,\n\t\tinput?:  (DataLayer | WebGLTexture)[] | DataLayer | WebGLTexture,\n\t) {\n\t\t// Add layer to end of input if needed.\n\t\tlet _inputLayers = input;\n\t\tif (isArray(_inputLayers)) {\n\t\t\tconst index = (_inputLayers as (DataLayer | WebGLTexture)[]).indexOf(layer);\n\t\t\tif (index < 0) {\n\t\t\t\t(_inputLayers as (DataLayer | WebGLTexture)[]).push(layer);\n\t\t\t} \n\t\t} else {\n\t\t\tif (_inputLayers !== layer) {\n\t\t\t\tconst previous = _inputLayers;\n\t\t\t\t_inputLayers = [];\n\t\t\t\tif (previous) (_inputLayers as (DataLayer | WebGLTexture)[]).push(previous);\n\t\t\t\t(_inputLayers as (DataLayer | WebGLTexture)[]).push(layer);\n\t\t\t} else {\n\t\t\t\t_inputLayers = [_inputLayers];\n\t\t\t}\n\t\t}\n\t\treturn _inputLayers as (DataLayer | WebGLTexture)[];\n\t}\n\n\tprivate passThroughLayerDataFromInputToOutput(state: DataLayer) {\n\t\t// TODO: figure out the fastest way to copy a texture.\n\t\tconst copyProgram = this.copyProgramForType(state.internalType);\n\t\tthis.step({\n\t\t\tprogram: copyProgram,\n\t\t\tinput: state,\n\t\t\toutput: state,\n\t\t});\n\t}\n\n\tprivate setOutputLayer(\n\t\tfullscreenRender: boolean,\n\t\tinput?: (DataLayer | WebGLTexture)[] | DataLayer | WebGLTexture,\n\t\toutput?: DataLayer, // Undefined renders to screen.\n\t) {\n\t\tconst { gl } = this;\n\n\t\t// Render to screen.\n\t\tif (!output) {\n\t\t\tgl.bindFramebuffer(gl.FRAMEBUFFER, null);\n\t\t\t// Resize viewport.\n\t\t\tconst { width, height } = this;\n\t\t\tgl.viewport(0, 0, width, height);\n\t\t\treturn;\n\t\t}\n\n\t\t// Check if output is same as one of input layers.\n\t\tif (input && ((input === output) || (isArray(input) && (input as (DataLayer | WebGLTexture)[]).indexOf(output) > -1))) {\n\t\t\tif (output.numBuffers === 1) {\n\t\t\t\tthrow new Error('Cannot use same buffer for input and output of a program. Try increasing the number of buffers in your output layer to at least 2 so you can render to nextState using currentState as an input.');\n\t\t\t}\n\t\t\tif (fullscreenRender) {\n\t\t\t\t// Render and increment buffer so we are rendering to a different target\n\t\t\t\t// than the input texture.\n\t\t\t\toutput._bindOutputBufferForWrite(true);\n\t\t\t} else {\n\t\t\t\t// Pass input texture through to output.\n\t\t\t\tthis.passThroughLayerDataFromInputToOutput(output);\n\t\t\t\t// Render to output without incrementing buffer.\n\t\t\t\toutput._bindOutputBufferForWrite(false);\n\t\t\t}\n\t\t} else {\n\t\t\tif (fullscreenRender) {\n\t\t\t\t// Render to current buffer.\n\t\t\t\toutput._bindOutputBufferForWrite(false);\n\t\t\t} else {\n\t\t\t\t// If we are doing a sneaky thing with a swapped texture and are\n\t\t\t\t// only rendering part of the screen, we may need to add a copy operation.\n\t\t\t\tif (output._usingTextureOverrideForCurrentBuffer()) {\n\t\t\t\t\tthis.passThroughLayerDataFromInputToOutput(output);\n\t\t\t\t}\n\t\t\t\toutput._bindOutputBufferForWrite(false);\n\t\t\t}\n\t\t}\n\t\t\n\t\t// Resize viewport.\n\t\tconst { width, height } = output;\n\t\tgl.viewport(0, 0, width, height);\n\t};\n\n\tprivate setPositionAttribute(program: WebGLProgram, programName: string) {\n\t\tthis.setVertexAttribute(program, 'a_internal_position', 2, programName);\n\t}\n\n\tprivate setIndexAttribute(program: WebGLProgram, programName: string) {\n\t\tthis.setVertexAttribute(program, 'a_internal_index', 1, programName);\n\t}\n\n\tprivate setUVAttribute(program: WebGLProgram, programName: string) {\n\t\tthis.setVertexAttribute(program, 'a_internal_uv', 2, programName);\n\t}\n\n\tprivate setVertexAttribute(program: WebGLProgram, name: string, size: number, programName: string) {\n\t\tconst { gl } = this;\n\t\t// Point attribute to the currently bound VBO.\n\t\tconst location = gl.getAttribLocation(program, name);\n\t\tif (location < 0) {\n\t\t\tthrow new Error(`Unable to find vertex attribute \"${name}\" in program \"${programName}\".`);\n\t\t}\n\t\t// TODO: only float is supported for vertex attributes.\n\t\tgl.vertexAttribPointer(location, size, gl.FLOAT, false, 0, 0);\n\t\t// Enable the attribute.\n\t\tgl.enableVertexAttribArray(location);\n\t}\n\n\t// Step for entire fullscreen quad.\n\tstep(\n\t\tparams: {\n\t\t\tprogram: GPUProgram,\n\t\t\tinput?:  (DataLayer | WebGLTexture)[] | DataLayer | WebGLTexture,\n\t\t\toutput?: DataLayer, // Undefined renders to screen.\n\t\t\tshouldBlendAlpha?: boolean,\n\t\t},\n\t) {\n\t\tconst { gl, errorState, quadPositionsBuffer } = this;\n\t\tconst { program, input, output } = params;\n\n\t\t// Ignore if we are in error state.\n\t\tif (errorState) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst glProgram = program._defaultProgram!;\n\n\t\t// Do setup - this must come first.\n\t\tthis.drawSetup(glProgram, true, input, output);\n\n\t\t// Update uniforms and buffers.\n\t\tprogram._setVertexUniform(glProgram, 'u_internal_scale', [1, 1], FLOAT);\n\t\tprogram._setVertexUniform(glProgram, 'u_internal_translation', [0, 0], FLOAT);\n\t\tgl.bindBuffer(gl.ARRAY_BUFFER, quadPositionsBuffer);\n\t\tthis.setPositionAttribute(glProgram, program.name);\n\n\t\t// Draw.\n\t\tthis.setBlendMode(params.shouldBlendAlpha);\n\t\tgl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n\t\tgl.disable(gl.BLEND);\n\t}\n\n\t// Step program only for a strip of px along the boundary.\n\tstepBoundary(\n\t\tparams: {\n\t\t\tprogram: GPUProgram,\n\t\t\tinput?:  (DataLayer | WebGLTexture)[] | DataLayer | WebGLTexture,\n\t\t\toutput?: DataLayer, // Undefined renders to screen.\n\t\t\tsingleEdge?: 'LEFT' | 'RIGHT' | 'TOP' | 'BOTTOM';\n\t\t\tshouldBlendAlpha?: boolean,\n\t\t},\n\t) {\n\t\tconst { gl, errorState, boundaryPositionsBuffer} = this;\n\t\tconst { program, input, output } = params;\n\t\tconst width = output ? output.width : this.width;\n\t\tconst height = output ? output.height : this.height;\n\n\t\t// Ignore if we are in error state.\n\t\tif (errorState) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst glProgram = program._defaultProgram!;\n\n\t\t// Do setup - this must come first.\n\t\tthis.drawSetup(glProgram, false, input, output);\n\n\t\t// Update uniforms and buffers.\n\t\t// Frame needs to be offset and scaled so that all four sides are in viewport.\n\t\tconst onePx = [ 1 / width, 1 / height] as [number, number];\n\t\tprogram._setVertexUniform(glProgram, 'u_internal_scale', [1 - onePx[0], 1 - onePx[1]], FLOAT);\n\t\tprogram._setVertexUniform(glProgram, 'u_internal_translation', onePx, FLOAT);\n\t\tgl.bindBuffer(gl.ARRAY_BUFFER, boundaryPositionsBuffer);\n\t\tthis.setPositionAttribute(glProgram, program.name);\n\n\t\t// Draw.\n\t\tthis.setBlendMode(params.shouldBlendAlpha);\n\t\tif (params.singleEdge) {\n\t\t\tswitch(params.singleEdge) {\n\t\t\t\tcase 'LEFT':\n\t\t\t\t\tgl.drawArrays(gl.LINES, 3, 2);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'RIGHT':\n\t\t\t\t\tgl.drawArrays(gl.LINES, 1, 2);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'TOP':\n\t\t\t\t\tgl.drawArrays(gl.LINES, 2, 2);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'BOTTOM':\n\t\t\t\t\tgl.drawArrays(gl.LINES, 0, 2);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tthrow new Error(`Unknown boundary edge type: ${params.singleEdge}.`);\n\t\t\t}\n\t\t} else {\n\t\t\tgl.drawArrays(gl.LINE_LOOP, 0, 4);\n\t\t}\n\t\tgl.disable(gl.BLEND);\n\t}\n\n\t// Step program for all but a strip of px along the boundary.\n\tstepNonBoundary(\n\t\tparams: {\n\t\t\tprogram: GPUProgram,\n\t\t\tinput?:  (DataLayer | WebGLTexture)[] | DataLayer | WebGLTexture,\n\t\t\toutput?: DataLayer, // Undefined renders to screen.\n\t\t\tshouldBlendAlpha?: boolean,\n\t\t},\n\t) {\n\t\tconst { gl, errorState, quadPositionsBuffer } = this;\n\t\tconst { program, input, output } = params;\n\t\tconst width = output ? output.width : this.width;\n\t\tconst height = output ? output.height : this.height;\n\n\t\t// Ignore if we are in error state.\n\t\tif (errorState) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst glProgram = program._defaultProgram!;\n\n\t\t// Do setup - this must come first.\n\t\tthis.drawSetup(glProgram, false, input, output);\n\n\t\t// Update uniforms and buffers.\n\t\tconst onePx = [ 1 / width, 1 / height] as [number, number];\n\t\tprogram._setVertexUniform(glProgram, 'u_internal_scale', [1 - 2 * onePx[0], 1 - 2 * onePx[1]], FLOAT);\n\t\tprogram._setVertexUniform(glProgram, 'u_internal_translation', onePx, FLOAT);\n\t\tgl.bindBuffer(gl.ARRAY_BUFFER, quadPositionsBuffer);\n\t\tthis.setPositionAttribute(glProgram, program.name);\n\t\t\n\t\t// Draw.\n\t\tthis.setBlendMode(params.shouldBlendAlpha);\n\t\tgl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n\t\tgl.disable(gl.BLEND);\n\t}\n\n\t// Step program only for a circular spot.\n\tstepCircle(\n\t\tparams: {\n\t\t\tprogram: GPUProgram,\n\t\t\tposition: [number, number], // Position is in units of pixels.\n\t\t\tradius: number, // Radius is in units of pixels.\n\t\t\tinput?:  (DataLayer | WebGLTexture)[] | DataLayer | WebGLTexture,\n\t\t\toutput?: DataLayer, // Undefined renders to screen.\n\t\t\tnumSegments?: number,\n\t\t\tshouldBlendAlpha?: boolean,\n\t\t},\n\t) {\n\t\tconst { gl, errorState, width, height } = this;\n\t\tconst { program, position, radius, input, output } = params;\n\n\t\t// Ignore if we are in error state.\n\t\tif (errorState) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst glProgram = program._defaultProgram!;\n\n\t\t// Do setup - this must come first.\n\t\tthis.drawSetup(glProgram, false, input, output);\n\n\t\t// Update uniforms and buffers.\n\t\tprogram._setVertexUniform(glProgram, 'u_internal_scale', [radius * 2 / width, radius * 2 / height], FLOAT);\n\t\tprogram._setVertexUniform(glProgram, 'u_internal_translation', [2 * position[0] / width - 1, 2 * position[1] / height - 1], FLOAT);\n\t\tconst numSegments = params.numSegments ? params.numSegments : DEFAULT_CIRCLE_NUM_SEGMENTS;\n\t\tif (numSegments < 3) {\n\t\t\tthrow new Error(`numSegments for WebGLCompute.stepCircle must be greater than 2, got ${numSegments}.`);\n\t\t}\n\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.getCirclePositionsBuffer(numSegments));\n\t\tthis.setPositionAttribute(glProgram, program.name);\n\t\t\n\t\t// Draw.\n\t\tthis.setBlendMode(params.shouldBlendAlpha);\n\t\tgl.drawArrays(gl.TRIANGLE_FAN, 0, numSegments + 2);\t\n\t\tgl.disable(gl.BLEND);\n\t}\n\n\t// Step program only for a thickened line segment (rounded end caps available).\n\tstepSegment(\n\t\tparams: {\n\t\t\tprogram: GPUProgram,\n\t\t\tposition1: [number, number], // Position is in units of pixels.\n\t\t\tposition2: [number, number], // Position is in units of pixels.\n\t\t\tthickness: number, // Thickness is in units of pixels.\n\t\t\tinput?:  (DataLayer | WebGLTexture)[] | DataLayer | WebGLTexture,\n\t\t\toutput?: DataLayer, // Undefined renders to screen.\n\t\t\tendCaps?: boolean,\n\t\t\tnumCapSegments?: number,\n\t\t\tshouldBlendAlpha?: boolean,\n\t\t},\n\t) {\n\t\tconst { gl, errorState } = this;\n\t\tconst { program, position1, position2, thickness, input, output } = params;\n\t\tconst width = output ? output.width : this.width;\n\t\tconst height = output ? output.height : this.height;\n\n\t\t// Ignore if we are in error state.\n\t\tif (errorState) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst glProgram = program._segmentProgram!;\n\n\t\t// Do setup - this must come first.\n\t\tthis.drawSetup(glProgram, false, input, output);\n\n\t\t// Update uniforms and buffers.\n\t\tprogram._setVertexUniform(glProgram, 'u_internal_halfThickness', thickness / 2, FLOAT);\n\t\tprogram._setVertexUniform(glProgram, 'u_internal_scale', [2 / width, 2 / height], FLOAT);\n\t\tconst diffX = position1[0] - position2[0];\n\t\tconst diffY = position1[1] - position2[1];\n\t\tconst angle = Math.atan2(diffY, diffX);\n\t\tprogram._setVertexUniform(glProgram, 'u_internal_rotation', angle, FLOAT);\n\t\tconst centerX = (position1[0] + position2[0]) / 2;\n\t\tconst centerY = (position1[1] + position2[1]) / 2;\n\t\tprogram._setVertexUniform(glProgram, 'u_internal_translation', [2 * centerX / this.width - 1, 2 * centerY / this.height - 1], FLOAT);\n\t\tconst length = Math.sqrt(diffX * diffX + diffY * diffY);\n\t\t\n\t\tconst numSegments = params.numCapSegments ? params.numCapSegments * 2 : DEFAULT_CIRCLE_NUM_SEGMENTS;\n\t\tif (params.endCaps) {\n\t\t\tif (numSegments < 6 || numSegments % 6 !== 0) {\n\t\t\t\tthrow new Error(`numSegments for WebGLCompute.stepSegment must be divisible by 6, got ${numSegments}.`);\n\t\t\t}\n\t\t\t// Have to subtract a small offset from length.\n\t\t\tprogram._setVertexUniform(glProgram, 'u_internal_length', length - thickness * Math.sin(Math.PI / numSegments), FLOAT);\n\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.getCirclePositionsBuffer(numSegments));\n\t\t} else {\n\t\t\t// Have to subtract a small offset from length.\n\t\t\tprogram._setVertexUniform(glProgram, 'u_internal_length', length - thickness, FLOAT);\n\t\t\t// Use a rectangle in case of no caps.\n\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.quadPositionsBuffer);\n\t\t}\n\n\t\tthis.setPositionAttribute(glProgram, program.name);\n\t\t\n\t\t// Draw.\n\t\tthis.setBlendMode(params.shouldBlendAlpha);\n\t\tif (params.endCaps) {\n\t\t\tgl.drawArrays(gl.TRIANGLE_FAN, 0, numSegments + 2);\n\t\t} else {\n\t\t\tgl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n\t\t}\n\t\tgl.disable(gl.BLEND);\n\t}\n\n\tstepPolyline(\n\t\tparams: {\n\t\t\tprogram: GPUProgram,\n\t\t\tpositions: [number, number][],\n\t\t\tthickness: number, // Thickness of line is in units of pixels.\n\t\t\tinput?: (DataLayer | WebGLTexture)[] | DataLayer | WebGLTexture,\n\t\t\toutput?: DataLayer, // Undefined renders to screen.\n\t\t\tcloseLoop?: boolean,\n\t\t\tincludeUVs?: boolean,\n\t\t\tincludeNormals?: boolean,\n\t\t\tshouldBlendAlpha?: boolean,\n\t\t},\n\t) {\n\t\tconst { program, input, output } = params;\n\t\tconst vertices = params.positions;\n\t\tconst closeLoop = !!params.closeLoop;\n\t\t\n\t\tconst { gl, width, height, errorState } = this;\n\n\t\t// Ignore if we are in error state.\n\t\tif (errorState) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Offset vertices.\n\t\tconst halfThickness = params.thickness / 2;\n\t\tconst numPositions = closeLoop ? vertices.length * 4 + 2 : (vertices.length - 1) * 4;\n\t\tconst positions = new Float32Array(2 * numPositions);\n\t\tconst uvs = params.includeUVs ? new Float32Array(2 * numPositions) : undefined;\n\t\tconst normals = params.includeNormals ? new Float32Array(2 * numPositions) : undefined;\n\n\t\t// tmp arrays.\n\t\tconst s1 = [0, 0];\n\t\tconst s2 = [0, 0];\n\t\tconst n1 = [0, 0];\n\t\tconst n2 = [0, 0];\n\t\tconst n3 = [0, 0];\n\t\tfor (let i = 0; i < vertices.length; i++) {\n\t\t\tif (!closeLoop && i === vertices.length - 1) continue;\n\t\t\t// Vertices on this segment.\n\t\t\tconst v1 = vertices[i];\n\t\t\tconst v2 = vertices[(i + 1) % vertices.length];\n\t\t\ts1[0] = v2[0] - v1[0];\n\t\t\ts1[1] = v2[1] - v1[1];\n\t\t\tconst length1 = Math.sqrt(s1[0] * s1[0] + s1[1] * s1[1]);\n\t\t\tn1[0] = s1[1] / length1;\n\t\t\tn1[1] = - s1[0] / length1;\n\n\t\t\tconst index = i * 4 + 2;\n\n\t\t\tif (!closeLoop && i === 0) {\n\t\t\t\t// Add starting points to positions array.\n\t\t\t\tpositions[0] = v1[0] + n1[0] * halfThickness;\n\t\t\t\tpositions[1] = v1[1] + n1[1] * halfThickness;\n\t\t\t\tpositions[2] = v1[0] - n1[0] * halfThickness;\n\t\t\t\tpositions[3] = v1[1] - n1[1] * halfThickness;\n\t\t\t\tif (uvs) {\n\t\t\t\t\tuvs[0] = 0;\n\t\t\t\t\tuvs[1] = 1;\n\t\t\t\t\tuvs[2] = 0;\n\t\t\t\t\tuvs[3] = 0;\n\t\t\t\t}\n\t\t\t\tif (normals) {\n\t\t\t\t\tnormals[0] = n1[0];\n\t\t\t\t\tnormals[1] = n1[1];\n\t\t\t\t\tnormals[2] = n1[0];\n\t\t\t\t\tnormals[3] = n1[1];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst u = (i + 1) / (vertices.length - 1);\n\n\t\t\t// Offset from v2.\n\t\t\tpositions[2 * index] = v2[0] + n1[0] * halfThickness;\n\t\t\tpositions[2 * index + 1] = v2[1] + n1[1] * halfThickness;\n\t\t\tpositions[2 * index + 2] = v2[0] - n1[0] * halfThickness;\n\t\t\tpositions[2 * index + 3] = v2[1] - n1[1] * halfThickness;\n\t\t\tif (uvs) {\n\t\t\t\tuvs[2 * index] = u;\n\t\t\t\tuvs[2 * index + 1] = 1;\n\t\t\t\tuvs[2 * index + 2] = u;\n\t\t\t\tuvs[2 * index + 3] = 0;\n\t\t\t}\n\t\t\tif (normals) {\n\t\t\t\tnormals[2 * index] = n1[0];\n\t\t\t\tnormals[2 * index + 1] = n1[1];\n\t\t\t\tnormals[2 * index + 2] = n1[0];\n\t\t\t\tnormals[2 * index + 3] = n1[1];\n\t\t\t}\n\n\t\t\tif ((i < vertices.length - 2) || closeLoop) {\n\t\t\t\t// Vertices on next segment.\n\t\t\t\tconst v3 = vertices[(i + 1) % vertices.length];\n\t\t\t\tconst v4 = vertices[(i + 2) % vertices.length];\n\t\t\t\ts2[0] = v4[0] - v3[0];\n\t\t\t\ts2[1] = v4[1] - v3[1];\n\t\t\t\tconst length2 = Math.sqrt(s2[0] * s2[0] + s2[1] * s2[1]);\n\t\t\t\tn2[0] = s2[1] / length2;\n\t\t\t\tn2[1] = - s2[0] / length2;\n\n\t\t\t\t// Offset from v3\n\t\t\t\tpositions[2 * ((index + 2) % (4 * vertices.length))] = v3[0] + n2[0] * halfThickness;\n\t\t\t\tpositions[2 * ((index + 2) % (4 * vertices.length)) + 1] = v3[1] + n2[1] * halfThickness;\n\t\t\t\tpositions[2 * ((index + 2) % (4 * vertices.length)) + 2] = v3[0] - n2[0] * halfThickness;\n\t\t\t\tpositions[2 * ((index + 2) % (4 * vertices.length)) + 3] = v3[1] - n2[1] * halfThickness;\n\t\t\t\tif (uvs) {\n\t\t\t\t\tuvs[2 * ((index + 2) % (4 * vertices.length))] = u;\n\t\t\t\t\tuvs[2 * ((index + 2) % (4 * vertices.length)) + 1] = 1;\n\t\t\t\t\tuvs[2 * ((index + 2) % (4 * vertices.length)) + 2] = u;\n\t\t\t\t\tuvs[2 * ((index + 2) % (4 * vertices.length)) + 3] = 0;\n\t\t\t\t}\n\t\t\t\tif (normals) {\n\t\t\t\t\tnormals[2 * ((index + 2) % (4 * vertices.length))] = n2[0];\n\t\t\t\t\tnormals[2 * ((index + 2) % (4 * vertices.length)) + 1] = n2[1];\n\t\t\t\t\tnormals[2 * ((index + 2) % (4 * vertices.length)) + 2] = n2[0];\n\t\t\t\t\tnormals[2 * ((index + 2) % (4 * vertices.length)) + 3] = n2[1];\n\t\t\t\t}\n\n\t\t\t\t// Check the angle between adjacent segments.\n\t\t\t\tconst cross = n1[0] * n2[1] - n1[1] * n2[0];\n\t\t\t\tif (Math.abs(cross) < 1e-6) continue;\n\t\t\t\tn3[0] = n1[0] + n2[0];\n\t\t\t\tn3[1] = n1[1] + n2[1];\n\t\t\t\tconst length3 = Math.sqrt(n3[0] * n3[0] + n3[1] * n3[1]);\n\t\t\t\tn3[0] /= length3;\n\t\t\t\tn3[1] /= length3;\n\t\t\t\t// Make adjustments to positions.\n\t\t\t\tconst angle = Math.acos(n1[0] * n2[0] + n1[1] * n2[1]);\n\t\t\t\tconst offset = halfThickness / Math.cos(angle / 2);\n\t\t\t\tif (cross < 0) {\n\t\t\t\t\tpositions[2 * index] = v2[0] + n3[0] * offset;\n\t\t\t\t\tpositions[2 * index + 1] = v2[1] + n3[1] * offset;\n\t\t\t\t\tpositions[2 * ((index + 2) % (4 * vertices.length))] = positions[2 * index];\n\t\t\t\t\tpositions[2 * ((index + 2) % (4 * vertices.length)) + 1] = positions[2 * index + 1];\n\t\t\t\t} else {\n\t\t\t\t\tpositions[2 * index + 2] = v2[0] - n3[0] * offset;\n\t\t\t\t\tpositions[2 * index + 3] = v2[1] - n3[1] * offset;\n\t\t\t\t\tpositions[2 * ((index + 2) % (4 * vertices.length)) + 2] = positions[2 * index + 2];\n\t\t\t\t\tpositions[2 * ((index + 2) % (4 * vertices.length)) + 3] = positions[2 * index + 3];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (closeLoop) {\n\t\t\t// Duplicate starting points to end of positions array.\n\t\t\tpositions[vertices.length * 8] = positions[0];\n\t\t\tpositions[vertices.length * 8 + 1] = positions[1];\n\t\t\tpositions[vertices.length * 8 + 2] = positions[2];\n\t\t\tpositions[vertices.length * 8 + 3] = positions[3];\n\t\t\tif (uvs) {\n\t\t\t\tuvs[vertices.length * 8] = uvs[0];\n\t\t\t\tuvs[vertices.length * 8 + 1] = uvs[1];\n\t\t\t\tuvs[vertices.length * 8 + 2] = uvs[2];\n\t\t\t\tuvs[vertices.length * 8 + 3] = uvs[3];\n\t\t\t}\n\t\t\tif (normals) {\n\t\t\t\tnormals[vertices.length * 8] = normals[0];\n\t\t\t\tnormals[vertices.length * 8 + 1] = normals[1];\n\t\t\t\tnormals[vertices.length * 8 + 2] = normals[2];\n\t\t\t\tnormals[vertices.length * 8 + 3] = normals[3];\n\t\t\t}\n\t\t}\n\n\t\tconst glProgram = (uvs ?\n\t\t\t(normals ? program._defaultProgramWithUVNormal : program._defaultProgramWithUV) :\n\t\t\t(normals ? program._defaultProgramWithNormal : program._defaultProgram)\n\t\t)!;\n\n\t\t// Do setup - this must come first.\n\t\tthis.drawSetup(glProgram, false, input, output);\n\n\t\t// Update uniforms and buffers.\n\t\tprogram._setVertexUniform(glProgram, 'u_internal_scale', [2 / width, 2 / height], FLOAT);\n\t\tprogram._setVertexUniform(glProgram, 'u_internal_translation', [-1, -1], FLOAT);\n\t\t// Init positions buffer.\n\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.initVertexBuffer(positions)!);\n\t\tthis.setPositionAttribute(glProgram, program.name);\n\t\tif (uvs) {\n\t\t\t// Init uv buffer.\n\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.initVertexBuffer(uvs)!);\n\t\t\tthis.setUVAttribute(glProgram, program.name);\n\t\t}\n\t\tif (normals) {\n\t\t\t// Init normals buffer.\n\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.initVertexBuffer(normals)!);\n\t\t\tthis.setVertexAttribute(glProgram, 'a_internal_normal', 2, program.name);\n\t\t}\n\n\t\t// Draw.\n\t\tthis.setBlendMode(params.shouldBlendAlpha);\n\t\tgl.drawArrays(gl.TRIANGLE_STRIP, 0, numPositions);\n\t\tgl.disable(gl.BLEND);\n\t}\n\n\tstepTriangleStrip(\n\t\tparams: {\n\t\t\tprogram: GPUProgram,\n\t\t\tpositions: Float32Array,\n\t\t\tnormals?: Float32Array,\n\t\t\tuvs?: Float32Array,\n\t\t\tinput?: (DataLayer | WebGLTexture)[] | DataLayer | WebGLTexture,\n\t\t\toutput?: DataLayer, // Undefined renders to screen.\n\t\t\tcount?: number,\n\t\t\tshouldBlendAlpha?: boolean,\n\t\t},\n\t) {\n\n\t\tconst { program, input, output, positions, uvs, normals } = params;\n\t\tconst { gl, width, height, errorState } = this;\n\n\t\t// Ignore if we are in error state.\n\t\tif (errorState) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst glProgram = (uvs ?\n\t\t\t(normals ? program._defaultProgramWithUVNormal : program._defaultProgramWithUV) :\n\t\t\t(normals ? program._defaultProgramWithNormal : program._defaultProgram)\n\t\t)!;\n\n\t\t// Do setup - this must come first.\n\t\tthis.drawSetup(glProgram, false, input, output);\n\n\t\t// Update uniforms and buffers.\n\t\tprogram._setVertexUniform(glProgram, 'u_internal_scale', [2 / width, 2 / height], FLOAT);\n\t\tprogram._setVertexUniform(glProgram, 'u_internal_translation', [-1, -1], FLOAT);\n\t\t// Init positions buffer.\n\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.initVertexBuffer(positions)!);\n\t\tthis.setPositionAttribute(glProgram, program.name);\n\t\tif (uvs) {\n\t\t\t// Init uv buffer.\n\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.initVertexBuffer(uvs)!);\n\t\t\tthis.setUVAttribute(glProgram, program.name);\n\t\t}\n\t\tif (normals) {\n\t\t\t// Init normals buffer.\n\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.initVertexBuffer(normals)!);\n\t\t\tthis.setVertexAttribute(glProgram, 'a_internal_normal', 2, program.name);\n\t\t}\n\n\t\tconst count = params.count ? params.count : positions.length / 2;\n\n\t\t// Draw.\n\t\tthis.setBlendMode(params.shouldBlendAlpha);\n\t\tgl.drawArrays(gl.TRIANGLE_STRIP, 0, count);\n\t\tgl.disable(gl.BLEND);\n\t}\n\n\tstepLines(params: {\n\t\tprogram: GPUProgram,\n\t\tpositions: Float32Array,\n\t\tindices?: Uint16Array | Uint32Array | Int16Array | Int32Array,\n\t\tnormals?: Float32Array,\n\t\tuvs?: Float32Array,\n\t\tinput?: (DataLayer | WebGLTexture)[] | DataLayer | WebGLTexture,\n\t\toutput?: DataLayer, // Undefined renders to screen.\n\t\tcount?: number,\n\t\tcloseLoop?: boolean,\n\t\tshouldBlendAlpha?: boolean,\n\t}) {\n\t\tconst { gl, errorState, width, height } = this;\n\t\tconst { indices, uvs, normals, input, output, program } = params;\n\n\t\t// Ignore if we are in error state.\n\t\tif (errorState) {\n\t\t\treturn;\n\t\t}\n\t\t// Check that params are valid.\n\t\tif (params.closeLoop && indices) {\n\t\t\tthrow new Error(`WebGLCompute.stepLines() can't be called with closeLoop == true and indices.`);\n\t\t}\n\t\t\n\t\tconst glProgram = (uvs ?\n\t\t\t(normals ? program._defaultProgramWithUVNormal : program._defaultProgramWithUV) :\n\t\t\t(normals ? program._defaultProgramWithNormal : program._defaultProgram)\n\t\t)!;\n\n\t\t// Do setup - this must come first.\n\t\tthis.drawSetup(glProgram, false, input, output);\n\n\t\tconst count = params.count ? params.count : (indices ? indices.length : (params.positions.length / 2));\n\n\t\t// Update uniforms and buffers.\n\t\tprogram._setVertexUniform(glProgram, 'u_internal_scale', [2 / width, 2 / height], FLOAT);\n\t\tprogram._setVertexUniform(glProgram, 'u_internal_translation', [-1, -1], FLOAT);\n\t\tif (indices) {\n\t\t\t// Reorder positions array to match indices.\n\t\t\tconst positions = new Float32Array(2 * count);\n\t\t\tfor (let i = 0; i < count; i++) {\n\t\t\t\tconst index = indices[i];\n\t\t\t\tpositions[2 * i] = params.positions[2 * index];\n\t\t\t\tpositions[2 * i + 1] = params.positions[2 * index + 1];\n\t\t\t}\n\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.initVertexBuffer(positions)!);\n\t\t} else {\n\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.initVertexBuffer(params.positions)!);\n\t\t}\n\t\tthis.setPositionAttribute(glProgram, program.name);\n\t\tif (uvs) {\n\t\t\t// Init uv buffer.\n\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.initVertexBuffer(uvs)!);\n\t\t\tthis.setUVAttribute(glProgram, program.name);\n\t\t}\n\t\tif (normals) {\n\t\t\t// Init normals buffer.\n\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.initVertexBuffer(normals)!);\n\t\t\tthis.setVertexAttribute(glProgram, 'a_internal_normal', 2, program.name);\n\t\t}\n\n\t\t// Draw.\n\t\tthis.setBlendMode(params.shouldBlendAlpha);\n\t\tif (params.indices) {\n\t\t\tgl.drawArrays(gl.LINES, 0, count);\n\t\t} else {\n\t\t\tif (params.closeLoop) {\n\t\t\t\tgl.drawArrays(gl.LINE_LOOP, 0, count);\n\t\t\t} else {\n\t\t\t\tgl.drawArrays(gl.LINE_STRIP, 0, count);\n\t\t\t}\n\t\t}\n\t\tgl.disable(gl.BLEND);\n\t}\n\n\tdrawLayerAsPoints(\n\t\tparams: {\n\t\t\tpositions: DataLayer, // Positions in units of pixels.\n\t\t\tprogram?: GPUProgram,\n\t\t\tinput?: (DataLayer | WebGLTexture)[] | DataLayer | WebGLTexture,\n\t\t\toutput?: DataLayer,\n\t\t\tpointSize?: number,\n\t\t\tcount?: number,\n\t\t\tcolor?: [number, number, number],\n\t\t\twrapX?: boolean,\n\t\t\twrapY?: boolean,\n\t\t\tshouldBlendAlpha?: boolean,\n\t\t},\n\t) {\n\t\tconst { gl, errorState, pointIndexArray, width, height } = this;\n\t\tconst { positions, output } = params;\n\n\t\t// Ignore if we are in error state.\n\t\tif (errorState) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Check that numPoints is valid.\n\t\tif (positions.numComponents !== 2 && positions.numComponents !== 4) {\n\t\t\tthrow new Error(`WebGLCompute.drawPoints() must be passed a position DataLayer with either 2 or 4 components, got position DataLayer \"${positions.name}\" with ${positions.numComponents} components.`)\n\t\t}\n\t\tconst { length } = positions;\n\t\tconst count = params.count || length;\n\t\tif (count > length) {\n\t\t\tthrow new Error(`Invalid count ${count} for position DataLayer of length ${length}.`);\n\t\t}\n\n\t\tlet program = params.program;\n\t\tif (program === undefined) {\n\t\t\tprogram = this._setValueProgramForType(FLOAT);\n\t\t\tconst color = params.color || [1, 0, 0]; // Default of red.\n\t\t\tprogram.setUniform('u_value', [...color, 1], FLOAT);\n\t\t}\n\t\tconst glProgram = program._dataLayerPointsProgram!;\n\n\t\t// Add positions to end of input if needed.\n\t\tconst input = this.addLayerToInputs(positions, params.input);\n\n\t\t// Do setup - this must come first.\n\t\tthis.drawSetup(glProgram, false, input, output);\n\n\t\t// Update uniforms and buffers.\n\t\tprogram._setVertexUniform(glProgram, 'u_internal_positions', input.indexOf(positions), INT);\n\t\tprogram._setVertexUniform(glProgram, 'u_internal_scale', [1 / width, 1 / height], FLOAT);\n\t\t// Tell whether we are using an absolute position (2 components), or position with accumulation buffer (4 components, better floating pt accuracy).\n\t\tprogram._setVertexUniform(glProgram, 'u_internal_positionWithAccumulation', positions.numComponents === 4 ? 1 : 0, INT);\n\t\t// Set default pointSize.\n\t\tconst pointSize = params.pointSize || 1;\n\t\tprogram._setVertexUniform(glProgram, 'u_internal_pointSize', pointSize, FLOAT);\n\t\tconst positionLayerDimensions = [positions.width, positions.height] as [number, number];\n\t\tprogram._setVertexUniform(glProgram, 'u_internal_positionsDimensions', positionLayerDimensions, FLOAT);\n\t\tprogram._setVertexUniform(glProgram, 'u_internal_wrapX', params.wrapX ? 1 : 0, INT);\n\t\tprogram._setVertexUniform(glProgram, 'u_internal_wrapY', params.wrapY ? 1 : 0, INT);\n\t\tif (this.pointIndexBuffer === undefined || (pointIndexArray && pointIndexArray.length < count)) {\n\t\t\t// Have to use float32 array bc int is not supported as a vertex attribute type.\n\t\t\tconst indices = initSequentialFloatArray(length);\n\t\t\tthis.pointIndexArray = indices;\n\t\t\tthis.pointIndexBuffer = this.initVertexBuffer(indices);\n\t\t}\n\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.pointIndexBuffer!);\n\t\tthis.setIndexAttribute(glProgram, program.name);\n\n\t\t// Draw.\n\t\tthis.setBlendMode(params.shouldBlendAlpha);\n\t\tgl.drawArrays(gl.POINTS, 0, count);\n\t\tgl.disable(gl.BLEND);\n\t}\n\n\tdrawLayerAsLines(\n\t\tparams: {\n\t\t\tpositions: DataLayer,\n\t\t\tindices?: Float32Array | Uint16Array | Uint32Array | Int16Array | Int32Array,\n\t\t\tprogram?: GPUProgram,\n\t\t\tinput?: (DataLayer | WebGLTexture)[] | DataLayer | WebGLTexture,\n\t\t\toutput?: DataLayer,\n\t\t\tcount?: number,\n\t\t\tcolor?: [number, number, number],\n\t\t\twrapX?: boolean,\n\t\t\twrapY?: boolean,\n\t\t\tcloseLoop?: boolean,\n\t\t\tshouldBlendAlpha?: boolean,\n\t\t},\n\t) {\n\t\tconst { gl, errorState, width, height } = this;\n\t\tconst { positions, output } = params;\n\n\t\t// Ignore if we are in error state.\n\t\tif (errorState) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Check that positions is valid.\n\t\tif (positions.numComponents !== 2 && positions.numComponents !== 4) {\n\t\t\tthrow new Error(`WebGLCompute.drawLayerAsLines() must be passed a position DataLayer with either 2 or 4 components, got position DataLayer \"${positions.name}\" with ${positions.numComponents} components.`)\n\t\t}\n\t\t// Check that params are valid.\n\t\tif (params.closeLoop && params.indices) {\n\t\t\tthrow new Error(`WebGLCompute.drawLayerAsLines() can't be called with closeLoop == true and indices.`);\n\t\t}\n\n\t\tlet program = params.program;\n\t\tif (program === undefined) {\n\t\t\tprogram = params.wrapX || params.wrapY ? this.wrappedLineColorProgram : this._setValueProgramForType(FLOAT);;\n\t\t\tconst color = params.color || [1, 0, 0]; // Default to red.\n\t\t\tprogram.setUniform('u_value', [...color, 1], FLOAT);\n\t\t}\n\t\tconst glProgram = program._dataLayerLinesProgram!;\n\n\t\t// Add positionLayer to end of input if needed.\n\t\tconst input = this.addLayerToInputs(positions, params.input);\n\n\t\t// Do setup - this must come first.\n\t\tthis.drawSetup(glProgram, false, input, output);\n\n\t\t// TODO: cache indexArray if no indices passed in.\n\t\tconst indices = params.indices ? params.indices : initSequentialFloatArray(params.count || positions.length);\n\t\tconst count = params.count ? params.count : indices.length;\n\n\t\t// Update uniforms and buffers.\n\t\tprogram._setVertexUniform(glProgram, 'u_internal_positions', input.indexOf(positions), INT);\n\t\tprogram._setVertexUniform(glProgram, 'u_internal_scale', [1 / width, 1 / height], FLOAT);\n\t\t// Tell whether we are using an absolute position (2 components), or position with accumulation buffer (4 components, better floating pt accuracy).\n\t\tprogram._setVertexUniform(glProgram, 'u_internal_positionWithAccumulation', positions.numComponents === 4 ? 1 : 0, INT);\n\t\tconst positionLayerDimensions = [positions.width, positions.height] as [number, number];\n\t\tprogram._setVertexUniform(glProgram, 'u_internal_positionsDimensions', positionLayerDimensions, FLOAT);\n\t\tprogram._setVertexUniform(glProgram, 'u_internal_wrapX', params.wrapX ? 1 : 0, INT);\n\t\tprogram._setVertexUniform(glProgram, 'u_internal_wrapY', params.wrapY ? 1 : 0, INT);\n\t\tif (this.indexedLinesIndexBuffer === undefined) {\n\t\t\t// Have to use float32 array bc int is not supported as a vertex attribute type.\n\t\t\tlet floatArray: Float32Array;\n\t\t\tif (indices.constructor !== Float32Array) {\n\t\t\t\t// Have to use float32 array bc int is not supported as a vertex attribute type.\n\t\t\t\tfloatArray = new Float32Array(indices.length);\n\t\t\t\tfor (let i = 0; i < count; i++) {\n\t\t\t\t\tfloatArray[i] = indices[i];\n\t\t\t\t}\n\t\t\t\tconsole.warn(`Converting indices array of type ${indices.constructor} to Float32Array in WebGLCompute.drawIndexedLines for WebGL compatibility, you may want to use a Float32Array to store this information so the conversion is not required.`);\n\t\t\t} else {\n\t\t\t\tfloatArray = indices as Float32Array;\n\t\t\t}\n\t\t\tthis.indexedLinesIndexBuffer = this.initVertexBuffer(floatArray);\n\t\t} else {\n\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.indexedLinesIndexBuffer!);\n\t\t\t// Copy buffer data.\n\t\t\tgl.bufferData(gl.ARRAY_BUFFER, indices, gl.STATIC_DRAW);\n\t\t}\n\t\tthis.setIndexAttribute(glProgram, program.name);\n\n\t\t// Draw.\n\t\tthis.setBlendMode(params.shouldBlendAlpha);\n\t\tif (params.indices) {\n\t\t\tgl.drawArrays(gl.LINES, 0, count);\n\t\t} else {\n\t\t\tif (params.closeLoop) {\n\t\t\t\tgl.drawArrays(gl.LINE_LOOP, 0, count);\n\t\t\t} else {\n\t\t\t\tgl.drawArrays(gl.LINE_STRIP, 0, count);\n\t\t\t}\n\t\t}\n\t\tgl.disable(gl.BLEND);\n\t}\n\n\tdrawLayerAsVectorField(\n\t\tparams: {\n\t\t\tdata: DataLayer,\n\t\t\tprogram?: GPUProgram,\n\t\t\tinput?: (DataLayer | WebGLTexture)[] | DataLayer | WebGLTexture,\n\t\t\toutput?: DataLayer,\n\t\t\tvectorSpacing?: number,\n\t\t\tvectorScale?: number,\n\t\t\tcolor?: [number, number, number],\n\t\t\tshouldBlendAlpha?: boolean,\n\t\t},\n\t) {\n\t\tconst { gl, errorState, vectorFieldIndexArray, width, height } = this;\n\t\tconst { data, output } = params;\n\n\t\t// Ignore if we are in error state.\n\t\tif (errorState) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Check that field is valid.\n\t\tif (data.numComponents !== 2) {\n\t\t\tthrow new Error(`WebGLCompute.drawLayerAsVectorField() must be passed a fieldLayer with 2 components, got fieldLayer \"${data.name}\" with ${data.numComponents} components.`)\n\t\t}\n\t\t// Check aspect ratio.\n\t\t// const dimensions = [vectorLayer.width, vectorLayer.height];\n\t\t// if (Math.abs(dimensions[0] / dimensions[1] - width / height) > 0.01) {\n\t\t// \tthrow new Error(`Invalid aspect ratio ${(dimensions[0] / dimensions[1]).toFixed(3)} vector DataLayer with dimensions [${dimensions[0]}, ${dimensions[1]}], expected ${(width / height).toFixed(3)}.`);\n\t\t// }\n\n\t\tlet program = params.program;\n\t\tif (program === undefined) {\n\t\t\tprogram = this._setValueProgramForType(FLOAT);;\n\t\t\tconst color = params.color || [1, 0, 0]; // Default to red.\n\t\t\tprogram.setUniform('u_value', [...color, 1], FLOAT);\n\t\t}\n\t\tconst glProgram = program._dataLayerVectorFieldProgram!;\n\n\t\t// Add data to end of input if needed.\n\t\tconst input = this.addLayerToInputs(data, params.input);\n\n\t\t// Do setup - this must come first.\n\t\tthis.drawSetup(glProgram, false, input, output);\n\n\t\t// Update uniforms and buffers.\n\t\tprogram._setVertexUniform(glProgram, 'u_internal_vectors', input.indexOf(data), INT);\n\t\t// Set default scale.\n\t\tconst vectorScale = params.vectorScale || 1;\n\t\tprogram._setVertexUniform(glProgram, 'u_internal_scale', [vectorScale / width, vectorScale / height], FLOAT);\n\t\tconst vectorSpacing = params.vectorSpacing || 10;\n\t\tconst spacedDimensions = [Math.floor(width / vectorSpacing), Math.floor(height / vectorSpacing)] as [number, number];\n\t\tprogram._setVertexUniform(glProgram, 'u_internal_dimensions', spacedDimensions, FLOAT);\n\t\tconst length = 2 * spacedDimensions[0] * spacedDimensions[1];\n\t\tif (this.vectorFieldIndexBuffer === undefined || (vectorFieldIndexArray && vectorFieldIndexArray.length < length)) {\n\t\t\t// Have to use float32 array bc int is not supported as a vertex attribute type.\n\t\t\tconst indices = initSequentialFloatArray(length);\n\t\t\tthis.vectorFieldIndexArray = indices;\n\t\t\tthis.vectorFieldIndexBuffer = this.initVertexBuffer(indices);\n\t\t}\n\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.vectorFieldIndexBuffer!);\n\t\tthis.setIndexAttribute(glProgram, program.name);\n\n\t\t// Draw.\n\t\tthis.setBlendMode(params.shouldBlendAlpha);\n\t\tgl.drawArrays(gl.LINES, 0, length);\n\t\tgl.disable(gl.BLEND);\n\t}\n\n\tdrawLayerMagnitude(\n\t\tparams: {\n\t\t\tdata: DataLayer,\n\t\t\tinput?: (DataLayer | WebGLTexture)[] | DataLayer | WebGLTexture,\n\t\t\toutput?: DataLayer,\n\t\t\tscale?: number,\n\t\t\tcolor?: [number, number, number],\n\t\t\tshouldBlendAlpha?: boolean,\n\t\t},\n\t) {\n\t\tconst { gl, errorState, quadPositionsBuffer } = this;\n\t\tconst { data, output } = params;\n\n\t\t// Ignore if we are in error state.\n\t\tif (errorState) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst program = this.vectorMagnitudeProgramForType(data.type);\n\t\tconst color = params.color || [1, 0, 0]; // Default to red.\n\t\tprogram.setUniform('u_color', color, FLOAT);\n\t\tconst scale = params.scale || 1;\n\t\tprogram.setUniform('u_scale', scale, FLOAT);\n\t\tprogram.setUniform('u_internal_numDimensions', data.numComponents, INT);\n\n\t\tconst glProgram = program._defaultProgram!;\n\n\t\t// Add data to end of input if needed.\n\t\tconst input = this.addLayerToInputs(data, params.input);\n\t\t// Do setup - this must come first.\n\t\tthis.drawSetup(glProgram, true, input, output);\n\n\t\t// Update uniforms and buffers.\n\t\tprogram._setVertexUniform(glProgram, 'u_internal_data', input.indexOf(data), INT);\n\t\tprogram._setVertexUniform(glProgram, 'u_internal_scale', [1, 1], FLOAT);\n\t\tprogram._setVertexUniform(glProgram, 'u_internal_translation', [0, 0], FLOAT);\n\t\tgl.bindBuffer(gl.ARRAY_BUFFER, quadPositionsBuffer);\n\t\tthis.setPositionAttribute(glProgram, program.name);\n\n\t\t// Draw.\n\t\tthis.setBlendMode(params.shouldBlendAlpha);\n\t\tgl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n\t\tgl.disable(gl.BLEND);\n\t}\n\n\tgetValues(dataLayer: DataLayer) {\n\t\tconst { gl, glslVersion } = this;\n\n\t\t// In case dataLayer was not the last output written to.\n\t\tdataLayer._bindOutputBuffer();\n\n\t\tconst { width, height } = dataLayer;\n\t\tlet { glNumChannels, glType, glFormat, internalType } = dataLayer;\n\t\tlet values;\n\t\tswitch (internalType) {\n\t\t\tcase HALF_FLOAT:\n\t\t\t\tif (gl.FLOAT !== undefined) {\n\t\t\t\t\t// Firefox requires that RGBA/FLOAT is used for readPixels of float16 types.\n\t\t\t\t\tglNumChannels = 4;\n\t\t\t\t\tglFormat = gl.RGBA;\n\t\t\t\t\tglType = gl.FLOAT;\n\t\t\t\t\tvalues = new Float32Array(width * height * glNumChannels);\n\t\t\t\t} else {\n\t\t\t\t\tvalues = new Uint16Array(width * height * glNumChannels);\n\t\t\t\t}\n\t\t\t\t// // The following works in Chrome.\n\t\t\t\t// values = new Uint16Array(width * height * glNumChannels);\n\t\t\t\tbreak\n\t\t\tcase FLOAT:\n\t\t\t\t// Chrome and Firefox require that RGBA/FLOAT is used for readPixels of float32 types.\n\t\t\t\t// https://github.com/KhronosGroup/WebGL/issues/2747\n\t\t\t\tglNumChannels = 4;\n\t\t\t\tglFormat = gl.RGBA;\n\t\t\t\tvalues = new Float32Array(width * height * glNumChannels);\n\t\t\t\tbreak;\n\t\t\tcase UNSIGNED_BYTE:\n\t\t\t\tif (glslVersion === GLSL1) {\n\t\t\t\t\t// Firefox requires that RGBA/UNSIGNED_BYTE is used for readPixels of unsigned byte types.\n\t\t\t\t\tglNumChannels = 4;\n\t\t\t\t\tglFormat = gl.RGBA;\n\t\t\t\t\tvalues = new Uint8Array(width * height * glNumChannels);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\t// Firefox requires that RGBA_INTEGER/UNSIGNED_INT is used for readPixels of unsigned int types.\n\t\t\t\tglNumChannels = 4;\n\t\t\t\tglFormat = (gl as WebGL2RenderingContext).RGBA_INTEGER;\n\t\t\t\tglType = gl.UNSIGNED_INT;\n\t\t\t\tvalues = new Uint32Array(width * height * glNumChannels);\n\t\t\t\t// // The following works in Chrome.\n\t\t\t\t// values = new Uint8Array(width * height * glNumChannels);\n\t\t\t\tbreak;\n\t\t\tcase UNSIGNED_SHORT:\n\t\t\t\t// Firefox requires that RGBA_INTEGER/UNSIGNED_INT is used for readPixels of unsigned int types.\n\t\t\t\tglNumChannels = 4;\n\t\t\t\tglFormat = (gl as WebGL2RenderingContext).RGBA_INTEGER;\n\t\t\t\tglType = gl.UNSIGNED_INT;\n\t\t\t\tvalues = new Uint32Array(width * height * glNumChannels);\n\t\t\t\t// // The following works in Chrome.\n\t\t\t\t// values = new Uint16Array(width * height * glNumChannels);\n\t\t\t\tbreak;\n\t\t\tcase UNSIGNED_INT:\n\t\t\t\t// Firefox requires that RGBA_INTEGER/UNSIGNED_INT is used for readPixels of unsigned int types.\n\t\t\t\tglNumChannels = 4;\n\t\t\t\tglFormat = (gl as WebGL2RenderingContext).RGBA_INTEGER;\n\t\t\t\tvalues = new Uint32Array(width * height * glNumChannels);\n\t\t\t\t// // The following works in Chrome.\n\t\t\t\t// values = new Uint32Array(width * height * glNumChannels);\n\t\t\t\tbreak;\n\t\t\tcase BYTE:\n\t\t\t\t// Firefox requires that RGBA_INTEGER/INT is used for readPixels of int types.\n\t\t\t\tglNumChannels = 4;\n\t\t\t\tglFormat = (gl as WebGL2RenderingContext).RGBA_INTEGER;\n\t\t\t\tglType = gl.INT;\n\t\t\t\tvalues = new Int32Array(width * height * glNumChannels);\n\t\t\t\t// // The following works in Chrome.\n\t\t\t\t// values = new Int8Array(width * height * glNumChannels);\n\t\t\t\tbreak;\n\t\t\tcase SHORT:\n\t\t\t\t// Firefox requires that RGBA_INTEGER/INT is used for readPixels of int types.\n\t\t\t\tglNumChannels = 4;\n\t\t\t\tglFormat = (gl as WebGL2RenderingContext).RGBA_INTEGER;\n\t\t\t\tglType = gl.INT;\n\t\t\t\tvalues = new Int32Array(width * height * glNumChannels);\n\t\t\t\t// // The following works in Chrome.\n\t\t\t\t// values = new Int16Array(width * height * glNumChannels);\n\t\t\t\tbreak;\n\t\t\tcase INT:\n\t\t\t\t// Firefox requires that RGBA_INTEGER/INT is used for readPixels of int types.\n\t\t\t\tglNumChannels = 4;\n\t\t\t\tglFormat = (gl as WebGL2RenderingContext).RGBA_INTEGER;\n\t\t\t\tvalues = new Int32Array(width * height * glNumChannels);\n\t\t\t\t// // The following works in Chrome.\n\t\t\t\t// values = new Int32Array(width * height * glNumChannels);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthrow new Error(`Unsupported internalType ${internalType} for getValues().`);\n\t\t}\n\n\t\tif (this.readyToRead()) {\n\t\t\t// https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/readPixels\n\t\t\tgl.readPixels(0, 0, width, height, glFormat, glType, values);\n\t\t\tconst { numComponents, type } = dataLayer;\n\t\t\tconst OUTPUT_LENGTH = (dataLayer._length ? dataLayer._length : width * height) * numComponents;\n\n\t\t\t// Convert uint16 to float32 if needed.\n\t\t\tconst handleFloat16Conversion = internalType === HALF_FLOAT && values.constructor === Uint16Array;\n\t\t\t// @ts-ignore\n\t\t\tconst view = handleFloat16Conversion ? new DataView((values as Uint16Array).buffer) : undefined;\n\n\t\t\tlet output: DataLayerArray = values;\n\t\t\t\n\t\t\t// We may use a different internal type than the assigned type of the DataLayer.\n\t\t\tif (internalType !== type) {\n\t\t\t\tswitch (type) {\n\t\t\t\t\tcase HALF_FLOAT:\n\t\t\t\t\tcase FLOAT:\n\t\t\t\t\t\toutput = new Float32Array(OUTPUT_LENGTH);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase UNSIGNED_BYTE:\n\t\t\t\t\t\toutput = new Uint8Array(OUTPUT_LENGTH);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase BYTE:\n\t\t\t\t\t\toutput = new Int8Array(OUTPUT_LENGTH);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase UNSIGNED_SHORT:\n\t\t\t\t\t\toutput = new Uint16Array(OUTPUT_LENGTH);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase SHORT:\n\t\t\t\t\t\toutput = new Int16Array(OUTPUT_LENGTH);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase UNSIGNED_INT:\n\t\t\t\t\t\toutput = new Uint32Array(OUTPUT_LENGTH);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase INT:\n\t\t\t\t\t\toutput = new Int32Array(OUTPUT_LENGTH);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tthrow new Error(`Unsupported type ${type} for getValues().`);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// In some cases glNumChannels may be > numComponents.\n\t\t\tif (handleFloat16Conversion || output !== values || numComponents !== glNumChannels) {\n\t\t\t\tfor (let i = 0, length = width * height; i < length; i++) {\n\t\t\t\t\tconst index1 = i * glNumChannels;\n\t\t\t\t\tconst index2 = i * numComponents;\n\t\t\t\t\tif (index2 >= OUTPUT_LENGTH) break;\n\t\t\t\t\tfor (let j = 0; j < numComponents; j++) {\n\t\t\t\t\t\tif (handleFloat16Conversion) {\n\t\t\t\t\t\t\toutput[index2 + j] = getFloat16(view!, 2 * (index1 + j), true);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\toutput[index2 + j] = values[index1 + j];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (output.length !== OUTPUT_LENGTH) {\n\t\t\t\toutput = output.slice(0, OUTPUT_LENGTH);\n\t\t\t}\n\t\t\treturn output;\n\t\t} else {\n\t\t\tthrow new Error(`Unable to read values from Buffer with status: ${gl.checkFramebufferStatus(gl.FRAMEBUFFER)}.`);\n\t\t}\n\t}\n\n\tprivate readyToRead() {\n\t\tconst { gl } = this;\n\t\treturn gl.checkFramebufferStatus(gl.FRAMEBUFFER) == gl.FRAMEBUFFER_COMPLETE;\n\t};\n\n\tsavePNG(dataLayer: DataLayer, filename = dataLayer.name, dpi?: number, callback = saveAs) {\n\t\tconst values = this.getValues(dataLayer);\n\t\tconst { width, height } = dataLayer;\n\n\t\tconst canvas = document.createElement('canvas');\n\t\tcanvas.width = width;\n    \tcanvas.height = height;\n\t\tconst context = canvas.getContext('2d')!;\n\t\tconst imageData = context.getImageData(0, 0, width, height);\n\t\tconst buffer = imageData.data;\n\t\t// TODO: this isn't working for UNSIGNED_BYTE types?\n\t\tconst isFloat = dataLayer.type === FLOAT || dataLayer.type === HALF_FLOAT;\n\t\t// Have to flip the y axis since PNGs are written top to bottom.\n\t\tfor (let y = 0; y < height; y++) {\n\t\t\tfor (let x = 0; x < width; x++) {\n\t\t\t\tconst index = y * width + x;\n\t\t\t\tconst indexFlipped = (height - 1 - y) * width + x;\n\t\t\t\tfor (let i = 0; i < dataLayer.numComponents; i++) {\n\t\t\t\t\tbuffer[4 * indexFlipped + i] = values[dataLayer.numComponents * index + i] * (isFloat ? 255 : 1);\n\t\t\t\t}\n\t\t\t\tif (dataLayer.numComponents < 4) {\n\t\t\t\t\tbuffer[4 * indexFlipped + 3] = 255; // Set alpha channel to 255.\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tcontext.putImageData(imageData, 0, 0);\n\n\t\tcanvas!.toBlob((blob) => {\n\t\t\tif (!blob) {\n\t\t\t\tconsole.warn('Problem saving PNG, unable to init blob.');\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (dpi) {\n\t\t\t\tchangeDpiBlob(blob, dpi).then((blob: Blob) =>{\n\t\t\t\t\tcallback(blob, `${filename}.png`);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tcallback(blob, `${filename}.png`);\n\t\t\t}\n\t\t\t\n\t\t}, 'image/png');\n\t}\n\n\tattachDataLayerToThreeTexture(dataLayer: DataLayer, texture: Texture) {\n\t\tif (!this.renderer) {\n\t\t\tthrow new Error('WebGLCompute was not inited with a renderer.');\n\t\t}\n\t\t// Link webgl texture to threejs object.\n\t\t// This is not officially supported.\n\t\tif (dataLayer.numBuffers > 1) {\n\t\t\tthrow new Error(`DataLayer \"${dataLayer.name}\" contains multiple WebGL textures (one for each buffer) that are flip-flopped during compute cycles, please choose a DataLayer with one buffer.`);\n\t\t}\n\t\tconst offsetTextureProperties = this.renderer.properties.get(texture);\n\t\toffsetTextureProperties.__webglTexture = dataLayer.currentState;\n\t\toffsetTextureProperties.__webglInit = true;\n\t}\n\n\tresetThreeState() {\n\t\tif (!this.renderer) {\n\t\t\tthrow new Error('WebGLCompute was not inited with a renderer.');\n\t\t}\n\t\tconst { gl } = this;\n\t\t// Reset viewport.\n\t\tconst viewport = this.renderer.getViewport(new utils.Vector4() as Vector4);\n\t\tgl.viewport(viewport.x, viewport.y, viewport.width, viewport.height);\n\t\t// Unbind framebuffer (render to screen).\n\t\tthis.renderer.setRenderTarget(null);\n\t\t// Reset texture bindings.\n\t\tthis.renderer.resetState();\n\t}\n\t\n\tdispose() {\n\t\tconst {\n\t\t\tgl, verboseLogging,\n\t\t\t_vertexShaders,\n\t\t\tcopyPrograms, setValuePrograms, vectorMagnitudePrograms,\n\t\t} = this;\n\n\t\tif (verboseLogging) console.log(`Deallocating WebGLCompute.`);\n\n\t\t// TODO: delete buffers.\n\n\t\t// Delete vertex shaders.\n\t\tObject.values(_vertexShaders).forEach(vertexShader => {\n\t\t\tif (vertexShader.shader) {\n\t\t\t\tgl.deleteShader(vertexShader.shader);\n\t\t\t\tdelete vertexShader.shader;\n\t\t\t}\n\t\t});\n\t\t\n\t\t// Delete fragment shaders.\n\t\tObject.values(copyPrograms).forEach(program => {\n\t\t\t// @ts-ignore\n\t\t\tif ((program as GPUProgram).dispose) (program as GPUProgram).dispose();\n\t\t});\n\t\tObject.keys(copyPrograms).forEach(key => {\n\t\t\t// @ts-ignore\n\t\t\tdelete copyPrograms[key];\n\t\t});\n\t\tObject.values(setValuePrograms).forEach(program => {\n\t\t\t// @ts-ignore\n\t\t\tif ((program as GPUProgram).dispose) (program as GPUProgram).dispose();\n\t\t});\n\t\tObject.keys(setValuePrograms).forEach(key => {\n\t\t\t// @ts-ignore\n\t\t\tdelete setValuePrograms[key];\n\t\t});\n\t\tObject.values(vectorMagnitudePrograms).forEach(program => {\n\t\t\t// @ts-ignore\n\t\t\tif ((program as GPUProgram).dispose) (program as GPUProgram).dispose();\n\t\t});\n\t\tObject.keys(vectorMagnitudePrograms).forEach(key => {\n\t\t\t// @ts-ignore\n\t\t\tdelete vectorMagnitudePrograms[key];\n\t\t});\n\t\tthis._wrappedLineColorProgram?.dispose();\n\t\tdelete this._wrappedLineColorProgram;\n\n\t\tdelete this.renderer;\n\t\t// @ts-ignore\n\t\tdelete this.gl;\n\t}\n}","const extensions: { [key: string]: any } = {};\n\n// https://developer.mozilla.org/en-US/docs/Web/API/OES_texture_float\n// Float is provided by default in WebGL2 contexts.\n// This extension implicitly enables the WEBGL_color_buffer_float extension (if supported), which allows rendering to 32-bit floating-point color buffers.\nexport const OES_TEXTURE_FLOAT = 'OES_texture_float';\n// https://developer.mozilla.org/en-US/docs/Web/API/OES_texture_half_float\n// Half float is supported by modern mobile browsers, float not yet supported.\n// Half float is provided by default for Webgl2 contexts.\n// This extension implicitly enables the EXT_color_buffer_half_float extension (if supported), which allows rendering to 16-bit floating point formats.\nexport const OES_TEXTURE_HALF_FLOAT = 'OES_texture_half_float';\n// TODO: Seems like linear filtering of floats may be supported in some browsers without these extensions?\n// https://www.khronos.org/registry/OpenGL/extensions/OES/OES_texture_float_linear.txt\nexport const OES_TEXTURE_FLOAT_LINEAR = 'OES_texture_float_linear';\nexport const OES_TEXTURE_HAlF_FLOAT_LINEAR = 'OES_texture_half_float_linear';\n// https://developer.mozilla.org/en-US/docs/Web/API/WEBGL_depth_texture\n// Adds gl.UNSIGNED_SHORT, gl.UNSIGNED_INT types to textImage2D in WebGL1.0\nexport const WEBGL_DEPTH_TEXTURE = 'WEBGL_depth_texture';\n// EXT_COLOR_BUFFER_FLOAT adds ability to render to a variety of floating pt textures.\n// This is needed for the WebGL2 contexts that do not support OES_TEXTURE_FLOAT / OES_TEXTURE_HALF_FLOAT extensions.\n// https://developer.mozilla.org/en-US/docs/Web/API/EXT_color_buffer_float\n// https://stackoverflow.com/questions/34262493/framebuffer-incomplete-attachment-for-texture-with-internal-format\n// https://stackoverflow.com/questions/36109347/framebuffer-incomplete-attachment-only-happens-on-android-w-firefox\nexport const EXT_COLOR_BUFFER_FLOAT = 'EXT_color_buffer_float';\n\nexport function getExtension(\n\tgl: WebGLRenderingContext | WebGL2RenderingContext,\n\textensionName: string,\n\terrorCallback: (message: string) => void,\n\toptional = false,\n) {\n\t// Check if we've already loaded the extension.\n\tif (extensions[extensionName] !== undefined) return extensions[extensionName];\n\n\tlet extension;\n\ttry {\n\t\textension = gl.getExtension(extensionName);\n\t} catch (e) {}\n\tif (extension) {\n\t\t// Cache this extension.\n\t\textensions[extensionName] = extension;\n\t\tconsole.log(`Loaded extension: ${extensionName}.`);\n\t} else {\n\t\textensions[extensionName] = false; // Cache the bad extension lookup.\n\t\tconsole.warn(`Unsupported ${optional ? 'optional ' : ''}extension: ${extensionName}.`);\n\t}\n\t// If the extension is not optional, throw error.\n\tif (!extension && !optional) {\n\t\terrorCallback(`Required extension unsupported by this device / browser: ${extensionName}.`);\n\t}\n\treturn extension;\n}","import { inDevMode, isWebGL2Supported } from './utils';\nimport { WebGLCompute } from './WebGLCompute';\n\nif (inDevMode()) {\n\tconsole.log('Running in development mode.');\n}\n\nexport * from './Constants';\nexport {\n\tWebGLCompute,\n\tisWebGL2Supported,\n};","import { isString } from './Checks';\nimport { CompileTimeVars, GLSL1 } from './Constants';\nimport { WebGLCompute } from './WebGLCompute';\n\n// Copied from http://webglfundamentals.org/webgl/lessons/webgl-boilerplate.html\nexport function compileShader(\n\tglcompute: WebGLCompute,\n\tshaderSource: string,\n\tshaderType: number,\n\tprogramName: string,\n\tdefines?: CompileTimeVars,\n) {\n\tconst { gl, _errorCallback } = glcompute;\n\tif (defines) {\n\t\tshaderSource = insertDefinesAfterVersionDeclaration(glcompute, shaderSource, defines);\n\t}\n\t// Create the shader object\n\tconst shader = gl.createShader(shaderType);\n\tif (!shader) {\n\t\t_errorCallback('Unable to init gl shader.');\n\t\treturn null;\n\t}\n\n\t// Set the shader source code.\n\tgl.shaderSource(shader, shaderSource);\n\n\t// Compile the shader\n\tgl.compileShader(shader);\n\n\t// Check if it compiled\n\tconst success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\n\tif (!success) {\n\t\t// Something went wrong during compilation - print the error.\n\t\t_errorCallback(`Could not compile ${shaderType === gl.FRAGMENT_SHADER ? 'fragment' : 'vertex'}\n\t\t\t shader for program \"${programName}\": ${gl.getShaderInfoLog(shader)}.`);\n\t\treturn null;\n\t}\n\treturn shader;\n}\n\nexport function insertDefinesAfterVersionDeclaration(\n\tglcompute: WebGLCompute,\n\tshaderSource: string,\n\tdefines: CompileTimeVars) {\n\t\tconst definesSource = convertDefinesToString(defines);\n\t\tif (glcompute.glslVersion === GLSL1) {\n\t\t\t// GLSL version 1.\n\t\t\tshaderSource = `${definesSource}\\n${shaderSource}`\n\t\t} else {\n\t\t\t// GLSL version 3.\n\t\t\t// Defines should come after version declaration.\n\t\t\tshaderSource = shaderSource.replace('\\n', `\\n${definesSource}\\n`);\n\t\t}\n\t\treturn shaderSource;\n}\n\nexport function isWebGL2(gl: WebGLRenderingContext | WebGL2RenderingContext) {\n\t// This code is pulled from https://github.com/mrdoob/three.js/blob/master/src/renderers/webgl/WebGLCapabilities.js\n\t// @ts-ignore\n\treturn (typeof WebGL2RenderingContext !== 'undefined' && gl instanceof WebGL2RenderingContext) || (typeof WebGL2ComputeRenderingContext !== 'undefined' && gl instanceof WebGL2ComputeRenderingContext);\n\t// return !!(gl as WebGL2RenderingContext).HALF_FLOAT;\n}\n\nexport function isWebGL2Supported() {\n\tconst gl = document.createElement('canvas').getContext('webgl2');\n\tif (!gl) {\n\t\treturn false;\n\t}\n\treturn true;\n}\n\nexport function isPowerOf2(value: number) {\n\treturn (value & (value - 1)) == 0;\n}\n\nexport function initSequentialFloatArray(length: number) {\n\tconst array = new Float32Array(length);\n\tfor (let i = 0; i < length; i++) {\n\t\tarray[i] = i;\n\t}\n\treturn array;\n}\n\nexport function inDevMode() {\n\treturn process.env.NODE_ENV === 'development';\n}\n\nfunction convertDefinesToString(defines: CompileTimeVars) {\n\tlet definesSource = '';\n\tconst keys = Object.keys(defines);\n\tfor (let i = 0; i < keys.length; i++) {\n\t\tconst key = keys[i];\n\t\t// Check that define is passed in as a string.\n\t\tif (!isString(key) || !isString(defines[key])) {\n\t\t\tthrow new Error(`GPUProgram defines must be passed in as key value pairs that are both strings, got key value pair of type [${typeof key} : ${typeof defines[key]}].`)\n\t\t}\n\t\tdefinesSource += `#define ${key} ${defines[key]}\\n`;\n\t}\n\treturn definesSource;\n}","module.exports = \"#version 300 es\\nprecision highp int;precision highp float;precision lowp sampler2D;precision lowp isampler2D;precision lowp usampler2D;in vec2 v_UV;\\n#ifdef FLOAT\\nuniform sampler2D u_state;\\n#endif\\n#ifdef INT\\nuniform isampler2D u_state;\\n#endif\\n#ifdef UINT\\nuniform usampler2D u_state;\\n#endif\\n#ifdef FLOAT\\nout vec4 out_fragOut;\\n#endif\\n#ifdef INT\\nout ivec4 out_fragOut;\\n#endif\\n#ifdef UINT\\nout uvec4 out_fragOut;\\n#endif\\nvoid main(){out_fragOut=A(u_state,v_UV);}\"","module.exports = \"#version 300 es\\nprecision highp int;precision highp float;precision lowp sampler2D;precision lowp isampler2D;precision lowp usampler2D;\\n#ifdef FLOAT\\nuniform vec4 u_value;\\n#endif\\n#ifdef INT\\nuniform ivec4 u_value;\\n#endif\\n#ifdef UINT\\nuniform uvec4 u_value;\\n#endif\\n#ifdef FLOAT\\nout vec4 out_fragOut;\\n#endif\\n#ifdef INT\\nout ivec4 out_fragOut;\\n#endif\\n#ifdef UINT\\nout uvec4 out_fragOut;\\n#endif\\nvoid main(){out_fragOut=u_value;}\"","module.exports = \"#version 300 es\\nprecision highp int;precision highp float;precision lowp sampler2D;precision lowp isampler2D;precision lowp usampler2D;in vec2 v_UV;uniform vec3 u_color;uniform float u_scale;\\n#ifdef FLOAT\\nuniform sampler2D u_internal_data;\\n#endif\\n#ifdef INT\\nuniform isampler2D u_internal_data;\\n#endif\\n#ifdef UINT\\nuniform usampler2D u_internal_data;\\n#endif\\nout vec4 out_fragOut;void main(){uvec4 A=B(u_internal_data,v_UV);float C=length(A);out_fragOut=vec4(C*u_scale*u_color,1);}\"","module.exports = \"#version 300 es\\nprecision highp int;precision highp float;precision lowp sampler2D;precision lowp isampler2D;precision lowp usampler2D;in vec2 v_lineWrapping;uniform vec4 u_value;out vec4 out_fragOut;void main(){if((v_lineWrapping.x!=0.&&v_lineWrapping.x!=1.)||(v_lineWrapping.y!=0.&&v_lineWrapping.y!=1.)){discard;return;}out_fragOut=vec4(u_value);}\"","module.exports = \"#version 300 es\\nprecision highp int;precision highp float;precision lowp sampler2D;precision lowp isampler2D;precision lowp usampler2D;float A(float B,float C){float D=B-floor((B+0.5)/C)*C;return floor(D+0.5);}in float a_internal_index;uniform sampler2D u_internal_positions;uniform vec2 u_internal_positionsDimensions;uniform vec2 u_internal_scale;uniform bool u_internal_positionWithAccumulation;uniform bool u_internal_wrapX;uniform bool u_internal_wrapY;out vec2 v_UV;out vec2 v_lineWrapping;out float v_index;void main(){vec2 E=vec2(A(a_internal_index,u_internal_positionsDimensions.x),floor(floor(a_internal_index+0.5)/u_internal_positionsDimensions.x))/u_internal_positionsDimensions;vec4 F=texture2D(u_internal_positions,E);vec2 G=F.rg;if(u_internal_positionWithAccumulation)G+=F.ba;v_UV=G*u_internal_scale;v_lineWrapping=vec2(0.);if(u_internal_wrapX){if(v_UV.x<0.){v_UV.x+=1.;v_lineWrapping.x=1.;}else if(v_UV.x>1.){v_UV.x-=1.;v_lineWrapping.x=1.;}}if(u_internal_wrapY){if(v_UV.y<0.){v_UV.y+=1.;v_lineWrapping.y=1.;}else if(v_UV.y>1.){v_UV.y-=1.;v_lineWrapping.y=1.;}}vec2 H=v_UV*2.-1.;v_index=a_internal_index;gl_Position=vec4(H,0,1);}\"","module.exports = \"#version 300 es\\nprecision highp int;precision highp float;precision lowp sampler2D;precision lowp isampler2D;precision lowp usampler2D;float A(float B,float C){float D=B-floor((B+0.5)/C)*C;return floor(D+0.5);}in float a_internal_index;uniform sampler2D u_internal_positions;uniform vec2 u_internal_positionsDimensions;uniform vec2 u_internal_scale;uniform float u_internal_pointSize;uniform bool u_internal_positionWithAccumulation;uniform bool u_internal_wrapX;uniform bool u_internal_wrapY;out vec2 v_UV;out float v_index;void main(){vec2 E=vec2(A(a_internal_index,u_internal_positionsDimensions.x),floor(floor(a_internal_index+0.5)/u_internal_positionsDimensions.x))/u_internal_positionsDimensions;vec4 F=texture2D(u_internal_positions,E);vec2 G=F.rg;if(u_internal_positionWithAccumulation)G+=F.ba;v_UV=G*u_internal_scale;if(u_internal_wrapX){if(v_UV.x<0.)v_UV.x+=1.;if(v_UV.x>1.)v_UV.x-=1.;}if(u_internal_wrapY){if(v_UV.y<0.)v_UV.y+=1.;if(v_UV.y>1.)v_UV.y-=1.;}vec2 H=v_UV*2.-1.;v_index=a_internal_index;gl_PointSize=u_internal_pointSize;gl_Position=vec4(H,0,1);}\"","module.exports = \"#version 300 es\\nprecision highp int;precision highp float;precision lowp sampler2D;precision lowp isampler2D;precision lowp usampler2D;float A(float B,float C){float D=B-floor((B+0.5)/C)*C;return floor(D+0.5);}in float a_internal_index;uniform sampler2D u_internal_vectors;uniform vec2 u_internal_dimensions;uniform vec2 u_internal_scale;out vec2 v_UV;out float v_index;void main(){float E=floor((a_internal_index+0.5)/2.);v_UV=vec2(A(E,u_internal_dimensions.x),floor(floor(E+0.5)/u_internal_dimensions.x))/u_internal_dimensions;if(A(a_internal_index,2.)>0.){vec2 F=texture2D(u_internal_vectors,v_UV).xy;v_UV+=F*u_internal_scale;}vec2 G=v_UV*2.-1.;v_index=a_internal_index;gl_Position=vec4(G,0,1);}\"","module.exports = \"#version 300 es\\nprecision highp int;precision highp float;precision lowp sampler2D;precision lowp isampler2D;precision lowp usampler2D;in vec2 a_internal_position;\\n#ifdef UV_ATTRIBUTE\\nin vec2 a_internal_uv;\\n#endif\\n#ifdef NORMAL_ATTRIBUTE\\nin vec2 a_internal_normal;\\n#endif\\nuniform vec2 u_internal_scale;uniform vec2 u_internal_translation;out vec2 v_UV;out vec2 v_UV_local;\\n#ifdef NORMAL_ATTRIBUTE\\nout vec2 v_normal;\\n#endif\\nvoid main(){\\n#ifdef UV_ATTRIBUTE\\nv_UV_local=a_internal_uv;\\n#else\\nv_UV_local=a_internal_position;\\n#endif\\n#ifdef NORMAL_ATTRIBUTE\\nv_normal=a_internal_normal;\\n#endif\\nvec2 A=u_internal_scale*a_internal_position+u_internal_translation;v_UV=0.5*(A+1.);gl_Position=vec4(A,0,1);}\"","module.exports = \"#version 300 es\\nprecision highp int;precision highp float;precision lowp sampler2D;precision lowp isampler2D;precision lowp usampler2D;in vec2 a_internal_position;uniform float u_internal_halfThickness;uniform vec2 u_internal_scale;uniform float u_internal_length;uniform float u_internal_rotation;uniform vec2 u_internal_translation;out vec2 v_UV_local;out vec2 v_UV;mat2 A(float B){return mat2(cos(B),-sin(B),sin(B),cos(B));}void main(){v_UV_local=0.5*(a_internal_position+1.);vec2 C=a_internal_position;C*=u_internal_halfThickness;if(C.x<0.){C.x-=u_internal_length/2.;v_UV_local.x=0.;}else if(C.x>0.){C.x+=u_internal_length/2.;v_UV_local.x=1.;}C=u_internal_scale*(A(-u_internal_rotation)*C)+u_internal_translation;v_UV=0.5*(C+1.);gl_Position=vec4(C,0,1);}\"","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\tloaded: false,\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Flag the module as loaded\n\tmodule.loaded = true;\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.hmd = (module) => {\n\tmodule = Object.create(module);\n\tif (!module.children) module.children = [];\n\tObject.defineProperty(module, 'exports', {\n\t\tenumerable: true,\n\t\tset: () => {\n\t\t\tthrow new Error('ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: ' + module.id);\n\t\t}\n\t});\n\treturn module;\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(607);\n"],"sourceRoot":""}
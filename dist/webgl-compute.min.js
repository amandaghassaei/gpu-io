!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.WebGLCompute=t():e.WebGLCompute=t()}(self,(function(){return(()=>{var e={501:(e,t,r)=>{"use strict";r.r(t),r.d(t,{Float16Array:()=>Ce,getFloat16:()=>We,hfround:()=>h,setFloat16:()=>je});const n=new ArrayBuffer(4),i=new Float32Array(n),o=new Uint32Array(n),a=new Uint32Array(512),s=new Uint32Array(512);for(let e=0;e<256;++e){const t=e-127;t<-27?(a[0|e]=0,a[256|e]=32768,s[0|e]=24,s[256|e]=24):t<-14?(a[0|e]=1024>>-t-14,a[256|e]=1024>>-t-14|32768,s[0|e]=-t-1,s[256|e]=-t-1):t<=15?(a[0|e]=t+15<<10,a[256|e]=t+15<<10|32768,s[0|e]=13,s[256|e]=13):t<128?(a[0|e]=31744,a[256|e]=64512,s[0|e]=24,s[256|e]=24):(a[0|e]=31744,a[256|e]=64512,s[0|e]=13,s[256|e]=13)}function l(e){i[0]=e;const t=o[0],r=t>>23&511;return a[r]+((8388607&t)>>s[r])}const u=new Uint32Array(2048),f=new Uint32Array(64),c=new Uint32Array(64);u[0]=0;for(let e=1;e<1024;++e){let t=e<<13,r=0;for(;0==(8388608&t);)r-=8388608,t<<=1;t&=-8388609,r+=947912704,u[e]=t|r}for(let e=1024;e<2048;++e)u[e]=939524096+(e-1024<<13);f[0]=0;for(let e=1;e<31;++e)f[e]=e<<23;f[31]=1199570944,f[32]=2147483648;for(let e=33;e<63;++e)f[e]=2147483648+(e-32<<23);f[63]=3347054592,c[0]=0;for(let e=1;e<64;++e)c[e]=32===e?0:1024;function p(e){const t=e>>10;return o[0]=u[c[t]+(1023&e)]+f[t],i[0]}function h(e){if(e=Number(e),!Number.isFinite(e)||0===e)return e;return p(l(e))}var _=r(277),d="object"==typeof self&&self&&self.Object===Object&&self;const g=_.Z||d||Function("return this")();const m=g.Symbol;var v=Object.prototype,y=v.hasOwnProperty,T=v.toString,A=m?m.toStringTag:void 0;const E=function(e){var t=y.call(e,A),r=e[A];try{e[A]=void 0;var n=!0}catch(e){}var i=T.call(e);return n&&(t?e[A]=r:delete e[A]),i};var b=Object.prototype.toString;const w=function(e){return b.call(e)};var L=m?m.toStringTag:void 0;const R=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":L&&L in Object(e)?E(e):w(e)};const F=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};const O=function(e){if(!F(e))return!1;var t=R(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t};const U=g["__core-js_shared__"];var N,I=(N=/[^.]+$/.exec(U&&U.keys&&U.keys.IE_PROTO||""))?"Symbol(src)_1."+N:"";const x=function(e){return!!I&&I in e};var D=Function.prototype.toString;const S=function(e){if(null!=e){try{return D.call(e)}catch(e){}try{return e+""}catch(e){}}return""};var P=/^\[object .+?Constructor\]$/,B=Function.prototype,G=Object.prototype,M=B.toString,C=G.hasOwnProperty,V=RegExp("^"+M.call(C).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const k=function(e){return!(!F(e)||x(e))&&(O(e)?V:P).test(S(e))};const W=function(e,t){return null==e?void 0:e[t]};const j=function(e,t){var r=W(e,t);return k(r)?r:void 0};const H=j(Object,"create");const Y=function(){this.__data__=H?H(null):{},this.size=0};const X=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t};var z=Object.prototype.hasOwnProperty;const q=function(e){var t=this.__data__;if(H){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return z.call(t,e)?t[e]:void 0};var K=Object.prototype.hasOwnProperty;const Z=function(e){var t=this.__data__;return H?void 0!==t[e]:K.call(t,e)};const $=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=H&&void 0===t?"__lodash_hash_undefined__":t,this};function J(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}J.prototype.clear=Y,J.prototype.delete=X,J.prototype.get=q,J.prototype.has=Z,J.prototype.set=$;const Q=J;const ee=function(){this.__data__=[],this.size=0};const te=function(e,t){return e===t||e!=e&&t!=t};const re=function(e,t){for(var r=e.length;r--;)if(te(e[r][0],t))return r;return-1};var ne=Array.prototype.splice;const ie=function(e){var t=this.__data__,r=re(t,e);return!(r<0)&&(r==t.length-1?t.pop():ne.call(t,r,1),--this.size,!0)};const oe=function(e){var t=this.__data__,r=re(t,e);return r<0?void 0:t[r][1]};const ae=function(e){return re(this.__data__,e)>-1};const se=function(e,t){var r=this.__data__,n=re(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};function le(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}le.prototype.clear=ee,le.prototype.delete=ie,le.prototype.get=oe,le.prototype.has=ae,le.prototype.set=se;const ue=le;const fe=j(g,"Map");const ce=function(){this.size=0,this.__data__={hash:new Q,map:new(fe||ue),string:new Q}};const pe=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};const he=function(e,t){var r=e.__data__;return pe(t)?r["string"==typeof t?"string":"hash"]:r.map};const _e=function(e){var t=he(this,e).delete(e);return this.size-=t?1:0,t};const de=function(e){return he(this,e).get(e)};const ge=function(e){return he(this,e).has(e)};const me=function(e,t){var r=he(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};function ve(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}ve.prototype.clear=ce,ve.prototype.delete=_e,ve.prototype.get=de,ve.prototype.has=ge,ve.prototype.set=me;const ye=ve;function Te(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],o=r.cache;if(o.has(i))return o.get(i);var a=e.apply(this,n);return r.cache=o.set(i,a)||o,a};return r.cache=new(Te.Cache||ye),r}Te.Cache=ye;const Ae=Te,Ee=Object.getOwnPropertyDescriptor(new Uint8Array(1),0).writable;function be(e){let t="number"!=typeof e?Number(e):e;return Number.isNaN(t)&&(t=0),Math.trunc(t)}function we(e,t){const[r,n]=[Number.isNaN(e),Number.isNaN(t)];if(r&&n)return 0;if(r)return 1;if(n)return-1;if(e<t)return-1;if(e>t)return 1;if(0===e&&0===t){const[r,n]=[Object.is(e,0),Object.is(t,0)];if(!r&&n)return-1;if(r&&!n)return 1}return 0}function Le(e){return e instanceof DataView}function Re(e){return"string"==typeof e&&e===be(e)+""}const Fe=function(e){return null!=e&&"object"==typeof e};const Oe=function(e){return Fe(e)&&"[object ArrayBuffer]"==R(e)};const Ue=function(e){return function(t){return e(t)}};var Ne=r(730),Ie=Ne.Z&&Ne.Z.isArrayBuffer;const xe=Ie?Ue(Ie):Oe;const De=function(){const e=new WeakMap;return t=>{let r=e.get(t);return r||(r=Object.create(null),e.set(t,r),r)}}();function Se(e){return e instanceof Ce}function Pe(e){if(!Se(e))throw new TypeError("This is not a Float16Array")}function Be(e){const t=e.length,r=new Array(t);for(let n=0;n<t;++n)r[n]=p(e[n]);return r}const Ge={apply(e,t,r){return Se(t)&&("function"==typeof(n=e)&&ke.has(n))?Reflect.apply(e,De(t).target,r):Reflect.apply(e,t,r);var n}},Me={get(e,t){let r=null;if(Ee||(r=e,e=De(r).target),Re(t))return Reflect.has(e,t)?p(Reflect.get(e,t)):void 0;{const n=null!==r&&Reflect.has(r,t)?Reflect.get(r,t):Reflect.get(e,t);if("function"!=typeof n)return n;let i=De(n).proxy;return void 0===i&&(i=De(n).proxy=new Proxy(n,Ge)),i}},set(e,t,r){let n=null;return Ee||(n=e,e=De(n).target),Re(t)?Reflect.set(e,t,l(r)):null===n||Reflect.has(e,t)&&!Object.isFrozen(n)?Reflect.set(e,t,r):Reflect.set(n,t,r)}};Ee||(Me.getPrototypeOf=e=>Reflect.getPrototypeOf(De(e).target),Me.setPrototypeOf=(e,t)=>Reflect.setPrototypeOf(De(e).target,t),Me.defineProperty=(e,t,r)=>{const n=De(e).target;return!Reflect.has(n,t)||Object.isFrozen(e)?Reflect.defineProperty(e,t,r):Reflect.defineProperty(n,t,r)},Me.deleteProperty=(e,t)=>{const r=De(e).target;return Reflect.has(e,t)?Reflect.deleteProperty(e,t):Reflect.deleteProperty(r,t)},Me.has=(e,t)=>Reflect.has(e,t)||Reflect.has(De(e).target,t),Me.isExtensible=e=>Reflect.isExtensible(e),Me.preventExtensions=e=>Reflect.preventExtensions(e),Me.getOwnPropertyDescriptor=(e,t)=>Reflect.getOwnPropertyDescriptor(e,t),Me.ownKeys=e=>Reflect.ownKeys(e));class Ce extends Uint16Array{constructor(e,t,r){if(Se(e))super(De(e).target);else if(null===e||"object"!=typeof e||xe(e))switch(arguments.length){case 0:super();break;case 1:super(e);break;case 2:super(e,t);break;case 3:super(e,t,r);break;default:super(...arguments)}else{const t=Reflect.has(e,"length")||void 0===e[Symbol.iterator]?e:[...e],r=t.length;super(r);for(let e=0;e<r;++e)this[e]=l(t[e])}let n;if(Ee)n=new Proxy(this,Me);else{const e=Object.create(null);De(e).target=this,n=new Proxy(e,Me)}return De(n).target=this,De(this).proxy=n,n}static from(e,...t){if(0===t.length)return new Ce(Uint16Array.from(e,l).buffer);const r=t[0],n=t[1];return new Ce(Uint16Array.from(e,(function(e,...t){return l(r.call(this,e,...t))}),n).buffer)}static of(...e){return new Ce(e)}*[Symbol.iterator](){for(const e of super[Symbol.iterator]())yield p(e)}keys(){return super.keys()}*values(){for(const e of super.values())yield p(e)}*entries(){for(const[e,t]of super.entries())yield[e,p(t)]}map(e,...t){Pe(this);const r=t[0],n=[];for(let t=0,i=this.length;t<i;++t){const i=p(this[t]);n.push(e.call(r,i,t,De(this).proxy))}return new Ce(n)}filter(e,...t){Pe(this);const r=t[0],n=[];for(let t=0,i=this.length;t<i;++t){const i=p(this[t]);e.call(r,i,t,De(this).proxy)&&n.push(i)}return new Ce(n)}reduce(e,...t){let r,n;Pe(this),0===t.length?(r=p(this[0]),n=1):(r=t[0],n=0);for(let t=n,i=this.length;t<i;++t)r=e(r,p(this[t]),t,De(this).proxy);return r}reduceRight(e,...t){let r,n;Pe(this);const i=this.length;0===t.length?(r=p(this[i-1]),n=i-1):(r=t[0],n=i);for(let t=n;t--;)r=e(r,p(this[t]),t,De(this).proxy);return r}forEach(e,...t){Pe(this);const r=t[0];for(let t=0,n=this.length;t<n;++t)e.call(r,p(this[t]),t,De(this).proxy)}find(e,...t){Pe(this);const r=t[0];for(let t=0,n=this.length;t<n;++t){const n=p(this[t]);if(e.call(r,n,t,De(this).proxy))return n}}findIndex(e,...t){Pe(this);const r=t[0];for(let t=0,n=this.length;t<n;++t){const n=p(this[t]);if(e.call(r,n,t,De(this).proxy))return t}return-1}every(e,...t){Pe(this);const r=t[0];for(let t=0,n=this.length;t<n;++t)if(!e.call(r,p(this[t]),t,De(this).proxy))return!1;return!0}some(e,...t){Pe(this);const r=t[0];for(let t=0,n=this.length;t<n;++t)if(e.call(r,p(this[t]),t,De(this).proxy))return!0;return!1}set(e,...t){Pe(this);const r=t[0];let n;if(Se(e))n=De(e).target;else{const t=Reflect.has(e,"length")||void 0===e[Symbol.iterator]?e:[...e],r=t.length;n=new Uint16Array(r);for(let e=0,r=t.length;e<r;++e)n[e]=l(t[e])}super.set(n,r)}reverse(){return Pe(this),super.reverse(),De(this).proxy}fill(e,...t){return Pe(this),super.fill(l(e),...t),De(this).proxy}copyWithin(e,t,...r){return Pe(this),super.copyWithin(e,t,...r),De(this).proxy}sort(...e){Pe(this);let t=e[0];void 0===t&&(t=we);const r=Ae(p);return super.sort(((e,n)=>t(r(e),r(n)))),De(this).proxy}slice(...e){let t;Pe(this);try{t=super.slice(...e)}catch(r){if(!(r instanceof TypeError))throw r;t=new Uint16Array(this.buffer,this.byteOffset,this.length).slice(...e)}return new Ce(t.buffer)}subarray(...e){let t;Pe(this);try{t=super.subarray(...e)}catch(r){if(!(r instanceof TypeError))throw r;t=new Uint16Array(this.buffer,this.byteOffset,this.length).subarray(...e)}return new Ce(t.buffer,t.byteOffset,t.length)}indexOf(e,...t){Pe(this);const r=this.length;let n=be(t[0]);n<0&&(n+=r,n<0&&(n=0));for(let t=n,i=r;t<i;++t)if(p(this[t])===e)return t;return-1}lastIndexOf(e,...t){Pe(this);const r=this.length;let n=be(t[0]);n=0===n?r:n+1,n>=0?n=n<r?n:r:n+=r;for(let t=n;t--;)if(p(this[t])===e)return t;return-1}includes(e,...t){Pe(this);const r=this.length;let n=be(t[0]);n<0&&(n+=r,n<0&&(n=0));const i=Number.isNaN(e);for(let t=n,o=r;t<o;++t){const r=p(this[t]);if(i&&Number.isNaN(r))return!0;if(r===e)return!0}return!1}join(...e){Pe(this);return Be(this).join(...e)}toLocaleString(...e){Pe(this);return Be(this).toLocaleString(...e)}get[Symbol.toStringTag](){if(Se(this))return"Float16Array"}}const Ve=Ce.prototype,ke=new WeakSet;for(const e of Reflect.ownKeys(Ve)){const t=Ve[e];"function"==typeof t&&ke.add(t)}function We(e,t,...r){if(!Le(e))throw new TypeError("First argument to getFloat16 function must be a DataView");return p(e.getUint16(t,...r))}function je(e,t,r,...n){if(!Le(e))throw new TypeError("First argument to setFloat16 function must be a DataView");e.setUint16(t,l(r),...n)}},809:(e,t)=>{"use strict";function r(e){var t=-1;n||(n=function(){for(var e=new Int32Array(256),t=0;t<256;t++){for(var r=t,n=0;n<8;n++)r=1&r?3988292384^r>>>1:r>>>1;e[t]=r}return e}());for(var r=0;r<e.length;r++)t=n[255&(t^e[r])]^t>>>8;return-1^t}Object.defineProperty(t,"__esModule",{value:!0}),t.changeDpiBlob=function(e,t){var r=e.slice(0,33);return new Promise((function(n,i){var o=new FileReader;o.onload=function(){var r=new Uint8Array(o.result),i=e.slice(33),a=h(r,t,e.type);n(new Blob([a,i],{type:e.type}))},o.readAsArrayBuffer(r)}))},t.changeDpiDataUrl=function(e,t){var r=e.split(","),n=r[0],u=r[1],f=void 0,c=void 0,p=!1;if(-1!==n.indexOf(i)){f=i;var _=function(e){var t=e.indexOf(a);-1===t&&(t=e.indexOf(s));-1===t&&(t=e.indexOf(l));return t}(u);_>=0?(c=4*Math.ceil((_+28)/3),p=!0):c=44}-1!==n.indexOf(o)&&(f=o,c=24);for(var d=u.substring(0,c),g=u.substring(c),m=atob(d),v=new Uint8Array(m.length),y=0;y<v.length;y++)v[y]=m.charCodeAt(y);var T=h(v,t,f,p),A=btoa(String.fromCharCode.apply(String,function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(T)));return[n,",",A,g].join("")};var n=void 0,i="image/png",o="image/jpeg",a="AAlwSFlz",s="AAAJcEhZ",l="AAAACXBI",u="p".charCodeAt(0),f="H".charCodeAt(0),c="Y".charCodeAt(0),p="s".charCodeAt(0);function h(e,t,n,a){if(n===o)return e[13]=1,e[14]=t>>8,e[15]=255&t,e[16]=t>>8,e[17]=255&t,e;if(n===i){var s=new Uint8Array(13);t*=39.3701,s[0]=u,s[1]=f,s[2]=c,s[3]=p,s[4]=t>>>24,s[5]=t>>>16,s[6]=t>>>8,s[7]=255&t,s[8]=s[4],s[9]=s[5],s[10]=s[6],s[11]=s[7],s[12]=1;var l=r(s),h=new Uint8Array(4);if(h[0]=l>>>24,h[1]=l>>>16,h[2]=l>>>8,h[3]=255&l,a){var _=function(e){for(var t=e.length-1;t>=4;t--)if(9===e[t-4]&&e[t-3]===u&&e[t-2]===f&&e[t-1]===c&&e[t]===p)return t-3}(e);return e.set(s,_),e.set(h,_+13),e}var d=new Uint8Array(4);d[0]=0,d[1]=0,d[2]=0,d[3]=9;var g=new Uint8Array(54);return g.set(e,0),g.set(d,33),g.set(s,37),g.set(h,50),g}}},162:function(e,t,r){var n,i,o;i=[],void 0===(o="function"==typeof(n=function(){"use strict";function t(e,t){return void 0===t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}function n(e,t,r){var n=new XMLHttpRequest;n.open("GET",e),n.responseType="blob",n.onload=function(){l(n.response,t,r)},n.onerror=function(){console.error("could not download file")},n.send()}function i(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function o(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(r){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var a="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof r.g&&r.g.global===r.g?r.g:void 0,s=a.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),l=a.saveAs||("object"!=typeof window||window!==a?function(){}:"download"in HTMLAnchorElement.prototype&&!s?function(e,t,r){var s=a.URL||a.webkitURL,l=document.createElement("a");t=t||e.name||"download",l.download=t,l.rel="noopener","string"==typeof e?(l.href=e,l.origin===location.origin?o(l):i(l.href)?n(e,t,r):o(l,l.target="_blank")):(l.href=s.createObjectURL(e),setTimeout((function(){s.revokeObjectURL(l.href)}),4e4),setTimeout((function(){o(l)}),0))}:"msSaveOrOpenBlob"in navigator?function(e,r,a){if(r=r||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(t(e,a),r);else if(i(e))n(e,r,a);else{var s=document.createElement("a");s.href=e,s.target="_blank",setTimeout((function(){o(s)}))}}:function(e,t,r,i){if((i=i||open("","_blank"))&&(i.document.title=i.document.body.innerText="downloading..."),"string"==typeof e)return n(e,t,r);var o="application/octet-stream"===e.type,l=/constructor/i.test(a.HTMLElement)||a.safari,u=/CriOS\/[\d]+/.test(navigator.userAgent);if((u||o&&l||s)&&"undefined"!=typeof FileReader){var f=new FileReader;f.onloadend=function(){var e=f.result;e=u?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),i?i.location.href=e:location=e,i=null},f.readAsDataURL(e)}else{var c=a.URL||a.webkitURL,p=c.createObjectURL(e);i?i.location=p:location.href=p,i=null,setTimeout((function(){c.revokeObjectURL(p)}),4e4)}});a.saveAs=l.saveAs=l,e.exports=l})?n.apply(t,i):n)||(e.exports=o)},277:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});const n="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g},730:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});var n=r(277);e=r.hmd(e);var i="object"==typeof exports&&exports&&!exports.nodeType&&exports,o=i&&e&&!e.nodeType&&e,a=o&&o.exports===i&&n.Z.process;const s=function(){try{var e=o&&o.require&&o.require("util").types;return e||a&&a.binding&&a.binding("util")}catch(e){}}()},627:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isBoolean=t.isArray=t.isString=t.isNonNegativeInteger=t.isPositiveInteger=t.isInteger=t.isNumber=t.isNumberOfType=t.isValidClearValue=t.isValidTextureType=t.isValidTextureFormat=t.isValidWrap=t.isValidFilter=t.isValidDataType=void 0;var n=r(738);function i(e,t){switch(t){case n.HALF_FLOAT:case n.FLOAT:return o(e);case n.BYTE:case n.SHORT:case n.INT:return a(e);case n.UNSIGNED_BYTE:case n.UNSIGNED_SHORT:case n.UNSIGNED_INT:return s(e);default:throw new Error("Unknown type "+t)}}function o(e){return!isNaN(e)}function a(e){return o(e)&&e%1==0}function s(e){return a(e)&&e>=0}function l(e){return Array.isArray(e)}t.isValidDataType=function(e){return n.validDataTypes.indexOf(e)>-1},t.isValidFilter=function(e){return n.validFilters.indexOf(e)>-1},t.isValidWrap=function(e){return n.validWraps.indexOf(e)>-1},t.isValidTextureFormat=function(e){return n.validTextureFormats.indexOf(e)>-1},t.isValidTextureType=function(e){return n.validTextureTypes.indexOf(e)>-1},t.isValidClearValue=function(e,t,r){if(l(e)){if(e.length!==t)return!1;for(var n=0;n<e.length;n++)if(!i(e[n],r))return!1}else if(!i(e,r))return!1;return!0},t.isNumberOfType=i,t.isNumber=o,t.isInteger=a,t.isPositiveInteger=function(e){return a(e)&&e>0},t.isNonNegativeInteger=s,t.isString=function(e){return"string"==typeof e},t.isArray=l,t.isBoolean=function(e){return"boolean"==typeof e}},738:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_CIRCLE_NUM_SEGMENTS=t.DATA_LAYER_VECTOR_FIELD_PROGRAM_NAME=t.DATA_LAYER_LINES_PROGRAM_NAME=t.DATA_LAYER_POINTS_PROGRAM_NAME=t.SEGMENT_PROGRAM_NAME=t.DEFAULT_W_UV_NORMAL_PROGRAM_NAME=t.DEFAULT_W_NORMAL_PROGRAM_NAME=t.DEFAULT_W_UV_PROGRAM_NAME=t.DEFAULT_PROGRAM_NAME=t.INT_4D_UNIFORM=t.INT_3D_UNIFORM=t.INT_2D_UNIFORM=t.INT_1D_UNIFORM=t.FLOAT_4D_UNIFORM=t.FLOAT_3D_UNIFORM=t.FLOAT_2D_UNIFORM=t.FLOAT_1D_UNIFORM=t.GLSL1=t.GLSL3=t.validTextureTypes=t.validTextureFormats=t.validWraps=t.validFilters=t.validDataTypes=t.validArrayTypes=t.RGBA=t.RGB=t.CLAMP_TO_EDGE=t.REPEAT=t.NEAREST=t.LINEAR=t.UINT=t.BOOL=t.INT=t.UNSIGNED_INT=t.SHORT=t.UNSIGNED_SHORT=t.BYTE=t.UNSIGNED_BYTE=t.FLOAT=t.HALF_FLOAT=void 0,t.HALF_FLOAT="HALF_FLOAT",t.FLOAT="FLOAT",t.UNSIGNED_BYTE="UNSIGNED_BYTE",t.BYTE="BYTE",t.UNSIGNED_SHORT="UNSIGNED_SHORT",t.SHORT="SHORT",t.UNSIGNED_INT="UNSIGNED_INT",t.INT="INT",t.BOOL="BOOL",t.UINT="UINT",t.LINEAR="LINEAR",t.NEAREST="NEAREST",t.REPEAT="REPEAT",t.CLAMP_TO_EDGE="CLAMP_TO_EDGE",t.RGB="RGB",t.RGBA="RGBA",t.validArrayTypes=[Float32Array,Uint8Array,Int8Array,Uint16Array,Int16Array,Uint32Array,Int32Array,Array],t.validDataTypes=[t.HALF_FLOAT,t.FLOAT,t.UNSIGNED_BYTE,t.BYTE,t.UNSIGNED_SHORT,t.SHORT,t.UNSIGNED_INT,t.INT],t.validFilters=[t.LINEAR,t.NEAREST],t.validWraps=[t.CLAMP_TO_EDGE,t.REPEAT],t.validTextureFormats=[t.RGB,t.RGBA],t.validTextureTypes=[t.UNSIGNED_BYTE],t.GLSL3="300 es",t.GLSL1="100",t.FLOAT_1D_UNIFORM="1f",t.FLOAT_2D_UNIFORM="2f",t.FLOAT_3D_UNIFORM="3f",t.FLOAT_4D_UNIFORM="3f",t.INT_1D_UNIFORM="1i",t.INT_2D_UNIFORM="2i",t.INT_3D_UNIFORM="3i",t.INT_4D_UNIFORM="3i",t.DEFAULT_PROGRAM_NAME="DEFAULT",t.DEFAULT_W_UV_PROGRAM_NAME="DEFAULT_W_UV",t.DEFAULT_W_NORMAL_PROGRAM_NAME="DEFAULT_W_NORMAL",t.DEFAULT_W_UV_NORMAL_PROGRAM_NAME="DEFAULT_W_UV_NORMAL",t.SEGMENT_PROGRAM_NAME="SEGMENT",t.DATA_LAYER_POINTS_PROGRAM_NAME="DATA_LAYER_POINTS",t.DATA_LAYER_LINES_PROGRAM_NAME="DATA_LAYER_LINES",t.DATA_LAYER_VECTOR_FIELD_PROGRAM_NAME="DATA_LAYER_VECTOR_FIELD",t.DEFAULT_CIRCLE_NUM_SEGMENTS=18},930:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DataLayer=void 0;var n=r(501),i=r(627),o=r(738),a=r(581),s=r(593),l=function(){function e(t,r){this._bufferIndex=0,this.buffers=[];var n=r.name,a=r.dimensions,s=r.type,l=r.numComponents,u=r.array,f=t.gl,c=t._errorCallback,p=t.glslVersion;if(this.glcompute=t,this.name=n,!i.isPositiveInteger(l)||l>4)throw new Error("Invalid numComponents: "+l+' for DataLayer "'+n+'".');this.numComponents=l;var h=!!r.writable;this.writable=h;var _=e.calcSize(a,n),d=_.length,g=_.width,m=_.height;if(this._length=d,!i.isPositiveInteger(g))throw new Error("Invalid width: "+g+' for DataLayer "'+n+'".');if(this._width=g,!i.isPositiveInteger(m))throw new Error("Invalid length: "+m+' for DataLayer "'+n+'".');this._height=m;var v=d?o.NEAREST:s===o.FLOAT||s==o.HALF_FLOAT?o.LINEAR:o.NEAREST,y=void 0!==r.filter?r.filter:v;if(!i.isValidFilter(y))throw new Error("Invalid filter: "+y+' for DataLayer "'+n+'", must be one of ['+o.validFilters.join(", ")+"].");if(y===o.LINEAR&&s!==o.FLOAT&&s!=o.HALF_FLOAT)throw new Error('LINEAR filtering is not supported on integer types, please use NEAREST filtering for DataLayer "'+n+'" with type: '+s+".");this.filter=y;var T=void 0!==r.wrapS?r.wrapS:o.CLAMP_TO_EDGE;if(!i.isValidWrap(T))throw new Error("Invalid wrapS: "+T+' for DataLayer "'+n+'", must be one of ['+o.validWraps.join(", ")+"].");this.wrapS=T;var A=void 0!==r.wrapT?r.wrapT:o.CLAMP_TO_EDGE;if(!i.isValidWrap(A))throw new Error("Invalid wrapT: "+A+' for DataLayer "'+n+'", must be one of ['+o.validWraps.join(", ")+"].");if(this.wrapT=A,!i.isValidDataType(s))throw new Error("Invalid type: "+s+' for DataLayer "'+n+'", must be one of ['+o.validDataTypes.join(", ")+"].");this.type=s;var E=e.getInternalType({gl:f,type:s,glslVersion:p,writable:h,name:n,errorCallback:c});this.internalType=E;var b=e.getGLTextureParameters({gl:f,name:n,numComponents:l,writable:h,internalType:E,glslVersion:p,errorCallback:c}),w=b.glFormat,L=b.glInternalFormat,R=b.glType,F=b.glNumChannels;this.glInternalFormat=L,this.glFormat=w,this.glType=R,this.glNumChannels=F,this.internalFilter=e.getInternalFilter({gl:f,filter:y,internalType:E,name:n,errorCallback:c}),this.glFilter=f[this.internalFilter],this.internalWrapS=e.getInternalWrap({gl:f,wrap:T,name:n}),this.glWrapS=f[this.internalWrapS],this.internalWrapT=e.getInternalWrap({gl:f,wrap:A,name:n}),this.glWrapT=f[this.internalWrapT];var O=void 0!==r.numBuffers?r.numBuffers:1;if(!i.isPositiveInteger(O))throw new Error("Invalid numBuffers: "+O+' for DataLayer "'+n+'", must be positive integer.');this.numBuffers=O;var U=void 0!==r.clearValue?r.clearValue:0;this.clearValue=U,this.initBuffers(u)}return e.calcSize=function(e,t){var r,n,o;if(isNaN(e)){if(n=e[0],!i.isPositiveInteger(n))throw new Error("Invalid width: "+n+' for DataLayer "'+t+'", must be positive integer.');if(o=e[1],!i.isPositiveInteger(o))throw new Error("Invalid height: "+o+' for DataLayer "'+t+'", must be positive integer.')}else{if(!i.isPositiveInteger(e))throw new Error("Invalid length: "+e+' for DataLayer "'+t+'", must be positive integer.');for(var a=1,l=r=e;l>2;)a++,l/=2;n=Math.pow(2,Math.floor(a/2)+a%2),o=Math.pow(2,Math.floor(a/2)),s.inDevMode()&&console.log("Using ["+n+", "+o+"] for 1D array of length "+e+' in DataLayer "'+t+'".')}return{width:n,height:o,length:r}},e.getInternalWrap=function(e){var t=e.gl,r=e.wrap,n=e.name;return s.isWebGL2(t)||r===o.CLAMP_TO_EDGE||s.isWebGL2(t)?r:(console.warn('Falling back to CLAMP_TO_EDGE wrapping for DataLayer "'+n+'" for WebGL 1.'),o.CLAMP_TO_EDGE)},e.getInternalFilter=function(e){var t=e.gl,r=e.errorCallback,n=e.internalType,i=e.name,s=e.filter;if(s===o.NEAREST)return s;n===o.HALF_FLOAT&&(a.getExtension(t,a.OES_TEXTURE_HAlF_FLOAT_LINEAR,r,!0)||a.getExtension(t,a.OES_TEXTURE_FLOAT_LINEAR,r,!0)||(console.warn('Falling back to NEAREST filter for DataLayer "'+i+'".'),s=o.NEAREST));n===o.FLOAT&&(a.getExtension(t,a.OES_TEXTURE_FLOAT_LINEAR,r,!0)||(console.warn('Falling back to NEAREST filter for DataLayer "'+i+'".'),s=o.NEAREST));return s},e.getInternalType=function(t){var r=t.gl,n=t.errorCallback,i=t.writable,l=t.name,u=t.glslVersion,f=t.type;if(e.shouldCastIntTypeAsFloat(t)&&(f===o.UNSIGNED_BYTE||f===o.BYTE?f=o.HALF_FLOAT:(console.warn("Falling back "+f+' type to FLOAT type for glsl1.x support for DataLayer "'+l+'".\nLarge UNSIGNED_INT or INT with absolute value > 16,777,216 are not supported, on mobile UNSIGNED_INT, INT, UNSIGNED_SHORT, and SHORT with absolute value > 2,048 may not be supported.'),f=o.FLOAT)),!s.isWebGL2(r)){if(f===o.FLOAT)if(a.getExtension(r,a.OES_TEXTURE_FLOAT,n,!0)||(console.warn('FLOAT not supported, falling back to HALF_FLOAT type for DataLayer "'+l+'".'),f=o.HALF_FLOAT),i)e.testFramebufferWrite({gl:r,type:f,glslVersion:u})||f===o.HALF_FLOAT||(console.warn('FLOAT not supported for writing operations, falling back to HALF_FLOAT type for DataLayer "'+l+'".'),f=o.HALF_FLOAT);if(f===o.HALF_FLOAT)if(a.getExtension(r,a.OES_TEXTURE_HALF_FLOAT,n),i)e.testFramebufferWrite({gl:r,type:f,glslVersion:u})||n("This browser does not support rendering to HALF_FLOAT textures.")}return i&&s.isWebGL2(r)&&(f===o.HALF_FLOAT||f===o.FLOAT)&&a.getExtension(r,a.EXT_COLOR_BUFFER_FLOAT,n),f},e.shouldCastIntTypeAsFloat=function(e){var t=e.gl,r=e.type;return(e.glslVersion!==o.GLSL3||!s.isWebGL2(t))&&(r===o.BYTE||r===o.SHORT||r===o.INT||r===o.UNSIGNED_SHORT||r===o.UNSIGNED_INT)},e.getGLTextureParameters=function(e){var t,r,n,i,l=e.gl,u=e.errorCallback,f=e.name,c=e.numComponents,p=e.internalType,h=e.writable,_=e.glslVersion;if(s.isWebGL2(l)){if(i=c,3===c&&h&&(i=4),p===o.FLOAT||p===o.HALF_FLOAT)switch(i){case 1:r=l.RED;break;case 2:r=l.RG;break;case 3:r=l.RGB;break;case 4:r=l.RGBA;break;default:throw new Error("Unsupported glNumChannels: "+i+' for DataLayer "'+f+'".')}else if(_===o.GLSL1&&p===o.UNSIGNED_BYTE)switch(i){case 1:if(!h){r=l.ALPHA;break}case 2:if(!h){r=l.LUMINANCE_ALPHA;break}case 3:r=l.RGB,i=3;break;case 4:r=l.RGBA,i=4;break;default:throw new Error("Unsupported glNumChannels: "+i+' for DataLayer "'+f+'".')}else switch(i){case 1:r=l.RED_INTEGER;break;case 2:r=l.RG_INTEGER;break;case 3:r=l.RGB_INTEGER;break;case 4:r=l.RGBA_INTEGER;break;default:throw new Error("Unsupported glNumChannels: "+i+' for DataLayer "'+f+'".')}switch(p){case o.HALF_FLOAT:switch(t=l.HALF_FLOAT,i){case 1:n=l.R16F;break;case 2:n=l.RG16F;break;case 3:n=l.RGB16F;break;case 4:n=l.RGBA16F;break;default:throw new Error("Unsupported glNumChannels: "+i+' for DataLayer "'+f+'".')}break;case o.FLOAT:switch(t=l.FLOAT,i){case 1:n=l.R32F;break;case 2:n=l.RG32F;break;case 3:n=l.RGB32F;break;case 4:n=l.RGBA32F;break;default:throw new Error("Unsupported glNumChannels: "+i+' for DataLayer "'+f+'".')}break;case o.UNSIGNED_BYTE:if(t=l.UNSIGNED_BYTE,_===o.GLSL1&&p===o.UNSIGNED_BYTE)n=r;else switch(i){case 1:n=l.R8UI;break;case 2:n=l.RG8UI;break;case 3:n=l.RGB8UI;break;case 4:n=l.RGBA8UI;break;default:throw new Error("Unsupported glNumChannels: "+i+' for DataLayer "'+f+'".')}break;case o.BYTE:switch(t=l.BYTE,i){case 1:n=l.R8I;break;case 2:n=l.RG8I;break;case 3:n=l.RGB8I;break;case 4:n=l.RGBA8I;break;default:throw new Error("Unsupported glNumChannels: "+i+' for DataLayer "'+f+'".')}break;case o.SHORT:switch(t=l.SHORT,i){case 1:n=l.R16I;break;case 2:n=l.RG16I;break;case 3:n=l.RGB16I;break;case 4:n=l.RGBA16I;break;default:throw new Error("Unsupported glNumChannels: "+i+' for DataLayer "'+f+'".')}break;case o.UNSIGNED_SHORT:switch(t=l.UNSIGNED_SHORT,i){case 1:n=l.R16UI;break;case 2:n=l.RG16UI;break;case 3:n=l.RGB16UI;break;case 4:n=l.RGBA16UI;break;default:throw new Error("Unsupported glNumChannels: "+i+' for DataLayer "'+f+'".')}break;case o.INT:switch(t=l.INT,i){case 1:n=l.R32I;break;case 2:n=l.RG32I;break;case 3:n=l.RGB32I;break;case 4:n=l.RGBA32I;break;default:throw new Error("Unsupported glNumChannels: "+i+' for DataLayer "'+f+'".')}break;case o.UNSIGNED_INT:switch(t=l.UNSIGNED_INT,i){case 1:n=l.R32UI;break;case 2:n=l.RG32UI;break;case 3:n=l.RGB32UI;break;case 4:n=l.RGBA32UI;break;default:throw new Error("Unsupported glNumChannels: "+i+' for DataLayer "'+f+'".')}break;default:throw new Error("Unsupported type: "+p+' for DataLayer "'+f+'".')}}else{switch(c){case 1:if(!h){r=l.ALPHA,n=l.ALPHA,i=1;break}case 2:if(!h){r=l.LUMINANCE_ALPHA,n=l.LUMINANCE_ALPHA,i=2;break}case 3:r=l.RGB,n=l.RGB,i=3;break;case 4:r=l.RGBA,n=l.RGBA,i=4;break;default:throw new Error("Unsupported numComponents: "+c+' for DataLayer "'+f+'".')}switch(p){case o.FLOAT:t=l.FLOAT;break;case o.HALF_FLOAT:t=l.HALF_FLOAT||a.getExtension(l,a.OES_TEXTURE_HALF_FLOAT,u).HALF_FLOAT_OES;break;case o.UNSIGNED_BYTE:t=l.UNSIGNED_BYTE;break;default:throw new Error("Unsupported type: "+p+' in WebGL 1.0 for DataLayer "'+f+'".')}}if(void 0===t||void 0===r||void 0===n){var d=[];throw void 0===t&&d.push("glType"),void 0===r&&d.push("glFormat"),void 0===n&&d.push("glInternalFormat"),new Error("Invalid type: "+p+" for numComponents: "+c+", unable to init parameter"+(d.length>1?"s":"")+" "+d.join(", ")+' for DataLayer "'+f+'".')}if(void 0===i||c<1||c>4||i<c)throw new Error("Invalid numChannels: "+i+" for numComponents: "+c+' for DataLayer "'+f+'".');return{glFormat:r,glInternalFormat:n,glType:t,glNumChannels:i}},e.testFramebufferWrite=function(t){var r=t.gl,n=t.type,i=t.glslVersion,a=r.createTexture();if(!a)return!1;r.bindTexture(r.TEXTURE_2D,a);var s=r[o.CLAMP_TO_EDGE],l=r[o.CLAMP_TO_EDGE],u=r[o.NEAREST];r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,s),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,l),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,u),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,u);var f=e.getGLTextureParameters({gl:r,name:"testFramebufferWrite",numComponents:1,writable:!0,internalType:n,glslVersion:i,errorCallback:function(){}}),c=f.glInternalFormat,p=f.glFormat,h=f.glType;r.texImage2D(r.TEXTURE_2D,0,c,100,100,0,p,h,null);var _=r.createFramebuffer();if(!_)return r.deleteTexture(a),!1;r.bindFramebuffer(r.FRAMEBUFFER,_),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,a,0);var d=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.deleteTexture(a),r.deleteFramebuffer(_),d},Object.defineProperty(e.prototype,"bufferIndex",{get:function(){return this._bufferIndex},enumerable:!1,configurable:!0}),e.prototype.saveCurrentStateToDataLayer=function(e){if(this.numBuffers<2)throw new Error("Can't call DataLayer.saveCurrentStateToDataLayer on DataLayer \""+this.name+'" with less than 2 buffers.');if(!this.writable)throw new Error("Can't call DataLayer.saveCurrentStateToDataLayer on read-only DataLayer \""+this.name+'".');if(e.writable)throw new Error("Can't call DataLayer.saveCurrentStateToDataLayer on DataLayer \""+this.name+'" using writable DataLayer "'+e.name+'".');if(e.glWrapS!==this.glWrapS||e.glWrapT!==this.glWrapT||e.wrapS!==this.wrapS||e.wrapT!==this.wrapT||e.width!==this.width||e.height!==this.height||e.glFilter!==this.glFilter||e.filter!==this.filter||e.glNumChannels!==this.glNumChannels||e.numComponents!==this.numComponents||e.glType!==this.glType||e.type!==this.type||e.glFormat!==this.glFormat||e.glInternalFormat!==this.glInternalFormat)throw new Error('Incompatible texture params between DataLayers "'+e.name+'" and "'+this.name+'".');if(!this.textureOverrides){this.textureOverrides=[];for(var t=0;t<this.numBuffers;t++)this.textureOverrides.push(void 0)}if(this.textureOverrides[this.bufferIndex])throw new Error("Can't call DataLayer.saveCurrentStateToDataLayer on DataLayer \""+this.name+'", this DataLayer has not written new state since last call to DataLayer.saveCurrentStateToDataLayer.');var r=this.currentState;this.textureOverrides[this.bufferIndex]=r,this.buffers[this.bufferIndex].texture=e.currentState,e._setCurrentStateTexture(r);var n=this.glcompute.gl,i=this.buffers[this.bufferIndex],o=i.framebuffer,a=i.texture;if(!o)throw new Error('No framebuffer for writable DataLayer "'+this.name+'".');n.bindFramebuffer(n.FRAMEBUFFER,o),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,a,0),n.bindFramebuffer(n.FRAMEBUFFER,null)},e.prototype._setCurrentStateTexture=function(e){if(this.writable)throw new Error("Can't call DataLayer._setCurrentStateTexture on writable texture \""+this.name+'".');this.buffers[this.bufferIndex].texture=e},e.initArrayForInternalType=function(e,t){switch(e){case o.HALF_FLOAT:return new Uint16Array(t);case o.FLOAT:return new Float32Array(t);case o.UNSIGNED_BYTE:return new Uint8Array(t);case o.BYTE:return new Int8Array(t);case o.UNSIGNED_SHORT:return new Uint16Array(t);case o.SHORT:return new Int16Array(t);case o.UNSIGNED_INT:return new Uint32Array(t);case o.INT:return new Int32Array(t);default:throw new Error("Unsupported internalType: "+e+".")}},e.prototype.validateDataArray=function(t){var r=this,i=r.numComponents,a=r.glNumChannels,s=(r.type,r.internalType),l=r.width,u=r.height,f=this._length;if(t.length!==l*u*i&&(!f||f&&t.length!==f*i))throw new Error("Invalid data length: "+t.length+' for DataLayer "'+this.name+'" of '+(f?"length "+f+" and ":"")+"dimensions: ["+l+", "+u+"] and numComponents: "+i+".");var c=!1;switch(t.constructor){case Array:c=!0;break;case Float32Array:c=s!==o.FLOAT;break;case Uint8Array:c=s!==o.UNSIGNED_BYTE;break;case Int8Array:c=s!==o.BYTE;break;case Uint16Array:c=s!==o.UNSIGNED_SHORT;break;case Int16Array:c=s!==o.SHORT;break;case Uint32Array:c=s!==o.UNSIGNED_INT;break;case Int32Array:c=s!==o.INT;break;default:throw new Error("Invalid array type: "+t.constructor.name+' for DataLayer "'+this.name+'", please use one of ['+o.validArrayTypes.map((function(e){return e.name})).join(", ")+"].")}var p=l*u*a,h=t.length!==p,_=s===o.HALF_FLOAT,d=t;if(c||h||_){d=e.initArrayForInternalType(s,p);for(var g=_?new DataView(d.buffer):null,m=0,v=t.length/i;m<v;m++)for(var y=0;y<i;y++){var T=t[m*i+y],A=m*a+y;_?n.setFloat16(g,2*A,T,!0):d[A]=T}}return d},e.prototype.initBuffers=function(e){for(var t=this,r=t.name,n=t.numBuffers,i=t.glcompute,o=t.glInternalFormat,a=t.glFormat,s=t.glType,l=t.glFilter,u=t.glWrapS,f=t.glWrapT,c=t.writable,p=t.width,h=t.height,_=i.gl,d=i._errorCallback,g=e?this.validateDataArray(e):void 0,m=0;m<n;m++){var v=_.createTexture();if(!v)return void d('Could not init texture for DataLayer "'+r+'": '+_.getError()+".");_.bindTexture(_.TEXTURE_2D,v),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,u),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,f),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,l),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,l),_.texImage2D(_.TEXTURE_2D,0,o,p,h,0,a,s,g||null);var y={texture:v};if(c){var T=_.createFramebuffer();if(!T)return void d('Could not init framebuffer for DataLayer "'+r+'": '+_.getError()+".");_.bindFramebuffer(_.FRAMEBUFFER,T),_.framebufferTexture2D(_.FRAMEBUFFER,_.COLOR_ATTACHMENT0,_.TEXTURE_2D,v,0);var A=_.checkFramebufferStatus(_.FRAMEBUFFER);A!=_.FRAMEBUFFER_COMPLETE&&d('Invalid status for framebuffer for DataLayer "'+r+'": '+A+"."),y.framebuffer=T}this.buffers.push(y)}_.bindTexture(_.TEXTURE_2D,null),_.bindFramebuffer(_.FRAMEBUFFER,null)},e.prototype.getStateAtIndex=function(e){if(e<0||e>=this.numBuffers)throw new Error("Invalid buffer index: "+e+' for DataLayer "'+this.name+'" with '+this.numBuffers+" buffer"+(this.numBuffers>1?"s":"")+".");return this.textureOverrides&&this.textureOverrides[e]?this.textureOverrides[e]:this.buffers[e].texture},Object.defineProperty(e.prototype,"currentState",{get:function(){return this.getStateAtIndex(this.bufferIndex)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastState",{get:function(){if(1===this.numBuffers)throw new Error('Cannot access lastState on DataLayer "'+this.name+'" with only one buffer.');return this.getStateAtIndex((this.bufferIndex-1+this.numBuffers)%this.numBuffers)},enumerable:!1,configurable:!0}),e.prototype._usingTextureOverrideForCurrentBuffer=function(){return this.textureOverrides&&this.textureOverrides[this.bufferIndex]},e.prototype._bindOutputBufferForWrite=function(e){e&&(this._bufferIndex=(this.bufferIndex+1)%this.numBuffers),this._bindOutputBuffer(),this.textureOverrides&&(this.textureOverrides[this.bufferIndex]=void 0)},e.prototype._bindOutputBuffer=function(){var e=this.glcompute.gl,t=this.buffers[this.bufferIndex].framebuffer;if(!t)throw new Error('DataLayer "'+this.name+'" is not writable.');e.bindFramebuffer(e.FRAMEBUFFER,t)},e.prototype.setFromArray=function(e,t){void 0===t&&(t=!1);for(var r=this,n=r.glcompute,i=r.glInternalFormat,o=r.glFormat,a=r.glType,s=r.numBuffers,l=r.width,u=r.height,f=r.bufferIndex,c=n.gl,p=this.validateDataArray(e),h=t?s:f+1,_=t?0:f;_<h;_++){var d=this.getStateAtIndex(_);c.bindTexture(c.TEXTURE_2D,d),c.texImage2D(c.TEXTURE_2D,0,i,l,u,0,o,a,p)}c.bindTexture(c.TEXTURE_2D,null)},e.prototype.resize=function(t,r){var n=this.name;this.glcompute.verboseLogging&&console.log('Resizing DataLayer "'+n+'" to '+JSON.stringify(t)+".");var i=e.calcSize(t,n),o=i.length,a=i.width,s=i.height;this._length=o,this._width=a,this._height=s,this.destroyBuffers(),this.initBuffers(r)},Object.defineProperty(e.prototype,"clearValue",{get:function(){return this._clearValue},set:function(e){var t=this.numComponents,r=this.type;if(!i.isValidClearValue(e,t,r))throw new Error("Invalid clearValue: "+JSON.stringify(e)+' for DataLayer "'+this.name+'", expected '+r+" or array of "+r+" of length "+t+".");this._clearValue=e},enumerable:!1,configurable:!0}),e.prototype.clear=function(t){void 0===t&&(t=!1);var r=this,a=r.name,s=r.glcompute,l=r.clearValue,u=r.numBuffers,f=r.bufferIndex,c=r.type;s.verboseLogging&&console.log('Clearing DataLayer "'+a+'".');var p=[];if(i.isNumber(l))p.push(l,l,l,l);else{p.push.apply(p,l);for(var h=p.length;h<4;h++)p.push(0)}var _=t?0:f,d=t?u:f+1;if(this.writable){var g=s._setValueProgramForType(c);g.setUniform("u_value",p);for(var m=_;m<d;m++)s.step({program:g,output:this})}else{var v=this,y=v.width,T=v.height,A=v.glNumChannels,E=v.internalType,b=v.glInternalFormat,w=v.glFormat,L=v.glType,R=s.gl,F=this._length?this._length:y*T,O=e.initArrayForInternalType(E,y*T*A),U=E===o.HALF_FLOAT?new DataView(O.buffer):null;for(h=0;h<F;h++)for(var N=0;N<A;N++){var I=h*A+N;E===o.HALF_FLOAT?n.setFloat16(U,2*I,p[N],!0):O[I]=p[N]}for(m=_;m<d;m++){var x=this.getStateAtIndex(m);R.bindTexture(R.TEXTURE_2D,x),R.texImage2D(R.TEXTURE_2D,0,b,y,T,0,w,L,O)}R.bindTexture(R.TEXTURE_2D,null)}},Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){if(!this._length)throw new Error('Cannot access length on 2D DataLayer "'+this.name+'".');return this._length},enumerable:!1,configurable:!0}),e.prototype.destroyBuffers=function(){var e=this.glcompute,t=this.buffers,r=e.gl;t.forEach((function(e){var t=e.framebuffer,n=e.texture;r.deleteTexture(n),t&&r.deleteFramebuffer(t),delete e.texture,delete e.framebuffer})),t.length=0,delete this.textureOverrides},e.prototype.dispose=function(){var e=this.name;this.glcompute.verboseLogging&&console.log('Deallocating DataLayer "'+e+'".'),this.destroyBuffers(),delete this.glcompute},e.prototype.clone=function(e){return this.glcompute._cloneDataLayer(this,e)},e}();t.DataLayer=l},664:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GPUProgram=void 0;var n=r(627),i=r(738),o=r(593),a=function(){function e(e,t){this.defines={},this.uniforms={},this.programs={};var r=t.name,n=t.fragmentShader,i=t.uniforms,o=t.defines;this.glcompute=e,this.name=r;var a="string"==typeof n?n:n.join("\n");if(this.fragmentShaderSource=a,this.recompile(o||this.defines),i)for(var s=0;s<(null==i?void 0:i.length);s++){var l=i[s],u=l.name,f=l.value,c=l.type;this.setUniform(u,f,c)}}return e.prototype.recompile=function(e){for(var t=this,r=t.glcompute,n=t.name,i=t.fragmentShaderSource,a=r.gl,s=r._errorCallback,l=r.verboseLogging,u=!1,f=Object.keys(e),c=0;c<f.length;c++){var p=f[c];this.defines[p]!==e[p]&&(u=!0,this.defines[p]=e[p])}if(!this.fragmentShader||u){l&&console.log('Compiling fragment shader for GPUProgram "'+n+'" with defines: '+JSON.stringify(this.defines));var h=o.compileShader(r,i,a.FRAGMENT_SHADER,n,this.defines);h?this.fragmentShader=h:s('Unable to compile fragment shader for GPUProgram "'+n+'".')}},e.prototype.initProgram=function(e,t){var r=this,n=r.glcompute,i=r.fragmentShader,o=r.uniforms,a=n.gl,s=n._errorCallback,l=a.createProgram();if(l){if(a.attachShader(l,i),a.attachShader(l,e),a.linkProgram(l),a.getProgramParameter(l,a.LINK_STATUS)){for(var u=Object.keys(o),f=0;f<u.length;f++){var c=u[f],p=o[c],h=p.value,_=p.type;this.setProgramUniform(l,t,c,h,_)}return l}s('Program "'+this.name+'" failed to link: '+a.getProgramInfoLog(l))}else s("Unable to init gl program, gl.createProgram() has failed.")},e.prototype.getProgramWithName=function(e){if(this.programs[e])return this.programs[e];var t=this.glcompute,r=t._errorCallback,n=t._vertexShaders[e];if(void 0===n.shader){var a=this.glcompute,s=a.gl,l=a._preprocessVertShader(n.src);if(""===l)throw new Error("No source for vertex shader "+this.name+" : "+e);var u=o.compileShader(a,l,s.VERTEX_SHADER,this.name,n.defines);if(!u)return void r('Unable to compile "'+e+'" vertex shader for GPUProgram "'+this.name+'".');n.shader=u}var f=this.initProgram(n.shader,i.DEFAULT_PROGRAM_NAME);if(void 0!==f)return this.programs[e]=f,f;r('Unable to init program "'+e+'" for GPUProgram "'+this.name+'".')},Object.defineProperty(e.prototype,"_defaultProgram",{get:function(){return this.getProgramWithName(i.DEFAULT_PROGRAM_NAME)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_defaultProgramWithUV",{get:function(){return this.getProgramWithName(i.DEFAULT_W_UV_PROGRAM_NAME)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_defaultProgramWithNormal",{get:function(){return this.getProgramWithName(i.DEFAULT_W_NORMAL_PROGRAM_NAME)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_defaultProgramWithUVNormal",{get:function(){return this.getProgramWithName(i.DEFAULT_W_UV_NORMAL_PROGRAM_NAME)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_segmentProgram",{get:function(){return this.getProgramWithName(i.SEGMENT_PROGRAM_NAME)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_dataLayerPointsProgram",{get:function(){return this.getProgramWithName(i.DATA_LAYER_POINTS_PROGRAM_NAME)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_dataLayerVectorFieldProgram",{get:function(){return this.getProgramWithName(i.DATA_LAYER_VECTOR_FIELD_PROGRAM_NAME)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_dataLayerLinesProgram",{get:function(){return this.getProgramWithName(i.DATA_LAYER_LINES_PROGRAM_NAME)},enumerable:!1,configurable:!0}),e.prototype.uniformInternalTypeForValue=function(e,t){if(t===i.FLOAT){if(n.isArray(e)){for(var r=0;r<e.length;r++)if(!n.isNumber(e[r]))throw new Error("Invalid uniform value: "+e+' for program "'+this.name+'", expected float or float[] of length 1-4.')}else if(!n.isNumber(e))throw new Error("Invalid uniform value: "+e+' for program "'+this.name+'", expected float or float[] of length 1-4.');if(!n.isArray(e)||1===e.length)return i.FLOAT_1D_UNIFORM;if(2===e.length)return i.FLOAT_2D_UNIFORM;if(3===e.length)return i.FLOAT_3D_UNIFORM;if(4===e.length)return i.FLOAT_4D_UNIFORM;throw new Error("Invalid uniform value: "+e+' for program "'+this.name+'", expected float or float[] of length 1-4.')}if(t===i.INT){if(n.isArray(e)){for(r=0;r<e.length;r++)if(!n.isInteger(e[r]))throw new Error("Invalid uniform value: "+e+' for program "'+this.name+'", expected int or int[] of length 1-4.')}else if(!n.isInteger(e))throw new Error("Invalid uniform value: "+e+' for program "'+this.name+'", expected int or int[] of length 1-4.');if(!n.isArray(e)||1===e.length)return i.INT_1D_UNIFORM;if(2===e.length)return i.INT_2D_UNIFORM;if(3===e.length)return i.INT_3D_UNIFORM;if(4===e.length)return i.INT_4D_UNIFORM;throw new Error("Invalid uniform value: "+e+' for program "'+this.name+'", expected int or int[] of length 1-4.')}if(t===i.BOOL){if(n.isBoolean(e))return i.INT_1D_UNIFORM;throw new Error("Invalid uniform value: "+e+' for program "'+this.name+'", expected boolean.')}throw new Error("Invalid uniform type: "+t+' for program "'+this.name+'", expected '+i.FLOAT+" or "+i.INT+" of "+i.BOOL+".")},e.prototype.setProgramUniform=function(e,t,r,o,a){var s,l=this.glcompute,u=this.uniforms,f=l.gl,c=l._errorCallback;f.useProgram(e);var p=null===(s=u[r])||void 0===s?void 0:s.location[t];if(void 0===p){var h=f.getUniformLocation(e,r);if(!h)return void c('Could not init uniform "'+r+'" for program "'+this.name+'".\nCheck that uniform is present in shader code, unused uniforms may be removed by compiler.\nAlso check that uniform type in shader code matches type '+a+".\nError code: "+f.getError()+".");p=h,u[r]&&(u[r].location[t]=p)}switch(a){case i.FLOAT_1D_UNIFORM:f.uniform1f(p,o);break;case i.FLOAT_2D_UNIFORM:f.uniform2fv(p,o);break;case i.FLOAT_3D_UNIFORM:f.uniform3fv(p,o);break;case i.FLOAT_4D_UNIFORM:f.uniform4fv(p,o);break;case i.INT_1D_UNIFORM:n.isBoolean(o)?f.uniform1i(p,o?1:0):f.uniform1i(p,o);break;case i.INT_2D_UNIFORM:f.uniform2iv(p,o);break;case i.INT_3D_UNIFORM:f.uniform3iv(p,o);break;case i.INT_4D_UNIFORM:f.uniform4iv(p,o);break;default:throw new Error("Unknown uniform type "+a+' for GPUProgram "'+this.name+'".')}},e.prototype.setUniform=function(e,t,r){var i,o=this,a=o.programs,s=o.uniforms,l=o.glcompute.verboseLogging;if(n.isArray(t)&&t.length>4)throw new Error("Invalid uniform value: ["+t.join(", ")+'] passed to GPUProgram "'+this.name+', uniforms must be of type number[] with length <= 4, number, or boolean."');var u=null===(i=s[e])||void 0===i?void 0:i.type;if(r){var f=this.uniformInternalTypeForValue(t,r);if(void 0===u)u=f;else if(u!==f)throw new Error('Uniform "'+e+'" for GPUProgram "'+this.name+'" cannot change from type '+u+" to type "+f+".")}if(void 0===u)throw new Error('Unknown type for uniform "'+e+'", please pass in type to GPUProgram.setUniform(name, value, type) when initing a new uniform.');if(s[e]){if(n.isArray(t)){for(var c=!0,p=0;p<t.length;p++)if(s[e].value!==t){c=!0;break}if(!c)return}else if(s[e].value===t)return;s[e].value=t}else s[e]={type:u,location:{},value:t};l&&console.log('Setting uniform "'+e+'" for program "'+this.name+'" to value '+JSON.stringify(t)+" with type "+u+".");var h=Object.keys(a);for(p=0;p<h.length;p++){var _=h[p];this.setProgramUniform(a[_],_,e,t,u)}},e.prototype._setVertexUniform=function(e,t,r,n){var i=this,o=this.uniformInternalTypeForValue(r,n);if(void 0===e)throw new Error("Must pass in valid WebGLProgram to setVertexUniform, got undefined.");var a=Object.keys(this.programs).find((function(t){return i.programs[t]===e}));if(!a)throw new Error('Could not find valid vertex programName for WebGLProgram "'+this.name+'".');this.setProgramUniform(e,a,t,r,o)},e.prototype.dispose=function(){var e=this,t=this,r=t.glcompute,n=t.fragmentShader,i=t.programs,o=r.gl;r.verboseLogging&&console.log('Deallocating GPUProgram "'+this.name+'".'),Object.values(i).forEach((function(e){o.deleteProgram(e)})),Object.keys(this.programs).forEach((function(t){delete e.programs[t]})),o.deleteShader(n),delete this.fragmentShader,delete this.glcompute},e}();t.GPUProgram=a},404:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Vector4=void 0;var r=function(){function e(e,t,r,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=0),void 0===n&&(n=1),this.x=e,this.y=t,this.z=r,this.w=n}return Object.defineProperty(e.prototype,"width",{get:function(){return this.z},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.w},enumerable:!1,configurable:!0}),e.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},e}();t.Vector4=r},215:function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),i=0;for(t=0;t<r;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)n[i]=o[a];return n};Object.defineProperty(t,"__esModule",{value:!0}),t.WebGLCompute=void 0;var o=r(162),a=r(809),s=r(930),l=r(738),u=r(664),f=r(404),c=r(593),p=r(501),h=r(627),_=r(288),d=function(){function e(e,t,n){var i;void 0===t&&(t=function(e){throw new Error(e)}),this.errorState=!1,this._circlePositionsBuffer={},this.copyPrograms={src:r(158)},this.setValuePrograms={src:r(148)},this.vectorMagnitudePrograms={src:r(723)},this._vertexShaders=((i={})[l.DEFAULT_PROGRAM_NAME]={src:_},i[l.DEFAULT_W_UV_PROGRAM_NAME]={src:_,defines:{UV_ATTRIBUTE:"1"}},i[l.DEFAULT_W_NORMAL_PROGRAM_NAME]={src:_,defines:{NORMAL_ATTRIBUTE:"1"}},i[l.DEFAULT_W_UV_NORMAL_PROGRAM_NAME]={src:_,defines:{UV_ATTRIBUTE:"1",NORMAL_ATTRIBUTE:"1"}},i[l.SEGMENT_PROGRAM_NAME]={src:r(974)},i[l.DATA_LAYER_POINTS_PROGRAM_NAME]={src:r(18)},i[l.DATA_LAYER_VECTOR_FIELD_PROGRAM_NAME]={src:r(7)},i[l.DATA_LAYER_LINES_PROGRAM_NAME]={src:r(587)},i),this.verboseLogging=!1;var o=["canvas","context","contextID","contextOptions","glslVersion","verboseLogging"];if(Object.keys(e).forEach((function(e){if(o.indexOf(e)<0)throw new Error('Invalid key "'+e+'" passed to WebGLCompute.constructor.  Valid keys are '+o.join(", ")+".")})),!e.canvas)throw new Error("Must init WebGLCompute with a canvas.");void 0!==e.verboseLogging&&(this.verboseLogging=e.verboseLogging);var a=this;this._errorCallback=function(e){a.errorState||(a.errorState=!0,t(e))};var s=e.canvas,u=e.context;if(u||(e.contextID&&((u=s.getContext(e.contextID,e.contextOptions))||console.warn("Unable to initialize WebGL context with contextID: "+e.contextID+".")),u||(u=s.getContext("webgl2",e.contextOptions)||s.getContext("webgl",e.contextOptions)||s.getContext("experimental-webgl",e.contextOptions)),null!==u)){c.isWebGL2(u)?c.inDevMode()&&console.log("Using WebGL 2.0 context."):c.inDevMode()&&console.log("Using WebGL 1.0 context."),this.gl=u,this.renderer=n;var f=void 0===e.glslVersion?l.GLSL1:e.glslVersion;c.isWebGL2(u)||f!==l.GLSL3||(console.warn("GLSL3.x is incompatible with WebGL1.0 contexts, falling back to GLSL1."),f=l.GLSL1),this.glslVersion=f,u.disable(u.DEPTH_TEST),u.pixelStorei(u.UNPACK_ALIGNMENT,1),u.bindBuffer(u.ARRAY_BUFFER,null),this.onResize(s),this.maxNumTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),c.inDevMode()&&console.log(this.maxNumTextures+" textures max.")}else this._errorCallback("Unable to initialize WebGL context.")}return e.initWithThreeRenderer=function(t,r,i){return new e(n({canvas:t.domElement,context:t.getContext()},r),i,t)},e.prototype.preprocessShader=function(e){return e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace("#version 300 es","")).replace(/precision \w+ isampler2D;/g,"")).replace(/precision \w+ usampler2D;/g,"")).replace(/uvec2/g,"vec2")).replace(/uvec3/g,"vec3")).replace(/uvec4/g,"vec4")).replace(/usampler2D/g,"sampler2D")).replace(/ivec2/g,"vec2")).replace(/ivec3/g,"vec3")).replace(/ivec4/g,"vec4")).replace(/isampler2D/g,"sampler2D")).replace(/texture\(/g,"texture2D(")},e.prototype._preprocessFragShader=function(e){return this.glslVersion===l.GLSL3?e:e=(e=(e=(e=(e=this.preprocessShader(e)).replace(/\n\s*in\s+/g,"\nvarying ")).replace(/;\s*in\s+/g,";varying ")).replace(/out \w+ out_fragOut;/g,"")).replace(/out_fragOut\s+=/,"gl_FragColor =")},e.prototype._preprocessVertShader=function(e){return this.glslVersion===l.GLSL3?e:e=(e=(e=(e=(e=this.preprocessShader(e)).replace(/\n\s*in\s+/g,"\nattribute ")).replace(/;\s*in\s+/g,";attribute ")).replace(/\n\s*out\s+/g,"\nvarying ")).replace(/;\s*out\s+/g,";varying ")},e.prototype.glslKeyForType=function(e){if(this.glslVersion===l.GLSL1)return l.FLOAT;switch(e){case l.HALF_FLOAT:case l.FLOAT:return l.FLOAT;case l.UNSIGNED_BYTE:case l.UNSIGNED_SHORT:case l.UNSIGNED_INT:return l.UINT;case l.BYTE:case l.SHORT:case l.INT:return l.INT;default:throw new Error("Invalid type: "+e+" passed to WebGLCompute.copyProgramForType.")}},e.prototype._setValueProgramForType=function(e){var t,r=this.glslKeyForType(e);if(void 0===this.setValuePrograms[r]){var n=this.initProgram({name:"setValue-"+r,fragmentShader:this._preprocessFragShader(this.setValuePrograms.src),uniforms:[{name:"u_value",value:[0,0,0,0],type:r===l.UINT?l.INT:r}],defines:(t={},t[r]="1",t)});this.setValuePrograms[r]=n}return this.setValuePrograms[r]},e.prototype.copyProgramForType=function(e){var t,r=this.glslKeyForType(e);if(void 0===this.copyPrograms[r]){var n=this.initProgram({name:"copy-"+r,fragmentShader:this._preprocessFragShader(this.copyPrograms.src),uniforms:[{name:"u_state",value:0,type:l.INT}],defines:(t={},t[r]="1",t)});this.copyPrograms[r]=n}return this.copyPrograms[r]},Object.defineProperty(e.prototype,"wrappedLineColorProgram",{get:function(){if(void 0===this._wrappedLineColorProgram){var e=this.initProgram({name:"wrappedLineColor",fragmentShader:this._preprocessFragShader(r(598))});this._wrappedLineColorProgram=e}return this._wrappedLineColorProgram},enumerable:!1,configurable:!0}),e.prototype.vectorMagnitudeProgramForType=function(e){var t,r=this.glslKeyForType(e);if(void 0===this.vectorMagnitudePrograms[r]){var n=this.initProgram({name:"vectorMagnitude-"+r,fragmentShader:this._preprocessFragShader(this.vectorMagnitudePrograms.src),defines:(t={},t[r]="1",t)});this.vectorMagnitudePrograms[r]=n}return this.vectorMagnitudePrograms[r]},e.prototype.isWebGL2=function(){return c.isWebGL2(this.gl)},Object.defineProperty(e.prototype,"quadPositionsBuffer",{get:function(){if(void 0===this._quadPositionsBuffer){var e=new Float32Array([-1,-1,1,-1,-1,1,1,1]);this._quadPositionsBuffer=this.initVertexBuffer(e)}return this._quadPositionsBuffer},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"boundaryPositionsBuffer",{get:function(){if(void 0===this._boundaryPositionsBuffer){var e=new Float32Array([-1,-1,1,-1,1,1,-1,1,-1,-1]);this._boundaryPositionsBuffer=this.initVertexBuffer(e)}return this._boundaryPositionsBuffer},enumerable:!1,configurable:!0}),e.prototype.getCirclePositionsBuffer=function(e){if(null==this._circlePositionsBuffer[e]){for(var t=[0,0],r=0;r<=e;r++)t.push(Math.cos(2*Math.PI*r/e),Math.sin(2*Math.PI*r/e));var n=new Float32Array(t),i=this.initVertexBuffer(n);this._circlePositionsBuffer[e]=i}return this._circlePositionsBuffer[e]},e.prototype.initVertexBuffer=function(e){var t=this._errorCallback,r=this.gl,n=r.createBuffer();if(n)return r.bindBuffer(r.ARRAY_BUFFER,n),r.bufferData(r.ARRAY_BUFFER,e,r.STATIC_DRAW),n;t("Unable to allocate gl buffer.")},e.prototype.initDataLayer=function(e){var t=["name","dimensions","type","numComponents","array","filter","wrapS","wrapT","writable","numBuffers","clearValue"];return Object.keys(e).forEach((function(r){if(t.indexOf(r)<0)throw new Error('Invalid key "'+r+'" passed to WebGLCompute.initDataLayer with name "'+e.name+'".  Valid keys are '+t.join(", ")+".")})),new s.DataLayer(this,e)},e.prototype.initProgram=function(e){var t=["name","fragmentShader","uniforms","defines"];return Object.keys(e).forEach((function(r){if(t.indexOf(r)<0)throw new Error('Invalid key "'+r+'" passed to WebGLCompute.initProgram with name "'+e.name+'".  Valid keys are '+t.join(", ")+".")})),new u.GPUProgram(this,e)},e.prototype._cloneDataLayer=function(e,t){var r=0;try{r=e.length}catch(t){r=[e.width,e.height]}var n=e.writable?void 0:this.getValues(e),i=this.initDataLayer({name:t||e.name+"-clone",dimensions:r,type:e.type,numComponents:e.numComponents,array:n,filter:e.filter,wrapS:e.wrapS,wrapT:e.wrapT,writable:e.writable,numBuffers:e.numBuffers});if(e.writable){for(var o=0;o<e.numBuffers-1;o++)this.step({program:this.copyProgramForType(e.type),input:e.getStateAtIndex((e.bufferIndex+o+1)%e.numBuffers),output:i});this.step({program:this.copyProgramForType(e.type),input:e.currentState,output:i})}return i},e.prototype.initTexture=function(e){var t=["name","url","filter","wrapS","wrapT","format","type","onLoad"];Object.keys(e).forEach((function(r){if(t.indexOf(r)<0)throw new Error('Invalid key "'+r+'" passed to WebGLCompute.initTexture with name "'+e.name+'".  Valid keys are '+t.join(", ")+".")}));var r=e.url,n=e.name;if(!h.isString(r))throw new Error("Expected WebGLCompute.initTexture params to have url of type string, got "+r+" of type "+typeof r+".");if(!h.isString(n))throw new Error("Expected WebGLCompute.initTexture params to have name of type string, got "+n+" of type "+typeof n+".");var i=void 0!==e.filter?e.filter:l.NEAREST;if(!h.isValidFilter(i))throw new Error("Invalid filter: "+i+' for DataLayer "'+n+'", must be '+l.validFilters.join(", ")+".");var o=void 0!==e.wrapS?e.wrapS:l.CLAMP_TO_EDGE;if(!h.isValidWrap(o))throw new Error("Invalid wrapS: "+o+' for DataLayer "'+n+'", must be '+l.validWraps.join(", ")+".");var a=void 0!==e.wrapT?e.wrapT:l.CLAMP_TO_EDGE;if(!h.isValidWrap(a))throw new Error("Invalid wrapT: "+a+' for DataLayer "'+n+'", must be '+l.validWraps.join(", ")+".");var s=void 0!==e.format?e.format:l.RGBA;if(!h.isValidTextureFormat(s))throw new Error("Invalid format: "+s+' for DataLayer "'+n+'", must be '+l.validTextureFormats.join(", ")+".");var u=void 0!==e.type?e.type:l.UNSIGNED_BYTE;if(!h.isValidTextureType(u))throw new Error("Invalid type: "+u+' for DataLayer "'+n+'", must be '+l.validTextureTypes.join(", ")+".");var f=this.gl,p=this._errorCallback,_=f.createTexture();if(null===_)throw new Error("Unable to init glTexture.");f.bindTexture(f.TEXTURE_2D,_);var d=f.RGBA,g=f[s],m=f[u],v=new Uint8Array([0,0,0,0]);f.texImage2D(f.TEXTURE_2D,0,d,1,1,0,g,m,v);var y=new Image;return y.onload=function(){f.bindTexture(f.TEXTURE_2D,_),f.texImage2D(f.TEXTURE_2D,0,d,g,m,y),c.isPowerOf2(y.width)&&c.isPowerOf2(y.height)||console.warn("Texture "+n+" dimensions ["+y.width+", "+y.height+"] are not power of 2."),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f[o]),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f[a]),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f[i]),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f[i]),e.onLoad&&e.onLoad(_)},y.onerror=function(e){p("Error loading image "+n+": "+e)},y.src=r,_},e.prototype.onResize=function(e){var t=e.clientWidth,r=e.clientHeight;e.width=t,e.height=r,this.width=t,this.height=r},e.prototype.drawSetup=function(e,t,r,n){var i=this.gl;if(e){var o=[];if(r)if(r.constructor===WebGLTexture)o.push(r);else if(r.constructor===s.DataLayer)o.push(r.currentState);else for(var a=0;a<r.length;a++){var l=r[a];o.push(l.getCurrentStateTexture?l.currentState:l)}this.setOutputLayer(t,r,n),i.useProgram(e);for(a=0;a<o.length;a++)i.activeTexture(i.TEXTURE0+a),i.bindTexture(i.TEXTURE_2D,o[a])}},e.prototype.setBlendMode=function(e){var t=this.gl;e&&(t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA))},e.prototype.addLayerToInputs=function(e,t){var r=t;if(h.isArray(r))r.indexOf(e)<0&&r.push(e);else if(r!==e){var n=r;r=[],n&&r.push(n),r.push(e)}else r=[r];return r},e.prototype.passThroughLayerDataFromInputToOutput=function(e){var t=this.copyProgramForType(e.internalType);this.step({program:t,input:e,output:e})},e.prototype.setOutputLayer=function(e,t,r){var n=this.gl;if(r){if(t&&(t===r||h.isArray(t)&&t.indexOf(r)>-1)){if(1===r.numBuffers)throw new Error("Cannot use same buffer for input and output of a program. Try increasing the number of buffers in your output layer to at least 2 so you can render to nextState using currentState as an input.");e?r._bindOutputBufferForWrite(!0):(this.passThroughLayerDataFromInputToOutput(r),r._bindOutputBufferForWrite(!1))}else e||r._usingTextureOverrideForCurrentBuffer()&&this.passThroughLayerDataFromInputToOutput(r),r._bindOutputBufferForWrite(!1);var i=r.width,o=r.height;n.viewport(0,0,i,o)}else{n.bindFramebuffer(n.FRAMEBUFFER,null);var a=this.width,s=this.height;n.viewport(0,0,a,s)}},e.prototype.setPositionAttribute=function(e,t){this.setVertexAttribute(e,"a_internal_position",2,t)},e.prototype.setIndexAttribute=function(e,t){this.setVertexAttribute(e,"a_internal_index",1,t)},e.prototype.setUVAttribute=function(e,t){this.setVertexAttribute(e,"a_internal_uv",2,t)},e.prototype.setVertexAttribute=function(e,t,r,n){var i=this.gl,o=i.getAttribLocation(e,t);if(o<0)throw new Error('Unable to find vertex attribute "'+t+'" in program "'+n+'".');i.vertexAttribPointer(o,r,i.FLOAT,!1,0,0),i.enableVertexAttribArray(o)},e.prototype.step=function(e){var t=this,r=t.gl,n=t.errorState,i=t.quadPositionsBuffer,o=e.program,a=e.input,s=e.output;if(!n){var u=o._defaultProgram;this.drawSetup(u,!0,a,s),o._setVertexUniform(u,"u_internal_scale",[1,1],l.FLOAT),o._setVertexUniform(u,"u_internal_translation",[0,0],l.FLOAT),r.bindBuffer(r.ARRAY_BUFFER,i),this.setPositionAttribute(u,o.name),this.setBlendMode(e.shouldBlendAlpha),r.drawArrays(r.TRIANGLE_STRIP,0,4),r.disable(r.BLEND)}},e.prototype.stepBoundary=function(e){var t=this,r=t.gl,n=t.errorState,i=t.boundaryPositionsBuffer,o=e.program,a=e.input,s=e.output,u=s?s.width:this.width,f=s?s.height:this.height;if(!n){var c=o._defaultProgram;this.drawSetup(c,!1,a,s);var p=[1/u,1/f];if(o._setVertexUniform(c,"u_internal_scale",[1-p[0],1-p[1]],l.FLOAT),o._setVertexUniform(c,"u_internal_translation",p,l.FLOAT),r.bindBuffer(r.ARRAY_BUFFER,i),this.setPositionAttribute(c,o.name),this.setBlendMode(e.shouldBlendAlpha),e.singleEdge)switch(e.singleEdge){case"LEFT":r.drawArrays(r.LINES,3,2);break;case"RIGHT":r.drawArrays(r.LINES,1,2);break;case"TOP":r.drawArrays(r.LINES,2,2);break;case"BOTTOM":r.drawArrays(r.LINES,0,2);break;default:throw new Error("Unknown boundary edge type: "+e.singleEdge+".")}else r.drawArrays(r.LINE_LOOP,0,4);r.disable(r.BLEND)}},e.prototype.stepNonBoundary=function(e){var t=this,r=t.gl,n=t.errorState,i=t.quadPositionsBuffer,o=e.program,a=e.input,s=e.output,u=s?s.width:this.width,f=s?s.height:this.height;if(!n){var c=o._defaultProgram;this.drawSetup(c,!1,a,s);var p=[1/u,1/f];o._setVertexUniform(c,"u_internal_scale",[1-2*p[0],1-2*p[1]],l.FLOAT),o._setVertexUniform(c,"u_internal_translation",p,l.FLOAT),r.bindBuffer(r.ARRAY_BUFFER,i),this.setPositionAttribute(c,o.name),this.setBlendMode(e.shouldBlendAlpha),r.drawArrays(r.TRIANGLE_STRIP,0,4),r.disable(r.BLEND)}},e.prototype.stepCircle=function(e){var t=this,r=t.gl,n=t.errorState,i=t.width,o=t.height,a=e.program,s=e.position,u=e.radius,f=e.input,c=e.output;if(!n){var p=a._defaultProgram;this.drawSetup(p,!1,f,c),a._setVertexUniform(p,"u_internal_scale",[2*u/i,2*u/o],l.FLOAT),a._setVertexUniform(p,"u_internal_translation",[2*s[0]/i-1,2*s[1]/o-1],l.FLOAT);var h=e.numSegments?e.numSegments:l.DEFAULT_CIRCLE_NUM_SEGMENTS;if(h<3)throw new Error("numSegments for WebGLCompute.stepCircle must be greater than 2, got "+h+".");r.bindBuffer(r.ARRAY_BUFFER,this.getCirclePositionsBuffer(h)),this.setPositionAttribute(p,a.name),this.setBlendMode(e.shouldBlendAlpha),r.drawArrays(r.TRIANGLE_FAN,0,h+2),r.disable(r.BLEND)}},e.prototype.stepSegment=function(e){var t=this.gl,r=this.errorState,n=e.program,i=e.position1,o=e.position2,a=e.thickness,s=e.input,u=e.output,f=u?u.width:this.width,c=u?u.height:this.height;if(!r){var p=n._segmentProgram;this.drawSetup(p,!1,s,u),n._setVertexUniform(p,"u_internal_halfThickness",a/2,l.FLOAT),n._setVertexUniform(p,"u_internal_scale",[2/f,2/c],l.FLOAT);var h=i[0]-o[0],_=i[1]-o[1],d=Math.atan2(_,h);n._setVertexUniform(p,"u_internal_rotation",d,l.FLOAT);var g=(i[0]+o[0])/2,m=(i[1]+o[1])/2;n._setVertexUniform(p,"u_internal_translation",[2*g/this.width-1,2*m/this.height-1],l.FLOAT);var v=Math.sqrt(h*h+_*_),y=e.numCapSegments?2*e.numCapSegments:l.DEFAULT_CIRCLE_NUM_SEGMENTS;if(e.endCaps){if(y<6||y%6!=0)throw new Error("numSegments for WebGLCompute.stepSegment must be divisible by 6, got "+y+".");n._setVertexUniform(p,"u_internal_length",v-a*Math.sin(Math.PI/y),l.FLOAT),t.bindBuffer(t.ARRAY_BUFFER,this.getCirclePositionsBuffer(y))}else n._setVertexUniform(p,"u_internal_length",v-a,l.FLOAT),t.bindBuffer(t.ARRAY_BUFFER,this.quadPositionsBuffer);this.setPositionAttribute(p,n.name),this.setBlendMode(e.shouldBlendAlpha),e.endCaps?t.drawArrays(t.TRIANGLE_FAN,0,y+2):t.drawArrays(t.TRIANGLE_STRIP,0,4),t.disable(t.BLEND)}},e.prototype.stepPolyline=function(e){var t=e.program,r=e.input,n=e.output,i=e.positions,o=!!e.closeLoop,a=this,s=a.gl,u=a.width,f=a.height;if(!a.errorState){for(var c=e.thickness/2,p=o?4*i.length+2:4*(i.length-1),h=new Float32Array(2*p),_=e.includeUVs?new Float32Array(2*p):void 0,d=e.includeNormals?new Float32Array(2*p):void 0,g=[0,0],m=[0,0],v=[0,0],y=[0,0],T=[0,0],A=0;A<i.length;A++)if(o||A!==i.length-1){var E=i[A],b=i[(A+1)%i.length];g[0]=b[0]-E[0],g[1]=b[1]-E[1];var w=Math.sqrt(g[0]*g[0]+g[1]*g[1]);v[0]=g[1]/w,v[1]=-g[0]/w;var L=4*A+2;o||0!==A||(h[0]=E[0]+v[0]*c,h[1]=E[1]+v[1]*c,h[2]=E[0]-v[0]*c,h[3]=E[1]-v[1]*c,_&&(_[0]=0,_[1]=1,_[2]=0,_[3]=0),d&&(d[0]=v[0],d[1]=v[1],d[2]=v[0],d[3]=v[1]));var R=(A+1)/(i.length-1);if(h[2*L]=b[0]+v[0]*c,h[2*L+1]=b[1]+v[1]*c,h[2*L+2]=b[0]-v[0]*c,h[2*L+3]=b[1]-v[1]*c,_&&(_[2*L]=R,_[2*L+1]=1,_[2*L+2]=R,_[2*L+3]=0),d&&(d[2*L]=v[0],d[2*L+1]=v[1],d[2*L+2]=v[0],d[2*L+3]=v[1]),A<i.length-2||o){var F=i[(A+1)%i.length],O=i[(A+2)%i.length];m[0]=O[0]-F[0],m[1]=O[1]-F[1];var U=Math.sqrt(m[0]*m[0]+m[1]*m[1]);y[0]=m[1]/U,y[1]=-m[0]/U,h[(L+2)%(4*i.length)*2]=F[0]+y[0]*c,h[(L+2)%(4*i.length)*2+1]=F[1]+y[1]*c,h[(L+2)%(4*i.length)*2+2]=F[0]-y[0]*c,h[(L+2)%(4*i.length)*2+3]=F[1]-y[1]*c,_&&(_[(L+2)%(4*i.length)*2]=R,_[(L+2)%(4*i.length)*2+1]=1,_[(L+2)%(4*i.length)*2+2]=R,_[(L+2)%(4*i.length)*2+3]=0),d&&(d[(L+2)%(4*i.length)*2]=y[0],d[(L+2)%(4*i.length)*2+1]=y[1],d[(L+2)%(4*i.length)*2+2]=y[0],d[(L+2)%(4*i.length)*2+3]=y[1]);var N=v[0]*y[1]-v[1]*y[0];if(Math.abs(N)<1e-6)continue;T[0]=v[0]+y[0],T[1]=v[1]+y[1];var I=Math.sqrt(T[0]*T[0]+T[1]*T[1]);T[0]/=I,T[1]/=I;var x=Math.acos(v[0]*y[0]+v[1]*y[1]),D=c/Math.cos(x/2);N<0?(h[2*L]=b[0]+T[0]*D,h[2*L+1]=b[1]+T[1]*D,h[(L+2)%(4*i.length)*2]=h[2*L],h[(L+2)%(4*i.length)*2+1]=h[2*L+1]):(h[2*L+2]=b[0]-T[0]*D,h[2*L+3]=b[1]-T[1]*D,h[(L+2)%(4*i.length)*2+2]=h[2*L+2],h[(L+2)%(4*i.length)*2+3]=h[2*L+3])}}o&&(h[8*i.length]=h[0],h[8*i.length+1]=h[1],h[8*i.length+2]=h[2],h[8*i.length+3]=h[3],_&&(_[8*i.length]=_[0],_[8*i.length+1]=_[1],_[8*i.length+2]=_[2],_[8*i.length+3]=_[3]),d&&(d[8*i.length]=d[0],d[8*i.length+1]=d[1],d[8*i.length+2]=d[2],d[8*i.length+3]=d[3]));var S=_?d?t._defaultProgramWithUVNormal:t._defaultProgramWithUV:d?t._defaultProgramWithNormal:t._defaultProgram;this.drawSetup(S,!1,r,n),t._setVertexUniform(S,"u_internal_scale",[2/u,2/f],l.FLOAT),t._setVertexUniform(S,"u_internal_translation",[-1,-1],l.FLOAT),s.bindBuffer(s.ARRAY_BUFFER,this.initVertexBuffer(h)),this.setPositionAttribute(S,t.name),_&&(s.bindBuffer(s.ARRAY_BUFFER,this.initVertexBuffer(_)),this.setUVAttribute(S,t.name)),d&&(s.bindBuffer(s.ARRAY_BUFFER,this.initVertexBuffer(d)),this.setVertexAttribute(S,"a_internal_normal",2,t.name)),this.setBlendMode(e.shouldBlendAlpha),s.drawArrays(s.TRIANGLE_STRIP,0,p),s.disable(s.BLEND)}},e.prototype.stepTriangleStrip=function(e){var t=e.program,r=e.input,n=e.output,i=e.positions,o=e.uvs,a=e.normals,s=this,u=s.gl,f=s.width,c=s.height;if(!s.errorState){var p=o?a?t._defaultProgramWithUVNormal:t._defaultProgramWithUV:a?t._defaultProgramWithNormal:t._defaultProgram;this.drawSetup(p,!1,r,n),t._setVertexUniform(p,"u_internal_scale",[2/f,2/c],l.FLOAT),t._setVertexUniform(p,"u_internal_translation",[-1,-1],l.FLOAT),u.bindBuffer(u.ARRAY_BUFFER,this.initVertexBuffer(i)),this.setPositionAttribute(p,t.name),o&&(u.bindBuffer(u.ARRAY_BUFFER,this.initVertexBuffer(o)),this.setUVAttribute(p,t.name)),a&&(u.bindBuffer(u.ARRAY_BUFFER,this.initVertexBuffer(a)),this.setVertexAttribute(p,"a_internal_normal",2,t.name));var h=e.count?e.count:i.length/2;this.setBlendMode(e.shouldBlendAlpha),u.drawArrays(u.TRIANGLE_STRIP,0,h),u.disable(u.BLEND)}},e.prototype.stepLines=function(e){var t=this,r=t.gl,n=t.errorState,i=t.width,o=t.height,a=e.indices,s=e.uvs,u=e.normals,f=e.input,c=e.output,p=e.program;if(!n){if(e.closeLoop&&a)throw new Error("WebGLCompute.stepLines() can't be called with closeLoop == true and indices.");var h=s?u?p._defaultProgramWithUVNormal:p._defaultProgramWithUV:u?p._defaultProgramWithNormal:p._defaultProgram;this.drawSetup(h,!1,f,c);var _=e.count?e.count:a?a.length:e.positions.length/2;if(p._setVertexUniform(h,"u_internal_scale",[2/i,2/o],l.FLOAT),p._setVertexUniform(h,"u_internal_translation",[-1,-1],l.FLOAT),a){for(var d=new Float32Array(2*_),g=0;g<_;g++){var m=a[g];d[2*g]=e.positions[2*m],d[2*g+1]=e.positions[2*m+1]}r.bindBuffer(r.ARRAY_BUFFER,this.initVertexBuffer(d))}else r.bindBuffer(r.ARRAY_BUFFER,this.initVertexBuffer(e.positions));this.setPositionAttribute(h,p.name),s&&(r.bindBuffer(r.ARRAY_BUFFER,this.initVertexBuffer(s)),this.setUVAttribute(h,p.name)),u&&(r.bindBuffer(r.ARRAY_BUFFER,this.initVertexBuffer(u)),this.setVertexAttribute(h,"a_internal_normal",2,p.name)),this.setBlendMode(e.shouldBlendAlpha),e.indices?r.drawArrays(r.LINES,0,_):e.closeLoop?r.drawArrays(r.LINE_LOOP,0,_):r.drawArrays(r.LINE_STRIP,0,_),r.disable(r.BLEND)}},e.prototype.drawLayerAsPoints=function(e){var t=this,r=t.gl,n=t.errorState,o=t.pointIndexArray,a=t.width,s=t.height,u=e.positions,f=e.output;if(!n){if(2!==u.numComponents&&4!==u.numComponents)throw new Error('WebGLCompute.drawPoints() must be passed a position DataLayer with either 2 or 4 components, got position DataLayer "'+u.name+'" with '+u.numComponents+" components.");var p=u.length,h=e.count||p;if(h>p)throw new Error("Invalid count "+h+" for position DataLayer of length "+p+".");var _=e.program;if(void 0===_){_=this._setValueProgramForType(l.FLOAT);var d=e.color||[1,0,0];_.setUniform("u_value",i(d,[1]),l.FLOAT)}var g=_._dataLayerPointsProgram,m=this.addLayerToInputs(u,e.input);this.drawSetup(g,!1,m,f),_._setVertexUniform(g,"u_internal_positions",m.indexOf(u),l.INT),_._setVertexUniform(g,"u_internal_scale",[1/a,1/s],l.FLOAT),_._setVertexUniform(g,"u_internal_positionWithAccumulation",4===u.numComponents?1:0,l.INT);var v=e.pointSize||1;_._setVertexUniform(g,"u_internal_pointSize",v,l.FLOAT);var y=[u.width,u.height];if(_._setVertexUniform(g,"u_internal_positionsDimensions",y,l.FLOAT),_._setVertexUniform(g,"u_internal_wrapX",e.wrapX?1:0,l.INT),_._setVertexUniform(g,"u_internal_wrapY",e.wrapY?1:0,l.INT),void 0===this.pointIndexBuffer||o&&o.length<h){var T=c.initSequentialFloatArray(p);this.pointIndexArray=T,this.pointIndexBuffer=this.initVertexBuffer(T)}r.bindBuffer(r.ARRAY_BUFFER,this.pointIndexBuffer),this.setIndexAttribute(g,_.name),this.setBlendMode(e.shouldBlendAlpha),r.drawArrays(r.POINTS,0,h),r.disable(r.BLEND)}},e.prototype.drawLayerAsLines=function(e){var t=this,r=t.gl,n=t.errorState,o=t.width,a=t.height,s=e.positions,u=e.output;if(!n){if(2!==s.numComponents&&4!==s.numComponents)throw new Error('WebGLCompute.drawLayerAsLines() must be passed a position DataLayer with either 2 or 4 components, got position DataLayer "'+s.name+'" with '+s.numComponents+" components.");if(e.closeLoop&&e.indices)throw new Error("WebGLCompute.drawLayerAsLines() can't be called with closeLoop == true and indices.");var f=e.program;if(void 0===f){f=e.wrapX||e.wrapY?this.wrappedLineColorProgram:this._setValueProgramForType(l.FLOAT);var p=e.color||[1,0,0];f.setUniform("u_value",i(p,[1]),l.FLOAT)}var h=f._dataLayerLinesProgram,_=this.addLayerToInputs(s,e.input);this.drawSetup(h,!1,_,u);var d=e.indices?e.indices:c.initSequentialFloatArray(e.count||s.length),g=e.count?e.count:d.length;f._setVertexUniform(h,"u_internal_positions",_.indexOf(s),l.INT),f._setVertexUniform(h,"u_internal_scale",[1/o,1/a],l.FLOAT),f._setVertexUniform(h,"u_internal_positionWithAccumulation",4===s.numComponents?1:0,l.INT);var m=[s.width,s.height];if(f._setVertexUniform(h,"u_internal_positionsDimensions",m,l.FLOAT),f._setVertexUniform(h,"u_internal_wrapX",e.wrapX?1:0,l.INT),f._setVertexUniform(h,"u_internal_wrapY",e.wrapY?1:0,l.INT),void 0===this.indexedLinesIndexBuffer){var v=void 0;if(d.constructor!==Float32Array){v=new Float32Array(d.length);for(var y=0;y<g;y++)v[y]=d[y];console.warn("Converting indices array of type "+d.constructor+" to Float32Array in WebGLCompute.drawIndexedLines for WebGL compatibility, you may want to use a Float32Array to store this information so the conversion is not required.")}else v=d;this.indexedLinesIndexBuffer=this.initVertexBuffer(v)}else r.bindBuffer(r.ARRAY_BUFFER,this.indexedLinesIndexBuffer),r.bufferData(r.ARRAY_BUFFER,d,r.STATIC_DRAW);this.setIndexAttribute(h,f.name),this.setBlendMode(e.shouldBlendAlpha),e.indices?r.drawArrays(r.LINES,0,g):e.closeLoop?r.drawArrays(r.LINE_LOOP,0,g):r.drawArrays(r.LINE_STRIP,0,g),r.disable(r.BLEND)}},e.prototype.drawLayerAsVectorField=function(e){var t=this,r=t.gl,n=t.errorState,o=t.vectorFieldIndexArray,a=t.width,s=t.height,u=e.data,f=e.output;if(!n){if(2!==u.numComponents)throw new Error('WebGLCompute.drawLayerAsVectorField() must be passed a fieldLayer with 2 components, got fieldLayer "'+u.name+'" with '+u.numComponents+" components.");var p=e.program;if(void 0===p){p=this._setValueProgramForType(l.FLOAT);var h=e.color||[1,0,0];p.setUniform("u_value",i(h,[1]),l.FLOAT)}var _=p._dataLayerVectorFieldProgram,d=this.addLayerToInputs(u,e.input);this.drawSetup(_,!1,d,f),p._setVertexUniform(_,"u_internal_vectors",d.indexOf(u),l.INT);var g=e.vectorScale||1;p._setVertexUniform(_,"u_internal_scale",[g/a,g/s],l.FLOAT);var m=e.vectorSpacing||10,v=[Math.floor(a/m),Math.floor(s/m)];p._setVertexUniform(_,"u_internal_dimensions",v,l.FLOAT);var y=2*v[0]*v[1];if(void 0===this.vectorFieldIndexBuffer||o&&o.length<y){var T=c.initSequentialFloatArray(y);this.vectorFieldIndexArray=T,this.vectorFieldIndexBuffer=this.initVertexBuffer(T)}r.bindBuffer(r.ARRAY_BUFFER,this.vectorFieldIndexBuffer),this.setIndexAttribute(_,p.name),this.setBlendMode(e.shouldBlendAlpha),r.drawArrays(r.LINES,0,y),r.disable(r.BLEND)}},e.prototype.drawLayerMagnitude=function(e){var t=this,r=t.gl,n=t.errorState,i=t.quadPositionsBuffer,o=e.data,a=e.output;if(!n){var s=this.vectorMagnitudeProgramForType(o.type),u=e.color||[1,0,0];s.setUniform("u_color",u,l.FLOAT);var f=e.scale||1;s.setUniform("u_scale",f,l.FLOAT),s.setUniform("u_internal_numDimensions",o.numComponents,l.INT);var c=s._defaultProgram,p=this.addLayerToInputs(o,e.input);this.drawSetup(c,!0,p,a),s._setVertexUniform(c,"u_internal_data",p.indexOf(o),l.INT),s._setVertexUniform(c,"u_internal_scale",[1,1],l.FLOAT),s._setVertexUniform(c,"u_internal_translation",[0,0],l.FLOAT),r.bindBuffer(r.ARRAY_BUFFER,i),this.setPositionAttribute(c,s.name),this.setBlendMode(e.shouldBlendAlpha),r.drawArrays(r.TRIANGLE_STRIP,0,4),r.disable(r.BLEND)}},e.prototype.getValues=function(e){var t=this.gl,r=this.glslVersion;e._bindOutputBuffer();var n,i=e.width,o=e.height,a=e.glNumChannels,s=e.glType,u=e.glFormat,f=e.internalType;switch(f){case l.HALF_FLOAT:void 0!==t.FLOAT?(a=4,u=t.RGBA,s=t.FLOAT,n=new Float32Array(i*o*a)):n=new Uint16Array(i*o*a);break;case l.FLOAT:a=4,u=t.RGBA,n=new Float32Array(i*o*a);break;case l.UNSIGNED_BYTE:if(r===l.GLSL1){a=4,u=t.RGBA,n=new Uint8Array(i*o*a);break}a=4,u=t.RGBA_INTEGER,s=t.UNSIGNED_INT,n=new Uint32Array(i*o*a);break;case l.UNSIGNED_SHORT:a=4,u=t.RGBA_INTEGER,s=t.UNSIGNED_INT,n=new Uint32Array(i*o*a);break;case l.UNSIGNED_INT:a=4,u=t.RGBA_INTEGER,n=new Uint32Array(i*o*a);break;case l.BYTE:case l.SHORT:a=4,u=t.RGBA_INTEGER,s=t.INT,n=new Int32Array(i*o*a);break;case l.INT:a=4,u=t.RGBA_INTEGER,n=new Int32Array(i*o*a);break;default:throw new Error("Unsupported internalType "+f+" for getValues().")}if(this.readyToRead()){t.readPixels(0,0,i,o,u,s,n);var c=e.numComponents,h=e.type,_=(e._length?e._length:i*o)*c,d=f===l.HALF_FLOAT&&n.constructor===Uint16Array,g=d?new DataView(n.buffer):void 0,m=n;if(f!==h)switch(h){case l.HALF_FLOAT:case l.FLOAT:m=new Float32Array(_);break;case l.UNSIGNED_BYTE:m=new Uint8Array(_);break;case l.BYTE:m=new Int8Array(_);break;case l.UNSIGNED_SHORT:m=new Uint16Array(_);break;case l.SHORT:m=new Int16Array(_);break;case l.UNSIGNED_INT:m=new Uint32Array(_);break;case l.INT:m=new Int32Array(_);break;default:throw new Error("Unsupported type "+h+" for getValues().")}if(d||m!==n||c!==a)for(var v=0,y=i*o;v<y;v++){var T=v*a,A=v*c;if(A>=_)break;for(var E=0;E<c;E++)m[A+E]=d?p.getFloat16(g,2*(T+E),!0):n[T+E]}return m.length!==_&&(m=m.slice(0,_)),m}throw new Error("Unable to read values from Buffer with status: "+t.checkFramebufferStatus(t.FRAMEBUFFER)+".")},e.prototype.readyToRead=function(){var e=this.gl;return e.checkFramebufferStatus(e.FRAMEBUFFER)==e.FRAMEBUFFER_COMPLETE},e.prototype.savePNG=function(e,t,r,n){void 0===t&&(t=e.name),void 0===n&&(n=o.saveAs);var i=this.getValues(e),s=e.width,u=e.height,f=document.createElement("canvas");f.width=s,f.height=u;for(var c=f.getContext("2d"),p=c.getImageData(0,0,s,u),h=p.data,_=e.type===l.FLOAT||e.type===l.HALF_FLOAT,d=0;d<u;d++)for(var g=0;g<s;g++){for(var m=d*s+g,v=(u-1-d)*s+g,y=0;y<e.numComponents;y++)h[4*v+y]=i[e.numComponents*m+y]*(_?255:1);e.numComponents<4&&(h[4*v+3]=255)}c.putImageData(p,0,0),f.toBlob((function(e){e?r?a.changeDpiBlob(e,r).then((function(e){n(e,t+".png")})):n(e,t+".png"):console.warn("Problem saving PNG, unable to init blob.")}),"image/png")},e.prototype.attachDataLayerToThreeTexture=function(e,t){if(!this.renderer)throw new Error("WebGLCompute was not inited with a renderer.");if(e.numBuffers>1)throw new Error('DataLayer "'+e.name+'" contains multiple WebGL textures (one for each buffer) that are flip-flopped during compute cycles, please choose a DataLayer with one buffer.');var r=this.renderer.properties.get(t);r.__webglTexture=e.currentState,r.__webglInit=!0},e.prototype.resetThreeState=function(){if(!this.renderer)throw new Error("WebGLCompute was not inited with a renderer.");var e=this.gl,t=this.renderer.getViewport(new f.Vector4);e.viewport(t.x,t.y,t.width,t.height),this.renderer.setRenderTarget(null),this.renderer.resetState()},e.prototype.dispose=function(){var e,t=this,r=t.gl,n=t.verboseLogging,i=t._vertexShaders,o=t.copyPrograms,a=t.setValuePrograms,s=t.vectorMagnitudePrograms;n&&console.log("Deallocating WebGLCompute."),Object.values(i).forEach((function(e){e.shader&&(r.deleteShader(e.shader),delete e.shader)})),Object.values(o).forEach((function(e){e.dispose&&e.dispose()})),Object.keys(o).forEach((function(e){delete o[e]})),Object.values(a).forEach((function(e){e.dispose&&e.dispose()})),Object.keys(a).forEach((function(e){delete a[e]})),Object.values(s).forEach((function(e){e.dispose&&e.dispose()})),Object.keys(s).forEach((function(e){delete s[e]})),null===(e=this._wrappedLineColorProgram)||void 0===e||e.dispose(),delete this._wrappedLineColorProgram,delete this.renderer,delete this.gl},e}();t.WebGLCompute=d},581:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getExtension=t.EXT_COLOR_BUFFER_FLOAT=t.WEBGL_DEPTH_TEXTURE=t.OES_TEXTURE_HAlF_FLOAT_LINEAR=t.OES_TEXTURE_FLOAT_LINEAR=t.OES_TEXTURE_HALF_FLOAT=t.OES_TEXTURE_FLOAT=void 0;var r={};t.OES_TEXTURE_FLOAT="OES_texture_float",t.OES_TEXTURE_HALF_FLOAT="OES_texture_half_float",t.OES_TEXTURE_FLOAT_LINEAR="OES_texture_float_linear",t.OES_TEXTURE_HAlF_FLOAT_LINEAR="OES_texture_half_float_linear",t.WEBGL_DEPTH_TEXTURE="WEBGL_depth_texture",t.EXT_COLOR_BUFFER_FLOAT="EXT_color_buffer_float",t.getExtension=function(e,t,n,i){if(void 0===i&&(i=!1),void 0!==r[t])return r[t];var o;try{o=e.getExtension(t)}catch(e){}return o?(r[t]=o,console.log("Loaded extension: "+t+".")):(r[t]=!1,console.warn("Unsupported "+(i?"optional ":"")+"extension: "+t+".")),o||i||n("Required extension unsupported by this device / browser: "+t+"."),o}},607:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.isWebGL2Supported=t.WebGLCompute=void 0;var o=r(593);Object.defineProperty(t,"isWebGL2Supported",{enumerable:!0,get:function(){return o.isWebGL2Supported}});var a=r(215);Object.defineProperty(t,"WebGLCompute",{enumerable:!0,get:function(){return a.WebGLCompute}}),o.inDevMode()&&console.log("Running in development mode."),i(r(738),t)},593:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.inDevMode=t.initSequentialFloatArray=t.isPowerOf2=t.isWebGL2Supported=t.isWebGL2=t.insertDefinesAfterVersionDeclaration=t.compileShader=void 0;var n=r(627),i=r(738);function o(e,t,r){var o=function(e){for(var t="",r=Object.keys(e),i=0;i<r.length;i++){var o=r[i];if(!n.isString(o)||!n.isString(e[o]))throw new Error("GPUProgram defines must be passed in as key value pairs that are both strings, got key value pair of type ["+typeof o+" : "+typeof e[o]+"].");t+="#define "+o+" "+e[o]+"\n"}return t}(r);return t=e.glslVersion===i.GLSL1?o+"\n"+t:t.replace("\n","\n"+o+"\n")}t.compileShader=function(e,t,r,n,i){var a=e.gl,s=e._errorCallback;i&&(t=o(e,t,i));var l=a.createShader(r);return l?(a.shaderSource(l,t),a.compileShader(l),a.getShaderParameter(l,a.COMPILE_STATUS)?l:(s("Could not compile "+(r===a.FRAGMENT_SHADER?"fragment":"vertex")+'\n\t\t\t shader for program "'+n+'": '+a.getShaderInfoLog(l)+"."),null)):(s("Unable to init gl shader."),null)},t.insertDefinesAfterVersionDeclaration=o,t.isWebGL2=function(e){return"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext},t.isWebGL2Supported=function(){return!!document.createElement("canvas").getContext("webgl2")},t.isPowerOf2=function(e){return 0==(e&e-1)},t.initSequentialFloatArray=function(e){for(var t=new Float32Array(e),r=0;r<e;r++)t[r]=r;return t},t.inDevMode=function(){return!1}},158:e=>{e.exports="#version 300 es\nprecision highp int;precision highp float;precision lowp sampler2D;precision lowp isampler2D;precision lowp usampler2D;in vec2 v_UV;\n#ifdef FLOAT\nuniform sampler2D u_state;\n#endif\n#ifdef INT\nuniform isampler2D u_state;\n#endif\n#ifdef UINT\nuniform usampler2D u_state;\n#endif\n#ifdef FLOAT\nout vec4 out_fragOut;\n#endif\n#ifdef INT\nout ivec4 out_fragOut;\n#endif\n#ifdef UINT\nout uvec4 out_fragOut;\n#endif\nvoid main(){out_fragOut=A(u_state,v_UV);}"},148:e=>{e.exports="#version 300 es\nprecision highp int;precision highp float;precision lowp sampler2D;precision lowp isampler2D;precision lowp usampler2D;\n#ifdef FLOAT\nuniform vec4 u_value;\n#endif\n#ifdef INT\nuniform ivec4 u_value;\n#endif\n#ifdef UINT\nuniform uvec4 u_value;\n#endif\n#ifdef FLOAT\nout vec4 out_fragOut;\n#endif\n#ifdef INT\nout ivec4 out_fragOut;\n#endif\n#ifdef UINT\nout uvec4 out_fragOut;\n#endif\nvoid main(){out_fragOut=u_value;}"},723:e=>{e.exports="#version 300 es\nprecision highp int;precision highp float;precision lowp sampler2D;precision lowp isampler2D;precision lowp usampler2D;in vec2 v_UV;uniform vec3 u_color;uniform float u_scale;\n#ifdef FLOAT\nuniform sampler2D u_internal_data;\n#endif\n#ifdef INT\nuniform isampler2D u_internal_data;\n#endif\n#ifdef UINT\nuniform usampler2D u_internal_data;\n#endif\nout vec4 out_fragOut;void main(){uvec4 A=B(u_internal_data,v_UV);float C=length(A);out_fragOut=vec4(C*u_scale*u_color,1);}"},598:e=>{e.exports="#version 300 es\nprecision highp int;precision highp float;precision lowp sampler2D;precision lowp isampler2D;precision lowp usampler2D;in vec2 v_lineWrapping;uniform vec4 u_value;out vec4 out_fragOut;void main(){if((v_lineWrapping.x!=0.&&v_lineWrapping.x!=1.)||(v_lineWrapping.y!=0.&&v_lineWrapping.y!=1.)){discard;return;}out_fragOut=vec4(u_value);}"},587:e=>{e.exports="#version 300 es\nprecision highp int;precision highp float;precision lowp sampler2D;precision lowp isampler2D;precision lowp usampler2D;float A(float B,float C){float D=B-floor((B+0.5)/C)*C;return floor(D+0.5);}in float a_internal_index;uniform sampler2D u_internal_positions;uniform vec2 u_internal_positionsDimensions;uniform vec2 u_internal_scale;uniform bool u_internal_positionWithAccumulation;uniform bool u_internal_wrapX;uniform bool u_internal_wrapY;out vec2 v_UV;out vec2 v_lineWrapping;out float v_index;void main(){vec2 E=vec2(A(a_internal_index,u_internal_positionsDimensions.x),floor(floor(a_internal_index+0.5)/u_internal_positionsDimensions.x))/u_internal_positionsDimensions;vec4 F=texture2D(u_internal_positions,E);vec2 G=F.rg;if(u_internal_positionWithAccumulation)G+=F.ba;v_UV=G*u_internal_scale;v_lineWrapping=vec2(0.);if(u_internal_wrapX){if(v_UV.x<0.){v_UV.x+=1.;v_lineWrapping.x=1.;}else if(v_UV.x>1.){v_UV.x-=1.;v_lineWrapping.x=1.;}}if(u_internal_wrapY){if(v_UV.y<0.){v_UV.y+=1.;v_lineWrapping.y=1.;}else if(v_UV.y>1.){v_UV.y-=1.;v_lineWrapping.y=1.;}}vec2 H=v_UV*2.-1.;v_index=a_internal_index;gl_Position=vec4(H,0,1);}"},18:e=>{e.exports="#version 300 es\nprecision highp int;precision highp float;precision lowp sampler2D;precision lowp isampler2D;precision lowp usampler2D;float A(float B,float C){float D=B-floor((B+0.5)/C)*C;return floor(D+0.5);}in float a_internal_index;uniform sampler2D u_internal_positions;uniform vec2 u_internal_positionsDimensions;uniform vec2 u_internal_scale;uniform float u_internal_pointSize;uniform bool u_internal_positionWithAccumulation;uniform bool u_internal_wrapX;uniform bool u_internal_wrapY;out vec2 v_UV;out float v_index;void main(){vec2 E=vec2(A(a_internal_index,u_internal_positionsDimensions.x),floor(floor(a_internal_index+0.5)/u_internal_positionsDimensions.x))/u_internal_positionsDimensions;vec4 F=texture2D(u_internal_positions,E);vec2 G=F.rg;if(u_internal_positionWithAccumulation)G+=F.ba;v_UV=G*u_internal_scale;if(u_internal_wrapX){if(v_UV.x<0.)v_UV.x+=1.;if(v_UV.x>1.)v_UV.x-=1.;}if(u_internal_wrapY){if(v_UV.y<0.)v_UV.y+=1.;if(v_UV.y>1.)v_UV.y-=1.;}vec2 H=v_UV*2.-1.;v_index=a_internal_index;gl_PointSize=u_internal_pointSize;gl_Position=vec4(H,0,1);}"},7:e=>{e.exports="#version 300 es\nprecision highp int;precision highp float;precision lowp sampler2D;precision lowp isampler2D;precision lowp usampler2D;float A(float B,float C){float D=B-floor((B+0.5)/C)*C;return floor(D+0.5);}in float a_internal_index;uniform sampler2D u_internal_vectors;uniform vec2 u_internal_dimensions;uniform vec2 u_internal_scale;out vec2 v_UV;out float v_index;void main(){float E=floor((a_internal_index+0.5)/2.);v_UV=vec2(A(E,u_internal_dimensions.x),floor(floor(E+0.5)/u_internal_dimensions.x))/u_internal_dimensions;if(A(a_internal_index,2.)>0.){vec2 F=texture2D(u_internal_vectors,v_UV).xy;v_UV+=F*u_internal_scale;}vec2 G=v_UV*2.-1.;v_index=a_internal_index;gl_Position=vec4(G,0,1);}"},288:e=>{e.exports="#version 300 es\nprecision highp int;precision highp float;precision lowp sampler2D;precision lowp isampler2D;precision lowp usampler2D;in vec2 a_internal_position;\n#ifdef UV_ATTRIBUTE\nin vec2 a_internal_uv;\n#endif\n#ifdef NORMAL_ATTRIBUTE\nin vec2 a_internal_normal;\n#endif\nuniform vec2 u_internal_scale;uniform vec2 u_internal_translation;out vec2 v_UV;out vec2 v_UV_local;\n#ifdef NORMAL_ATTRIBUTE\nout vec2 v_normal;\n#endif\nvoid main(){\n#ifdef UV_ATTRIBUTE\nv_UV_local=a_internal_uv;\n#else\nv_UV_local=a_internal_position;\n#endif\n#ifdef NORMAL_ATTRIBUTE\nv_normal=a_internal_normal;\n#endif\nvec2 A=u_internal_scale*a_internal_position+u_internal_translation;v_UV=0.5*(A+1.);gl_Position=vec4(A,0,1);}"},974:e=>{e.exports="#version 300 es\nprecision highp int;precision highp float;precision lowp sampler2D;precision lowp isampler2D;precision lowp usampler2D;in vec2 a_internal_position;uniform float u_internal_halfThickness;uniform vec2 u_internal_scale;uniform float u_internal_length;uniform float u_internal_rotation;uniform vec2 u_internal_translation;out vec2 v_UV_local;out vec2 v_UV;mat2 A(float B){return mat2(cos(B),-sin(B),sin(B),cos(B));}void main(){v_UV_local=0.5*(a_internal_position+1.);vec2 C=a_internal_position;C*=u_internal_halfThickness;if(C.x<0.){C.x-=u_internal_length/2.;v_UV_local.x=0.;}else if(C.x>0.){C.x+=u_internal_length/2.;v_UV_local.x=1.;}C=u_internal_scale*(A(-u_internal_rotation)*C)+u_internal_translation;v_UV=0.5*(C+1.);gl_Position=vec4(C,0,1);}"}},t={};function r(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={id:n,loaded:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.loaded=!0,o.exports}return r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r(607)})()}));
//# sourceMappingURL=webgl-compute.min.js.map
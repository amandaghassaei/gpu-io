!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.WebGLCompute=t():e.WebGLCompute=t()}(self,function(){return r={501:(e,t,r)=>{"use strict";r.r(t),r.d(t,{Float16Array:()=>de,getFloat16:()=>function(e,t,...r){if(ne(e))return c(e.getUint16(t,...r));throw new TypeError("First argument to getFloat16 function must be a DataView")},hfround:()=>function(e){if(e=Number(e),!Number.isFinite(e)||0===e)return e;e=u(e);return c(e)},setFloat16:()=>function(e,t,r,...n){if(!ne(e))throw new TypeError("First argument to setFloat16 function must be a DataView");e.setUint16(t,u(r),...n)}});var n=new ArrayBuffer(4);const i=new Float32Array(n),o=new Uint32Array(n),a=new Uint32Array(512),s=new Uint32Array(512);for(let e=0;e<256;++e){var l=e-127;l<-27?(a[0|e]=0,a[256|e]=32768,s[0|e]=24,s[256|e]=24):l<-14?(a[0|e]=1024>>-l-14,a[256|e]=1024>>-l-14|32768,s[0|e]=-l-1,s[256|e]=-l-1):l<=15?(a[0|e]=15+l<<10,a[256|e]=15+l<<10|32768,s[0|e]=13,s[256|e]=13):l<128?(a[0|e]=31744,a[256|e]=64512,s[0|e]=24,s[256|e]=24):(a[0|e]=31744,a[256|e]=64512,s[0|e]=13,s[256|e]=13)}function u(e){i[0]=e;var t=o[0],e=t>>23&511;return a[e]+((8388607&t)>>s[e])}const f=new Uint32Array(2048),p=new Uint32Array(64),h=new Uint32Array(64);f[0]=0;for(let r=1;r<1024;++r){let e=r<<13,t=0;for(;0==(8388608&e);)t-=8388608,e<<=1;e&=-8388609,t+=947912704,f[r]=e|t}for(let e=1024;e<2048;++e)f[e]=939524096+(e-1024<<13);p[0]=0;for(let e=1;e<31;++e)p[e]=e<<23;p[31]=1199570944,p[32]=2147483648;for(let e=33;e<63;++e)p[e]=2147483648+(e-32<<23);p[63]=3347054592,h[0]=0;for(let e=1;e<64;++e)32===e?h[e]=0:h[e]=1024;function c(e){var t=e>>10;return o[0]=f[h[t]+(1023&e)]+p[t],i[0]}var d=r(277),_="object"==typeof self&&self&&self.Object===Object&&self,g=d.Z||_||Function("return this")(),t=g.Symbol,n=Object.prototype,m=n.hasOwnProperty,v=n.toString,y=t?t.toStringTag:void 0;const A=function(e){var t=m.call(e,y),r=e[y];try{var n=!(e[y]=void 0)}catch(e){}var i=v.call(e);return n&&(t?e[y]=r:delete e[y]),i};var T=Object.prototype.toString;const b=function(e){return T.call(e)};var E=t?t.toStringTag:void 0;const w=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":(E&&E in Object(e)?A:b)(e)};const L=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};const R=function(e){return!!L(e)&&("[object Function]"==(e=w(e))||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e)},F=g["__core-js_shared__"];var O=(d=/[^.]+$/.exec(F&&F.keys&&F.keys.IE_PROTO||""))?"Symbol(src)_1."+d:"";const U=function(e){return!!O&&O in e};var x=Function.prototype.toString;const I=function(e){if(null!=e){try{return x.call(e)}catch(e){}try{return e+""}catch(e){}}return""};var N=/^\[object .+?Constructor\]$/,_=Function.prototype,n=Object.prototype,t=_.toString,d=n.hasOwnProperty,D=RegExp("^"+t.call(d).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const S=function(e){return!(!L(e)||U(e))&&(R(e)?D:N).test(I(e))};const P=function(e,t){return null==e?void 0:e[t]};const B=function(e,t){return t=P(e,t),S(t)?t:void 0},G=B(Object,"create");var _=function(e){return e=this.has(e)&&delete this.__data__[e],this.size-=e?1:0,e},M=Object.prototype.hasOwnProperty;var n=function(e){var t=this.__data__;if(G){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return M.call(t,e)?t[e]:void 0},C=Object.prototype.hasOwnProperty;t=function(e){var t=this.__data__;return G?void 0!==t[e]:C.call(t,e)};d=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=G&&void 0===t?"__lodash_hash_undefined__":t,this};function V(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}V.prototype.clear=function(){this.__data__=G?G(null):{},this.size=0},V.prototype.delete=_,V.prototype.get=n,V.prototype.has=t,V.prototype.set=d;const k=V;const W=function(e,t){return e===t||e!=e&&t!=t};const j=function(e,t){for(var r=e.length;r--;)if(W(e[r][0],t))return r;return-1};var H=Array.prototype.splice;_=function(e){var t=this.__data__;return!((e=j(t,e))<0)&&(e==t.length-1?t.pop():H.call(t,e,1),--this.size,!0)};n=function(e){var t=this.__data__;return(e=j(t,e))<0?void 0:t[e][1]};t=function(e){return-1<j(this.__data__,e)};d=function(e,t){var r=this.__data__,n=j(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};function Y(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Y.prototype.clear=function(){this.__data__=[],this.size=0},Y.prototype.delete=_,Y.prototype.get=n,Y.prototype.has=t,Y.prototype.set=d;const X=Y,z=B(g,"Map");_=function(){this.size=0,this.__data__={hash:new k,map:new(z||X),string:new k}};const q=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};const Z=function(e,t){return e=e.__data__,q(t)?e["string"==typeof t?"string":"hash"]:e.map};n=function(e){return e=Z(this,e).delete(e),this.size-=e?1:0,e};t=function(e){return Z(this,e).get(e)};d=function(e){return Z(this,e).has(e)};g=function(e,t){var r=Z(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};function K(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}K.prototype.clear=_,K.prototype.delete=n,K.prototype.get=t,K.prototype.has=d,K.prototype.set=g;const $=K;function J(n,i){if("function"!=typeof n||null!=i&&"function"!=typeof i)throw new TypeError("Expected a function");function o(){var e=arguments,t=i?i.apply(this,e):e[0],r=o.cache;return r.has(t)?r.get(t):(e=n.apply(this,e),o.cache=r.set(t,e)||r,e)}return o.cache=new(J.Cache||$),o}J.Cache=$;const Q=J,ee=Object.getOwnPropertyDescriptor(new Uint8Array(1),0).writable;function te(e){let t="number"!=typeof e?Number(e):e;return Number.isNaN(t)&&(t=0),Math.trunc(t)}function re(e,t){var[r,n]=[Number.isNaN(e),Number.isNaN(t)];if(r&&n)return 0;if(r)return 1;if(n)return-1;if(e<t)return-1;if(t<e)return 1;if(0===e&&0===t){var[e,t]=[Object.is(e,0),Object.is(t,0)];if(!e&&t)return-1;if(e&&!t)return 1}return 0}function ne(e){return e instanceof DataView}function ie(e){return"string"==typeof e&&e===te(e)+""}const oe=function(e){return null!=e&&"object"==typeof e};g=function(e){return oe(e)&&"[object ArrayBuffer]"==w(e)};const ae=function(t){return function(e){return t(e)}};r=r(730),r=r.Z&&r.Z.isArrayBuffer;const se=r?ae(r):g;const le=function(){const r=new WeakMap;return e=>{let t=r.get(e);return t||(t=Object.create(null),r.set(e,t),t)}}();function ue(e){return e instanceof de}function fe(e){if(!ue(e))throw new TypeError("This is not a Float16Array")}function pe(t){var r=t.length;const n=new Array(r);for(let e=0;e<r;++e)n[e]=c(t[e]);return n}const he={apply(e,t,r){return ue(t)&&("function"==typeof(n=e)&&ge.has(n))?Reflect.apply(e,le(t).target,r):Reflect.apply(e,t,r);var n}},ce={get(t,r){let n=null;if(ee||(n=t,t=le(n).target),ie(r))return Reflect.has(t,r)?c(Reflect.get(t,r)):void 0;{r=null!==n&&Reflect.has(n,r)?Reflect.get(n,r):Reflect.get(t,r);if("function"!=typeof r)return r;let e=le(r).proxy;return void 0===e&&(e=le(r).proxy=new Proxy(r,he)),e}},set(e,t,r){let n=null;return ee||(n=e,e=le(n).target),ie(t)?Reflect.set(e,t,u(r)):null===n||Reflect.has(e,t)&&!Object.isFrozen(n)?Reflect.set(e,t,r):Reflect.set(n,t,r)}};ee||(ce.getPrototypeOf=e=>Reflect.getPrototypeOf(le(e).target),ce.setPrototypeOf=(e,t)=>Reflect.setPrototypeOf(le(e).target,t),ce.defineProperty=(e,t,r)=>{var n=le(e).target;return!Reflect.has(n,t)||Object.isFrozen(e)?Reflect.defineProperty(e,t,r):Reflect.defineProperty(n,t,r)},ce.deleteProperty=(e,t)=>{var r=le(e).target;return Reflect.has(e,t)?Reflect.deleteProperty(e,t):Reflect.deleteProperty(r,t)},ce.has=(e,t)=>Reflect.has(e,t)||Reflect.has(le(e).target,t),ce.isExtensible=e=>Reflect.isExtensible(e),ce.preventExtensions=e=>Reflect.preventExtensions(e),ce.getOwnPropertyDescriptor=(e,t)=>Reflect.getOwnPropertyDescriptor(e,t),ce.ownKeys=e=>Reflect.ownKeys(e));class de extends Uint16Array{constructor(e,t,r){if(ue(e))super(le(e).target);else if(null===e||"object"!=typeof e||se(e))switch(arguments.length){case 0:super();break;case 1:super(e);break;case 2:super(e,t);break;case 3:super(e,t,r);break;default:super(...arguments)}else{var n=Reflect.has(e,"length")||void 0===e[Symbol.iterator]?e:[...e];const r=n.length;super(r);for(let e=0;e<r;++e)this[e]=u(n[e])}let i;var o;return i=ee?new Proxy(this,ce):(o=Object.create(null),le(o).target=this,new Proxy(o,ce)),le(i).target=this,le(this).proxy=i,i}static from(e,...t){if(0===t.length)return new de(Uint16Array.from(e,u).buffer);const r=t[0];t=t[1];return new de(Uint16Array.from(e,function(e,...t){return u(r.call(this,e,...t))},t).buffer)}static of(...e){return new de(e)}*[Symbol.iterator](){for(const e of super[Symbol.iterator]())yield c(e)}keys(){return super.keys()}*values(){for(const e of super.values())yield c(e)}*entries(){for(var[e,t]of super.entries())yield[e,c(t)]}map(r,...e){fe(this);var n=e[0];const i=[];for(let e=0,t=this.length;e<t;++e){var o=c(this[e]);i.push(r.call(n,o,e,le(this).proxy))}return new de(i)}filter(r,...e){fe(this);var n=e[0];const i=[];for(let e=0,t=this.length;e<t;++e){var o=c(this[e]);r.call(n,o,e,le(this).proxy)&&i.push(o)}return new de(i)}reduce(r,...e){fe(this);let n,i;i=0===e.length?(n=c(this[0]),1):(n=e[0],0);for(let e=i,t=this.length;e<t;++e)n=r(n,c(this[e]),e,le(this).proxy);return n}reduceRight(t,...e){fe(this);let r,n;var i=this.length;n=0===e.length?(r=c(this[i-1]),i-1):(r=e[0],i);for(let e=n;e--;)r=t(r,c(this[e]),e,le(this).proxy);return r}forEach(r,...e){fe(this);var n=e[0];for(let e=0,t=this.length;e<t;++e)r.call(n,c(this[e]),e,le(this).proxy)}find(r,...e){fe(this);var n=e[0];for(let e=0,t=this.length;e<t;++e){var i=c(this[e]);if(r.call(n,i,e,le(this).proxy))return i}}findIndex(r,...e){fe(this);var n=e[0];for(let e=0,t=this.length;e<t;++e){var i=c(this[e]);if(r.call(n,i,e,le(this).proxy))return e}return-1}every(r,...e){fe(this);var n=e[0];for(let e=0,t=this.length;e<t;++e)if(!r.call(n,c(this[e]),e,le(this).proxy))return!1;return!0}some(r,...e){fe(this);var n=e[0];for(let e=0,t=this.length;e<t;++e)if(r.call(n,c(this[e]),e,le(this).proxy))return!0;return!1}set(e,...t){fe(this);t=t[0];let r;if(ue(e))r=le(e).target;else{var n=Reflect.has(e,"length")||void 0===e[Symbol.iterator]?e:[...e],e=n.length;r=new Uint16Array(e);for(let e=0,t=n.length;e<t;++e)r[e]=u(n[e])}super.set(r,t)}reverse(){return fe(this),super.reverse(),le(this).proxy}fill(e,...t){return fe(this),super.fill(u(e),...t),le(this).proxy}copyWithin(e,t,...r){return fe(this),super.copyWithin(e,t,...r),le(this).proxy}sort(...e){fe(this);let r=e[0];void 0===r&&(r=re);const n=Q(c);return super.sort((e,t)=>r(n(e),n(t))),le(this).proxy}slice(...t){fe(this);let r;try{r=super.slice(...t)}catch(e){if(!(e instanceof TypeError))throw e;{const n=new Uint16Array(this.buffer,this.byteOffset,this.length);r=n.slice(...t)}}return new de(r.buffer)}subarray(...t){fe(this);let r;try{r=super.subarray(...t)}catch(e){if(!(e instanceof TypeError))throw e;{const n=new Uint16Array(this.buffer,this.byteOffset,this.length);r=n.subarray(...t)}}return new de(r.buffer,r.byteOffset,r.length)}indexOf(r,...e){fe(this);var n=this.length;let i=te(e[0]);i<0&&(i+=n,i<0&&(i=0));for(let e=i,t=n;e<t;++e)if(c(this[e])===r)return e;return-1}lastIndexOf(t,...e){fe(this);var r=this.length;let n=te(e[0]);n=0===n?r:n+1,0<=n?n=n<r?n:r:n+=r;for(let e=n;e--;)if(c(this[e])===t)return e;return-1}includes(r,...e){fe(this);var n=this.length;let i=te(e[0]);i<0&&(i+=n,i<0&&(i=0));var o=Number.isNaN(r);for(let e=i,t=n;e<t;++e){var a=c(this[e]);if(o&&Number.isNaN(a))return!0;if(a===r)return!0}return!1}join(...e){fe(this);const t=pe(this);return t.join(...e)}toLocaleString(...e){fe(this);const t=pe(this);return t.toLocaleString(...e)}get[Symbol.toStringTag](){if(ue(this))return"Float16Array"}}var _e=de.prototype;const ge=new WeakSet;for(const ve of Reflect.ownKeys(_e)){var me=_e[ve];"function"==typeof me&&ge.add(me)}},809:(e,t)=>{"use strict";function a(e){var t=-1;n=n||function(){for(var e=new Int32Array(256),t=0;t<256;t++){for(var r=t,n=0;n<8;n++)r=1&r?3988292384^r>>>1:r>>>1;e[t]=r}return e}();for(var r=0;r<e.length;r++)t=n[255&(t^e[r])]^t>>>8;return-1^t}Object.defineProperty(t,"__esModule",{value:!0}),t.changeDpiBlob=function(i,o){var t=i.slice(0,33);return new Promise(function(r,e){var n=new FileReader;n.onload=function(){var e=new Uint8Array(n.result),t=i.slice(33),e=g(e,o,i.type);r(new Blob([e,t],{type:i.type}))},n.readAsArrayBuffer(t)})},t.changeDpiDataUrl=function(e,t){var r=e.split(","),n=r[0],i=r[1],o=void 0,e=void 0,r=!1;-1!==n.indexOf(f)&&(o=f,0<=(a=function(e){var t=e.indexOf(h);-1===t&&(t=e.indexOf(c));-1===t&&(t=e.indexOf(d));return t}(i))?(e=4*Math.ceil((a+28)/3),r=!0):e=44);-1!==n.indexOf(p)&&(o=p,e=24);for(var a=i.substring(0,e),e=i.substring(e),s=atob(a),l=new Uint8Array(s.length),u=0;u<l.length;u++)l[u]=s.charCodeAt(u);r=g(l,t,o,r),r=btoa(String.fromCharCode.apply(String,function(e){{if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}}(r)));return[n,",",r,e].join("")};var n=void 0,f="image/png",p="image/jpeg",h="AAlwSFlz",c="AAAJcEhZ",d="AAAACXBI",s="p".charCodeAt(0),l="H".charCodeAt(0),u="Y".charCodeAt(0),_="s".charCodeAt(0);function g(e,t,r,n){if(r===p)return e[13]=1,e[14]=t>>8,e[15]=255&t,e[16]=t>>8,e[17]=255&t,e;if(r===f){var i=new Uint8Array(13);t*=39.3701,i[0]=s,i[1]=l,i[2]=u,i[3]=_,i[4]=t>>>24,i[5]=t>>>16,i[6]=t>>>8,i[7]=255&t,i[8]=i[4],i[9]=i[5],i[10]=i[6],i[11]=i[7],i[12]=1;r=a(i),t=new Uint8Array(4);if(t[0]=r>>>24,t[1]=r>>>16,t[2]=r>>>8,t[3]=255&r,n){var o=function(e){for(var t=e.length-1;4<=t;t--)if(9===e[t-4]&&e[t-3]===s&&e[t-2]===l&&e[t-1]===u&&e[t]===_)return t-3}(e);return e.set(i,o),e.set(t,o+13),e}n=new Uint8Array(4);n[0]=0,n[1]=0,n[2]=0,n[3]=9;o=new Uint8Array(54);return o.set(e,0),o.set(n,33),o.set(i,37),o.set(t,50),o}}},162:function(e,t,r){var n;void 0===(n="function"==typeof(n=function(){"use strict";function i(e,t){return"undefined"==typeof t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}function f(e,t,r){var n=new XMLHttpRequest;n.open("GET",e),n.responseType="blob",n.onload=function(){s(n.response,t,r)},n.onerror=function(){console.error("could not download file")},n.send()}function o(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function a(t){try{t.dispatchEvent(new MouseEvent("click"))}catch(e){var r=document.createEvent("MouseEvents");r.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(r)}}var p="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof r.g&&r.g.global===r.g?r.g:void 0,h=p.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),s=p.saveAs||("object"!=typeof window||window!==p?function(){}:"download"in HTMLAnchorElement.prototype&&!h?function(e,t,r){var n=p.URL||p.webkitURL,i=document.createElement("a");t=t||e.name||"download",i.download=t,i.rel="noopener","string"==typeof e?(i.href=e,i.origin===location.origin?a(i):o(i.href)?f(e,t,r):a(i,i.target="_blank")):(i.href=n.createObjectURL(e),setTimeout(function(){n.revokeObjectURL(i.href)},4e4),setTimeout(function(){a(i)},0))}:"msSaveOrOpenBlob"in navigator?function(e,t,r){if(t=t||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(i(e,r),t);else if(o(e))f(e,t,r);else{var n=document.createElement("a");n.href=e,n.target="_blank",setTimeout(function(){a(n)})}}:function(e,t,r,n){if(n=n||open("","_blank"),n&&(n.document.title=n.document.body.innerText="downloading..."),"string"==typeof e)return f(e,t,r);var i="application/octet-stream"===e.type,o=/constructor/i.test(p.HTMLElement)||p.safari,a=/CriOS\/[\d]+/.test(navigator.userAgent);if((a||i&&o||h)&&"undefined"!=typeof FileReader){var s=new FileReader;s.onloadend=function(){var e=s.result;e=a?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),n?n.location.href=e:location=e,n=null},s.readAsDataURL(e)}else{var l=p.URL||p.webkitURL,u=l.createObjectURL(e);n?n.location=u:location.href=u,n=null,setTimeout(function(){l.revokeObjectURL(u)},4e4)}});p.saveAs=s.saveAs=s,true&&(e.exports=s)})?n.apply(t,[]):n)||(e.exports=n)},277:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});const n="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g},730:(e,t,r)=>{"use strict";r.d(t,{Z:()=>o});t=r(277);e=r.hmd(e);var r="object"==typeof exports&&exports&&!exports.nodeType&&exports,n=r&&e&&!e.nodeType&&e,i=n&&n.exports===r&&t.Z.process;const o=function(){try{var e=n&&n.require&&n.require("util").types;return e?e:i&&i.binding&&i.binding("util")}catch(e){}}()},627:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isBoolean=t.isArray=t.isString=t.isPositiveInteger=t.isInteger=t.isNumber=t.isValidClearValue=t.isValidTextureType=t.validTextureTypes=t.isValidTextureFormat=t.validTextureFormats=t.isValidWrap=t.validWraps=t.isValidFilter=t.validFilters=t.isValidDataType=t.validDataTypes=t.validArrayTypes=void 0;r=r(738);function n(e){return!isNaN(e)}function i(e){return n(e)&&e%1==0}function o(e){return Array.isArray(e)}t.validArrayTypes=[Float32Array,Uint8Array,Int8Array,Uint16Array,Int16Array,Uint32Array,Int32Array,Array],t.validDataTypes=[r.HALF_FLOAT,r.FLOAT,r.UNSIGNED_BYTE,r.BYTE,r.UNSIGNED_SHORT,r.SHORT,r.UNSIGNED_INT,r.INT],t.isValidDataType=function(e){return-1<t.validDataTypes.indexOf(e)},t.validFilters=[r.LINEAR,r.NEAREST],t.isValidFilter=function(e){return-1<t.validFilters.indexOf(e)},t.validWraps=[r.CLAMP_TO_EDGE,r.REPEAT],t.isValidWrap=function(e){return-1<t.validWraps.indexOf(e)},t.validTextureFormats=[r.RGB,r.RGBA],t.isValidTextureFormat=function(e){return-1<t.validTextureFormats.indexOf(e)},t.validTextureTypes=[r.UNSIGNED_BYTE],t.isValidTextureType=function(e){return-1<t.validTextureTypes.indexOf(e)},t.isValidClearValue=function(e,t){if(o(e)){if(e.length!==t)return!1;for(var r=0;r<e.length;r++)if(!n(e[r]))return!1}else if(!n(e))return!1;return!0},t.isNumber=n,t.isInteger=i,t.isPositiveInteger=function(e){return i(e)&&0<e},t.isString=function(e){return"string"==typeof e},t.isArray=o,t.isBoolean=function(e){return"boolean"==typeof e}},738:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_CIRCLE_NUM_SEGMENTS=t.DATA_LAYER_VECTOR_FIELD_PROGRAM_NAME=t.DATA_LAYER_LINES_PROGRAM_NAME=t.DATA_LAYER_POINTS_PROGRAM_NAME=t.SEGMENT_PROGRAM_NAME=t.DEFAULT_W_UV_NORMAL_PROGRAM_NAME=t.DEFAULT_W_NORMAL_PROGRAM_NAME=t.DEFAULT_W_UV_PROGRAM_NAME=t.DEFAULT_PROGRAM_NAME=t.INT_4D_UNIFORM=t.INT_3D_UNIFORM=t.INT_2D_UNIFORM=t.INT_1D_UNIFORM=t.FLOAT_4D_UNIFORM=t.FLOAT_3D_UNIFORM=t.FLOAT_2D_UNIFORM=t.FLOAT_1D_UNIFORM=t.GLSL1=t.GLSL3=t.RGBA=t.RGB=t.CLAMP_TO_EDGE=t.REPEAT=t.NEAREST=t.LINEAR=t.BOOL=t.INT=t.UNSIGNED_INT=t.SHORT=t.UNSIGNED_SHORT=t.BYTE=t.UNSIGNED_BYTE=t.FLOAT=t.HALF_FLOAT=void 0,t.HALF_FLOAT="HALF_FLOAT",t.FLOAT="FLOAT",t.UNSIGNED_BYTE="UNSIGNED_BYTE",t.BYTE="BYTE",t.UNSIGNED_SHORT="UNSIGNED_SHORT",t.SHORT="SHORT",t.UNSIGNED_INT="UNSIGNED_INT",t.INT="INT",t.BOOL="BOOL",t.LINEAR="LINEAR",t.NEAREST="NEAREST",t.REPEAT="REPEAT",t.CLAMP_TO_EDGE="CLAMP_TO_EDGE",t.RGB="RGB",t.RGBA="RGBA",t.GLSL3="300 es",t.GLSL1="100",t.FLOAT_1D_UNIFORM="1f",t.FLOAT_2D_UNIFORM="2f",t.FLOAT_3D_UNIFORM="3f",t.FLOAT_4D_UNIFORM="3f",t.INT_1D_UNIFORM="1i",t.INT_2D_UNIFORM="2i",t.INT_3D_UNIFORM="3i",t.INT_4D_UNIFORM="3i",t.DEFAULT_PROGRAM_NAME="DEFAULT",t.DEFAULT_W_UV_PROGRAM_NAME="DEFAULT_W_UV",t.DEFAULT_W_NORMAL_PROGRAM_NAME="DEFAULT_W_NORMAL",t.DEFAULT_W_UV_NORMAL_PROGRAM_NAME="DEFAULT_W_UV_NORMAL",t.SEGMENT_PROGRAM_NAME="SEGMENT",t.DATA_LAYER_POINTS_PROGRAM_NAME="DATA_LAYER_POINTS",t.DATA_LAYER_LINES_PROGRAM_NAME="DATA_LAYER_LINES",t.DATA_LAYER_VECTOR_FIELD_PROGRAM_NAME="DATA_LAYER_VECTOR_FIELD",t.DEFAULT_CIRCLE_NUM_SEGMENTS=18},930:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DataLayer=void 0;var m=r(501),v=r(627),y=r(738),h=r(581),c=r(593),r=(d.calcSize=function(e,t){var r,n;if(isNaN(e)){if(r=e[0],!v.isPositiveInteger(r))throw new Error("Invalid width: "+r+' for DataLayer "'+t+'", must be positive integer.');if(n=e[1],!v.isPositiveInteger(n))throw new Error("Invalid height: "+n+' for DataLayer "'+t+'", must be positive integer.')}else{if(!v.isPositiveInteger(e))throw new Error("Invalid length: "+e+' for DataLayer "'+t+'", must be positive integer.');for(var i,o=1,a=i=e;2<a;)o++,a/=2;r=Math.pow(2,Math.floor(o/2)+o%2),n=Math.pow(2,Math.floor(o/2)),c.inDevMode()&&console.log("Using ["+r+", "+n+"] for 1D array of length "+e+' in DataLayer "'+t+'".')}return{width:r,height:n,length:i}},d.getInternalWrap=function(e){var t=e.gl,r=e.wrap,e=e.name;return c.isWebGL2(t)||r===y.CLAMP_TO_EDGE||c.isWebGL2(t)?r:(console.warn('Falling back to CLAMP_TO_EDGE wrapping for DataLayer "'+e+'" for WebGL 1.'),y.CLAMP_TO_EDGE)},d.getInternalFilter=function(e){var t=e.gl,r=e.errorCallback,n=e.internalType,i=e.name,e=e.filter;return e===y.NEAREST||(n===y.HALF_FLOAT&&(h.getExtension(t,h.OES_TEXTURE_HAlF_FLOAT_LINEAR,r,!0)||h.getExtension(t,h.OES_TEXTURE_FLOAT_LINEAR,r,!0)||(console.warn('Falling back to NEAREST filter for DataLayer "'+i+'".'),e=y.NEAREST)),n===y.FLOAT&&(h.getExtension(t,h.OES_TEXTURE_FLOAT_LINEAR,r,!0)||(console.warn('Falling back to NEAREST filter for DataLayer "'+i+'".'),e=y.NEAREST))),e},d.getInternalType=function(e){var t=e.gl,r=e.errorCallback,n=e.writable,i=e.name,o=e.glslVersion,a=e.type;return d.shouldCastIntTypeAsFloat(e)&&(a=a===y.UNSIGNED_BYTE||a===y.BYTE?y.HALF_FLOAT:(console.warn("Falling back "+a+' type to FLOAT type for glsl1.x support for DataLayer "'+i+'".\nLarge UNSIGNED_INT or INT with absolute value > 16,777,216 are not supported, on mobile UNSIGNED_INT, INT, UNSIGNED_SHORT, and SHORT with absolute value > 2,048 may not be supported.'),y.FLOAT)),c.isWebGL2(t)||(a===y.FLOAT&&(h.getExtension(t,h.OES_TEXTURE_FLOAT,r,!0)||(console.warn('FLOAT not supported, falling back to HALF_FLOAT type for DataLayer "'+i+'".'),a=y.HALF_FLOAT),n&&(d.testFramebufferWrite({gl:t,type:a,glslVersion:o})||a===y.HALF_FLOAT||(console.warn('FLOAT not supported for writing operations, falling back to HALF_FLOAT type for DataLayer "'+i+'".'),a=y.HALF_FLOAT))),a===y.HALF_FLOAT&&(h.getExtension(t,h.OES_TEXTURE_HALF_FLOAT,r),n&&(d.testFramebufferWrite({gl:t,type:a,glslVersion:o})||r("This browser does not support rendering to HALF_FLOAT textures.")))),n&&c.isWebGL2(t)&&(a===y.HALF_FLOAT||a===y.FLOAT)&&h.getExtension(t,h.EXT_COLOR_BUFFER_FLOAT,r),a},d.shouldCastIntTypeAsFloat=function(e){var t=e.gl,r=e.type;return(e.glslVersion!==y.GLSL3||!c.isWebGL2(t))&&(r===y.BYTE||r===y.SHORT||r===y.INT||r===y.UNSIGNED_SHORT||r===y.UNSIGNED_INT)},d.getGLTextureParameters=function(e){var t,r,n,i,o=e.gl,a=e.errorCallback,s=e.name,l=e.numComponents,u=e.internalType,f=e.writable,p=e.glslVersion;if(c.isWebGL2(o)){if(3===(i=l)&&f&&(i=4),u===y.FLOAT||u===y.HALF_FLOAT)switch(i){case 1:r=o.RED;break;case 2:r=o.RG;break;case 3:r=o.RGB;break;case 4:r=o.RGBA;break;default:throw new Error("Unsupported glNumChannels: "+i+' for DataLayer "'+s+'".')}else if(p===y.GLSL1&&u===y.UNSIGNED_BYTE)switch(i){case 1:if(!f){r=o.ALPHA;break}case 2:if(!f){r=o.LUMINANCE_ALPHA;break}case 3:r=o.RGB,i=3;break;case 4:r=o.RGBA,i=4;break;default:throw new Error("Unsupported glNumChannels: "+i+' for DataLayer "'+s+'".')}else switch(i){case 1:r=o.RED_INTEGER;break;case 2:r=o.RG_INTEGER;break;case 3:r=o.RGB_INTEGER;break;case 4:r=o.RGBA_INTEGER;break;default:throw new Error("Unsupported glNumChannels: "+i+' for DataLayer "'+s+'".')}switch(u){case y.HALF_FLOAT:switch(t=o.HALF_FLOAT,i){case 1:n=o.R16F;break;case 2:n=o.RG16F;break;case 3:n=o.RGB16F;break;case 4:n=o.RGBA16F;break;default:throw new Error("Unsupported glNumChannels: "+i+' for DataLayer "'+s+'".')}break;case y.FLOAT:switch(t=o.FLOAT,i){case 1:n=o.R32F;break;case 2:n=o.RG32F;break;case 3:n=o.RGB32F;break;case 4:n=o.RGBA32F;break;default:throw new Error("Unsupported glNumChannels: "+i+' for DataLayer "'+s+'".')}break;case y.UNSIGNED_BYTE:if(t=o.UNSIGNED_BYTE,p===y.GLSL1&&u===y.UNSIGNED_BYTE)n=r;else switch(i){case 1:n=o.R8UI;break;case 2:n=o.RG8UI;break;case 3:n=o.RGB8UI;break;case 4:n=o.RGBA8UI;break;default:throw new Error("Unsupported glNumChannels: "+i+' for DataLayer "'+s+'".')}break;case y.BYTE:switch(t=o.BYTE,i){case 1:n=o.R8I;break;case 2:n=o.RG8I;break;case 3:n=o.RGB8I;break;case 4:n=o.RGBA8I;break;default:throw new Error("Unsupported glNumChannels: "+i+' for DataLayer "'+s+'".')}break;case y.SHORT:switch(t=o.SHORT,i){case 1:n=o.R16I;break;case 2:n=o.RG16I;break;case 3:n=o.RGB16I;break;case 4:n=o.RGBA16I;break;default:throw new Error("Unsupported glNumChannels: "+i+' for DataLayer "'+s+'".')}break;case y.UNSIGNED_SHORT:switch(t=o.UNSIGNED_SHORT,i){case 1:n=o.R16UI;break;case 2:n=o.RG16UI;break;case 3:n=o.RGB16UI;break;case 4:n=o.RGBA16UI;break;default:throw new Error("Unsupported glNumChannels: "+i+' for DataLayer "'+s+'".')}break;case y.INT:switch(t=o.INT,i){case 1:n=o.R32I;break;case 2:n=o.RG32I;break;case 3:n=o.RGB32I;break;case 4:n=o.RGBA32I;break;default:throw new Error("Unsupported glNumChannels: "+i+' for DataLayer "'+s+'".')}break;case y.UNSIGNED_INT:switch(t=o.UNSIGNED_INT,i){case 1:n=o.R32UI;break;case 2:n=o.RG32UI;break;case 3:n=o.RGB32UI;break;case 4:n=o.RGBA32UI;break;default:throw new Error("Unsupported glNumChannels: "+i+' for DataLayer "'+s+'".')}break;default:throw new Error("Unsupported type: "+u+' for DataLayer "'+s+'".')}}else{switch(l){case 1:if(!f){r=o.ALPHA,n=o.ALPHA,i=1;break}case 2:if(!f){r=o.LUMINANCE_ALPHA,n=o.LUMINANCE_ALPHA,i=2;break}case 3:r=o.RGB,n=o.RGB,i=3;break;case 4:r=o.RGBA,n=o.RGBA,i=4;break;default:throw new Error("Unsupported numComponents: "+l+' for DataLayer "'+s+'".')}switch(u){case y.FLOAT:t=o.FLOAT;break;case y.HALF_FLOAT:t=o.HALF_FLOAT||h.getExtension(o,h.OES_TEXTURE_HALF_FLOAT,a).HALF_FLOAT_OES;break;case y.UNSIGNED_BYTE:t=o.UNSIGNED_BYTE;break;default:throw new Error("Unsupported type: "+u+' in WebGL 1.0 for DataLayer "'+s+'".')}}if(void 0===t||void 0===r||void 0===n){e=[];throw void 0===t&&e.push("glType"),void 0===r&&e.push("glFormat"),void 0===n&&e.push("glInternalFormat"),new Error("Invalid type: "+u+" for numComponents: "+l+", unable to init parameter"+(1<e.length?"s":"")+" "+e.join(", ")+' for DataLayer "'+s+'".')}if(void 0===i||l<1||4<l||i<l)throw new Error("Invalid numChannels: "+i+" for numComponents: "+l+' for DataLayer "'+s+'".');return{glFormat:r,glInternalFormat:n,glType:t,glNumChannels:i}},d.testFramebufferWrite=function(e){var t=e.gl,r=e.type,n=e.glslVersion,i=t.createTexture();if(!i)return!1;t.bindTexture(t.TEXTURE_2D,i);var o=t[y.CLAMP_TO_EDGE],a=t[y.CLAMP_TO_EDGE],e=t[y.NEAREST];t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,o),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,a),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,e);e=d.getGLTextureParameters({gl:t,name:"testFramebufferWrite",numComponents:1,writable:!0,internalType:r,glslVersion:n,errorCallback:function(){}}),r=e.glInternalFormat,n=e.glFormat,e=e.glType;t.texImage2D(t.TEXTURE_2D,0,r,100,100,0,n,e,null);n=t.createFramebuffer();if(!n)return t.deleteTexture(i),!1;t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0);e=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.deleteTexture(i),t.deleteFramebuffer(n),e},Object.defineProperty(d.prototype,"bufferIndex",{get:function(){return this._bufferIndex},enumerable:!1,configurable:!0}),d.prototype.saveCurrentStateToDataLayer=function(e){if(this.numBuffers<2)throw new Error("Can't call DataLayer.saveCurrentStateToDataLayer on DataLayer \""+this.name+'" with less than 2 buffers.');if(!this.writable)throw new Error("Can't call DataLayer.saveCurrentStateToDataLayer on read-only DataLayer \""+this.name+'".');if(e.writable)throw new Error("Can't call DataLayer.saveCurrentStateToDataLayer on DataLayer \""+this.name+'" using writable DataLayer "'+e.name+'".');if(e.glWrapS!==this.glWrapS||e.glWrapT!==this.glWrapT||e.wrapS!==this.wrapS||e.wrapT!==this.wrapT||e.width!==this.width||e.height!==this.height||e.glFilter!==this.glFilter||e.filter!==this.filter||e.glNumChannels!==this.glNumChannels||e.numComponents!==this.numComponents||e.glType!==this.glType||e.type!==this.type||e.glFormat!==this.glFormat||e.glInternalFormat!==this.glInternalFormat)throw new Error('Incompatible texture params between DataLayers "'+e.name+'" and "'+this.name+'".');if(!this.textureOverrides){this.textureOverrides=[];for(var t=0;t<this.numBuffers;t++)this.textureOverrides.push(void 0)}if(this.textureOverrides[this.bufferIndex])throw new Error("Can't call DataLayer.saveCurrentStateToDataLayer on DataLayer \""+this.name+'", this DataLayer has not written new state since last call to DataLayer.saveCurrentStateToDataLayer.');var r=this.currentState;this.textureOverrides[this.bufferIndex]=r,this.buffers[this.bufferIndex].texture=e.currentState,e._setCurrentStateTexture(r);var n=this.glcompute.gl,e=this.buffers[this.bufferIndex],r=e.framebuffer,e=e.texture;if(!r)throw new Error('No framebuffer for writable DataLayer "'+this.name+'".');n.bindFramebuffer(n.FRAMEBUFFER,r),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0),n.bindFramebuffer(n.FRAMEBUFFER,null)},d.prototype._setCurrentStateTexture=function(e){if(this.writable)throw new Error("Can't call DataLayer._setCurrentStateTexture on writable texture \""+this.name+'".');this.buffers[this.bufferIndex].texture=e},d.prototype.validateDataArray=function(e){var t=this,r=t.numComponents,n=t.glNumChannels,i=(t.type,t.internalType),o=t.width,a=t.height,t=this._length;if(e.length!==o*a*r&&(!t||e.length!==t*r))throw new Error("Invalid data length: "+e.length+' for DataLayer "'+this.name+'" of '+(t?"length "+t+" and ":"")+"dimensions: ["+o+", "+a+"] and numComponents: "+r+".");var s=!1;switch(e.constructor){case Array:s=!0;break;case Float32Array:s=i!==y.FLOAT;break;case Uint8Array:s=i!==y.UNSIGNED_BYTE;break;case Int8Array:s=i!==y.BYTE;break;case Uint16Array:s=i!==y.UNSIGNED_SHORT;break;case Int16Array:s=i!==y.SHORT;break;case Uint32Array:s=i!==y.UNSIGNED_INT;break;case Int32Array:s=i!==y.INT;break;default:throw new Error("Invalid array type: "+e.constructor.name+' for DataLayer "'+this.name+'", please use one of ['+v.validArrayTypes.map(function(e){return e.name}).join(", ")+"].")}var l=o*a*n,a=e.length!==l,u=i===y.HALF_FLOAT,f=e;if(s||a||u){switch(i){case y.HALF_FLOAT:f=new Uint16Array(l);break;case y.FLOAT:f=new Float32Array(l);break;case y.UNSIGNED_BYTE:f=new Uint8Array(l);break;case y.BYTE:f=new Int8Array(l);break;case y.UNSIGNED_SHORT:f=new Uint16Array(l);break;case y.SHORT:f=new Int16Array(l);break;case y.UNSIGNED_INT:f=new Uint32Array(l);break;case y.INT:f=new Int32Array(l);break;default:throw new Error('Error initing DataLayer "'+this.name+'", unsupported internalType: '+i+".")}for(var p=u?new DataView(f.buffer):null,h=0,c=e.length/r;h<c;h++)for(var d=0;d<r;d++){var _=e[h*r+d],g=h*n+d;u?m.setFloat16(p,2*g,_,!0):f[g]=_}}return f},d.prototype.initBuffers=function(e){for(var t=this,r=t.name,n=t.numBuffers,i=t.glcompute,o=t.glInternalFormat,a=t.glFormat,s=t.glType,l=t.glFilter,u=t.glWrapS,f=t.glWrapT,p=t.writable,h=t.width,c=t.height,d=i.gl,_=i.errorCallback,g=e?this.validateDataArray(e):void 0,m=0;m<n;m++){var v=d.createTexture();if(!v)return void _('Could not init texture for DataLayer "'+r+'": '+d.getError()+".");d.bindTexture(d.TEXTURE_2D,v),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,u),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,f),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,l),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,l),d.texImage2D(d.TEXTURE_2D,0,o,h,c,0,a,s,g||null);var y={texture:v};if(p){var A=d.createFramebuffer();if(!A)return void _('Could not init framebuffer for DataLayer "'+r+'": '+d.getError()+".");d.bindFramebuffer(d.FRAMEBUFFER,A),d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,v,0);v=d.checkFramebufferStatus(d.FRAMEBUFFER);v!=d.FRAMEBUFFER_COMPLETE&&_('Invalid status for framebuffer for DataLayer "'+r+'": '+v+"."),y.framebuffer=A}this.buffers.push(y)}d.bindTexture(d.TEXTURE_2D,null),d.bindFramebuffer(d.FRAMEBUFFER,null)},d.prototype.getStateAtIndex=function(e){if(e<0||e>=this.numBuffers)throw new Error("Invalid buffer index: "+e+' for DataLayer "'+this.name+'" with '+this.numBuffers+" buffer"+(1<this.numBuffers?"s":"")+".");return this.textureOverrides&&this.textureOverrides[e]?this.textureOverrides[e]:this.buffers[e].texture},Object.defineProperty(d.prototype,"currentState",{get:function(){return this.getStateAtIndex(this.bufferIndex)},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"lastState",{get:function(){if(1===this.numBuffers)throw new Error('Cannot access lastState on DataLayer "'+this.name+'" with only one buffer.');return this.getStateAtIndex((this.bufferIndex-1+this.numBuffers)%this.numBuffers)},enumerable:!1,configurable:!0}),d.prototype._usingTextureOverrideForCurrentBuffer=function(){return this.textureOverrides&&this.textureOverrides[this.bufferIndex]},d.prototype._bindOutputBufferForWrite=function(e){e&&(this._bufferIndex=(this.bufferIndex+1)%this.numBuffers),this._bindOutputBuffer(),this.textureOverrides&&(this.textureOverrides[this.bufferIndex]=void 0)},d.prototype._bindOutputBuffer=function(){var e=this.glcompute.gl,t=this.buffers[this.bufferIndex].framebuffer;if(!t)throw new Error('DataLayer "'+this.name+'" is not writable.');e.bindFramebuffer(e.FRAMEBUFFER,t)},d.prototype.setFromArray=function(e,t){void 0===t&&(t=!1);for(var r=this,n=r.glcompute,i=r.glInternalFormat,o=r.glFormat,a=r.glType,s=r.numBuffers,l=r.width,u=r.height,r=r.bufferIndex,f=n.gl,p=this.validateDataArray(e),h=t?s:r+1,c=t?0:r;c<h;c++){var d=this.getStateAtIndex(c);f.bindTexture(f.TEXTURE_2D,d),f.texImage2D(f.TEXTURE_2D,0,i,l,u,0,o,a,p)}f.bindTexture(f.TEXTURE_2D,null)},d.prototype.resize=function(e,t){var r=this.name;this.glcompute.verboseLogging&&console.log('Resizing DataLayer "'+r+'" to '+JSON.stringify(e)+".");var n=d.calcSize(e,r),e=n.length,r=n.width,n=n.height;this._length=e,this._width=r,this._height=n,this.destroyBuffers(),this.initBuffers(t)},Object.defineProperty(d.prototype,"clearValue",{get:function(){return this._clearValue},set:function(e){var t=this.numComponents;if(!v.isValidClearValue(e,t))throw new Error("Invalid clearValue: "+JSON.stringify(e)+' for DataLayer "'+this.name+'", expected number or array of number of length '+t+".");this._clearValue=e},enumerable:!1,configurable:!0}),d.prototype.clear=function(e){void 0===e&&(e=!1);var t=this,r=t.name,n=t.glcompute,i=(t.clearValue,t.numBuffers),o=t.bufferIndex,a=t.numComponents;n.verboseLogging&&console.log('Clearing DataLayer "'+r+'".');for(var s=e?i:o+1,l=e?0:o;l<s;l++)if(this.writable)switch(a){case 1:case 2:case 3:case 4:break;default:throw new Error("Invalid numComponents: "+a+' for DataLayer "'+this.name+'".')}},Object.defineProperty(d.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"length",{get:function(){if(!this._length)throw new Error('Cannot access length on 2D DataLayer "'+this.name+'".');return this._length},enumerable:!1,configurable:!0}),d.prototype.destroyBuffers=function(){var e=this.glcompute,t=this.buffers,n=e.gl;t.forEach(function(e){var t=e.framebuffer,r=e.texture;n.deleteTexture(r),t&&n.deleteFramebuffer(t),delete e.texture,delete e.framebuffer}),t.length=0,delete this.textureOverrides},d.prototype.dispose=function(){var e=this.name;this.glcompute.verboseLogging&&console.log('Destroying DataLayer "'+e+'".'),this.destroyBuffers(),delete this.glcompute},d.prototype.clone=function(){return this.glcompute.cloneDataLayer(this)},d);function d(e,t){this._bufferIndex=0,this.buffers=[];var r=t.name,n=t.dimensions,i=t.type,o=t.numComponents,a=t.array,s=e.gl,l=e.errorCallback,u=e.glslVersion;if(this.glcompute=e,this.name=r,!v.isPositiveInteger(o)||4<o)throw new Error("Invalid numComponents: "+o+' for DataLayer "'+r+'".');this.numComponents=o;var f=void 0!==t.clearValue?t.clearValue:0;this.clearValue=f;var p=!!t.writable;this.writable=p;var h=d.calcSize(n,r),e=h.length,f=h.width,n=h.height;if(this._length=e,!v.isPositiveInteger(f))throw new Error("Invalid width: "+f+' for DataLayer "'+r+'".');if(this._width=f,!v.isPositiveInteger(n))throw new Error("Invalid length: "+n+' for DataLayer "'+r+'".');this._height=n;h=!e&&(i===y.FLOAT||i==y.HALF_FLOAT)?y.LINEAR:y.NEAREST,f=void 0!==t.filter?t.filter:h;if(!v.isValidFilter(f))throw new Error("Invalid filter: "+f+' for DataLayer "'+r+'", must be one of ['+v.validFilters.join(", ")+"].");if(f===y.LINEAR&&i!==y.FLOAT&&i!=y.HALF_FLOAT)throw new Error('LINEAR filtering is not supported on integer types, please use NEAREST filtering for DataLayer "'+r+'" with type: '+i+".");this.filter=f;n=void 0!==t.wrapS?t.wrapS:y.CLAMP_TO_EDGE;if(!v.isValidWrap(n))throw new Error("Invalid wrapS: "+n+' for DataLayer "'+r+'", must be one of ['+v.validWraps.join(", ")+"].");this.wrapS=n;e=void 0!==t.wrapT?t.wrapT:y.CLAMP_TO_EDGE;if(!v.isValidWrap(e))throw new Error("Invalid wrapT: "+e+' for DataLayer "'+r+'", must be one of ['+v.validWraps.join(", ")+"].");if(this.wrapT=e,!v.isValidDataType(i))throw new Error("Invalid type: "+i+' for DataLayer "'+r+'", must be one of ['+v.validDataTypes.join(", ")+"].");this.type=i;h=d.getInternalType({gl:s,type:i,glslVersion:u,writable:p,name:r,errorCallback:l});this.internalType=h;i=d.getGLTextureParameters({gl:s,name:r,numComponents:o,writable:p,internalType:h,glslVersion:u,errorCallback:l}),o=i.glFormat,p=i.glInternalFormat,u=i.glType,i=i.glNumChannels;this.glInternalFormat=p,this.glFormat=o,this.glType=u,this.glNumChannels=i,this.internalFilter=d.getInternalFilter({gl:s,filter:f,internalType:h,name:r,errorCallback:l}),this.glFilter=s[this.internalFilter],this.internalWrapS=d.getInternalWrap({gl:s,wrap:n,name:r}),this.glWrapS=s[this.internalWrapS],this.internalWrapT=d.getInternalWrap({gl:s,wrap:e,name:r}),this.glWrapT=s[this.internalWrapT];t=void 0!==t.numBuffers?t.numBuffers:1;if(!v.isPositiveInteger(t))throw new Error("Invalid numBuffers: "+t+' for DataLayer "'+r+'", must be positive integer.');this.numBuffers=t,this.initBuffers(a)}t.DataLayer=r},664:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GPUProgram=void 0;var f=r(627),p=r(738),h=r(593),r=(c.convertDefinesToString=function(e){for(var t="",r=Object.keys(e),n=0;n<r.length;n++){var i=r[n];if(!f.isString(i)||!f.isString(e[i]))throw new Error("GPUProgram defines must be passed in as key value pairs that are both strings, got key value pair of type ["+typeof i+" : "+typeof e[i]+"].");t+="#define "+i+" "+e[i]+"\n"}return t},c.prototype.recompile=function(e){var t=this.glcompute,r=this.name,n=this.fragmentShaderSource,i=t.gl,o=t.errorCallback,t=t.verboseLogging,a=!1;if(e)for(var s=Object.keys(e),l=0;l<s.length;l++){var u=s[l];this.defines[u]!==e[u]&&(a=!0,this.defines[u]=e[u])}if(!this.fragmentShader||a){if(!n)throw new Error('Unable to recompile fragment shader for program "'+r+'" because fragment shader is already compiled, no source available.');t&&console.log('Compiling fragment shader "'+r+'" with defines '+JSON.stringify(this.defines));t=c.convertDefinesToString(this.defines),i=h.compileShader(i,o,""+t+n,i.FRAGMENT_SHADER,r);i?this.fragmentShader=i:o('Unable to compile fragment shader for program "'+r+'".')}},c.prototype.initProgram=function(e,t){var r=this.glcompute,n=this.fragmentShader,i=this.uniforms,o=r.gl,r=r.errorCallback,a=o.createProgram();if(a){if(o.attachShader(a,n),o.attachShader(a,e),o.linkProgram(a),o.getProgramParameter(a,o.LINK_STATUS)){for(var s=Object.keys(i),l=0;l<s.length;l++){var u=s[l],f=i[u],p=f.value,f=f.type;this.setProgramUniform(a,t,u,p,f)}return a}r('Program "'+this.name+'" failed to link: '+o.getProgramInfoLog(a))}else r("Unable to init gl program: "+this.name+".")},c.prototype.getProgramWithName=function(e){if(this.programs[e])return this.programs[e];var t=this.glcompute,r=t.errorCallback,n=t._vertexShaders[e];if(void 0===n.shader){var i=this.glcompute,o=this.name,t=i.gl,i=i._preprocessVertShader(n.src);if(""===i)throw new Error("No source for vertex shader "+this.name+" : "+o);n.defines&&(i=c.convertDefinesToString(n.defines)+i);t=h.compileShader(t,r,i,t.VERTEX_SHADER,o);if(!t)return void r('Unable to compile default vertex shader for program "'+o+'".');n.shader=t}n=this.initProgram(n.shader,p.DEFAULT_PROGRAM_NAME);if(void 0!==n)return this.programs[e]=n;r('Unable to init program "'+e+'".')},Object.defineProperty(c.prototype,"defaultProgram",{get:function(){return this.getProgramWithName(p.DEFAULT_PROGRAM_NAME)},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"defaultProgramWithUV",{get:function(){return this.getProgramWithName(p.DEFAULT_W_UV_PROGRAM_NAME)},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"defaultProgramWithNormal",{get:function(){return this.getProgramWithName(p.DEFAULT_W_NORMAL_PROGRAM_NAME)},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"defaultProgramWithUVNormal",{get:function(){return this.getProgramWithName(p.DEFAULT_W_UV_NORMAL_PROGRAM_NAME)},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"segmentProgram",{get:function(){return this.getProgramWithName(p.SEGMENT_PROGRAM_NAME)},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"dataLayerPointsProgram",{get:function(){return this.getProgramWithName(p.DATA_LAYER_POINTS_PROGRAM_NAME)},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"dataLayerVectorFieldProgram",{get:function(){return this.getProgramWithName(p.DATA_LAYER_VECTOR_FIELD_PROGRAM_NAME)},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"dataLayerLinesProgram",{get:function(){return this.getProgramWithName(p.DATA_LAYER_LINES_PROGRAM_NAME)},enumerable:!1,configurable:!0}),c.prototype.uniformInternalTypeForValue=function(e,t){if(t===p.FLOAT){if(f.isArray(e)){for(var r=0;r<e.length;r++)if(!f.isNumber(e[r]))throw new Error("Invalid uniform value: "+e+' for program "'+this.name+'", expected float or float[] of length 1-4.')}else if(!f.isNumber(e))throw new Error("Invalid uniform value: "+e+' for program "'+this.name+'", expected float or float[] of length 1-4.');if(!f.isArray(e)||1===e.length)return p.FLOAT_1D_UNIFORM;if(2===e.length)return p.FLOAT_2D_UNIFORM;if(3===e.length)return p.FLOAT_3D_UNIFORM;if(4===e.length)return p.FLOAT_4D_UNIFORM;throw new Error("Invalid uniform value: "+e+' for program "'+this.name+'", expected float or float[] of length 1-4.')}if(t===p.INT){if(f.isArray(e)){for(r=0;r<e.length;r++)if(!f.isInteger(e[r]))throw new Error("Invalid uniform value: "+e+' for program "'+this.name+'", expected int or int[] of length 1-4.')}else if(!f.isInteger(e))throw new Error("Invalid uniform value: "+e+' for program "'+this.name+'", expected int or int[] of length 1-4.');if(!f.isArray(e)||1===e.length)return p.INT_1D_UNIFORM;if(2===e.length)return p.INT_2D_UNIFORM;if(3===e.length)return p.INT_3D_UNIFORM;if(4===e.length)return p.INT_4D_UNIFORM;throw new Error("Invalid uniform value: "+e+' for program "'+this.name+'", expected int or int[] of length 1-4.')}if(t!==p.BOOL)throw new Error("Invalid uniform type: "+t+' for program "'+this.name+'", expected '+p.FLOAT+" or "+p.INT+" of "+p.BOOL+".");if(f.isBoolean(e))return p.INT_1D_UNIFORM;throw new Error("Invalid uniform value: "+e+' for program "'+this.name+'", expected boolean.')},c.prototype.setProgramUniform=function(e,t,r,n,i){var o=this.glcompute,a=this.uniforms,s=o.gl,l=o.errorCallback;s.useProgram(e);var u=null===(o=a[r])||void 0===o?void 0:o.location[t];if(void 0===u){e=s.getUniformLocation(e,r);if(!e)return void l('Could not init uniform "'+r+'" for program "'+this.name+'".\nCheck that uniform is present in shader code, unused uniforms may be removed by compiler.\nAlso check that uniform type in shader code matches type '+i+".\nError code: "+s.getError()+".");u=e,a[r]&&(a[r].location[t]=u)}switch(i){case p.FLOAT_1D_UNIFORM:s.uniform1f(u,n);break;case p.FLOAT_2D_UNIFORM:s.uniform2fv(u,n);break;case p.FLOAT_3D_UNIFORM:s.uniform3fv(u,n);break;case p.FLOAT_4D_UNIFORM:s.uniform4fv(u,n);break;case p.INT_1D_UNIFORM:f.isBoolean(n)?s.uniform1i(u,n?1:0):s.uniform1i(u,n);break;case p.INT_2D_UNIFORM:s.uniform2iv(u,n);break;case p.INT_3D_UNIFORM:s.uniform3iv(u,n);break;case p.INT_4D_UNIFORM:s.uniform4iv(u,n);break;default:throw new Error("Unknown uniform type "+i+' for GPUProgram "'+this.name+'".')}},c.prototype.setUniform=function(e,t,r){var n,i=this.programs,o=this.uniforms,a=this.glcompute.verboseLogging,s=null===(n=o[e])||void 0===n?void 0:n.type;if(r){r=this.uniformInternalTypeForValue(t,r);if(void 0===s)s=r;else if(s!==r)throw new Error('Uniform "'+e+'" for GPUProgram "'+this.name+'" cannot change from type '+s+" to type "+r+".")}if(void 0===s)throw new Error('Unknown type for uniform "'+e+'", please pass in type to GPUProgram.setUniform(name, value, type) when initing a new uniform.');if(o[e]){if(o[e].value===t)return;o[e].value=t}else o[e]={type:s,location:{},value:t};a&&console.log('Setting uniform "'+e+'" for program "'+this.name+'" to value '+JSON.stringify(t)+" with type "+s+".");for(var l=Object.keys(i),u=0;u<l.length;u++){var f=l[u];this.setProgramUniform(i[f],f,e,t,s)}},c.prototype.setVertexUniform=function(t,e,r,n){var i=this,o=this.uniformInternalTypeForValue(r,n);if(void 0===t)throw new Error("Must pass in valid WebGLProgram to setVertexUniform, got undefined.");n=Object.keys(this.programs).find(function(e){return i.programs[e]===t});if(!n)throw new Error('Could not find valid vertex programName for WebGLProgram "'+this.name+'".');this.setProgramUniform(t,n,e,r,o)},c.prototype.dispose=function(){var t=this,e=this.glcompute,r=this.fragmentShader,n=this.programs,i=e.gl;e.verboseLogging&&console.log('Destroying program "'+name+'".'),Object.values(n).forEach(function(e){i.deleteProgram(e)}),Object.keys(this.programs).forEach(function(e){delete t.programs[e]}),i.deleteShader(r),delete this.fragmentShader,delete this.glcompute},c);function c(e,t){this.uniforms={},this.defines={},this.programs={};var r=t.name,n=t.fragmentShader,i=t.uniforms,t=t.defines;if(this.glcompute=e,this.name=r,"string"==typeof n||"string"==typeof n[0]?(r="string"==typeof n?n:n.join("\n"),this.fragmentShaderSource=r):this.fragmentShader=n,this.recompile(t),i)for(var o=0;o<(null==i?void 0:i.length);o++){var a=i[o],s=a.name,l=a.value,a=a.type;this.setUniform(s,l,a)}}t.GPUProgram=r},404:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Vector4=void 0;var r=(Object.defineProperty(n.prototype,"width",{get:function(){return this.z},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this.w},enumerable:!1,configurable:!0}),n.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},n);function n(e,t,r,n){void 0===t&&(t=0),void 0===r&&(r=0),void 0===n&&(n=1),this.x=e=void 0===e?0:e,this.y=t,this.z=r,this.w=n}t.Vector4=r},215:function(e,t,s){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.WebGLCompute=void 0;var g=s(162),m=s(809),l=s(930),R=s(738),i=s(664),r=s(404),v=s(593),T=s(501),y=s(627),u=s(726),o=(a.initWithThreeRenderer=function(e,t,r){return new a(n({canvas:e.domElement,context:e.getContext()},t),r,e)},a.prototype.preprocessShader=function(e){return e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace("#version 300 es\n","")).replace(/precision \w+ isampler2D;*\n/g,"")).replace(/precision \w+ usampler2D;*\n/g,"")).replace(/uvec2/g,"vec2")).replace(/uvec3/g,"vec3")).replace(/uvec4/g,"vec4")).replace(/usampler2D/g,"sampler2D")).replace(/ivec2/g,"vec2")).replace(/ivec3/g,"vec3")).replace(/ivec4/g,"vec4")).replace(/isampler2D/g,"sampler2D")).replace(/texture\(/g,"texture2D(")},a.prototype._preprocessFragShader=function(e){return this.glslVersion===R.GLSL3?e:e=(e=(e=(e=this.preprocessShader(e)).replace(/\nin\s+/,"\nvarying ")).replace(/out \w+ out_fragOut;\n/,"")).replace(/out_fragOut\s+=/,"gl_FragColor =")},a.prototype._preprocessVertShader=function(e){return this.glslVersion===R.GLSL3?e:e=(e=(e=this.preprocessShader(e)).replace(/\nin\s+/g,"\nattribute ")).replace(/\nout\s+/g,"\nvarying ")},Object.defineProperty(a.prototype,"singleColorProgram",{get:function(){var e;return void 0===this._singleColorProgram&&(e=this.initProgram({name:"singleColor",fragmentShader:this._preprocessFragShader(s(805))}),this._singleColorProgram=e),this._singleColorProgram},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"singleColorWithWrapCheckProgram",{get:function(){var e;return void 0===this._singleColorWithWrapCheckProgram&&(e=this.initProgram({name:"singleColorWithWrapCheck",fragmentShader:this._preprocessFragShader(s(674))}),this._singleColorWithWrapCheckProgram=e),this._singleColorWithWrapCheckProgram},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"vectorMagnitudeProgram",{get:function(){var e;return void 0===this._vectorMagnitudeProgram&&(e=this.initProgram({name:"vectorMagnitude",fragmentShader:this._preprocessFragShader(s(850))}),this._vectorMagnitudeProgram=e),this._vectorMagnitudeProgram},enumerable:!1,configurable:!0}),a.prototype.isWebGL2=function(){return v.isWebGL2(this.gl)},Object.defineProperty(a.prototype,"quadPositionsBuffer",{get:function(){var e;return void 0===this._quadPositionsBuffer&&(e=new Float32Array([-1,-1,1,-1,-1,1,1,1]),this._quadPositionsBuffer=this.initVertexBuffer(e)),this._quadPositionsBuffer},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"boundaryPositionsBuffer",{get:function(){var e;return void 0===this._boundaryPositionsBuffer&&(e=new Float32Array([-1,-1,1,-1,1,1,-1,1,-1,-1]),this._boundaryPositionsBuffer=this.initVertexBuffer(e)),this._boundaryPositionsBuffer},enumerable:!1,configurable:!0}),a.prototype.getCirclePositionsBuffer=function(e){if(null==this._circlePositionsBuffer[e]){for(var t=[0,0],r=0;r<=e;r++)t.push(Math.cos(2*Math.PI*r/e),Math.sin(2*Math.PI*r/e));var n=new Float32Array(t),n=this.initVertexBuffer(n);this._circlePositionsBuffer[e]=n}return this._circlePositionsBuffer[e]},a.prototype.initVertexBuffer=function(e){var t=this.errorCallback,r=this.gl,n=r.createBuffer();if(n)return r.bindBuffer(r.ARRAY_BUFFER,n),r.bufferData(r.ARRAY_BUFFER,e,r.STATIC_DRAW),n;t("Unable to allocate gl buffer.")},a.prototype.initProgram=function(t){var r=["name","fragmentShader","uniforms","defines"];return Object.keys(t).forEach(function(e){if(r.indexOf(e)<0)throw new Error('Invalid key "'+e+'" passed to WebGLCompute.initProgram with name "'+t.name+'".  Valid keys are '+r.join(", ")+".")}),new i.GPUProgram(this,t)},a.prototype.initDataLayer=function(t){var r=["name","dimensions","type","numComponents","array","filter","wrapS","wrapT","writable","numBuffers","clearValue"];return Object.keys(t).forEach(function(e){if(r.indexOf(e)<0)throw new Error('Invalid key "'+e+'" passed to WebGLCompute.initDataLayer with name "'+t.name+'".  Valid keys are '+r.join(", ")+".")}),new l.DataLayer(this,t)},a.prototype.cloneDataLayer=function(t){var r=0;try{r=t.length}catch(e){r=[t.width,t.height]}var e=t.writable?void 0:this.getValues(t),n=this.initDataLayer({name:t.name+"-clone",dimensions:r,type:t.type,numComponents:t.numComponents,array:e,filter:t.filter,wrapS:t.wrapS,wrapT:t.wrapT,writable:t.writable,numBuffers:t.numBuffers});if(t.writable){for(var i=0;i<t.numBuffers-1;i++)this.step({program:this.copyProgramForType(t.type),input:t.getStateAtIndex((t.bufferIndex+i+1)%t.numBuffers),output:n});this.step({program:this.copyProgramForType(t.type),input:t.currentState,output:n})}return n},a.prototype.initTexture=function(t){var r=["name","url","filter","wrapS","wrapT","format","type","onLoad"];Object.keys(t).forEach(function(e){if(r.indexOf(e)<0)throw new Error('Invalid key "'+e+'" passed to WebGLCompute.initTexture with name "'+t.name+'".  Valid keys are '+r.join(", ")+".")});var e=t.url,n=t.name;if(!y.isString(e))throw new Error("Expected WebGLCompute.initTexture params to have url of type string, got "+e+" of type "+typeof e+".");if(!y.isString(n))throw new Error("Expected WebGLCompute.initTexture params to have name of type string, got "+n+" of type "+typeof n+".");var i=void 0!==t.filter?t.filter:R.NEAREST;if(!y.isValidFilter(i))throw new Error("Invalid filter: "+i+' for DataLayer "'+n+'", must be '+y.validFilters.join(", ")+".");var o=void 0!==t.wrapS?t.wrapS:R.CLAMP_TO_EDGE;if(!y.isValidWrap(o))throw new Error("Invalid wrapS: "+o+' for DataLayer "'+n+'", must be '+y.validWraps.join(", ")+".");var a=void 0!==t.wrapT?t.wrapT:R.CLAMP_TO_EDGE;if(!y.isValidWrap(a))throw new Error("Invalid wrapT: "+a+' for DataLayer "'+n+'", must be '+y.validWraps.join(", ")+".");var s=void 0!==t.format?t.format:R.RGBA;if(!y.isValidTextureFormat(s))throw new Error("Invalid format: "+s+' for DataLayer "'+n+'", must be '+y.validTextureFormats.join(", ")+".");var l=void 0!==t.type?t.type:R.UNSIGNED_BYTE;if(!y.isValidTextureType(l))throw new Error("Invalid type: "+l+' for DataLayer "'+n+'", must be '+y.validTextureTypes.join(", ")+".");var u=this.gl,f=this.errorCallback,p=u.createTexture();if(null===p)throw new Error("Unable to init glTexture.");u.bindTexture(u.TEXTURE_2D,p);var h=u.RGBA,c=u[s],d=u[l],l=new Uint8Array([0,0,0,0]);u.texImage2D(u.TEXTURE_2D,0,h,1,1,0,c,d,l);var _=new Image;return _.onload=function(){u.bindTexture(u.TEXTURE_2D,p),u.texImage2D(u.TEXTURE_2D,0,h,c,d,_),v.isPowerOf2(_.width)&&v.isPowerOf2(_.height)||console.warn("Texture "+n+" dimensions ["+_.width+", "+_.height+"] are not power of 2."),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u[o]),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u[a]),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u[i]),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u[i]),t.onLoad&&t.onLoad(p)},_.onerror=function(e){f("Error loading image "+n+": "+e)},_.src=e,p},a.prototype.onResize=function(e){var t=e.clientWidth,r=e.clientHeight;e.width=t,e.height=r,this.width=t,this.height=r},a.prototype.drawSetup=function(e,t,r,n){var i=this.gl;if(e){var o=[];if(r)if(r.constructor===WebGLTexture)o.push(r);else if(r.constructor===l.DataLayer)o.push(r.currentState);else for(var a=0;a<r.length;a++){var s=r[a];o.push(s.getCurrentStateTexture?s.currentState:s)}this.setOutputLayer(t,r,n),i.useProgram(e);for(a=0;a<o.length;a++)i.activeTexture(i.TEXTURE0+a),i.bindTexture(i.TEXTURE_2D,o[a])}},a.prototype.copyProgramForType=function(e){switch(e){case R.HALF_FLOAT:case R.FLOAT:return this.copyFloatProgram;case R.UNSIGNED_BYTE:case R.UNSIGNED_SHORT:case R.UNSIGNED_INT:return this.copyUintProgram;case R.BYTE:case R.SHORT:case R.INT:return this.copyIntProgram;default:throw new Error("Invalid type: "+e+" passed to WebGLCompute.copyProgramForType.")}},a.prototype.setBlendMode=function(e){var t=this.gl;e&&(t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA))},a.prototype.addLayerToInputs=function(e,t){var r=t;return y.isArray(r)?r.indexOf(e)<0&&r.push(e):r!==e?(t=r,r=[],t&&r.push(t),r.push(e)):r=[r],r},a.prototype.passThroughLayerDataFromInputToOutput=function(e){var t=this.copyProgramForType(e.internalType);this.step({program:t,input:e,output:e})},a.prototype.setOutputLayer=function(e,t,r){var n=this.gl;if(r){if(t&&(t===r||y.isArray(t)&&-1<t.indexOf(r))){if(1===r.numBuffers)throw new Error("Cannot use same buffer for input and output of a program. Try increasing the number of buffers in your output layer to at least 2 so you can render to nextState using currentState as an input.");e?r._bindOutputBufferForWrite(!0):(this.passThroughLayerDataFromInputToOutput(r),r._bindOutputBufferForWrite(!1))}else e||r._usingTextureOverrideForCurrentBuffer()&&this.passThroughLayerDataFromInputToOutput(r),r._bindOutputBufferForWrite(!1);var i=r.width,o=r.height;n.viewport(0,0,i,o)}else{n.bindFramebuffer(n.FRAMEBUFFER,null);i=this.width,o=this.height;n.viewport(0,0,i,o)}},a.prototype.setPositionAttribute=function(e,t){this.setVertexAttribute(e,"a_internal_position",2,t)},a.prototype.setIndexAttribute=function(e,t){this.setVertexAttribute(e,"a_internal_index",1,t)},a.prototype.setUVAttribute=function(e,t){this.setVertexAttribute(e,"a_internal_uv",2,t)},a.prototype.setVertexAttribute=function(e,t,r,n){var i=this.gl,e=i.getAttribLocation(e,t);if(e<0)throw new Error('Unable to find vertex attribute "'+t+'" in program "'+n+'".');i.vertexAttribPointer(e,r,i.FLOAT,!1,0,0),i.enableVertexAttribArray(e)},a.prototype.step=function(e){var t=this.gl,r=this.errorState,n=this.quadPositionsBuffer,i=e.program,o=e.input,a=e.output;r||(r=i.defaultProgram,this.drawSetup(r,!0,o,a),i.setVertexUniform(r,"u_internal_scale",[1,1],R.FLOAT),i.setVertexUniform(r,"u_internal_translation",[0,0],R.FLOAT),t.bindBuffer(t.ARRAY_BUFFER,n),this.setPositionAttribute(r,i.name),this.setBlendMode(e.shouldBlendAlpha),t.drawArrays(t.TRIANGLE_STRIP,0,4),t.disable(t.BLEND))},a.prototype.stepBoundary=function(e){var t=this.gl,r=this.errorState,n=this.boundaryPositionsBuffer,i=e.program,o=e.input,a=e.output,s=(a||this).width,l=(a||this).height;if(!r){r=i.defaultProgram;this.drawSetup(r,!1,o,a);l=[1/s,1/l];if(i.setVertexUniform(r,"u_internal_scale",[1-l[0],1-l[1]],R.FLOAT),i.setVertexUniform(r,"u_internal_translation",l,R.FLOAT),t.bindBuffer(t.ARRAY_BUFFER,n),this.setPositionAttribute(r,i.name),this.setBlendMode(e.shouldBlendAlpha),e.singleEdge)switch(e.singleEdge){case"LEFT":t.drawArrays(t.LINES,3,2);break;case"RIGHT":t.drawArrays(t.LINES,1,2);break;case"TOP":t.drawArrays(t.LINES,2,2);break;case"BOTTOM":t.drawArrays(t.LINES,0,2);break;default:throw new Error("Unknown boundary edge type: "+e.singleEdge+".")}else t.drawArrays(t.LINE_LOOP,0,4);t.disable(t.BLEND)}},a.prototype.stepNonBoundary=function(e){var t=this.gl,r=this.errorState,n=this.quadPositionsBuffer,i=e.program,o=e.input,a=e.output,s=(a||this).width,l=(a||this).height;r||(r=i.defaultProgram,this.drawSetup(r,!1,o,a),i.setVertexUniform(r,"u_internal_scale",[1-2*(l=[1/s,1/l])[0],1-2*l[1]],R.FLOAT),i.setVertexUniform(r,"u_internal_translation",l,R.FLOAT),t.bindBuffer(t.ARRAY_BUFFER,n),this.setPositionAttribute(r,i.name),this.setBlendMode(e.shouldBlendAlpha),t.drawArrays(t.TRIANGLE_STRIP,0,4),t.disable(t.BLEND))},a.prototype.stepCircle=function(e){var t=this.gl,r=this.errorState,n=this.width,i=this.height,o=e.program,a=e.position,s=e.radius,l=e.input,u=e.output;if(!r){r=o.defaultProgram;this.drawSetup(r,!1,l,u),o.setVertexUniform(r,"u_internal_scale",[2*s/n,2*s/i],R.FLOAT),o.setVertexUniform(r,"u_internal_translation",[2*a[0]/n-1,2*a[1]/i-1],R.FLOAT);i=e.numSegments||R.DEFAULT_CIRCLE_NUM_SEGMENTS;if(i<3)throw new Error("numSegments for WebGLCompute.stepCircle must be greater than 2, got "+i+".");t.bindBuffer(t.ARRAY_BUFFER,this.getCirclePositionsBuffer(i)),this.setPositionAttribute(r,o.name),this.setBlendMode(e.shouldBlendAlpha),t.drawArrays(t.TRIANGLE_FAN,0,i+2),t.disable(t.BLEND)}},a.prototype.stepSegment=function(e){var t=this.gl,r=this.errorState,n=e.program,i=e.position1,o=e.position2,a=e.thickness,s=e.input,l=e.output,u=(l||this).width,f=(l||this).height;if(!r){r=n.segmentProgram;this.drawSetup(r,!1,s,l),n.setVertexUniform(r,"u_internal_halfThickness",a/2,R.FLOAT),n.setVertexUniform(r,"u_internal_scale",[2/u,2/f],R.FLOAT);l=i[0]-o[0],u=i[1]-o[1],f=Math.atan2(u,l);n.setVertexUniform(r,"u_internal_rotation",f,R.FLOAT);f=(i[0]+o[0])/2,o=(i[1]+o[1])/2;n.setVertexUniform(r,"u_internal_translation",[2*f/this.width-1,2*o/this.height-1],R.FLOAT);l=Math.sqrt(l*l+u*u),u=e.numCapSegments?2*e.numCapSegments:R.DEFAULT_CIRCLE_NUM_SEGMENTS;if(e.endCaps){if(u<6||u%6!=0)throw new Error("numSegments for WebGLCompute.stepSegment must be divisible by 6, got "+u+".");n.setVertexUniform(r,"u_internal_length",l-a*Math.sin(Math.PI/u),R.FLOAT),t.bindBuffer(t.ARRAY_BUFFER,this.getCirclePositionsBuffer(u))}else n.setVertexUniform(r,"u_internal_length",l-a,R.FLOAT),t.bindBuffer(t.ARRAY_BUFFER,this.quadPositionsBuffer);this.setPositionAttribute(r,n.name),this.setBlendMode(e.shouldBlendAlpha),e.endCaps?t.drawArrays(t.TRIANGLE_FAN,0,u+2):t.drawArrays(t.TRIANGLE_STRIP,0,4),t.disable(t.BLEND)}},a.prototype.stepPolyline=function(e){var t=e.program,r=e.input,n=e.output,i=e.positions,o=!!e.closeLoop,a=this.gl,s=this.width,l=this.height;if(!this.errorState){for(var u,f,p,h,c,d=e.thickness/2,_=o?4*i.length+2:4*(i.length-1),g=new Float32Array(2*_),m=e.includeUVs?new Float32Array(2*_):void 0,v=e.includeNormals?new Float32Array(2*_):void 0,y=[0,0],A=[0,0],T=[0,0],b=[0,0],E=[0,0],w=0;w<i.length;w++)!o&&w===i.length-1||(p=i[w],u=i[(w+1)%i.length],y[0]=u[0]-p[0],y[1]=u[1]-p[1],h=Math.sqrt(y[0]*y[0]+y[1]*y[1]),T[0]=y[1]/h,T[1]=-y[0]/h,f=4*w+2,o||0!==w||(g[0]=p[0]+T[0]*d,g[1]=p[1]+T[1]*d,g[2]=p[0]-T[0]*d,g[3]=p[1]-T[1]*d,m&&(m[0]=0,m[1]=1,m[2]=0,m[3]=0),v&&(v[0]=T[0],v[1]=T[1],v[2]=T[0],v[3]=T[1])),c=(w+1)/(i.length-1),g[2*f]=u[0]+T[0]*d,g[2*f+1]=u[1]+T[1]*d,g[2*f+2]=u[0]-T[0]*d,g[2*f+3]=u[1]-T[1]*d,m&&(m[2*f]=c,m[2*f+1]=1,m[2*f+2]=c,m[2*f+3]=0),v&&(v[2*f]=T[0],v[2*f+1]=T[1],v[2*f+2]=T[0],v[2*f+3]=T[1]),(w<i.length-2||o)&&(h=i[(w+1)%i.length],p=i[(w+2)%i.length],A[0]=p[0]-h[0],A[1]=p[1]-h[1],p=Math.sqrt(A[0]*A[0]+A[1]*A[1]),b[0]=A[1]/p,b[1]=-A[0]/p,g[(2+f)%(4*i.length)*2]=h[0]+b[0]*d,g[(2+f)%(4*i.length)*2+1]=h[1]+b[1]*d,g[(2+f)%(4*i.length)*2+2]=h[0]-b[0]*d,g[(2+f)%(4*i.length)*2+3]=h[1]-b[1]*d,m&&(m[(2+f)%(4*i.length)*2]=c,m[(2+f)%(4*i.length)*2+1]=1,m[(2+f)%(4*i.length)*2+2]=c,m[(2+f)%(4*i.length)*2+3]=0),v&&(v[(2+f)%(4*i.length)*2]=b[0],v[(2+f)%(4*i.length)*2+1]=b[1],v[(2+f)%(4*i.length)*2+2]=b[0],v[(2+f)%(4*i.length)*2+3]=b[1]),h=T[0]*b[1]-T[1]*b[0],Math.abs(h)<1e-6||(E[0]=T[0]+b[0],E[1]=T[1]+b[1],c=Math.sqrt(E[0]*E[0]+E[1]*E[1]),E[0]/=c,E[1]/=c,c=Math.acos(T[0]*b[0]+T[1]*b[1]),c=d/Math.cos(c/2),h<0?(g[2*f]=u[0]+E[0]*c,g[2*f+1]=u[1]+E[1]*c,g[(2+f)%(4*i.length)*2]=g[2*f],g[(2+f)%(4*i.length)*2+1]=g[2*f+1]):(g[2*f+2]=u[0]-E[0]*c,g[2*f+3]=u[1]-E[1]*c,g[(2+f)%(4*i.length)*2+2]=g[2*f+2],g[(2+f)%(4*i.length)*2+3]=g[2*f+3]))));o&&(g[8*i.length]=g[0],g[8*i.length+1]=g[1],g[8*i.length+2]=g[2],g[8*i.length+3]=g[3],m&&(m[8*i.length]=m[0],m[8*i.length+1]=m[1],m[8*i.length+2]=m[2],m[8*i.length+3]=m[3]),v&&(v[8*i.length]=v[0],v[8*i.length+1]=v[1],v[8*i.length+2]=v[2],v[8*i.length+3]=v[3]));var L=m?v?t.defaultProgramWithUVNormal:t.defaultProgramWithUV:v?t.defaultProgramWithNormal:t.defaultProgram;this.drawSetup(L,!1,r,n),t.setVertexUniform(L,"u_internal_scale",[2/s,2/l],R.FLOAT),t.setVertexUniform(L,"u_internal_translation",[-1,-1],R.FLOAT),a.bindBuffer(a.ARRAY_BUFFER,this.initVertexBuffer(g)),this.setPositionAttribute(L,t.name),m&&(a.bindBuffer(a.ARRAY_BUFFER,this.initVertexBuffer(m)),this.setUVAttribute(L,t.name)),v&&(a.bindBuffer(a.ARRAY_BUFFER,this.initVertexBuffer(v)),this.setVertexAttribute(L,"a_internal_normal",2,t.name)),this.setBlendMode(e.shouldBlendAlpha),a.drawArrays(a.TRIANGLE_STRIP,0,_),a.disable(a.BLEND)}},a.prototype.stepTriangleStrip=function(e){var t,r=e.program,n=e.input,i=e.output,o=e.positions,a=e.uvs,s=e.normals,l=this.gl,u=this.width,f=this.height;this.errorState||(t=a?s?r.defaultProgramWithUVNormal:r.defaultProgramWithUV:s?r.defaultProgramWithNormal:r.defaultProgram,this.drawSetup(t,!1,n,i),r.setVertexUniform(t,"u_internal_scale",[2/u,2/f],R.FLOAT),r.setVertexUniform(t,"u_internal_translation",[-1,-1],R.FLOAT),l.bindBuffer(l.ARRAY_BUFFER,this.initVertexBuffer(o)),this.setPositionAttribute(t,r.name),a&&(l.bindBuffer(l.ARRAY_BUFFER,this.initVertexBuffer(a)),this.setUVAttribute(t,r.name)),s&&(l.bindBuffer(l.ARRAY_BUFFER,this.initVertexBuffer(s)),this.setVertexAttribute(t,"a_internal_normal",2,r.name)),o=e.count||o.length/2,this.setBlendMode(e.shouldBlendAlpha),l.drawArrays(l.TRIANGLE_STRIP,0,o),l.disable(l.BLEND))},a.prototype.stepLines=function(e){var t=this.gl,r=this.errorState,n=this.width,i=this.height,o=e.indices,a=e.uvs,s=e.normals,l=e.input,u=e.output,f=e.program;if(!r){if(e.closeLoop&&o)throw new Error("WebGLCompute.stepLines() can't be called with closeLoop == true and indices.");r=a?s?f.defaultProgramWithUVNormal:f.defaultProgramWithUV:s?f.defaultProgramWithNormal:f.defaultProgram;this.drawSetup(r,!1,l,u);var p=e.count||(o?o.length:e.positions.length/2);if(f.setVertexUniform(r,"u_internal_scale",[2/n,2/i],R.FLOAT),f.setVertexUniform(r,"u_internal_translation",[-1,-1],R.FLOAT),o){for(var h=new Float32Array(2*p),c=0;c<p;c++){var d=o[c];h[2*c]=e.positions[2*d],h[2*c+1]=e.positions[2*d+1]}t.bindBuffer(t.ARRAY_BUFFER,this.initVertexBuffer(h))}else t.bindBuffer(t.ARRAY_BUFFER,this.initVertexBuffer(e.positions));this.setPositionAttribute(r,f.name),a&&(t.bindBuffer(t.ARRAY_BUFFER,this.initVertexBuffer(a)),this.setUVAttribute(r,f.name)),s&&(t.bindBuffer(t.ARRAY_BUFFER,this.initVertexBuffer(s)),this.setVertexAttribute(r,"a_internal_normal",2,f.name)),this.setBlendMode(e.shouldBlendAlpha),e.indices?t.drawArrays(t.LINES,0,p):e.closeLoop?t.drawArrays(t.LINE_LOOP,0,p):t.drawArrays(t.LINE_STRIP,0,p),t.disable(t.BLEND)}},a.prototype.drawLayerAsPoints=function(e){var t=this,r=t.gl,n=t.errorState,i=t.pointIndexArray,o=t.width,a=t.height,s=e.positions,l=e.output;if(!n){if(2!==s.numComponents&&4!==s.numComponents)throw new Error('WebGLCompute.drawPoints() must be passed a position DataLayer with either 2 or 4 components, got position DataLayer "'+s.name+'" with '+s.numComponents+" components.");var u=s.length,f=e.count||u;if(u<f)throw new Error("Invalid count "+f+" for position DataLayer of length "+u+".");t=e.program;void 0===t&&(t=this.singleColorProgram,p=e.color||[1,0,0],t.setUniform("u_color",p,R.FLOAT));var n=t.dataLayerPointsProgram,p=this.addLayerToInputs(s,e.input);this.drawSetup(n,!1,p,l),t.setVertexUniform(n,"u_internal_positions",p.indexOf(s),R.INT),t.setVertexUniform(n,"u_internal_scale",[1/o,1/a],R.FLOAT),t.setVertexUniform(n,"u_internal_positionWithAccumulation",4===s.numComponents?1:0,R.INT);a=e.pointSize||1;t.setVertexUniform(n,"u_internal_pointSize",a,R.FLOAT);s=[s.width,s.height];t.setVertexUniform(n,"u_internal_positionsDimensions",s,R.FLOAT),t.setVertexUniform(n,"u_internal_wrapX",e.wrapX?1:0,R.INT),t.setVertexUniform(n,"u_internal_wrapY",e.wrapY?1:0,R.INT),(void 0===this.pointIndexBuffer||i&&i.length<f)&&(u=v.initSequentialFloatArray(u),this.pointIndexArray=u,this.pointIndexBuffer=this.initVertexBuffer(u)),r.bindBuffer(r.ARRAY_BUFFER,this.pointIndexBuffer),this.setIndexAttribute(n,t.name),this.setBlendMode(e.shouldBlendAlpha),r.drawArrays(r.POINTS,0,f),r.disable(r.BLEND)}},a.prototype.drawLayerAsLines=function(e){var t=this.gl,r=this.errorState,n=this.width,i=this.height,o=e.positions,a=e.output;if(!r){if(2!==o.numComponents&&4!==o.numComponents)throw new Error('WebGLCompute.drawLayerAsLines() must be passed a position DataLayer with either 2 or 4 components, got position DataLayer "'+o.name+'" with '+o.numComponents+" components.");if(e.closeLoop&&e.indices)throw new Error("WebGLCompute.drawLayerAsLines() can't be called with closeLoop == true and indices.");var s=e.program;void 0===s&&(s=e.wrapX||e.wrapY?this.singleColorWithWrapCheckProgram:this.singleColorProgram,l=e.color||[1,0,0],s.setUniform("u_color",l,R.FLOAT));var r=s.dataLayerLinesProgram,l=this.addLayerToInputs(o,e.input);this.drawSetup(r,!1,l,a);var u=e.indices||v.initSequentialFloatArray(e.count||o.length),f=e.count||u.length;s.setVertexUniform(r,"u_internal_positions",l.indexOf(o),R.INT),s.setVertexUniform(r,"u_internal_scale",[1/n,1/i],R.FLOAT),s.setVertexUniform(r,"u_internal_positionWithAccumulation",4===o.numComponents?1:0,R.INT);o=[o.width,o.height];if(s.setVertexUniform(r,"u_internal_positionsDimensions",o,R.FLOAT),s.setVertexUniform(r,"u_internal_wrapX",e.wrapX?1:0,R.INT),s.setVertexUniform(r,"u_internal_wrapY",e.wrapY?1:0,R.INT),void 0===this.indexedLinesIndexBuffer){var p=void 0;if(u.constructor!==Float32Array){for(var p=new Float32Array(u.length),h=0;h<f;h++)p[h]=u[h];console.warn("Converting indices array of type "+u.constructor+" to Float32Array in WebGLCompute.drawIndexedLines for WebGL compatibility, you may want to use a Float32Array to store this information so the conversion is not required.")}else p=u;this.indexedLinesIndexBuffer=this.initVertexBuffer(p)}else t.bindBuffer(t.ARRAY_BUFFER,this.indexedLinesIndexBuffer),t.bufferData(t.ARRAY_BUFFER,u,t.STATIC_DRAW);this.setIndexAttribute(r,s.name),this.setBlendMode(e.shouldBlendAlpha),e.indices?t.drawArrays(t.LINES,0,f):e.closeLoop?t.drawArrays(t.LINE_LOOP,0,f):t.drawArrays(t.LINE_STRIP,0,f),t.disable(t.BLEND)}},a.prototype.drawLayerAsVectorField=function(e){var t=this,r=t.gl,n=t.errorState,i=t.vectorFieldIndexArray,o=t.width,a=t.height,s=e.data,l=e.output;if(!n){if(2!==s.numComponents)throw new Error('WebGLCompute.drawLayerAsVectorField() must be passed a fieldLayer with 2 components, got fieldLayer "'+s.name+'" with '+s.numComponents+" components.");t=e.program;void 0===t&&(t=this.singleColorProgram,u=e.color||[1,0,0],t.setUniform("u_color",u,R.FLOAT));var n=t.dataLayerVectorFieldProgram,u=this.addLayerToInputs(s,e.input);this.drawSetup(n,!1,u,l),t.setVertexUniform(n,"u_internal_vectors",u.indexOf(s),R.INT);s=e.vectorScale||1;t.setVertexUniform(n,"u_internal_scale",[s/o,s/a],R.FLOAT);s=e.vectorSpacing||10,s=[Math.floor(o/s),Math.floor(a/s)];t.setVertexUniform(n,"u_internal_dimensions",s,R.FLOAT);s=2*s[0]*s[1];(void 0===this.vectorFieldIndexBuffer||i&&i.length<s)&&(i=v.initSequentialFloatArray(s),this.vectorFieldIndexArray=i,this.vectorFieldIndexBuffer=this.initVertexBuffer(i)),r.bindBuffer(r.ARRAY_BUFFER,this.vectorFieldIndexBuffer),this.setIndexAttribute(n,t.name),this.setBlendMode(e.shouldBlendAlpha),r.drawArrays(r.LINES,0,s),r.disable(r.BLEND)}},a.prototype.drawLayerMagnitude=function(e){var t,r,n=this.gl,i=this.errorState,o=this.quadPositionsBuffer,a=e.data,s=e.output;i||(t=this.vectorMagnitudeProgram,r=e.color||[1,0,0],t.setUniform("u_color",r,R.FLOAT),i=e.scale||1,t.setUniform("u_scale",i,R.FLOAT),t.setUniform("u_internal_numDimensions",a.numComponents,R.INT),r=t.defaultProgram,i=this.addLayerToInputs(a,e.input),this.drawSetup(r,!0,i,s),t.setVertexUniform(r,"u_internal_data",i.indexOf(a),R.INT),t.setVertexUniform(r,"u_internal_scale",[1,1],R.FLOAT),t.setVertexUniform(r,"u_internal_translation",[0,0],R.FLOAT),n.bindBuffer(n.ARRAY_BUFFER,o),this.setPositionAttribute(r,t.name),this.setBlendMode(e.shouldBlendAlpha),n.drawArrays(n.TRIANGLE_STRIP,0,4),n.disable(n.BLEND))},a.prototype.getContext=function(){return this.gl},a.prototype.getValues=function(e){var t=this.gl,r=this.glslVersion;e._bindOutputBuffer();var n,i=e.width,o=e.height,a=e.glNumChannels,s=e.glType,l=e.glFormat,u=e.internalType;switch(u){case R.HALF_FLOAT:n=void 0!==t.FLOAT?(a=4,l=t.RGBA,s=t.FLOAT,new Float32Array(i*o*a)):new Uint16Array(i*o*a);break;case R.FLOAT:a=4,l=t.RGBA,n=new Float32Array(i*o*a);break;case R.UNSIGNED_BYTE:if(r===R.GLSL1){a=4,l=t.RGBA,n=new Uint8Array(i*o*a);break}a=4,l=t.RGBA_INTEGER,s=t.UNSIGNED_INT,n=new Uint32Array(i*o*a);break;case R.UNSIGNED_SHORT:a=4,l=t.RGBA_INTEGER,s=t.UNSIGNED_INT,n=new Uint32Array(i*o*a);break;case R.UNSIGNED_INT:a=4,l=t.RGBA_INTEGER,n=new Uint32Array(i*o*a);break;case R.BYTE:case R.SHORT:a=4,l=t.RGBA_INTEGER,s=t.INT,n=new Int32Array(i*o*a);break;case R.INT:a=4,l=t.RGBA_INTEGER,n=new Int32Array(i*o*a);break;default:throw new Error("Unsupported internalType "+u+" for getValues().")}if(this.readyToRead()){t.readPixels(0,0,i,o,l,s,n);var f=e.numComponents,p=e.type,h=i*o*f,c=u===R.HALF_FLOAT&&n.constructor===Uint16Array,d=c?new DataView(n.buffer):void 0,_=n;if(u!==p)switch(p){case R.HALF_FLOAT:case R.FLOAT:_=new Float32Array(h);break;case R.UNSIGNED_BYTE:_=new Uint8Array(h);break;case R.BYTE:_=new Int8Array(h);break;case R.UNSIGNED_SHORT:_=new Uint16Array(h);break;case R.SHORT:_=new Int16Array(h);break;case R.UNSIGNED_INT:_=new Uint32Array(h);break;case R.INT:_=new Int32Array(h);break;default:throw new Error("Unsupported type "+p+" for getValues().")}if(c||_!==n||f!==a)for(var g=0,m=i*o;g<m;g++)for(var v=g*a,y=g*f,A=0;A<f;A++)_[y+A]=c?T.getFloat16(d,2*(v+A),!0):n[v+A];return _=_.length!==h?_.slice(0,h):_}throw new Error("Unable to read values from Buffer with status: "+t.checkFramebufferStatus(t.FRAMEBUFFER)+".")},a.prototype.readyToRead=function(){var e=this.gl;return e.checkFramebufferStatus(e.FRAMEBUFFER)==e.FRAMEBUFFER_COMPLETE},a.prototype.savePNG=function(e,t,r){void 0===t&&(t=e.name);var n=this.getValues(e),i=e.width,o=e.height,a=document.createElement("canvas");a.width=i,a.height=o;for(var s=a.getContext("2d"),l=s.getImageData(0,0,i,o),u=l.data,f=e.type===R.FLOAT||e.type===R.HALF_FLOAT,p=0;p<o;p++)for(var h=0;h<i;h++){for(var c=p*i+h,d=(o-1-p)*i+h,_=0;_<e.numComponents;_++)u[4*d+_]=n[e.numComponents*c+_]*(f?255:1);e.numComponents<4&&(u[4*d+3]=255)}s.putImageData(l,0,0),a.toBlob(function(e){e?r?m.changeDpiBlob(e,r).then(function(e){g.saveAs(e,t+".png")}):g.saveAs(e,t+".png"):console.warn("Problem saving PNG, unable to init blob.")},"image/png")},a.prototype.reset=function(){throw new Error("WebGLCompute.reset() not implemented.")},a.prototype.attachDataLayerToThreeTexture=function(e,t){if(!this.renderer)throw new Error("WebGLCompute was not inited with a renderer.");if(1<e.numBuffers)throw new Error('DataLayer "'+e.name+'" contains multiple WebGL textures (one for each buffer) that are flip-flopped during compute cycles, please choose a DataLayer with one buffer.');t=this.renderer.properties.get(t);t.__webglTexture=e.currentState,t.__webglInit=!0},a.prototype.resetThreeState=function(){if(!this.renderer)throw new Error("WebGLCompute was not inited with a renderer.");var e=this.gl,t=this.renderer.getViewport(new r.Vector4);e.viewport(t.x,t.y,t.width,t.height),this.renderer.setRenderTarget(null),this.renderer.resetState()},a.prototype.dispose=function(){var t=this;delete this.renderer,Object.values(this._vertexShaders).forEach(function(e){e.shader&&(t.gl.deleteShader(e.shader),delete e.shader)})},a);function a(e,t,r){void 0===t&&(t=function(e){throw new Error(e)}),this.errorState=!1,this._circlePositionsBuffer={},this._vertexShaders=((a={})[R.DEFAULT_PROGRAM_NAME]={src:u},a[R.DEFAULT_W_UV_PROGRAM_NAME]={src:u,defines:{UV_ATTRIBUTE:"1"}},a[R.DEFAULT_W_NORMAL_PROGRAM_NAME]={src:u,defines:{NORMAL_ATTRIBUTE:"1"}},a[R.DEFAULT_W_UV_NORMAL_PROGRAM_NAME]={src:u,defines:{UV_ATTRIBUTE:"1",NORMAL_ATTRIBUTE:"1"}},a[R.SEGMENT_PROGRAM_NAME]={src:s(680)},a[R.DATA_LAYER_POINTS_PROGRAM_NAME]={src:s(262)},a[R.DATA_LAYER_VECTOR_FIELD_PROGRAM_NAME]={src:s(396)},a[R.DATA_LAYER_LINES_PROGRAM_NAME]={src:s(656)},a),this.verboseLogging=!1;var n=["canvas","context","contextID","contextOptions","glslVersion","verboseLogging"];if(Object.keys(e).forEach(function(e){if(n.indexOf(e)<0)throw new Error('Invalid key "'+e+'" passed to WebGLCompute.constructor.  Valid keys are '+n.join(", ")+".")}),!e.canvas)throw new Error("Must init WebGLCompute with a canvas.");void 0!==e.verboseLogging&&(this.verboseLogging=e.verboseLogging);var i=this;this.errorCallback=function(e){i.errorState||(i.errorState=!0,t(e))};var o=e.canvas,a=e.context;a||(e.contextID&&((a=o.getContext(e.contextID,e.contextOptions))||console.warn("Unable to initialize WebGL context with contextID: "+e.contextID+".")),null!==(a=a||(o.getContext("webgl2",e.contextOptions)||o.getContext("webgl",e.contextOptions)||o.getContext("experimental-webgl",e.contextOptions))))?(v.isWebGL2(a)?v.inDevMode()&&console.log("Using WebGL 2.0 context."):v.inDevMode()&&console.log("Using WebGL 1.0 context."),this.gl=a,this.renderer=r,e=void 0===e.glslVersion?R.GLSL1:e.glslVersion,this.glslVersion=e,v.isWebGL2(a)||e!==R.GLSL3||console.warn("GLSL3.x is incompatible with WebGL1.0 contexts."),a.disable(a.DEPTH_TEST),a.pixelStorei(a.UNPACK_ALIGNMENT,1),this.copyFloatProgram=this.initProgram({name:"copyFloat",fragmentShader:this._preprocessFragShader(s(129)),uniforms:[{name:"u_state",value:0,type:R.INT}]}),e===R.GLSL3?(this.copyIntProgram=this.initProgram({name:"copyInt",fragmentShader:s(548),uniforms:[{name:"u_state",value:0,type:R.INT}]}),this.copyUintProgram=this.initProgram({name:"copyUint",fragmentShader:s(707),uniforms:[{name:"u_state",value:0,type:R.INT}]})):(this.copyIntProgram=this.copyFloatProgram,this.copyUintProgram=this.copyFloatProgram),a.bindBuffer(a.ARRAY_BUFFER,null),this.onResize(o),this.maxNumTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),v.inDevMode()&&console.log(this.maxNumTextures+" textures max.")):this.errorCallback("Unable to initialize WebGL context.")}t.WebGLCompute=o},581:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getExtension=t.EXT_COLOR_BUFFER_FLOAT=t.WEBGL_DEPTH_TEXTURE=t.OES_TEXTURE_HAlF_FLOAT_LINEAR=t.OES_TEXTURE_FLOAT_LINEAR=t.OES_TEXTURE_HALF_FLOAT=t.OES_TEXTURE_FLOAT=void 0;var o={};t.OES_TEXTURE_FLOAT="OES_texture_float",t.OES_TEXTURE_HALF_FLOAT="OES_texture_half_float",t.OES_TEXTURE_FLOAT_LINEAR="OES_texture_float_linear",t.OES_TEXTURE_HAlF_FLOAT_LINEAR="OES_texture_half_float_linear",t.WEBGL_DEPTH_TEXTURE="WEBGL_depth_texture",t.EXT_COLOR_BUFFER_FLOAT="EXT_color_buffer_float",t.getExtension=function(e,t,r,n){if(void 0===n&&(n=!1),void 0!==o[t])return o[t];var i;try{i=e.getExtension(t)}catch(e){}return i?(o[t]=i,console.log("Loaded extension: "+t+".")):(o[t]=!1,console.warn("Unsupported "+(n?"optional ":"")+"extension: "+t+".")),i||n||r("Required extension unsupported by this device / browser: "+t+"."),i}},607:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.isWebGL2Supported=t.WebGLCompute=void 0;var o=r(593);Object.defineProperty(t,"isWebGL2Supported",{enumerable:!0,get:function(){return o.isWebGL2Supported}});var a=r(215);Object.defineProperty(t,"WebGLCompute",{enumerable:!0,get:function(){return a.WebGLCompute}}),o.inDevMode()&&console.log("Running in development mode."),i(r(738),t)},593:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.inDevMode=t.initSequentialFloatArray=t.isPowerOf2=t.isWebGL2Supported=t.isWebGL2=t.compileShader=void 0,t.compileShader=function(e,t,r,n,i){var o=e.createShader(n);return o?(e.shaderSource(o,r),e.compileShader(o),e.getShaderParameter(o,e.COMPILE_STATUS)?o:(t("Could not compile "+(n===e.FRAGMENT_SHADER?"fragment":"vertex")+"\n\t\t\t shader"+(i?' for program "'+i+'"':"")+": "+e.getShaderInfoLog(o)+"."),null)):(t("Unable to init gl shader."),null)},t.isWebGL2=function(e){return"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext},t.isWebGL2Supported=function(){return!!document.createElement("canvas").getContext("webgl2")},t.isPowerOf2=function(e){return 0==(e&e-1)},t.initSequentialFloatArray=function(e){for(var t=new Float32Array(e),r=0;r<e;r++)t[r]=r;return t},t.inDevMode=function(){return!1}},129:e=>{e.exports="#version 300 es\n// These precision definitions are applied to all internal\n// vertex and fragment shaders in this library.\nprecision highp int;\nprecision highp float;\nprecision lowp sampler2D;\nprecision lowp isampler2D;\nprecision lowp usampler2D;\n\nin vec2 v_UV;\n\nuniform sampler2D u_state;\n\nout vec4 out_fragOut;\n\nvoid main() {\n\tout_fragOut = texture(u_state, v_UV);\n}"},548:e=>{e.exports="#version 300 es\n// These precision definitions are applied to all internal\n// vertex and fragment shaders in this library.\nprecision highp int;\nprecision highp float;\nprecision lowp sampler2D;\nprecision lowp isampler2D;\nprecision lowp usampler2D;\n\nin vec2 v_UV;\n\nuniform isampler2D u_state;\n\nout ivec4 out_fragOut;\n\nvoid main() {\n\tout_fragOut = texture(u_state, v_UV);\n}"},707:e=>{e.exports="#version 300 es\n// These precision definitions are applied to all internal\n// vertex and fragment shaders in this library.\nprecision highp int;\nprecision highp float;\nprecision lowp sampler2D;\nprecision lowp isampler2D;\nprecision lowp usampler2D;\n\nin vec2 v_UV;\n\nuniform usampler2D u_state;\n\nout uvec4 out_fragOut;\n\nvoid main() {\n\tout_fragOut = texture(u_state, v_UV);\n}"},656:e=>{e.exports="#version 300 es\n// These precision definitions are applied to all internal\n// vertex and fragment shaders in this library.\nprecision highp int;\nprecision highp float;\nprecision lowp sampler2D;\nprecision lowp isampler2D;\nprecision lowp usampler2D;\n/**\n * Returns accurate MOD when arguments are approximate integers.\n */\nfloat modI(float a, float b) {\n    float m = a - floor((a + 0.5) / b) * b;\n    return floor(m + 0.5);\n}\n\n// Cannot use int vertex attributes: https://stackoverflow.com/questions/27874983/webgl-how-to-use-integer-attributes-in-glsl\nin float a_internal_index; // Index of point.\n\nuniform sampler2D u_internal_positions; // Texture lookup with position data.\nuniform vec2 u_internal_positionsDimensions;\nuniform vec2 u_internal_scale;\n// TODO: remove branching, do these as defines and make separate vert shaders.\nuniform bool u_internal_positionWithAccumulation;\nuniform bool u_internal_wrapX;\nuniform bool u_internal_wrapY;\n\nout vec2 v_UV;\nout vec2 v_lineWrapping; // Use this to test if line is only half wrapped and should not be rendered.\nout float v_index;\n\nvoid main() {\n\t// Calculate a uv based on the point's index attribute.\n\tvec2 particleUV = vec2(\n\t\tmodI(a_internal_index, u_internal_positionsDimensions.x),\n\t\tfloor(floor(a_internal_index + 0.5) / u_internal_positionsDimensions.x)\n\t) / u_internal_positionsDimensions;\n\n\t// Calculate a global uv for the viewport.\n\t// Lookup vertex position and scale to [0, 1] range.\n\t// We have packed a 2D displacement with the position.\n\tvec4 positionData = texture2D(u_internal_positions, particleUV);\n\t// position = first two components plus last two components (optional accumulation buffer).\n\tvec2 positionAbsolute = positionData.rg;\n\tif (u_internal_positionWithAccumulation) positionAbsolute += positionData.ba;\n\tv_UV = positionAbsolute * u_internal_scale;\n\n\t// Wrap if needed.\n\tv_lineWrapping = vec2(0.0);\n\tif (u_internal_wrapX) {\n\t\tif (v_UV.x < 0.0) {\n\t\t\tv_UV.x += 1.0;\n\t\t\tv_lineWrapping.x = 1.0;\n\t\t} else if (v_UV.x > 1.0) {\n\t\t\tv_UV.x -= 1.0;\n\t\t\tv_lineWrapping.x = 1.0;\n\t\t}\n\t}\n\tif (u_internal_wrapY) {\n\t\tif (v_UV.y < 0.0) {\n\t\t\tv_UV.y += 1.0;\n\t\t\tv_lineWrapping.y = 1.0;\n\t\t} else if (v_UV.y > 1.0) {\n\t\t\tv_UV.y -= 1.0;\n\t\t\tv_lineWrapping.y = 1.0;\n\t\t}\n\t}\n\n\t// Calculate position in [-1, 1] range.\n\tvec2 position = v_UV * 2.0 - 1.0;\n\n\tv_index = a_internal_index;\n\tgl_Position = vec4(position, 0, 1);\n}"},262:e=>{e.exports="#version 300 es\n// These precision definitions are applied to all internal\n// vertex and fragment shaders in this library.\nprecision highp int;\nprecision highp float;\nprecision lowp sampler2D;\nprecision lowp isampler2D;\nprecision lowp usampler2D;\n/**\n * Returns accurate MOD when arguments are approximate integers.\n */\nfloat modI(float a, float b) {\n    float m = a - floor((a + 0.5) / b) * b;\n    return floor(m + 0.5);\n}\n\n// Cannot use int vertex attributes: https://stackoverflow.com/questions/27874983/webgl-how-to-use-integer-attributes-in-glsl\nin float a_internal_index; // Index of point.\n\nuniform sampler2D u_internal_positions; // Texture lookup with position data.\nuniform vec2 u_internal_positionsDimensions;\nuniform vec2 u_internal_scale;\nuniform float u_internal_pointSize;\nuniform bool u_internal_positionWithAccumulation;\nuniform bool u_internal_wrapX;\nuniform bool u_internal_wrapY;\n\nout vec2 v_UV;\nout float v_index;\n\nvoid main() {\n\t// Calculate a uv based on the point's index attribute.\n\tvec2 particleUV = vec2(\n\t\tmodI(a_internal_index, u_internal_positionsDimensions.x),\n\t\tfloor(floor(a_internal_index + 0.5) / u_internal_positionsDimensions.x)\n\t) / u_internal_positionsDimensions;\n\n\t// Calculate a global uv for the viewport.\n\t// Lookup vertex position and scale to [0, 1] range.\n\t// We have packed a 2D displacement with the position.\n\tvec4 positionData = texture2D(u_internal_positions, particleUV);\n\t// position = first two components plus last two components (optional accumulation buffer).\n\tvec2 positionAbsolute = positionData.rg;\n\tif (u_internal_positionWithAccumulation) positionAbsolute += positionData.ba;\n\tv_UV = positionAbsolute * u_internal_scale;\n\n\t// Wrap if needed.\n\tif (u_internal_wrapX) {\n\t\tif (v_UV.x < 0.0) v_UV.x += 1.0;\n\t\tif (v_UV.x > 1.0) v_UV.x -= 1.0;\n\t}\n\tif (u_internal_wrapY) {\n\t\tif (v_UV.y < 0.0) v_UV.y += 1.0;\n\t\tif (v_UV.y > 1.0) v_UV.y -= 1.0;\n\t}\n\n\t// Calculate position in [-1, 1] range.\n\tvec2 position = v_UV * 2.0 - 1.0;\n\n\tv_index = a_internal_index;\n\tgl_PointSize = u_internal_pointSize;\n\tgl_Position = vec4(position, 0, 1);\n}"},396:e=>{e.exports="#version 300 es\n// These precision definitions are applied to all internal\n// vertex and fragment shaders in this library.\nprecision highp int;\nprecision highp float;\nprecision lowp sampler2D;\nprecision lowp isampler2D;\nprecision lowp usampler2D;\n/**\n * Returns accurate MOD when arguments are approximate integers.\n */\nfloat modI(float a, float b) {\n    float m = a - floor((a + 0.5) / b) * b;\n    return floor(m + 0.5);\n}\n\n// Cannot use int vertex attributes: https://stackoverflow.com/questions/27874983/webgl-how-to-use-integer-attributes-in-glsl\nint float a_internal_index; // Index of point.\n\nuniform sampler2D u_internal_vectors; // Texture lookup with vector data.\nuniform vec2 u_internal_dimensions;\nuniform vec2 u_internal_scale;\n\nout vec2 v_UV;\nout float v_index;\n\nvoid main() {\n\t// Divide index by 2.\n\tfloat index = floor((a_internal_index + 0.5) / 2.0);\n\t// Calculate a uv based on the vertex index attribute.\n\tv_UV = vec2(\n\t\tmodI(index, u_internal_dimensions.x),\n\t\tfloor(floor(index + 0.5) / u_internal_dimensions.x)\n\t) / u_internal_dimensions;\n\n\t// Add vector displacement if needed.\n\tif (modI(a_internal_index, 2.0) > 0.0) {\n\t\t// Lookup vectorData at current UV.\n\t\tvec2 vectorData = texture2D(u_internal_vectors, v_UV).xy;\n\t\tv_UV += vectorData * u_internal_scale;\n\t}\n\n\t// Calculate position in [-1, 1] range.\n\tvec2 position = v_UV * 2.0 - 1.0;\n\n\tv_index = a_internal_index;\n\tgl_Position = vec4(position, 0, 1);\n}"},726:e=>{e.exports="#version 300 es\n// These precision definitions are applied to all internal\n// vertex and fragment shaders in this library.\nprecision highp int;\nprecision highp float;\nprecision lowp sampler2D;\nprecision lowp isampler2D;\nprecision lowp usampler2D;\n\nin vec2 a_internal_position;\n#ifdef UV_ATTRIBUTE\nin vec2 a_internal_uv;\n#endif\n#ifdef NORMAL_ATTRIBUTE\nin vec2 a_internal_normal;\n#endif\n\nuniform vec2 u_internal_scale;\nuniform vec2 u_internal_translation;\n\nout vec2 v_UV;\nout vec2 v_UV_local;\n#ifdef NORMAL_ATTRIBUTE\nout vec2 v_normal;\n#endif\n\nvoid main() {\n\t// Optional varyings.\n\t#ifdef UV_ATTRIBUTE\n\tv_UV_local = a_internal_uv;\n\t#else\n\tv_UV_local = a_internal_position;\n\t#endif\n\t#ifdef NORMAL_ATTRIBUTE\n\tv_normal = a_internal_normal;\n\t#endif\n\n\t// Apply transformations.\n\tvec2 position = u_internal_scale * a_internal_position + u_internal_translation;\n\n\t// Calculate a global uv for the viewport.\n\tv_UV = 0.5 * (position + 1.0);\n\n\t// Calculate vertex position.\n\tgl_Position = vec4(position, 0, 1);\n}"},680:e=>{e.exports="#version 300 es\n// These precision definitions are applied to all internal\n// vertex and fragment shaders in this library.\nprecision highp int;\nprecision highp float;\nprecision lowp sampler2D;\nprecision lowp isampler2D;\nprecision lowp usampler2D;\n\nin vec2 a_internal_position;\n\nuniform float u_internal_halfThickness;\nuniform vec2 u_internal_scale;\nuniform float u_internal_length;\nuniform float u_internal_rotation;\nuniform vec2 u_internal_translation;\n\nout vec2 v_UV_local;\nout vec2 v_UV;\n\nmat2 rotate2d(float _angle){\n\treturn mat2(cos(_angle), -sin(_angle), sin(_angle), cos(_angle));\n}\n\nvoid main() {\n\t// Calculate UV coordinates of current rendered object.\n\tv_UV_local = 0.5 * (a_internal_position + 1.0);\n\n\tvec2 position = a_internal_position;\n\n\t// Apply thickness / radius.\n\tposition *= u_internal_halfThickness;\n\n\t// Stretch center of shape to form a round-capped line segment.\n\tif (position.x < 0.0) {\n\t\tposition.x -= u_internal_length / 2.0;\n\t\tv_UV_local.x = 0.0; // Set entire cap UV.x to 0.\n\t} else if (position.x > 0.0) {\n\t\tposition.x += u_internal_length / 2.0;\n\t\tv_UV_local.x = 1.0; // Set entire cap UV.x to 1.\n\t}\n\n\t// Apply transformations.\n\tposition = u_internal_scale * (rotate2d(-u_internal_rotation) * position) + u_internal_translation;\n\n\t// Calculate a global uv for the viewport.\n\tv_UV = 0.5 * (position + 1.0);\n\n\t// Calculate vertex position.\n\tgl_Position = vec4(position, 0, 1);\n}"},805:e=>{e.exports="// Fragment shader that draws a single color.\nprecision highp float;\n\nuniform vec3 u_color;\n\nvoid main() {\n\tgl_FragColor = vec4(u_color, 1);\n}"},674:e=>{e.exports="// Fragment shader that draws a single color.\nprecision highp float;\n\nuniform vec3 u_color;\nvarying vec2 v_lineWrapping;\n\nvoid main() {\n\t// check if this line has wrapped.\n\tif ((v_lineWrapping.x != 0.0 && v_lineWrapping.x != 1.0) || (v_lineWrapping.y != 0.0 && v_lineWrapping.y != 1.0)) {\n\t\t// Render nothing.\n\t\tdiscard;\n\t\treturn;\n\t}\n\tgl_FragColor = vec4(u_color, 1);\n}"},850:e=>{e.exports="// Fragment shader that draws the magnitude of a DataLayer.\nprecision highp float;\n\nvarying vec2 v_UV;\n\nuniform vec3 u_color;\nuniform float u_scale;\nuniform sampler2D u_internal_data;\n\nvoid main() {\n\tvec4 value = texture2D(u_internal_data, v_UV);\n\tfloat mag = length(value);\n\tgl_FragColor = vec4(mag * u_scale * u_color, 1);\n}"}},i={},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n(607);function n(e){var t=i[e];if(void 0!==t)return t.exports;t=i[e]={id:e,loaded:!1,exports:{}};return r[e].call(t.exports,t,t.exports,n),t.loaded=!0,t.exports}var r,i});
//# sourceMappingURL=webgl-compute.min.js.map
!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports.WebGLCompute=r():e.WebGLCompute=r()}(self,(function(){return(()=>{var e={501:(e,r,t)=>{"use strict";t.r(r),t.d(r,{Float16Array:()=>Ce,getFloat16:()=>We,hfround:()=>h,setFloat16:()=>je});const n=new ArrayBuffer(4),i=new Float32Array(n),o=new Uint32Array(n),a=new Uint32Array(512),s=new Uint32Array(512);for(let e=0;e<256;++e){const r=e-127;r<-27?(a[0|e]=0,a[256|e]=32768,s[0|e]=24,s[256|e]=24):r<-14?(a[0|e]=1024>>-r-14,a[256|e]=1024>>-r-14|32768,s[0|e]=-r-1,s[256|e]=-r-1):r<=15?(a[0|e]=r+15<<10,a[256|e]=r+15<<10|32768,s[0|e]=13,s[256|e]=13):r<128?(a[0|e]=31744,a[256|e]=64512,s[0|e]=24,s[256|e]=24):(a[0|e]=31744,a[256|e]=64512,s[0|e]=13,s[256|e]=13)}function l(e){i[0]=e;const r=o[0],t=r>>23&511;return a[t]+((8388607&r)>>s[t])}const u=new Uint32Array(2048),f=new Uint32Array(64),c=new Uint32Array(64);u[0]=0;for(let e=1;e<1024;++e){let r=e<<13,t=0;for(;0==(8388608&r);)t-=8388608,r<<=1;r&=-8388609,t+=947912704,u[e]=r|t}for(let e=1024;e<2048;++e)u[e]=939524096+(e-1024<<13);f[0]=0;for(let e=1;e<31;++e)f[e]=e<<23;f[31]=1199570944,f[32]=2147483648;for(let e=33;e<63;++e)f[e]=2147483648+(e-32<<23);f[63]=3347054592,c[0]=0;for(let e=1;e<64;++e)c[e]=32===e?0:1024;function p(e){const r=e>>10;return o[0]=u[c[r]+(1023&e)]+f[r],i[0]}function h(e){if(e=Number(e),!Number.isFinite(e)||0===e)return e;return p(l(e))}var _=t(277),d="object"==typeof self&&self&&self.Object===Object&&self;const m=_.Z||d||Function("return this")();const g=m.Symbol;var v=Object.prototype,A=v.hasOwnProperty,T=v.toString,E=g?g.toStringTag:void 0;const y=function(e){var r=A.call(e,E),t=e[E];try{e[E]=void 0;var n=!0}catch(e){}var i=T.call(e);return n&&(r?e[E]=t:delete e[E]),i};var b=Object.prototype.toString;const w=function(e){return b.call(e)};var U=g?g.toStringTag:void 0;const L=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":U&&U in Object(e)?y(e):w(e)};const R=function(e){var r=typeof e;return null!=e&&("object"==r||"function"==r)};const F=function(e){if(!R(e))return!1;var r=L(e);return"[object Function]"==r||"[object GeneratorFunction]"==r||"[object AsyncFunction]"==r||"[object Proxy]"==r};const P=m["__core-js_shared__"];var O,I=(O=/[^.]+$/.exec(P&&P.keys&&P.keys.IE_PROTO||""))?"Symbol(src)_1."+O:"";const N=function(e){return!!I&&I in e};var G=Function.prototype.toString;const x=function(e){if(null!=e){try{return G.call(e)}catch(e){}try{return e+""}catch(e){}}return""};var S=/^\[object .+?Constructor\]$/,B=Function.prototype,D=Object.prototype,M=B.toString,C=D.hasOwnProperty,V=RegExp("^"+M.call(C).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const k=function(e){return!(!R(e)||N(e))&&(F(e)?V:S).test(x(e))};const W=function(e,r){return null==e?void 0:e[r]};const j=function(e,r){var t=W(e,r);return k(t)?t:void 0};const H=j(Object,"create");const Y=function(){this.__data__=H?H(null):{},this.size=0};const X=function(e){var r=this.has(e)&&delete this.__data__[e];return this.size-=r?1:0,r};var z=Object.prototype.hasOwnProperty;const q=function(e){var r=this.__data__;if(H){var t=r[e];return"__lodash_hash_undefined__"===t?void 0:t}return z.call(r,e)?r[e]:void 0};var K=Object.prototype.hasOwnProperty;const Z=function(e){var r=this.__data__;return H?void 0!==r[e]:K.call(r,e)};const $=function(e,r){var t=this.__data__;return this.size+=this.has(e)?0:1,t[e]=H&&void 0===r?"__lodash_hash_undefined__":r,this};function J(e){var r=-1,t=null==e?0:e.length;for(this.clear();++r<t;){var n=e[r];this.set(n[0],n[1])}}J.prototype.clear=Y,J.prototype.delete=X,J.prototype.get=q,J.prototype.has=Z,J.prototype.set=$;const Q=J;const ee=function(){this.__data__=[],this.size=0};const re=function(e,r){return e===r||e!=e&&r!=r};const te=function(e,r){for(var t=e.length;t--;)if(re(e[t][0],r))return t;return-1};var ne=Array.prototype.splice;const ie=function(e){var r=this.__data__,t=te(r,e);return!(t<0)&&(t==r.length-1?r.pop():ne.call(r,t,1),--this.size,!0)};const oe=function(e){var r=this.__data__,t=te(r,e);return t<0?void 0:r[t][1]};const ae=function(e){return te(this.__data__,e)>-1};const se=function(e,r){var t=this.__data__,n=te(t,e);return n<0?(++this.size,t.push([e,r])):t[n][1]=r,this};function le(e){var r=-1,t=null==e?0:e.length;for(this.clear();++r<t;){var n=e[r];this.set(n[0],n[1])}}le.prototype.clear=ee,le.prototype.delete=ie,le.prototype.get=oe,le.prototype.has=ae,le.prototype.set=se;const ue=le;const fe=j(m,"Map");const ce=function(){this.size=0,this.__data__={hash:new Q,map:new(fe||ue),string:new Q}};const pe=function(e){var r=typeof e;return"string"==r||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==e:null===e};const he=function(e,r){var t=e.__data__;return pe(r)?t["string"==typeof r?"string":"hash"]:t.map};const _e=function(e){var r=he(this,e).delete(e);return this.size-=r?1:0,r};const de=function(e){return he(this,e).get(e)};const me=function(e){return he(this,e).has(e)};const ge=function(e,r){var t=he(this,e),n=t.size;return t.set(e,r),this.size+=t.size==n?0:1,this};function ve(e){var r=-1,t=null==e?0:e.length;for(this.clear();++r<t;){var n=e[r];this.set(n[0],n[1])}}ve.prototype.clear=ce,ve.prototype.delete=_e,ve.prototype.get=de,ve.prototype.has=me,ve.prototype.set=ge;const Ae=ve;function Te(e,r){if("function"!=typeof e||null!=r&&"function"!=typeof r)throw new TypeError("Expected a function");var t=function(){var n=arguments,i=r?r.apply(this,n):n[0],o=t.cache;if(o.has(i))return o.get(i);var a=e.apply(this,n);return t.cache=o.set(i,a)||o,a};return t.cache=new(Te.Cache||Ae),t}Te.Cache=Ae;const Ee=Te,ye=Object.getOwnPropertyDescriptor(new Uint8Array(1),0).writable;function be(e){let r="number"!=typeof e?Number(e):e;return Number.isNaN(r)&&(r=0),Math.trunc(r)}function we(e,r){const[t,n]=[Number.isNaN(e),Number.isNaN(r)];if(t&&n)return 0;if(t)return 1;if(n)return-1;if(e<r)return-1;if(e>r)return 1;if(0===e&&0===r){const[t,n]=[Object.is(e,0),Object.is(r,0)];if(!t&&n)return-1;if(t&&!n)return 1}return 0}function Ue(e){return e instanceof DataView}function Le(e){return"string"==typeof e&&e===be(e)+""}const Re=function(e){return null!=e&&"object"==typeof e};const Fe=function(e){return Re(e)&&"[object ArrayBuffer]"==L(e)};const Pe=function(e){return function(r){return e(r)}};var Oe=t(730),Ie=Oe.Z&&Oe.Z.isArrayBuffer;const Ne=Ie?Pe(Ie):Fe;const Ge=function(){const e=new WeakMap;return r=>{let t=e.get(r);return t||(t=Object.create(null),e.set(r,t),t)}}();function xe(e){return e instanceof Ce}function Se(e){if(!xe(e))throw new TypeError("This is not a Float16Array")}function Be(e){const r=e.length,t=new Array(r);for(let n=0;n<r;++n)t[n]=p(e[n]);return t}const De={apply(e,r,t){return xe(r)&&("function"==typeof(n=e)&&ke.has(n))?Reflect.apply(e,Ge(r).target,t):Reflect.apply(e,r,t);var n}},Me={get(e,r){let t=null;if(ye||(t=e,e=Ge(t).target),Le(r))return Reflect.has(e,r)?p(Reflect.get(e,r)):void 0;{const n=null!==t&&Reflect.has(t,r)?Reflect.get(t,r):Reflect.get(e,r);if("function"!=typeof n)return n;let i=Ge(n).proxy;return void 0===i&&(i=Ge(n).proxy=new Proxy(n,De)),i}},set(e,r,t){let n=null;return ye||(n=e,e=Ge(n).target),Le(r)?Reflect.set(e,r,l(t)):null===n||Reflect.has(e,r)&&!Object.isFrozen(n)?Reflect.set(e,r,t):Reflect.set(n,r,t)}};ye||(Me.getPrototypeOf=e=>Reflect.getPrototypeOf(Ge(e).target),Me.setPrototypeOf=(e,r)=>Reflect.setPrototypeOf(Ge(e).target,r),Me.defineProperty=(e,r,t)=>{const n=Ge(e).target;return!Reflect.has(n,r)||Object.isFrozen(e)?Reflect.defineProperty(e,r,t):Reflect.defineProperty(n,r,t)},Me.deleteProperty=(e,r)=>{const t=Ge(e).target;return Reflect.has(e,r)?Reflect.deleteProperty(e,r):Reflect.deleteProperty(t,r)},Me.has=(e,r)=>Reflect.has(e,r)||Reflect.has(Ge(e).target,r),Me.isExtensible=e=>Reflect.isExtensible(e),Me.preventExtensions=e=>Reflect.preventExtensions(e),Me.getOwnPropertyDescriptor=(e,r)=>Reflect.getOwnPropertyDescriptor(e,r),Me.ownKeys=e=>Reflect.ownKeys(e));class Ce extends Uint16Array{constructor(e,r,t){if(xe(e))super(Ge(e).target);else if(null===e||"object"!=typeof e||Ne(e))switch(arguments.length){case 0:super();break;case 1:super(e);break;case 2:super(e,r);break;case 3:super(e,r,t);break;default:super(...arguments)}else{const r=Reflect.has(e,"length")||void 0===e[Symbol.iterator]?e:[...e],t=r.length;super(t);for(let e=0;e<t;++e)this[e]=l(r[e])}let n;if(ye)n=new Proxy(this,Me);else{const e=Object.create(null);Ge(e).target=this,n=new Proxy(e,Me)}return Ge(n).target=this,Ge(this).proxy=n,n}static from(e,...r){if(0===r.length)return new Ce(Uint16Array.from(e,l).buffer);const t=r[0],n=r[1];return new Ce(Uint16Array.from(e,(function(e,...r){return l(t.call(this,e,...r))}),n).buffer)}static of(...e){return new Ce(e)}*[Symbol.iterator](){for(const e of super[Symbol.iterator]())yield p(e)}keys(){return super.keys()}*values(){for(const e of super.values())yield p(e)}*entries(){for(const[e,r]of super.entries())yield[e,p(r)]}map(e,...r){Se(this);const t=r[0],n=[];for(let r=0,i=this.length;r<i;++r){const i=p(this[r]);n.push(e.call(t,i,r,Ge(this).proxy))}return new Ce(n)}filter(e,...r){Se(this);const t=r[0],n=[];for(let r=0,i=this.length;r<i;++r){const i=p(this[r]);e.call(t,i,r,Ge(this).proxy)&&n.push(i)}return new Ce(n)}reduce(e,...r){let t,n;Se(this),0===r.length?(t=p(this[0]),n=1):(t=r[0],n=0);for(let r=n,i=this.length;r<i;++r)t=e(t,p(this[r]),r,Ge(this).proxy);return t}reduceRight(e,...r){let t,n;Se(this);const i=this.length;0===r.length?(t=p(this[i-1]),n=i-1):(t=r[0],n=i);for(let r=n;r--;)t=e(t,p(this[r]),r,Ge(this).proxy);return t}forEach(e,...r){Se(this);const t=r[0];for(let r=0,n=this.length;r<n;++r)e.call(t,p(this[r]),r,Ge(this).proxy)}find(e,...r){Se(this);const t=r[0];for(let r=0,n=this.length;r<n;++r){const n=p(this[r]);if(e.call(t,n,r,Ge(this).proxy))return n}}findIndex(e,...r){Se(this);const t=r[0];for(let r=0,n=this.length;r<n;++r){const n=p(this[r]);if(e.call(t,n,r,Ge(this).proxy))return r}return-1}every(e,...r){Se(this);const t=r[0];for(let r=0,n=this.length;r<n;++r)if(!e.call(t,p(this[r]),r,Ge(this).proxy))return!1;return!0}some(e,...r){Se(this);const t=r[0];for(let r=0,n=this.length;r<n;++r)if(e.call(t,p(this[r]),r,Ge(this).proxy))return!0;return!1}set(e,...r){Se(this);const t=r[0];let n;if(xe(e))n=Ge(e).target;else{const r=Reflect.has(e,"length")||void 0===e[Symbol.iterator]?e:[...e],t=r.length;n=new Uint16Array(t);for(let e=0,t=r.length;e<t;++e)n[e]=l(r[e])}super.set(n,t)}reverse(){return Se(this),super.reverse(),Ge(this).proxy}fill(e,...r){return Se(this),super.fill(l(e),...r),Ge(this).proxy}copyWithin(e,r,...t){return Se(this),super.copyWithin(e,r,...t),Ge(this).proxy}sort(...e){Se(this);let r=e[0];void 0===r&&(r=we);const t=Ee(p);return super.sort(((e,n)=>r(t(e),t(n)))),Ge(this).proxy}slice(...e){let r;Se(this);try{r=super.slice(...e)}catch(t){if(!(t instanceof TypeError))throw t;r=new Uint16Array(this.buffer,this.byteOffset,this.length).slice(...e)}return new Ce(r.buffer)}subarray(...e){let r;Se(this);try{r=super.subarray(...e)}catch(t){if(!(t instanceof TypeError))throw t;r=new Uint16Array(this.buffer,this.byteOffset,this.length).subarray(...e)}return new Ce(r.buffer,r.byteOffset,r.length)}indexOf(e,...r){Se(this);const t=this.length;let n=be(r[0]);n<0&&(n+=t,n<0&&(n=0));for(let r=n,i=t;r<i;++r)if(p(this[r])===e)return r;return-1}lastIndexOf(e,...r){Se(this);const t=this.length;let n=be(r[0]);n=0===n?t:n+1,n>=0?n=n<t?n:t:n+=t;for(let r=n;r--;)if(p(this[r])===e)return r;return-1}includes(e,...r){Se(this);const t=this.length;let n=be(r[0]);n<0&&(n+=t,n<0&&(n=0));const i=Number.isNaN(e);for(let r=n,o=t;r<o;++r){const t=p(this[r]);if(i&&Number.isNaN(t))return!0;if(t===e)return!0}return!1}join(...e){Se(this);return Be(this).join(...e)}toLocaleString(...e){Se(this);return Be(this).toLocaleString(...e)}get[Symbol.toStringTag](){if(xe(this))return"Float16Array"}}const Ve=Ce.prototype,ke=new WeakSet;for(const e of Reflect.ownKeys(Ve)){const r=Ve[e];"function"==typeof r&&ke.add(r)}function We(e,r,...t){if(!Ue(e))throw new TypeError("First argument to getFloat16 function must be a DataView");return p(e.getUint16(r,...t))}function je(e,r,t,...n){if(!Ue(e))throw new TypeError("First argument to setFloat16 function must be a DataView");e.setUint16(r,l(t),...n)}},809:(e,r)=>{"use strict";function t(e){var r=-1;n||(n=function(){for(var e=new Int32Array(256),r=0;r<256;r++){for(var t=r,n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[r]=t}return e}());for(var t=0;t<e.length;t++)r=n[255&(r^e[t])]^r>>>8;return-1^r}Object.defineProperty(r,"__esModule",{value:!0}),r.changeDpiBlob=function(e,r){var t=e.slice(0,33);return new Promise((function(n,i){var o=new FileReader;o.onload=function(){var t=new Uint8Array(o.result),i=e.slice(33),a=h(t,r,e.type);n(new Blob([a,i],{type:e.type}))},o.readAsArrayBuffer(t)}))},r.changeDpiDataUrl=function(e,r){var t=e.split(","),n=t[0],u=t[1],f=void 0,c=void 0,p=!1;if(-1!==n.indexOf(i)){f=i;var _=function(e){var r=e.indexOf(a);-1===r&&(r=e.indexOf(s));-1===r&&(r=e.indexOf(l));return r}(u);_>=0?(c=4*Math.ceil((_+28)/3),p=!0):c=44}-1!==n.indexOf(o)&&(f=o,c=24);for(var d=u.substring(0,c),m=u.substring(c),g=atob(d),v=new Uint8Array(g.length),A=0;A<v.length;A++)v[A]=g.charCodeAt(A);var T=h(v,r,f,p),E=btoa(String.fromCharCode.apply(String,function(e){if(Array.isArray(e)){for(var r=0,t=Array(e.length);r<e.length;r++)t[r]=e[r];return t}return Array.from(e)}(T)));return[n,",",E,m].join("")};var n=void 0,i="image/png",o="image/jpeg",a="AAlwSFlz",s="AAAJcEhZ",l="AAAACXBI",u="p".charCodeAt(0),f="H".charCodeAt(0),c="Y".charCodeAt(0),p="s".charCodeAt(0);function h(e,r,n,a){if(n===o)return e[13]=1,e[14]=r>>8,e[15]=255&r,e[16]=r>>8,e[17]=255&r,e;if(n===i){var s=new Uint8Array(13);r*=39.3701,s[0]=u,s[1]=f,s[2]=c,s[3]=p,s[4]=r>>>24,s[5]=r>>>16,s[6]=r>>>8,s[7]=255&r,s[8]=s[4],s[9]=s[5],s[10]=s[6],s[11]=s[7],s[12]=1;var l=t(s),h=new Uint8Array(4);if(h[0]=l>>>24,h[1]=l>>>16,h[2]=l>>>8,h[3]=255&l,a){var _=function(e){for(var r=e.length-1;r>=4;r--)if(9===e[r-4]&&e[r-3]===u&&e[r-2]===f&&e[r-1]===c&&e[r]===p)return r-3}(e);return e.set(s,_),e.set(h,_+13),e}var d=new Uint8Array(4);d[0]=0,d[1]=0,d[2]=0,d[3]=9;var m=new Uint8Array(54);return m.set(e,0),m.set(d,33),m.set(s,37),m.set(h,50),m}}},162:function(e,r,t){var n,i,o;i=[],void 0===(o="function"==typeof(n=function(){"use strict";function r(e,r){return void 0===r?r={autoBom:!1}:"object"!=typeof r&&(console.warn("Deprecated: Expected third argument to be a object"),r={autoBom:!r}),r.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}function n(e,r,t){var n=new XMLHttpRequest;n.open("GET",e),n.responseType="blob",n.onload=function(){l(n.response,r,t)},n.onerror=function(){console.error("could not download file")},n.send()}function i(e){var r=new XMLHttpRequest;r.open("HEAD",e,!1);try{r.send()}catch(e){}return 200<=r.status&&299>=r.status}function o(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(t){var r=document.createEvent("MouseEvents");r.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(r)}}var a="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof t.g&&t.g.global===t.g?t.g:void 0,s=a.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),l=a.saveAs||("object"!=typeof window||window!==a?function(){}:"download"in HTMLAnchorElement.prototype&&!s?function(e,r,t){var s=a.URL||a.webkitURL,l=document.createElement("a");r=r||e.name||"download",l.download=r,l.rel="noopener","string"==typeof e?(l.href=e,l.origin===location.origin?o(l):i(l.href)?n(e,r,t):o(l,l.target="_blank")):(l.href=s.createObjectURL(e),setTimeout((function(){s.revokeObjectURL(l.href)}),4e4),setTimeout((function(){o(l)}),0))}:"msSaveOrOpenBlob"in navigator?function(e,t,a){if(t=t||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(r(e,a),t);else if(i(e))n(e,t,a);else{var s=document.createElement("a");s.href=e,s.target="_blank",setTimeout((function(){o(s)}))}}:function(e,r,t,i){if((i=i||open("","_blank"))&&(i.document.title=i.document.body.innerText="downloading..."),"string"==typeof e)return n(e,r,t);var o="application/octet-stream"===e.type,l=/constructor/i.test(a.HTMLElement)||a.safari,u=/CriOS\/[\d]+/.test(navigator.userAgent);if((u||o&&l||s)&&"undefined"!=typeof FileReader){var f=new FileReader;f.onloadend=function(){var e=f.result;e=u?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),i?i.location.href=e:location=e,i=null},f.readAsDataURL(e)}else{var c=a.URL||a.webkitURL,p=c.createObjectURL(e);i?i.location=p:location.href=p,i=null,setTimeout((function(){c.revokeObjectURL(p)}),4e4)}});a.saveAs=l.saveAs=l,e.exports=l})?n.apply(r,i):n)||(e.exports=o)},277:(e,r,t)=>{"use strict";t.d(r,{Z:()=>n});const n="object"==typeof t.g&&t.g&&t.g.Object===Object&&t.g},730:(e,r,t)=>{"use strict";t.d(r,{Z:()=>s});var n=t(277);e=t.hmd(e);var i="object"==typeof exports&&exports&&!exports.nodeType&&exports,o=i&&e&&!e.nodeType&&e,a=o&&o.exports===i&&n.Z.process;const s=function(){try{var e=o&&o.require&&o.require("util").types;return e||a&&a.binding&&a.binding("util")}catch(e){}}()},627:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.isBoolean=r.isArray=r.isString=r.isNonNegativeInteger=r.isPositiveInteger=r.isInteger=r.isNumber=r.isNumberOfType=r.isValidClearValue=r.isValidTextureType=r.isValidTextureFormat=r.isValidWrap=r.isValidFilter=r.isValidDataType=void 0;var n=t(738);function i(e,r){switch(r){case n.HALF_FLOAT:case n.FLOAT:return o(e);case n.BYTE:case n.SHORT:case n.INT:return a(e);case n.UNSIGNED_BYTE:case n.UNSIGNED_SHORT:case n.UNSIGNED_INT:return s(e);default:throw new Error("Unknown type "+r)}}function o(e){return!isNaN(e)}function a(e){return o(e)&&e%1==0}function s(e){return a(e)&&e>=0}function l(e){return Array.isArray(e)}r.isValidDataType=function(e){return n.validDataTypes.indexOf(e)>-1},r.isValidFilter=function(e){return n.validFilters.indexOf(e)>-1},r.isValidWrap=function(e){return n.validWraps.indexOf(e)>-1},r.isValidTextureFormat=function(e){return n.validTextureFormats.indexOf(e)>-1},r.isValidTextureType=function(e){return n.validTextureTypes.indexOf(e)>-1},r.isValidClearValue=function(e,r,t){if(l(e)){if(e.length!==r)return!1;for(var n=0;n<e.length;n++)if(!i(e[n],t))return!1}else if(!i(e,t))return!1;return!0},r.isNumberOfType=i,r.isNumber=o,r.isInteger=a,r.isPositiveInteger=function(e){return a(e)&&e>0},r.isNonNegativeInteger=s,r.isString=function(e){return"string"==typeof e},r.isArray=l,r.isBoolean=function(e){return"boolean"==typeof e}},738:(e,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.DEFAULT_CIRCLE_NUM_SEGMENTS=r.DATA_LAYER_VECTOR_FIELD_PROGRAM_NAME=r.DATA_LAYER_LINES_PROGRAM_NAME=r.DATA_LAYER_POINTS_PROGRAM_NAME=r.SEGMENT_PROGRAM_NAME=r.DEFAULT_W_UV_NORMAL_PROGRAM_NAME=r.DEFAULT_W_NORMAL_PROGRAM_NAME=r.DEFAULT_W_UV_PROGRAM_NAME=r.DEFAULT_PROGRAM_NAME=r.INT_4D_UNIFORM=r.INT_3D_UNIFORM=r.INT_2D_UNIFORM=r.INT_1D_UNIFORM=r.FLOAT_4D_UNIFORM=r.FLOAT_3D_UNIFORM=r.FLOAT_2D_UNIFORM=r.FLOAT_1D_UNIFORM=r.PRECISION_HIGH_P=r.PRECISION_MEDIUM_P=r.PRECISION_LOW_P=r.GLSL1=r.GLSL3=r.validTextureTypes=r.validTextureFormats=r.validWraps=r.validFilters=r.validDataTypes=r.validArrayTypes=r.RGBA=r.RGB=r.CLAMP_TO_EDGE=r.REPEAT=r.NEAREST=r.LINEAR=r.UINT=r.BOOL=r.INT=r.UNSIGNED_INT=r.SHORT=r.UNSIGNED_SHORT=r.BYTE=r.UNSIGNED_BYTE=r.FLOAT=r.HALF_FLOAT=void 0,r.HALF_FLOAT="HALF_FLOAT",r.FLOAT="FLOAT",r.UNSIGNED_BYTE="UNSIGNED_BYTE",r.BYTE="BYTE",r.UNSIGNED_SHORT="UNSIGNED_SHORT",r.SHORT="SHORT",r.UNSIGNED_INT="UNSIGNED_INT",r.INT="INT",r.BOOL="BOOL",r.UINT="UINT",r.LINEAR="LINEAR",r.NEAREST="NEAREST",r.REPEAT="REPEAT",r.CLAMP_TO_EDGE="CLAMP_TO_EDGE",r.RGB="RGB",r.RGBA="RGBA",r.validArrayTypes=[Float32Array,Uint8Array,Int8Array,Uint16Array,Int16Array,Uint32Array,Int32Array,Array],r.validDataTypes=[r.HALF_FLOAT,r.FLOAT,r.UNSIGNED_BYTE,r.BYTE,r.UNSIGNED_SHORT,r.SHORT,r.UNSIGNED_INT,r.INT],r.validFilters=[r.LINEAR,r.NEAREST],r.validWraps=[r.CLAMP_TO_EDGE,r.REPEAT],r.validTextureFormats=[r.RGB,r.RGBA],r.validTextureTypes=[r.UNSIGNED_BYTE],r.GLSL3="300 es",r.GLSL1="100",r.PRECISION_LOW_P="lowp",r.PRECISION_MEDIUM_P="mediump",r.PRECISION_HIGH_P="highp",r.FLOAT_1D_UNIFORM="1f",r.FLOAT_2D_UNIFORM="2f",r.FLOAT_3D_UNIFORM="3f",r.FLOAT_4D_UNIFORM="3f",r.INT_1D_UNIFORM="1i",r.INT_2D_UNIFORM="2i",r.INT_3D_UNIFORM="3i",r.INT_4D_UNIFORM="3i",r.DEFAULT_PROGRAM_NAME="DEFAULT",r.DEFAULT_W_UV_PROGRAM_NAME="DEFAULT_W_UV",r.DEFAULT_W_NORMAL_PROGRAM_NAME="DEFAULT_W_NORMAL",r.DEFAULT_W_UV_NORMAL_PROGRAM_NAME="DEFAULT_W_UV_NORMAL",r.SEGMENT_PROGRAM_NAME="SEGMENT",r.DATA_LAYER_POINTS_PROGRAM_NAME="DATA_LAYER_POINTS",r.DATA_LAYER_LINES_PROGRAM_NAME="DATA_LAYER_LINES",r.DATA_LAYER_VECTOR_FIELD_PROGRAM_NAME="DATA_LAYER_VECTOR_FIELD",r.DEFAULT_CIRCLE_NUM_SEGMENTS=18},484:function(e,r,t){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++)for(var i in r=arguments[t])Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i]);return e}).apply(this,arguments)},i=this&&this.__spreadArrays||function(){for(var e=0,r=0,t=arguments.length;r<t;r++)e+=arguments[r].length;var n=Array(e),i=0;for(r=0;r<t;r++)for(var o=arguments[r],a=0,s=o.length;a<s;a++,i++)n[i]=o[a];return n};Object.defineProperty(r,"__esModule",{value:!0}),r.GPUComposer=void 0;var o=t(162),a=t(809),s=t(355),l=t(738),u=t(664),f=t(404),c=t(593),p=t(501),h=t(627),_=t(288),d=function(){function e(e,r,n){var i;void 0===r&&(r=function(e){throw new Error(e)}),this.errorState=!1,this._circlePositionsBuffer={},this.copyPrograms={src:t(158)},this.setValuePrograms={src:t(148)},this.vectorMagnitudePrograms={src:t(723)},this._vertexShaders=((i={})[l.DEFAULT_PROGRAM_NAME]={src:_},i[l.DEFAULT_W_UV_PROGRAM_NAME]={src:_,defines:{UV_ATTRIBUTE:"1"}},i[l.DEFAULT_W_NORMAL_PROGRAM_NAME]={src:_,defines:{NORMAL_ATTRIBUTE:"1"}},i[l.DEFAULT_W_UV_NORMAL_PROGRAM_NAME]={src:_,defines:{UV_ATTRIBUTE:"1",NORMAL_ATTRIBUTE:"1"}},i[l.SEGMENT_PROGRAM_NAME]={src:t(974)},i[l.DATA_LAYER_POINTS_PROGRAM_NAME]={src:t(62)},i[l.DATA_LAYER_VECTOR_FIELD_PROGRAM_NAME]={src:t(430)},i[l.DATA_LAYER_LINES_PROGRAM_NAME]={src:t(629)},i),this.verboseLogging=!1;var o=["canvas","context","contextID","contextOptions","glslVersion","verboseLogging"];if(Object.keys(e).forEach((function(e){if(o.indexOf(e)<0)throw new Error('Invalid key "'+e+'" passed to GPUComposer.constructor.  Valid keys are '+o.join(", ")+".")})),!e.canvas)throw new Error('Must init GPUComposer with a "canvas" parameter.');void 0!==e.verboseLogging&&(this.verboseLogging=e.verboseLogging);var a=this;this._errorCallback=function(e){a.errorState||(a.errorState=!0,r(e))};var s=e.canvas,u=e.context;if(u||(e.contextID&&((u=s.getContext(e.contextID,e.contextOptions))||console.warn("Unable to initialize WebGL context with contextID: "+e.contextID+".")),u||(u=s.getContext("webgl2",e.contextOptions)||s.getContext("webgl",e.contextOptions)||s.getContext("experimental-webgl",e.contextOptions)),null!==u)){c.isWebGL2(u)?this.verboseLogging&&console.log("Using WebGL 2.0 context."):this.verboseLogging&&console.log("Using WebGL 1.0 context."),this.gl=u,this.renderer=n;var f=void 0===e.glslVersion?l.GLSL1:e.glslVersion;c.isWebGL2(u)||f!==l.GLSL3||(console.warn("GLSL3.x is incompatible with WebGL1.0 contexts, falling back to GLSL1."),f=l.GLSL1),this.glslVersion=f,u.disable(u.DEPTH_TEST),u.pixelStorei(u.UNPACK_ALIGNMENT,1),u.bindBuffer(u.ARRAY_BUFFER,null),this.onResize(s),this.maxNumTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.verboseLogging&&console.log(this.maxNumTextures+" textures max.")}else this._errorCallback("Unable to initialize WebGL context.")}return e.initWithThreeRenderer=function(r,t,i){return new e(n({canvas:r.domElement,context:r.getContext()},t),i,r)},e.prototype.preprocessShader=function(e){return e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace("#version 300 es","")).replace(/precision \w+ isampler2D;/g,"")).replace(/precision \w+ usampler2D;/g,"")).replace(/uvec2/g,"vec2")).replace(/uvec3/g,"vec3")).replace(/uvec4/g,"vec4")).replace(/usampler2D/g,"sampler2D")).replace(/ivec2/g,"vec2")).replace(/ivec3/g,"vec3")).replace(/ivec4/g,"vec4")).replace(/isampler2D/g,"sampler2D")).replace(/texture\(/g,"texture2D(")},e.prototype._preprocessFragShader=function(e){return this.glslVersion===l.GLSL3?e:e=(e=(e=(e=(e=this.preprocessShader(e)).replace(/\n\s*in\s+/g,"\nvarying ")).replace(/;\s*in\s+/g,";varying ")).replace(/out \w+ out_fragOut;/g,"")).replace(/out_fragOut\s+=/,"gl_FragColor =")},e.prototype._preprocessVertShader=function(e){return this.glslVersion===l.GLSL3?e:e=(e=(e=(e=(e=this.preprocessShader(e)).replace(/\n\s*in\s+/g,"\nattribute ")).replace(/;\s*in\s+/g,";attribute ")).replace(/\n\s*out\s+/g,"\nvarying ")).replace(/;\s*out\s+/g,";varying ")},e.prototype.glslKeyForType=function(e){if(this.glslVersion===l.GLSL1)return l.FLOAT;switch(e){case l.HALF_FLOAT:case l.FLOAT:return l.FLOAT;case l.UNSIGNED_BYTE:case l.UNSIGNED_SHORT:case l.UNSIGNED_INT:return l.UINT;case l.BYTE:case l.SHORT:case l.INT:return l.INT;default:throw new Error("Invalid type: "+e+" passed to GPUComposer.copyProgramForType.")}},e.prototype._setValueProgramForType=function(e){var r,t=this.glslKeyForType(e);if(void 0===this.setValuePrograms[t]){var n=new u.GPUProgram(this,{name:"setValue-"+t,fragmentShader:this._preprocessFragShader(this.setValuePrograms.src),uniforms:[{name:"u_value",value:[0,0,0,0],type:t===l.UINT?l.INT:t}],defines:(r={},r[t]="1",r)});this.setValuePrograms[t]=n}return this.setValuePrograms[t]},e.prototype.copyProgramForType=function(e){var r,t=this.glslKeyForType(e);if(void 0===this.copyPrograms[t]){var n=new u.GPUProgram(this,{name:"copy-"+t,fragmentShader:this._preprocessFragShader(this.copyPrograms.src),uniforms:[{name:"u_state",value:0,type:l.INT}],defines:(r={},r[t]="1",r)});this.copyPrograms[t]=n}return this.copyPrograms[t]},Object.defineProperty(e.prototype,"wrappedLineColorProgram",{get:function(){if(void 0===this._wrappedLineColorProgram){var e=new u.GPUProgram(this,{name:"wrappedLineColor",fragmentShader:this._preprocessFragShader(t(598))});this._wrappedLineColorProgram=e}return this._wrappedLineColorProgram},enumerable:!1,configurable:!0}),e.prototype.vectorMagnitudeProgramForType=function(e){var r,t=this.glslKeyForType(e);if(void 0===this.vectorMagnitudePrograms[t]){var n=new u.GPUProgram(this,{name:"vectorMagnitude-"+t,fragmentShader:this._preprocessFragShader(this.vectorMagnitudePrograms.src),defines:(r={},r[t]="1",r)});this.vectorMagnitudePrograms[t]=n}return this.vectorMagnitudePrograms[t]},e.prototype.isWebGL2=function(){return c.isWebGL2(this.gl)},Object.defineProperty(e.prototype,"quadPositionsBuffer",{get:function(){if(void 0===this._quadPositionsBuffer){var e=new Float32Array([-1,-1,1,-1,-1,1,1,1]);this._quadPositionsBuffer=this.initVertexBuffer(e)}return this._quadPositionsBuffer},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"boundaryPositionsBuffer",{get:function(){if(void 0===this._boundaryPositionsBuffer){var e=new Float32Array([-1,-1,1,-1,1,1,-1,1,-1,-1]);this._boundaryPositionsBuffer=this.initVertexBuffer(e)}return this._boundaryPositionsBuffer},enumerable:!1,configurable:!0}),e.prototype.getCirclePositionsBuffer=function(e){if(null==this._circlePositionsBuffer[e]){for(var r=[0,0],t=0;t<=e;t++)r.push(Math.cos(2*Math.PI*t/e),Math.sin(2*Math.PI*t/e));var n=new Float32Array(r),i=this.initVertexBuffer(n);this._circlePositionsBuffer[e]=i}return this._circlePositionsBuffer[e]},e.prototype.initVertexBuffer=function(e){var r=this._errorCallback,t=this.gl,n=t.createBuffer();if(n)return t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),n;r("Unable to allocate gl buffer.")},e.prototype._cloneGPULayer=function(e,r){var t=0;try{t=e.length}catch(r){t=[e.width,e.height]}var n=e.writable?void 0:this.getValues(e),i=new s.GPULayer(this,{name:r||e.name+"-clone",dimensions:t,type:e.type,numComponents:e.numComponents,array:n,filter:e.filter,wrapS:e.wrapS,wrapT:e.wrapT,writable:e.writable,numBuffers:e.numBuffers});if(e.writable){for(var o=0;o<e.numBuffers-1;o++)this.step({program:this.copyProgramForType(e.type),input:e.getStateAtIndex((e.bufferIndex+o+1)%e.numBuffers),output:i});this.step({program:this.copyProgramForType(e.type),input:e.currentState,output:i})}return i},e.prototype.initTexture=function(e){var r=["name","url","filter","wrapS","wrapT","format","type","onLoad"];Object.keys(e).forEach((function(t){if(r.indexOf(t)<0)throw new Error('Invalid key "'+t+'" passed to GPUComposer.initTexture with name "'+e.name+'".  Valid keys are '+r.join(", ")+".")}));var t=e.url,n=e.name;if(!h.isString(t))throw new Error("Expected GPUComposer.initTexture params to have url of type string, got "+t+" of type "+typeof t+".");if(!h.isString(n))throw new Error("Expected GPUComposer.initTexture params to have name of type string, got "+n+" of type "+typeof n+".");var i=void 0!==e.filter?e.filter:l.NEAREST;if(!h.isValidFilter(i))throw new Error("Invalid filter: "+i+' for GPULayer "'+n+'", must be '+l.validFilters.join(", ")+".");var o=void 0!==e.wrapS?e.wrapS:l.CLAMP_TO_EDGE;if(!h.isValidWrap(o))throw new Error("Invalid wrapS: "+o+' for GPULayer "'+n+'", must be '+l.validWraps.join(", ")+".");var a=void 0!==e.wrapT?e.wrapT:l.CLAMP_TO_EDGE;if(!h.isValidWrap(a))throw new Error("Invalid wrapT: "+a+' for GPULayer "'+n+'", must be '+l.validWraps.join(", ")+".");var s=void 0!==e.format?e.format:l.RGBA;if(!h.isValidTextureFormat(s))throw new Error("Invalid format: "+s+' for GPULayer "'+n+'", must be '+l.validTextureFormats.join(", ")+".");var u=void 0!==e.type?e.type:l.UNSIGNED_BYTE;if(!h.isValidTextureType(u))throw new Error("Invalid type: "+u+' for GPULayer "'+n+'", must be '+l.validTextureTypes.join(", ")+".");var f=this.gl,p=this._errorCallback,_=f.createTexture();if(null===_)throw new Error("Unable to init glTexture.");f.bindTexture(f.TEXTURE_2D,_);var d=f.RGBA,m=f[s],g=f[u],v=new Uint8Array([0,0,0,0]);f.texImage2D(f.TEXTURE_2D,0,d,1,1,0,m,g,v);var A=new Image;return A.onload=function(){f.bindTexture(f.TEXTURE_2D,_),f.texImage2D(f.TEXTURE_2D,0,d,m,g,A),c.isPowerOf2(A.width)&&c.isPowerOf2(A.height)||console.warn("Texture "+n+" dimensions ["+A.width+", "+A.height+"] are not power of 2."),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f[o]),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f[a]),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f[i]),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f[i]),e.onLoad&&e.onLoad(_)},A.onerror=function(e){p("Error loading image "+n+": "+e)},A.src=t,_},e.prototype.onResize=function(e){var r=e.clientWidth,t=e.clientHeight;e.width=r,e.height=t,this.width=r,this.height=t},e.prototype.drawSetup=function(e,r,t,n){var i=this.gl;if(e){var o=[];if(t)if(t.constructor===WebGLTexture)o.push(t);else if(t.constructor===s.GPULayer)o.push(t.currentState);else for(var a=0;a<t.length;a++){var l=t[a];o.push(l.currentState?l.currentState:l)}this.setOutputLayer(r,t,n),i.useProgram(e);for(a=0;a<o.length;a++)i.activeTexture(i.TEXTURE0+a),i.bindTexture(i.TEXTURE_2D,o[a])}},e.prototype.setBlendMode=function(e){var r=this.gl;e&&(r.enable(r.BLEND),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA))},e.prototype.addLayerToInputs=function(e,r){var t=r;if(h.isArray(t))t.indexOf(e)<0&&t.push(e);else if(t!==e){var n=t;t=[],n&&t.push(n),t.push(e)}else t=[t];return t},e.prototype.passThroughLayerDataFromInputToOutput=function(e){var r=this.copyProgramForType(e.internalType);this.step({program:r,input:e,output:e})},e.prototype.setOutputLayer=function(e,r,t){var n=this.gl;if(t){if(r&&(r===t||h.isArray(r)&&r.indexOf(t)>-1)){if(1===t.numBuffers)throw new Error("Cannot use same buffer for input and output of a program. Try increasing the number of buffers in your output layer to at least 2 so you can render to nextState using currentState as an input.");e?t._bindOutputBufferForWrite(!0):(this.passThroughLayerDataFromInputToOutput(t),t._bindOutputBufferForWrite(!1))}else e||t._usingTextureOverrideForCurrentBuffer()&&this.passThroughLayerDataFromInputToOutput(t),t._bindOutputBufferForWrite(!1);var i=t.width,o=t.height;n.viewport(0,0,i,o)}else{n.bindFramebuffer(n.FRAMEBUFFER,null);var a=this.width,s=this.height;n.viewport(0,0,a,s)}},e.prototype.setPositionAttribute=function(e,r){this.setVertexAttribute(e,"a_internal_position",2,r)},e.prototype.setIndexAttribute=function(e,r){this.setVertexAttribute(e,"a_internal_index",1,r)},e.prototype.setUVAttribute=function(e,r){this.setVertexAttribute(e,"a_internal_uv",2,r)},e.prototype.setVertexAttribute=function(e,r,t,n){var i=this.gl,o=i.getAttribLocation(e,r);if(o<0)throw new Error('Unable to find vertex attribute "'+r+'" in program "'+n+'".');i.vertexAttribPointer(o,t,i.FLOAT,!1,0,0),i.enableVertexAttribArray(o)},e.prototype.step=function(e){var r=this,t=r.gl,n=r.errorState,i=r.quadPositionsBuffer,o=e.program,a=e.input,s=e.output;if(!n){var u=o._defaultProgram;this.drawSetup(u,!0,a,s),o._setVertexUniform(u,"u_internal_scale",[1,1],l.FLOAT),o._setVertexUniform(u,"u_internal_translation",[0,0],l.FLOAT),t.bindBuffer(t.ARRAY_BUFFER,i),this.setPositionAttribute(u,o.name),this.setBlendMode(e.shouldBlendAlpha),t.drawArrays(t.TRIANGLE_STRIP,0,4),t.disable(t.BLEND)}},e.prototype.stepBoundary=function(e){var r=this,t=r.gl,n=r.errorState,i=r.boundaryPositionsBuffer,o=e.program,a=e.input,s=e.output,u=s?s.width:this.width,f=s?s.height:this.height;if(!n){var c=o._defaultProgram;this.drawSetup(c,!1,a,s);var p=[1/u,1/f];if(o._setVertexUniform(c,"u_internal_scale",[1-p[0],1-p[1]],l.FLOAT),o._setVertexUniform(c,"u_internal_translation",p,l.FLOAT),t.bindBuffer(t.ARRAY_BUFFER,i),this.setPositionAttribute(c,o.name),this.setBlendMode(e.shouldBlendAlpha),e.singleEdge)switch(e.singleEdge){case"LEFT":t.drawArrays(t.LINES,3,2);break;case"RIGHT":t.drawArrays(t.LINES,1,2);break;case"TOP":t.drawArrays(t.LINES,2,2);break;case"BOTTOM":t.drawArrays(t.LINES,0,2);break;default:throw new Error("Unknown boundary edge type: "+e.singleEdge+".")}else t.drawArrays(t.LINE_LOOP,0,4);t.disable(t.BLEND)}},e.prototype.stepNonBoundary=function(e){var r=this,t=r.gl,n=r.errorState,i=r.quadPositionsBuffer,o=e.program,a=e.input,s=e.output,u=s?s.width:this.width,f=s?s.height:this.height;if(!n){var c=o._defaultProgram;this.drawSetup(c,!1,a,s);var p=[1/u,1/f];o._setVertexUniform(c,"u_internal_scale",[1-2*p[0],1-2*p[1]],l.FLOAT),o._setVertexUniform(c,"u_internal_translation",p,l.FLOAT),t.bindBuffer(t.ARRAY_BUFFER,i),this.setPositionAttribute(c,o.name),this.setBlendMode(e.shouldBlendAlpha),t.drawArrays(t.TRIANGLE_STRIP,0,4),t.disable(t.BLEND)}},e.prototype.stepCircle=function(e){var r=this,t=r.gl,n=r.errorState,i=r.width,o=r.height,a=e.program,s=e.position,u=e.radius,f=e.input,c=e.output;if(!n){var p=a._defaultProgram;this.drawSetup(p,!1,f,c),a._setVertexUniform(p,"u_internal_scale",[2*u/i,2*u/o],l.FLOAT),a._setVertexUniform(p,"u_internal_translation",[2*s[0]/i-1,2*s[1]/o-1],l.FLOAT);var h=e.numSegments?e.numSegments:l.DEFAULT_CIRCLE_NUM_SEGMENTS;if(h<3)throw new Error("numSegments for GPUComposer.stepCircle must be greater than 2, got "+h+".");t.bindBuffer(t.ARRAY_BUFFER,this.getCirclePositionsBuffer(h)),this.setPositionAttribute(p,a.name),this.setBlendMode(e.shouldBlendAlpha),t.drawArrays(t.TRIANGLE_FAN,0,h+2),t.disable(t.BLEND)}},e.prototype.stepSegment=function(e){var r=this.gl,t=this.errorState,n=e.program,i=e.position1,o=e.position2,a=e.thickness,s=e.input,u=e.output,f=u?u.width:this.width,c=u?u.height:this.height;if(!t){var p=n._segmentProgram;this.drawSetup(p,!1,s,u),n._setVertexUniform(p,"u_internal_halfThickness",a/2,l.FLOAT),n._setVertexUniform(p,"u_internal_scale",[2/f,2/c],l.FLOAT);var h=i[0]-o[0],_=i[1]-o[1],d=Math.atan2(_,h);n._setVertexUniform(p,"u_internal_rotation",d,l.FLOAT);var m=(i[0]+o[0])/2,g=(i[1]+o[1])/2;n._setVertexUniform(p,"u_internal_translation",[2*m/this.width-1,2*g/this.height-1],l.FLOAT);var v=Math.sqrt(h*h+_*_),A=e.numCapSegments?2*e.numCapSegments:l.DEFAULT_CIRCLE_NUM_SEGMENTS;if(e.endCaps){if(A<6||A%6!=0)throw new Error("numSegments for GPUComposer.stepSegment must be divisible by 6, got "+A+".");n._setVertexUniform(p,"u_internal_length",v-a*Math.sin(Math.PI/A),l.FLOAT),r.bindBuffer(r.ARRAY_BUFFER,this.getCirclePositionsBuffer(A))}else n._setVertexUniform(p,"u_internal_length",v-a,l.FLOAT),r.bindBuffer(r.ARRAY_BUFFER,this.quadPositionsBuffer);this.setPositionAttribute(p,n.name),this.setBlendMode(e.shouldBlendAlpha),e.endCaps?r.drawArrays(r.TRIANGLE_FAN,0,A+2):r.drawArrays(r.TRIANGLE_STRIP,0,4),r.disable(r.BLEND)}},e.prototype.stepPolyline=function(e){var r=e.program,t=e.input,n=e.output,i=e.positions,o=!!e.closeLoop,a=this,s=a.gl,u=a.width,f=a.height;if(!a.errorState){for(var c=e.thickness/2,p=o?4*i.length+2:4*(i.length-1),h=new Float32Array(2*p),_=e.includeUVs?new Float32Array(2*p):void 0,d=e.includeNormals?new Float32Array(2*p):void 0,m=[0,0],g=[0,0],v=[0,0],A=[0,0],T=[0,0],E=0;E<i.length;E++)if(o||E!==i.length-1){var y=i[E],b=i[(E+1)%i.length];m[0]=b[0]-y[0],m[1]=b[1]-y[1];var w=Math.sqrt(m[0]*m[0]+m[1]*m[1]);v[0]=m[1]/w,v[1]=-m[0]/w;var U=4*E+2;o||0!==E||(h[0]=y[0]+v[0]*c,h[1]=y[1]+v[1]*c,h[2]=y[0]-v[0]*c,h[3]=y[1]-v[1]*c,_&&(_[0]=0,_[1]=1,_[2]=0,_[3]=0),d&&(d[0]=v[0],d[1]=v[1],d[2]=v[0],d[3]=v[1]));var L=(E+1)/(i.length-1);if(h[2*U]=b[0]+v[0]*c,h[2*U+1]=b[1]+v[1]*c,h[2*U+2]=b[0]-v[0]*c,h[2*U+3]=b[1]-v[1]*c,_&&(_[2*U]=L,_[2*U+1]=1,_[2*U+2]=L,_[2*U+3]=0),d&&(d[2*U]=v[0],d[2*U+1]=v[1],d[2*U+2]=v[0],d[2*U+3]=v[1]),E<i.length-2||o){var R=i[(E+1)%i.length],F=i[(E+2)%i.length];g[0]=F[0]-R[0],g[1]=F[1]-R[1];var P=Math.sqrt(g[0]*g[0]+g[1]*g[1]);A[0]=g[1]/P,A[1]=-g[0]/P,h[(U+2)%(4*i.length)*2]=R[0]+A[0]*c,h[(U+2)%(4*i.length)*2+1]=R[1]+A[1]*c,h[(U+2)%(4*i.length)*2+2]=R[0]-A[0]*c,h[(U+2)%(4*i.length)*2+3]=R[1]-A[1]*c,_&&(_[(U+2)%(4*i.length)*2]=L,_[(U+2)%(4*i.length)*2+1]=1,_[(U+2)%(4*i.length)*2+2]=L,_[(U+2)%(4*i.length)*2+3]=0),d&&(d[(U+2)%(4*i.length)*2]=A[0],d[(U+2)%(4*i.length)*2+1]=A[1],d[(U+2)%(4*i.length)*2+2]=A[0],d[(U+2)%(4*i.length)*2+3]=A[1]);var O=v[0]*A[1]-v[1]*A[0];if(Math.abs(O)<1e-6)continue;T[0]=v[0]+A[0],T[1]=v[1]+A[1];var I=Math.sqrt(T[0]*T[0]+T[1]*T[1]);T[0]/=I,T[1]/=I;var N=Math.acos(v[0]*A[0]+v[1]*A[1]),G=c/Math.cos(N/2);O<0?(h[2*U]=b[0]+T[0]*G,h[2*U+1]=b[1]+T[1]*G,h[(U+2)%(4*i.length)*2]=h[2*U],h[(U+2)%(4*i.length)*2+1]=h[2*U+1]):(h[2*U+2]=b[0]-T[0]*G,h[2*U+3]=b[1]-T[1]*G,h[(U+2)%(4*i.length)*2+2]=h[2*U+2],h[(U+2)%(4*i.length)*2+3]=h[2*U+3])}}o&&(h[8*i.length]=h[0],h[8*i.length+1]=h[1],h[8*i.length+2]=h[2],h[8*i.length+3]=h[3],_&&(_[8*i.length]=_[0],_[8*i.length+1]=_[1],_[8*i.length+2]=_[2],_[8*i.length+3]=_[3]),d&&(d[8*i.length]=d[0],d[8*i.length+1]=d[1],d[8*i.length+2]=d[2],d[8*i.length+3]=d[3]));var x=_?d?r._defaultProgramWithUVNormal:r._defaultProgramWithUV:d?r._defaultProgramWithNormal:r._defaultProgram;this.drawSetup(x,!1,t,n),r._setVertexUniform(x,"u_internal_scale",[2/u,2/f],l.FLOAT),r._setVertexUniform(x,"u_internal_translation",[-1,-1],l.FLOAT),s.bindBuffer(s.ARRAY_BUFFER,this.initVertexBuffer(h)),this.setPositionAttribute(x,r.name),_&&(s.bindBuffer(s.ARRAY_BUFFER,this.initVertexBuffer(_)),this.setUVAttribute(x,r.name)),d&&(s.bindBuffer(s.ARRAY_BUFFER,this.initVertexBuffer(d)),this.setVertexAttribute(x,"a_internal_normal",2,r.name)),this.setBlendMode(e.shouldBlendAlpha),s.drawArrays(s.TRIANGLE_STRIP,0,p),s.disable(s.BLEND)}},e.prototype.stepTriangleStrip=function(e){var r=e.program,t=e.input,n=e.output,i=e.positions,o=e.uvs,a=e.normals,s=this,u=s.gl,f=s.width,c=s.height;if(!s.errorState){var p=o?a?r._defaultProgramWithUVNormal:r._defaultProgramWithUV:a?r._defaultProgramWithNormal:r._defaultProgram;this.drawSetup(p,!1,t,n),r._setVertexUniform(p,"u_internal_scale",[2/f,2/c],l.FLOAT),r._setVertexUniform(p,"u_internal_translation",[-1,-1],l.FLOAT),u.bindBuffer(u.ARRAY_BUFFER,this.initVertexBuffer(i)),this.setPositionAttribute(p,r.name),o&&(u.bindBuffer(u.ARRAY_BUFFER,this.initVertexBuffer(o)),this.setUVAttribute(p,r.name)),a&&(u.bindBuffer(u.ARRAY_BUFFER,this.initVertexBuffer(a)),this.setVertexAttribute(p,"a_internal_normal",2,r.name));var h=e.count?e.count:i.length/2;this.setBlendMode(e.shouldBlendAlpha),u.drawArrays(u.TRIANGLE_STRIP,0,h),u.disable(u.BLEND)}},e.prototype.stepLines=function(e){var r=this,t=r.gl,n=r.errorState,i=r.width,o=r.height,a=e.indices,s=e.uvs,u=e.normals,f=e.input,c=e.output,p=e.program;if(!n){if(e.closeLoop&&a)throw new Error("GPUComposer.stepLines() can't be called with closeLoop == true and indices.");var h=s?u?p._defaultProgramWithUVNormal:p._defaultProgramWithUV:u?p._defaultProgramWithNormal:p._defaultProgram;this.drawSetup(h,!1,f,c);var _=e.count?e.count:a?a.length:e.positions.length/2;if(p._setVertexUniform(h,"u_internal_scale",[2/i,2/o],l.FLOAT),p._setVertexUniform(h,"u_internal_translation",[-1,-1],l.FLOAT),a){for(var d=new Float32Array(2*_),m=0;m<_;m++){var g=a[m];d[2*m]=e.positions[2*g],d[2*m+1]=e.positions[2*g+1]}t.bindBuffer(t.ARRAY_BUFFER,this.initVertexBuffer(d))}else t.bindBuffer(t.ARRAY_BUFFER,this.initVertexBuffer(e.positions));this.setPositionAttribute(h,p.name),s&&(t.bindBuffer(t.ARRAY_BUFFER,this.initVertexBuffer(s)),this.setUVAttribute(h,p.name)),u&&(t.bindBuffer(t.ARRAY_BUFFER,this.initVertexBuffer(u)),this.setVertexAttribute(h,"a_internal_normal",2,p.name)),this.setBlendMode(e.shouldBlendAlpha),e.indices?t.drawArrays(t.LINES,0,_):e.closeLoop?t.drawArrays(t.LINE_LOOP,0,_):t.drawArrays(t.LINE_STRIP,0,_),t.disable(t.BLEND)}},e.prototype.drawLayerAsPoints=function(e){var r=this,t=r.gl,n=r.errorState,o=r.pointIndexArray,a=r.width,s=r.height,u=e.positions,f=e.output;if(!n){if(2!==u.numComponents&&4!==u.numComponents)throw new Error('GPUComposer.drawPoints() must be passed a position GPULayer with either 2 or 4 components, got position GPULayer "'+u.name+'" with '+u.numComponents+" components.");var p=u.length,h=e.count||p;if(h>p)throw new Error("Invalid count "+h+" for position GPULayer of length "+p+".");var _=e.program;if(void 0===_){_=this._setValueProgramForType(l.FLOAT);var d=e.color||[1,0,0];_.setUniform("u_value",i(d,[1]),l.FLOAT)}var m=_._GPULayerPointsProgram,g=this.addLayerToInputs(u,e.input);this.drawSetup(m,!1,g,f),_._setVertexUniform(m,"u_internal_positions",g.indexOf(u),l.INT),_._setVertexUniform(m,"u_internal_scale",[1/a,1/s],l.FLOAT),_._setVertexUniform(m,"u_internal_positionWithAccumulation",4===u.numComponents?1:0,l.INT);var v=e.pointSize||1;_._setVertexUniform(m,"u_internal_pointSize",v,l.FLOAT);var A=[u.width,u.height];if(_._setVertexUniform(m,"u_internal_positionsDimensions",A,l.FLOAT),_._setVertexUniform(m,"u_internal_wrapX",e.wrapX?1:0,l.INT),_._setVertexUniform(m,"u_internal_wrapY",e.wrapY?1:0,l.INT),void 0===this.pointIndexBuffer||o&&o.length<h){var T=c.initSequentialFloatArray(p);this.pointIndexArray=T,this.pointIndexBuffer=this.initVertexBuffer(T)}t.bindBuffer(t.ARRAY_BUFFER,this.pointIndexBuffer),this.setIndexAttribute(m,_.name),this.setBlendMode(e.shouldBlendAlpha),t.drawArrays(t.POINTS,0,h),t.disable(t.BLEND)}},e.prototype.drawLayerAsLines=function(e){var r=this,t=r.gl,n=r.errorState,o=r.width,a=r.height,s=e.positions,u=e.output;if(!n){if(2!==s.numComponents&&4!==s.numComponents)throw new Error('GPUComposer.drawLayerAsLines() must be passed a position GPULayer with either 2 or 4 components, got position GPULayer "'+s.name+'" with '+s.numComponents+" components.");if(e.closeLoop&&e.indices)throw new Error("GPUComposer.drawLayerAsLines() can't be called with closeLoop == true and indices.");var f=e.program;if(void 0===f){f=e.wrapX||e.wrapY?this.wrappedLineColorProgram:this._setValueProgramForType(l.FLOAT);var p=e.color||[1,0,0];f.setUniform("u_value",i(p,[1]),l.FLOAT)}var h=f._GPULayerLinesProgram,_=this.addLayerToInputs(s,e.input);this.drawSetup(h,!1,_,u);var d=e.indices?e.indices:c.initSequentialFloatArray(e.count||s.length),m=e.count?e.count:d.length;f._setVertexUniform(h,"u_internal_positions",_.indexOf(s),l.INT),f._setVertexUniform(h,"u_internal_scale",[1/o,1/a],l.FLOAT),f._setVertexUniform(h,"u_internal_positionWithAccumulation",4===s.numComponents?1:0,l.INT);var g=[s.width,s.height];if(f._setVertexUniform(h,"u_internal_positionsDimensions",g,l.FLOAT),f._setVertexUniform(h,"u_internal_wrapX",e.wrapX?1:0,l.INT),f._setVertexUniform(h,"u_internal_wrapY",e.wrapY?1:0,l.INT),void 0===this.indexedLinesIndexBuffer){var v=void 0;if(d.constructor!==Float32Array){v=new Float32Array(d.length);for(var A=0;A<m;A++)v[A]=d[A];console.warn("Converting indices array of type "+d.constructor+" to Float32Array in GPUComposer.drawIndexedLines for WebGL compatibility, you may want to use a Float32Array to store this information so the conversion is not required.")}else v=d;this.indexedLinesIndexBuffer=this.initVertexBuffer(v)}else t.bindBuffer(t.ARRAY_BUFFER,this.indexedLinesIndexBuffer),t.bufferData(t.ARRAY_BUFFER,d,t.STATIC_DRAW);this.setIndexAttribute(h,f.name),this.setBlendMode(e.shouldBlendAlpha),e.indices?t.drawArrays(t.LINES,0,m):e.closeLoop?t.drawArrays(t.LINE_LOOP,0,m):t.drawArrays(t.LINE_STRIP,0,m),t.disable(t.BLEND)}},e.prototype.drawLayerAsVectorField=function(e){var r=this,t=r.gl,n=r.errorState,o=r.vectorFieldIndexArray,a=r.width,s=r.height,u=e.data,f=e.output;if(!n){if(2!==u.numComponents)throw new Error('GPUComposer.drawLayerAsVectorField() must be passed a fieldLayer with 2 components, got fieldLayer "'+u.name+'" with '+u.numComponents+" components.");var p=e.program;if(void 0===p){p=this._setValueProgramForType(l.FLOAT);var h=e.color||[1,0,0];p.setUniform("u_value",i(h,[1]),l.FLOAT)}var _=p._GPULayerVectorFieldProgram,d=this.addLayerToInputs(u,e.input);this.drawSetup(_,!1,d,f),p._setVertexUniform(_,"u_internal_vectors",d.indexOf(u),l.INT);var m=e.vectorScale||1;p._setVertexUniform(_,"u_internal_scale",[m/a,m/s],l.FLOAT);var g=e.vectorSpacing||10,v=[Math.floor(a/g),Math.floor(s/g)];p._setVertexUniform(_,"u_internal_dimensions",v,l.FLOAT);var A=2*v[0]*v[1];if(void 0===this.vectorFieldIndexBuffer||o&&o.length<A){var T=c.initSequentialFloatArray(A);this.vectorFieldIndexArray=T,this.vectorFieldIndexBuffer=this.initVertexBuffer(T)}t.bindBuffer(t.ARRAY_BUFFER,this.vectorFieldIndexBuffer),this.setIndexAttribute(_,p.name),this.setBlendMode(e.shouldBlendAlpha),t.drawArrays(t.LINES,0,A),t.disable(t.BLEND)}},e.prototype.drawLayerMagnitude=function(e){var r=this,t=r.gl,n=r.errorState,i=r.quadPositionsBuffer,o=e.data,a=e.output;if(!n){var s=this.vectorMagnitudeProgramForType(o.type),u=e.color||[1,0,0];s.setUniform("u_color",u,l.FLOAT);var f=e.scale||1;s.setUniform("u_scale",f,l.FLOAT),s.setUniform("u_internal_numDimensions",o.numComponents,l.INT);var c=s._defaultProgram,p=this.addLayerToInputs(o,e.input);this.drawSetup(c,!0,p,a),s._setVertexUniform(c,"u_internal_data",p.indexOf(o),l.INT),s._setVertexUniform(c,"u_internal_scale",[1,1],l.FLOAT),s._setVertexUniform(c,"u_internal_translation",[0,0],l.FLOAT),t.bindBuffer(t.ARRAY_BUFFER,i),this.setPositionAttribute(c,s.name),this.setBlendMode(e.shouldBlendAlpha),t.drawArrays(t.TRIANGLE_STRIP,0,4),t.disable(t.BLEND)}},e.prototype.getValues=function(e){var r=this.gl,t=this.glslVersion;e._bindOutputBuffer();var n,i=e.width,o=e.height,a=e.glNumChannels,s=e.glType,u=e.glFormat,f=e.internalType;switch(f){case l.HALF_FLOAT:void 0!==r.FLOAT?(a=4,u=r.RGBA,s=r.FLOAT,n=new Float32Array(i*o*a)):n=new Uint16Array(i*o*a);break;case l.FLOAT:a=4,u=r.RGBA,n=new Float32Array(i*o*a);break;case l.UNSIGNED_BYTE:if(t===l.GLSL1){a=4,u=r.RGBA,n=new Uint8Array(i*o*a);break}a=4,u=r.RGBA_INTEGER,s=r.UNSIGNED_INT,n=new Uint32Array(i*o*a);break;case l.UNSIGNED_SHORT:a=4,u=r.RGBA_INTEGER,s=r.UNSIGNED_INT,n=new Uint32Array(i*o*a);break;case l.UNSIGNED_INT:a=4,u=r.RGBA_INTEGER,n=new Uint32Array(i*o*a);break;case l.BYTE:case l.SHORT:a=4,u=r.RGBA_INTEGER,s=r.INT,n=new Int32Array(i*o*a);break;case l.INT:a=4,u=r.RGBA_INTEGER,n=new Int32Array(i*o*a);break;default:throw new Error("Unsupported internalType "+f+" for getValues().")}if(this.readyToRead()){r.readPixels(0,0,i,o,u,s,n);var c=e.numComponents,h=e.type,_=(e._length?e._length:i*o)*c,d=f===l.HALF_FLOAT&&n.constructor===Uint16Array,m=d?new DataView(n.buffer):void 0,g=n;if(f!==h)switch(h){case l.HALF_FLOAT:case l.FLOAT:g=new Float32Array(_);break;case l.UNSIGNED_BYTE:g=new Uint8Array(_);break;case l.BYTE:g=new Int8Array(_);break;case l.UNSIGNED_SHORT:g=new Uint16Array(_);break;case l.SHORT:g=new Int16Array(_);break;case l.UNSIGNED_INT:g=new Uint32Array(_);break;case l.INT:g=new Int32Array(_);break;default:throw new Error("Unsupported type "+h+" for getValues().")}if(d||g!==n||c!==a)for(var v=0,A=i*o;v<A;v++){var T=v*a,E=v*c;if(E>=_)break;for(var y=0;y<c;y++)g[E+y]=d?p.getFloat16(m,2*(T+y),!0):n[T+y]}return g.length!==_&&(g=g.slice(0,_)),g}throw new Error("Unable to read values from Buffer with status: "+r.checkFramebufferStatus(r.FRAMEBUFFER)+".")},e.prototype.readyToRead=function(){var e=this.gl;return e.checkFramebufferStatus(e.FRAMEBUFFER)==e.FRAMEBUFFER_COMPLETE},e.prototype.savePNG=function(e,r,t,n){void 0===r&&(r=e.name),void 0===n&&(n=o.saveAs);var i=this.getValues(e),s=e.width,u=e.height,f=document.createElement("canvas");f.width=s,f.height=u;for(var c=f.getContext("2d"),p=c.getImageData(0,0,s,u),h=p.data,_=e.type===l.FLOAT||e.type===l.HALF_FLOAT,d=0;d<u;d++)for(var m=0;m<s;m++){for(var g=d*s+m,v=(u-1-d)*s+m,A=0;A<e.numComponents;A++)h[4*v+A]=i[e.numComponents*g+A]*(_?255:1);e.numComponents<4&&(h[4*v+3]=255)}c.putImageData(p,0,0),f.toBlob((function(e){e?t?a.changeDpiBlob(e,t).then((function(e){n(e,r+".png")})):n(e,r+".png"):console.warn("Problem saving PNG, unable to init blob.")}),"image/png")},e.prototype.attachGPULayerToThreeTexture=function(e,r){if(!this.renderer)throw new Error("GPUComposer was not inited with a renderer.");if(e.numBuffers>1)throw new Error('GPULayer "'+e.name+'" contains multiple WebGL textures (one for each buffer) that are flip-flopped during compute cycles, please choose a GPULayer with one buffer.');var t=this.renderer.properties.get(r);t.__webglTexture=e.currentState,t.__webglInit=!0},e.prototype.resetThreeState=function(){if(!this.renderer)throw new Error("GPUComposer was not inited with a renderer.");var e=this.gl,r=this.renderer.getViewport(new f.Vector4);e.viewport(r.x,r.y,r.width,r.height),this.renderer.setRenderTarget(null),this.renderer.resetState()},e.prototype.dispose=function(){var e,r=this,t=r.gl,n=r.verboseLogging,i=r._vertexShaders,o=r.copyPrograms,a=r.setValuePrograms,s=r.vectorMagnitudePrograms;n&&console.log("Deallocating GPUComposer."),Object.values(i).forEach((function(e){e.shader&&(t.deleteShader(e.shader),delete e.shader)})),Object.values(o).forEach((function(e){e.dispose&&e.dispose()})),Object.keys(o).forEach((function(e){delete o[e]})),Object.values(a).forEach((function(e){e.dispose&&e.dispose()})),Object.keys(a).forEach((function(e){delete a[e]})),Object.values(s).forEach((function(e){e.dispose&&e.dispose()})),Object.keys(s).forEach((function(e){delete s[e]})),null===(e=this._wrappedLineColorProgram)||void 0===e||e.dispose(),delete this._wrappedLineColorProgram,delete this.renderer,delete this.gl},e}();r.GPUComposer=d},355:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.GPULayer=void 0;var n=t(501),i=t(627),o=t(738),a=t(581),s=t(593),l=function(){function e(r,t){this._bufferIndex=0,this.buffers=[];var n=(t||{}).name;if(!r)throw new Error('Error initing GPULayer "'+n+'": must pass GPUComposer instance to GPULayer(composer, params).');var a=["name","dimensions","type","numComponents","array","filter","wrapS","wrapT","writable","numBuffers","clearValue"],s=Object.keys(t);s.forEach((function(e){if(a.indexOf(e)<0)throw new Error('Invalid params key "'+e+'" passed to GPULayer(composer, params) with name "'+t.name+'".  Valid keys are '+a.join(", ")+".")})),["name","dimensions","type","numComponents"].forEach((function(e){if(s.indexOf(e)<0)throw new Error('Required params key "'+e+'" was not passed to GPUProgram(composer, params) with name "'+n+'".')}));var l=t.dimensions,u=t.type,f=t.numComponents,c=t.array,p=r.gl,h=r._errorCallback,_=r.glslVersion;if(this.composer=r,this.name=n,!i.isPositiveInteger(f)||f>4)throw new Error("Invalid numComponents: "+f+' for GPULayer "'+n+'".');this.numComponents=f;var d=!!t.writable;this.writable=d;var m=e.calcSize(l,n,r.verboseLogging),g=m.length,v=m.width,A=m.height;if(this._length=g,!i.isPositiveInteger(v))throw new Error("Invalid width: "+v+' for GPULayer "'+n+'".');if(this._width=v,!i.isPositiveInteger(A))throw new Error("Invalid length: "+A+' for GPULayer "'+n+'".');this._height=A;var T=g?o.NEAREST:u===o.FLOAT||u==o.HALF_FLOAT?o.LINEAR:o.NEAREST,E=void 0!==t.filter?t.filter:T;if(!i.isValidFilter(E))throw new Error("Invalid filter: "+E+' for GPULayer "'+n+'", must be one of ['+o.validFilters.join(", ")+"].");if(E===o.LINEAR&&u!==o.FLOAT&&u!=o.HALF_FLOAT)throw new Error('LINEAR filtering is not supported on integer types, please use NEAREST filtering for GPULayer "'+n+'" with type: '+u+".");this.filter=E;var y=void 0!==t.wrapS?t.wrapS:o.CLAMP_TO_EDGE;if(!i.isValidWrap(y))throw new Error("Invalid wrapS: "+y+' for GPULayer "'+n+'", must be one of ['+o.validWraps.join(", ")+"].");this.wrapS=y;var b=void 0!==t.wrapT?t.wrapT:o.CLAMP_TO_EDGE;if(!i.isValidWrap(b))throw new Error("Invalid wrapT: "+b+' for GPULayer "'+n+'", must be one of ['+o.validWraps.join(", ")+"].");if(this.wrapT=b,!i.isValidDataType(u))throw new Error("Invalid type: "+u+' for GPULayer "'+n+'", must be one of ['+o.validDataTypes.join(", ")+"].");this.type=u;var w=e.getInternalType({gl:p,type:u,glslVersion:_,writable:d,name:n,errorCallback:h});this.internalType=w;var U=e.getGLTextureParameters({gl:p,name:n,numComponents:f,writable:d,internalType:w,glslVersion:_,errorCallback:h}),L=U.glFormat,R=U.glInternalFormat,F=U.glType,P=U.glNumChannels;this.glInternalFormat=R,this.glFormat=L,this.glType=F,this.glNumChannels=P,this.internalFilter=e.getInternalFilter({gl:p,filter:E,internalType:w,name:n,errorCallback:h}),this.glFilter=p[this.internalFilter],this.internalWrapS=e.getInternalWrap({gl:p,wrap:y,name:n}),this.glWrapS=p[this.internalWrapS],this.internalWrapT=e.getInternalWrap({gl:p,wrap:b,name:n}),this.glWrapT=p[this.internalWrapT];var O=void 0!==t.numBuffers?t.numBuffers:1;if(!i.isPositiveInteger(O))throw new Error("Invalid numBuffers: "+O+' for GPULayer "'+n+'", must be positive integer.');this.numBuffers=O;var I=void 0!==t.clearValue?t.clearValue:0;this.clearValue=I,this.initBuffers(c)}return e.calcSize=function(e,r,t){var n,o,a;if(isNaN(e)){if(o=e[0],!i.isPositiveInteger(o))throw new Error("Invalid width: "+o+' for GPULayer "'+r+'", must be positive integer.');if(a=e[1],!i.isPositiveInteger(a))throw new Error("Invalid height: "+a+' for GPULayer "'+r+'", must be positive integer.')}else{if(!i.isPositiveInteger(e))throw new Error("Invalid length: "+e+' for GPULayer "'+r+'", must be positive integer.');for(var s=1,l=n=e;l>2;)s++,l/=2;o=Math.pow(2,Math.floor(s/2)+s%2),a=Math.pow(2,Math.floor(s/2)),t&&console.log("Using ["+o+", "+a+"] for 1D array of length "+e+' in GPULayer "'+r+'".')}return{width:o,height:a,length:n}},e.getInternalWrap=function(e){var r=e.gl,t=e.wrap,n=e.name;return s.isWebGL2(r)||t===o.CLAMP_TO_EDGE||s.isWebGL2(r)?t:(console.warn('Falling back to CLAMP_TO_EDGE wrapping for GPULayer "'+n+'" for WebGL 1.'),o.CLAMP_TO_EDGE)},e.getInternalFilter=function(e){var r=e.gl,t=e.errorCallback,n=e.internalType,i=e.name,s=e.filter;if(s===o.NEAREST)return s;n===o.HALF_FLOAT&&(a.getExtension(r,a.OES_TEXTURE_HAlF_FLOAT_LINEAR,t,!0)||a.getExtension(r,a.OES_TEXTURE_FLOAT_LINEAR,t,!0)||(console.warn('Falling back to NEAREST filter for GPULayer "'+i+'".'),s=o.NEAREST));n===o.FLOAT&&(a.getExtension(r,a.OES_TEXTURE_FLOAT_LINEAR,t,!0)||(console.warn('Falling back to NEAREST filter for GPULayer "'+i+'".'),s=o.NEAREST));return s},e.getInternalType=function(r){var t=r.gl,n=r.errorCallback,i=r.writable,l=r.name,u=r.glslVersion,f=r.type;if(e.shouldCastIntTypeAsFloat(r)&&(f===o.UNSIGNED_BYTE||f===o.BYTE?f=o.HALF_FLOAT:(console.warn("Falling back "+f+' type to FLOAT type for glsl1.x support for GPULayer "'+l+'".\nLarge UNSIGNED_INT or INT with absolute value > 16,777,216 are not supported, on mobile UNSIGNED_INT, INT, UNSIGNED_SHORT, and SHORT with absolute value > 2,048 may not be supported.'),f=o.FLOAT)),!s.isWebGL2(t)){if(f===o.FLOAT)if(a.getExtension(t,a.OES_TEXTURE_FLOAT,n,!0)||(console.warn('FLOAT not supported, falling back to HALF_FLOAT type for GPULayer "'+l+'".'),f=o.HALF_FLOAT),i)e.testFramebufferWrite({gl:t,type:f,glslVersion:u})||f===o.HALF_FLOAT||(console.warn('FLOAT not supported for writing operations, falling back to HALF_FLOAT type for GPULayer "'+l+'".'),f=o.HALF_FLOAT);if(f===o.HALF_FLOAT)if(a.getExtension(t,a.OES_TEXTURE_HALF_FLOAT,n),i)e.testFramebufferWrite({gl:t,type:f,glslVersion:u})||n("This browser does not support rendering to HALF_FLOAT textures.")}return i&&s.isWebGL2(t)&&(f===o.HALF_FLOAT||f===o.FLOAT)&&a.getExtension(t,a.EXT_COLOR_BUFFER_FLOAT,n),f},e.shouldCastIntTypeAsFloat=function(e){var r=e.gl,t=e.type;return(e.glslVersion!==o.GLSL3||!s.isWebGL2(r))&&(t===o.BYTE||t===o.SHORT||t===o.INT||t===o.UNSIGNED_SHORT||t===o.UNSIGNED_INT)},e.getGLTextureParameters=function(e){var r,t,n,i,l=e.gl,u=e.errorCallback,f=e.name,c=e.numComponents,p=e.internalType,h=e.writable,_=e.glslVersion;if(s.isWebGL2(l)){if(i=c,3===c&&h&&(i=4),p===o.FLOAT||p===o.HALF_FLOAT)switch(i){case 1:t=l.RED;break;case 2:t=l.RG;break;case 3:t=l.RGB;break;case 4:t=l.RGBA;break;default:throw new Error("Unsupported glNumChannels: "+i+' for GPULayer "'+f+'".')}else if(_===o.GLSL1&&p===o.UNSIGNED_BYTE)switch(i){case 1:if(!h){t=l.ALPHA;break}case 2:if(!h){t=l.LUMINANCE_ALPHA;break}case 3:t=l.RGB,i=3;break;case 4:t=l.RGBA,i=4;break;default:throw new Error("Unsupported glNumChannels: "+i+' for GPULayer "'+f+'".')}else switch(i){case 1:t=l.RED_INTEGER;break;case 2:t=l.RG_INTEGER;break;case 3:t=l.RGB_INTEGER;break;case 4:t=l.RGBA_INTEGER;break;default:throw new Error("Unsupported glNumChannels: "+i+' for GPULayer "'+f+'".')}switch(p){case o.HALF_FLOAT:switch(r=l.HALF_FLOAT,i){case 1:n=l.R16F;break;case 2:n=l.RG16F;break;case 3:n=l.RGB16F;break;case 4:n=l.RGBA16F;break;default:throw new Error("Unsupported glNumChannels: "+i+' for GPULayer "'+f+'".')}break;case o.FLOAT:switch(r=l.FLOAT,i){case 1:n=l.R32F;break;case 2:n=l.RG32F;break;case 3:n=l.RGB32F;break;case 4:n=l.RGBA32F;break;default:throw new Error("Unsupported glNumChannels: "+i+' for GPULayer "'+f+'".')}break;case o.UNSIGNED_BYTE:if(r=l.UNSIGNED_BYTE,_===o.GLSL1&&p===o.UNSIGNED_BYTE)n=t;else switch(i){case 1:n=l.R8UI;break;case 2:n=l.RG8UI;break;case 3:n=l.RGB8UI;break;case 4:n=l.RGBA8UI;break;default:throw new Error("Unsupported glNumChannels: "+i+' for GPULayer "'+f+'".')}break;case o.BYTE:switch(r=l.BYTE,i){case 1:n=l.R8I;break;case 2:n=l.RG8I;break;case 3:n=l.RGB8I;break;case 4:n=l.RGBA8I;break;default:throw new Error("Unsupported glNumChannels: "+i+' for GPULayer "'+f+'".')}break;case o.SHORT:switch(r=l.SHORT,i){case 1:n=l.R16I;break;case 2:n=l.RG16I;break;case 3:n=l.RGB16I;break;case 4:n=l.RGBA16I;break;default:throw new Error("Unsupported glNumChannels: "+i+' for GPULayer "'+f+'".')}break;case o.UNSIGNED_SHORT:switch(r=l.UNSIGNED_SHORT,i){case 1:n=l.R16UI;break;case 2:n=l.RG16UI;break;case 3:n=l.RGB16UI;break;case 4:n=l.RGBA16UI;break;default:throw new Error("Unsupported glNumChannels: "+i+' for GPULayer "'+f+'".')}break;case o.INT:switch(r=l.INT,i){case 1:n=l.R32I;break;case 2:n=l.RG32I;break;case 3:n=l.RGB32I;break;case 4:n=l.RGBA32I;break;default:throw new Error("Unsupported glNumChannels: "+i+' for GPULayer "'+f+'".')}break;case o.UNSIGNED_INT:switch(r=l.UNSIGNED_INT,i){case 1:n=l.R32UI;break;case 2:n=l.RG32UI;break;case 3:n=l.RGB32UI;break;case 4:n=l.RGBA32UI;break;default:throw new Error("Unsupported glNumChannels: "+i+' for GPULayer "'+f+'".')}break;default:throw new Error("Unsupported type: "+p+' for GPULayer "'+f+'".')}}else{switch(c){case 1:if(!h){t=l.ALPHA,n=l.ALPHA,i=1;break}case 2:if(!h){t=l.LUMINANCE_ALPHA,n=l.LUMINANCE_ALPHA,i=2;break}case 3:t=l.RGB,n=l.RGB,i=3;break;case 4:t=l.RGBA,n=l.RGBA,i=4;break;default:throw new Error("Unsupported numComponents: "+c+' for GPULayer "'+f+'".')}switch(p){case o.FLOAT:r=l.FLOAT;break;case o.HALF_FLOAT:r=l.HALF_FLOAT||a.getExtension(l,a.OES_TEXTURE_HALF_FLOAT,u).HALF_FLOAT_OES;break;case o.UNSIGNED_BYTE:r=l.UNSIGNED_BYTE;break;default:throw new Error("Unsupported type: "+p+' in WebGL 1.0 for GPULayer "'+f+'".')}}if(void 0===r||void 0===t||void 0===n){var d=[];throw void 0===r&&d.push("glType"),void 0===t&&d.push("glFormat"),void 0===n&&d.push("glInternalFormat"),new Error("Invalid type: "+p+" for numComponents: "+c+", unable to init parameter"+(d.length>1?"s":"")+" "+d.join(", ")+' for GPULayer "'+f+'".')}if(void 0===i||c<1||c>4||i<c)throw new Error("Invalid numChannels: "+i+" for numComponents: "+c+' for GPULayer "'+f+'".');return{glFormat:t,glInternalFormat:n,glType:r,glNumChannels:i}},e.testFramebufferWrite=function(r){var t=r.gl,n=r.type,i=r.glslVersion,a=t.createTexture();if(!a)return!1;t.bindTexture(t.TEXTURE_2D,a);var s=t[o.CLAMP_TO_EDGE],l=t[o.CLAMP_TO_EDGE],u=t[o.NEAREST];t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,s),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,l),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,u),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,u);var f=e.getGLTextureParameters({gl:t,name:"testFramebufferWrite",numComponents:1,writable:!0,internalType:n,glslVersion:i,errorCallback:function(){}}),c=f.glInternalFormat,p=f.glFormat,h=f.glType;t.texImage2D(t.TEXTURE_2D,0,c,100,100,0,p,h,null);var _=t.createFramebuffer();if(!_)return t.deleteTexture(a),!1;t.bindFramebuffer(t.FRAMEBUFFER,_),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,a,0);var d=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.deleteTexture(a),t.deleteFramebuffer(_),d},Object.defineProperty(e.prototype,"bufferIndex",{get:function(){return this._bufferIndex},enumerable:!1,configurable:!0}),e.prototype.saveCurrentStateToGPULayer=function(e){if(this.numBuffers<2)throw new Error("Can't call GPULayer.saveCurrentStateToGPULayer on GPULayer \""+this.name+'" with less than 2 buffers.');if(!this.writable)throw new Error("Can't call GPULayer.saveCurrentStateToGPULayer on read-only GPULayer \""+this.name+'".');if(e.writable)throw new Error("Can't call GPULayer.saveCurrentStateToGPULayer on GPULayer \""+this.name+'" using writable GPULayer "'+e.name+'".');if(e.glWrapS!==this.glWrapS||e.glWrapT!==this.glWrapT||e.wrapS!==this.wrapS||e.wrapT!==this.wrapT||e.width!==this.width||e.height!==this.height||e.glFilter!==this.glFilter||e.filter!==this.filter||e.glNumChannels!==this.glNumChannels||e.numComponents!==this.numComponents||e.glType!==this.glType||e.type!==this.type||e.glFormat!==this.glFormat||e.glInternalFormat!==this.glInternalFormat)throw new Error('Incompatible texture params between GPULayers "'+e.name+'" and "'+this.name+'".');if(!this.textureOverrides){this.textureOverrides=[];for(var r=0;r<this.numBuffers;r++)this.textureOverrides.push(void 0)}if(this.textureOverrides[this.bufferIndex])throw new Error("Can't call GPULayer.saveCurrentStateToGPULayer on GPULayer \""+this.name+'", this GPULayer has not written new state since last call to GPULayer.saveCurrentStateToGPULayer.');var t=this.currentState;this.textureOverrides[this.bufferIndex]=t,this.buffers[this.bufferIndex].texture=e.currentState,e._setCurrentStateTexture(t);var n=this.composer.gl,i=this.buffers[this.bufferIndex],o=i.framebuffer,a=i.texture;if(!o)throw new Error('No framebuffer for writable GPULayer "'+this.name+'".');n.bindFramebuffer(n.FRAMEBUFFER,o),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,a,0),n.bindFramebuffer(n.FRAMEBUFFER,null)},e.prototype._setCurrentStateTexture=function(e){if(this.writable)throw new Error("Can't call GPULayer._setCurrentStateTexture on writable texture \""+this.name+'".');this.buffers[this.bufferIndex].texture=e},e.initArrayForInternalType=function(e,r){switch(e){case o.HALF_FLOAT:return new Uint16Array(r);case o.FLOAT:return new Float32Array(r);case o.UNSIGNED_BYTE:return new Uint8Array(r);case o.BYTE:return new Int8Array(r);case o.UNSIGNED_SHORT:return new Uint16Array(r);case o.SHORT:return new Int16Array(r);case o.UNSIGNED_INT:return new Uint32Array(r);case o.INT:return new Int32Array(r);default:throw new Error("Unsupported internalType: "+e+".")}},e.prototype.validateDataArray=function(r){var t=this,i=t.numComponents,a=t.glNumChannels,s=(t.type,t.internalType),l=t.width,u=t.height,f=this._length;if(r.length!==l*u*i&&(!f||f&&r.length!==f*i))throw new Error("Invalid data length: "+r.length+' for GPULayer "'+this.name+'" of '+(f?"length "+f+" and ":"")+"dimensions: ["+l+", "+u+"] and numComponents: "+i+".");var c=!1;switch(r.constructor){case Array:c=!0;break;case Float32Array:c=s!==o.FLOAT;break;case Uint8Array:c=s!==o.UNSIGNED_BYTE;break;case Int8Array:c=s!==o.BYTE;break;case Uint16Array:c=s!==o.UNSIGNED_SHORT;break;case Int16Array:c=s!==o.SHORT;break;case Uint32Array:c=s!==o.UNSIGNED_INT;break;case Int32Array:c=s!==o.INT;break;default:throw new Error("Invalid array type: "+r.constructor.name+' for GPULayer "'+this.name+'", please use one of ['+o.validArrayTypes.map((function(e){return e.name})).join(", ")+"].")}var p=l*u*a,h=r.length!==p,_=s===o.HALF_FLOAT,d=r;if(c||h||_){d=e.initArrayForInternalType(s,p);for(var m=_?new DataView(d.buffer):null,g=0,v=r.length/i;g<v;g++)for(var A=0;A<i;A++){var T=r[g*i+A],E=g*a+A;_?n.setFloat16(m,2*E,T,!0):d[E]=T}}return d},e.prototype.initBuffers=function(e){for(var r=this,t=r.name,n=r.numBuffers,i=r.composer,o=r.glInternalFormat,a=r.glFormat,s=r.glType,l=r.glFilter,u=r.glWrapS,f=r.glWrapT,c=r.writable,p=r.width,h=r.height,_=i.gl,d=i._errorCallback,m=e?this.validateDataArray(e):void 0,g=0;g<n;g++){var v=_.createTexture();if(!v)return void d('Could not init texture for GPULayer "'+t+'": '+_.getError()+".");_.bindTexture(_.TEXTURE_2D,v),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,u),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,f),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,l),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,l),_.texImage2D(_.TEXTURE_2D,0,o,p,h,0,a,s,m||null);var A={texture:v};if(c){var T=_.createFramebuffer();if(!T)return void d('Could not init framebuffer for GPULayer "'+t+'": '+_.getError()+".");_.bindFramebuffer(_.FRAMEBUFFER,T),_.framebufferTexture2D(_.FRAMEBUFFER,_.COLOR_ATTACHMENT0,_.TEXTURE_2D,v,0);var E=_.checkFramebufferStatus(_.FRAMEBUFFER);E!=_.FRAMEBUFFER_COMPLETE&&d('Invalid status for framebuffer for GPULayer "'+t+'": '+E+"."),A.framebuffer=T}this.buffers.push(A)}_.bindTexture(_.TEXTURE_2D,null),_.bindFramebuffer(_.FRAMEBUFFER,null)},e.prototype.getStateAtIndex=function(e){if(e<0||e>=this.numBuffers)throw new Error("Invalid buffer index: "+e+' for GPULayer "'+this.name+'" with '+this.numBuffers+" buffer"+(this.numBuffers>1?"s":"")+".");return this.textureOverrides&&this.textureOverrides[e]?this.textureOverrides[e]:this.buffers[e].texture},Object.defineProperty(e.prototype,"currentState",{get:function(){return this.getStateAtIndex(this.bufferIndex)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastState",{get:function(){if(1===this.numBuffers)throw new Error('Cannot access lastState on GPULayer "'+this.name+'" with only one buffer.');return this.getStateAtIndex((this.bufferIndex-1+this.numBuffers)%this.numBuffers)},enumerable:!1,configurable:!0}),e.prototype._usingTextureOverrideForCurrentBuffer=function(){return this.textureOverrides&&this.textureOverrides[this.bufferIndex]},e.prototype._bindOutputBufferForWrite=function(e){e&&(this._bufferIndex=(this.bufferIndex+1)%this.numBuffers),this._bindOutputBuffer(),this.textureOverrides&&(this.textureOverrides[this.bufferIndex]=void 0)},e.prototype._bindOutputBuffer=function(){var e=this.composer.gl,r=this.buffers[this.bufferIndex].framebuffer;if(!r)throw new Error('GPULayer "'+this.name+'" is not writable.');e.bindFramebuffer(e.FRAMEBUFFER,r)},e.prototype.setFromArray=function(e,r){void 0===r&&(r=!1);for(var t=this,n=t.composer,i=t.glInternalFormat,o=t.glFormat,a=t.glType,s=t.numBuffers,l=t.width,u=t.height,f=t.bufferIndex,c=n.gl,p=this.validateDataArray(e),h=r?s:f+1,_=r?0:f;_<h;_++){var d=this.getStateAtIndex(_);c.bindTexture(c.TEXTURE_2D,d),c.texImage2D(c.TEXTURE_2D,0,i,l,u,0,o,a,p)}c.bindTexture(c.TEXTURE_2D,null)},e.prototype.resize=function(r,t){var n=this.name,i=this.composer.verboseLogging;i&&console.log('Resizing GPULayer "'+n+'" to '+JSON.stringify(r)+".");var o=e.calcSize(r,n,i),a=o.length,s=o.width,l=o.height;this._length=a,this._width=s,this._height=l,this.destroyBuffers(),this.initBuffers(t)},Object.defineProperty(e.prototype,"clearValue",{get:function(){return this._clearValue},set:function(e){var r=this.numComponents,t=this.type;if(!i.isValidClearValue(e,r,t))throw new Error("Invalid clearValue: "+JSON.stringify(e)+' for GPULayer "'+this.name+'", expected '+t+" or array of "+t+" of length "+r+".");this._clearValue=e},enumerable:!1,configurable:!0}),e.prototype.clear=function(r){void 0===r&&(r=!1);var t=this,a=t.name,s=t.composer,l=t.clearValue,u=t.numBuffers,f=t.bufferIndex,c=t.type;s.verboseLogging&&console.log('Clearing GPULayer "'+a+'".');var p=[];if(i.isNumber(l))p.push(l,l,l,l);else{p.push.apply(p,l);for(var h=p.length;h<4;h++)p.push(0)}var _=r?0:f,d=r?u:f+1;if(this.writable){var m=s._setValueProgramForType(c);m.setUniform("u_value",p);for(var g=_;g<d;g++)s.step({program:m,output:this})}else{var v=this,A=v.width,T=v.height,E=v.glNumChannels,y=v.internalType,b=v.glInternalFormat,w=v.glFormat,U=v.glType,L=s.gl,R=this._length?this._length:A*T,F=e.initArrayForInternalType(y,A*T*E),P=y===o.HALF_FLOAT?new DataView(F.buffer):null;for(h=0;h<R;h++)for(var O=0;O<E;O++){var I=h*E+O;y===o.HALF_FLOAT?n.setFloat16(P,2*I,p[O],!0):F[I]=p[O]}for(g=_;g<d;g++){var N=this.getStateAtIndex(g);L.bindTexture(L.TEXTURE_2D,N),L.texImage2D(L.TEXTURE_2D,0,b,A,T,0,w,U,F)}L.bindTexture(L.TEXTURE_2D,null)}},Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){if(!this._length)throw new Error('Cannot access length on 2D GPULayer "'+this.name+'".');return this._length},enumerable:!1,configurable:!0}),e.prototype.destroyBuffers=function(){var e=this.composer,r=this.buffers,t=e.gl;r.forEach((function(e){var r=e.framebuffer,n=e.texture;t.deleteTexture(n),r&&t.deleteFramebuffer(r),delete e.texture,delete e.framebuffer})),r.length=0,delete this.textureOverrides},e.prototype.dispose=function(){var e=this.name;this.composer.verboseLogging&&console.log('Deallocating GPULayer "'+e+'".'),this.destroyBuffers(),delete this.composer},e.prototype.clone=function(e){return this.composer._cloneGPULayer(this,e)},e}();r.GPULayer=l},664:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.GPUProgram=void 0;var n=t(627),i=t(738),o=t(593),a=function(){function e(e,r){this.defines={},this.uniforms={},this.programs={};var t=(r||{}).name;if(!e)throw new Error('Error initing GPUProgram "'+t+'": must pass GPUComposer instance to GPUProgram(composer, params).');var n=["name","fragmentShader","uniforms","defines"],i=Object.keys(r);i.forEach((function(e){if(n.indexOf(e)<0)throw new Error('Invalid params key "'+e+'" passed to GPUProgram(composer, params) with name "'+t+'".  Valid keys are '+n.join(", ")+".")})),["name","fragmentShader"].forEach((function(e){if(i.indexOf(e)<0)throw new Error('Required params key "'+e+'" was not passed to GPUProgram(composer, params) with name "'+t+'".')}));var o=r.fragmentShader,a=r.uniforms,s=r.defines;this.composer=e,this.name=t;var l="string"==typeof o?o:o.join("\n");if(this.fragmentShaderSource=l,this.recompile(s||this.defines),a)for(var u=0;u<a.length;u++){var f=a[u],c=f.name,p=f.value,h=f.type;this.setUniform(c,p,h)}}return e.prototype.recompile=function(e){for(var r=this,t=r.composer,n=r.name,i=r.fragmentShaderSource,a=t.gl,s=t._errorCallback,l=t.verboseLogging,u=t.glslVersion,f=!1,c=Object.keys(e),p=0;p<c.length;p++){var h=c[p];this.defines[h]!==e[h]&&(f=!0,this.defines[h]=e[h])}if(!this.fragmentShader||f){l&&console.log('Compiling fragment shader for GPUProgram "'+n+'" with defines: '+JSON.stringify(this.defines));var _=o.compileShader(a,u,i,a.FRAGMENT_SHADER,n,s,this.defines);_?this.fragmentShader=_:s('Unable to compile fragment shader for GPUProgram "'+n+'".')}},e.prototype.getProgramWithName=function(e){if(this.programs[e])return this.programs[e];var r=this,t=r.composer,n=r.uniforms,i=r.fragmentShader,a=t._errorCallback,s=t._vertexShaders,l=t.gl,u=t.glslVersion,f=s[e];if(void 0===f.shader){var c=this.composer,p=c.gl,h=c._preprocessVertShader(f.src);if(""===h)throw new Error("No source for vertex shader "+this.name+" : "+e);var _=o.compileShader(p,u,h,p.VERTEX_SHADER,this.name,a,f.defines);if(!_)return void a('Unable to compile "'+e+'" vertex shader for GPUProgram "'+this.name+'".');f.shader=_}var d=o.initGLProgram(l,i,f.shader,this.name,a);if(void 0!==d){for(var m=Object.keys(n),g=0;g<m.length;g++){var v=m[g],A=n[v],T=A.value,E=A.type;this.setProgramUniform(d,e,v,T,E)}return this.programs[e]=d,d}a('Unable to init program "'+e+'" for GPUProgram "'+this.name+'".')},Object.defineProperty(e.prototype,"_defaultProgram",{get:function(){return this.getProgramWithName(i.DEFAULT_PROGRAM_NAME)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_defaultProgramWithUV",{get:function(){return this.getProgramWithName(i.DEFAULT_W_UV_PROGRAM_NAME)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_defaultProgramWithNormal",{get:function(){return this.getProgramWithName(i.DEFAULT_W_NORMAL_PROGRAM_NAME)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_defaultProgramWithUVNormal",{get:function(){return this.getProgramWithName(i.DEFAULT_W_UV_NORMAL_PROGRAM_NAME)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_segmentProgram",{get:function(){return this.getProgramWithName(i.SEGMENT_PROGRAM_NAME)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_GPULayerPointsProgram",{get:function(){return this.getProgramWithName(i.DATA_LAYER_POINTS_PROGRAM_NAME)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_GPULayerVectorFieldProgram",{get:function(){return this.getProgramWithName(i.DATA_LAYER_VECTOR_FIELD_PROGRAM_NAME)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_GPULayerLinesProgram",{get:function(){return this.getProgramWithName(i.DATA_LAYER_LINES_PROGRAM_NAME)},enumerable:!1,configurable:!0}),e.prototype.uniformInternalTypeForValue=function(e,r){if(r===i.FLOAT){if(n.isArray(e)){for(var t=0;t<e.length;t++)if(!n.isNumber(e[t]))throw new Error("Invalid uniform value: "+e+' for program "'+this.name+'", expected float or float[] of length 1-4.')}else if(!n.isNumber(e))throw new Error("Invalid uniform value: "+e+' for program "'+this.name+'", expected float or float[] of length 1-4.');if(!n.isArray(e)||1===e.length)return i.FLOAT_1D_UNIFORM;if(2===e.length)return i.FLOAT_2D_UNIFORM;if(3===e.length)return i.FLOAT_3D_UNIFORM;if(4===e.length)return i.FLOAT_4D_UNIFORM;throw new Error("Invalid uniform value: "+e+' for program "'+this.name+'", expected float or float[] of length 1-4.')}if(r===i.INT){if(n.isArray(e)){for(t=0;t<e.length;t++)if(!n.isInteger(e[t]))throw new Error("Invalid uniform value: "+e+' for program "'+this.name+'", expected int or int[] of length 1-4.')}else if(!n.isInteger(e))throw new Error("Invalid uniform value: "+e+' for program "'+this.name+'", expected int or int[] of length 1-4.');if(!n.isArray(e)||1===e.length)return i.INT_1D_UNIFORM;if(2===e.length)return i.INT_2D_UNIFORM;if(3===e.length)return i.INT_3D_UNIFORM;if(4===e.length)return i.INT_4D_UNIFORM;throw new Error("Invalid uniform value: "+e+' for program "'+this.name+'", expected int or int[] of length 1-4.')}if(r===i.BOOL){if(n.isBoolean(e))return i.INT_1D_UNIFORM;throw new Error("Invalid uniform value: "+e+' for program "'+this.name+'", expected boolean.')}throw new Error("Invalid uniform type: "+r+' for program "'+this.name+'", expected '+i.FLOAT+" or "+i.INT+" of "+i.BOOL+".")},e.prototype.setProgramUniform=function(e,r,t,o,a){var s,l=this.composer,u=this.uniforms,f=l.gl,c=l._errorCallback;f.useProgram(e);var p=null===(s=u[t])||void 0===s?void 0:s.location[r];if(void 0===p){var h=f.getUniformLocation(e,t);if(!h)return void c('Could not init uniform "'+t+'" for program "'+this.name+'".\nCheck that uniform is present in shader code, unused uniforms may be removed by compiler.\nAlso check that uniform type in shader code matches type '+a+".\nError code: "+f.getError()+".");p=h,u[t]&&(u[t].location[r]=p)}switch(a){case i.FLOAT_1D_UNIFORM:f.uniform1f(p,o);break;case i.FLOAT_2D_UNIFORM:f.uniform2fv(p,o);break;case i.FLOAT_3D_UNIFORM:f.uniform3fv(p,o);break;case i.FLOAT_4D_UNIFORM:f.uniform4fv(p,o);break;case i.INT_1D_UNIFORM:n.isBoolean(o)?f.uniform1i(p,o?1:0):f.uniform1i(p,o);break;case i.INT_2D_UNIFORM:f.uniform2iv(p,o);break;case i.INT_3D_UNIFORM:f.uniform3iv(p,o);break;case i.INT_4D_UNIFORM:f.uniform4iv(p,o);break;default:throw new Error("Unknown uniform type "+a+' for GPUProgram "'+this.name+'".')}},e.prototype.setUniform=function(e,r,t){var i,o=this,a=o.programs,s=o.uniforms,l=o.composer.verboseLogging;if(n.isArray(r)&&r.length>4)throw new Error("Invalid uniform value: ["+r.join(", ")+'] passed to GPUProgram "'+this.name+', uniforms must be of type number[] with length <= 4, number, or boolean."');var u=null===(i=s[e])||void 0===i?void 0:i.type;if(t){var f=this.uniformInternalTypeForValue(r,t);if(void 0===u)u=f;else if(u!==f)throw new Error('Uniform "'+e+'" for GPUProgram "'+this.name+'" cannot change from type '+u+" to type "+f+".")}if(void 0===u)throw new Error('Unknown type for uniform "'+e+'", please pass in type to GPUProgram.setUniform(name, value, type) when initing a new uniform.');if(s[e]){if(n.isArray(r)){for(var c=!0,p=0;p<r.length;p++)if(s[e].value!==r){c=!0;break}if(!c)return}else if(s[e].value===r)return;s[e].value=r}else s[e]={type:u,location:{},value:r};l&&console.log('Setting uniform "'+e+'" for program "'+this.name+'" to value '+JSON.stringify(r)+" with type "+u+".");var h=Object.keys(a);for(p=0;p<h.length;p++){var _=h[p];this.setProgramUniform(a[_],_,e,r,u)}},e.prototype._setVertexUniform=function(e,r,t,n){var i=this,o=this.uniformInternalTypeForValue(t,n);if(void 0===e)throw new Error("Must pass in valid WebGLProgram to setVertexUniform, got undefined.");var a=Object.keys(this.programs).find((function(r){return i.programs[r]===e}));if(!a)throw new Error('Could not find valid vertex programName for WebGLProgram "'+this.name+'".');this.setProgramUniform(e,a,r,t,o)},e.prototype.dispose=function(){var e=this,r=this,t=r.composer,n=r.fragmentShader,i=r.programs,o=t.gl;t.verboseLogging&&console.log('Deallocating GPUProgram "'+this.name+'".'),Object.values(i).forEach((function(e){o.deleteProgram(e)})),Object.keys(this.programs).forEach((function(r){delete e.programs[r]})),o.deleteShader(n),delete this.fragmentShader,delete this.composer,delete this.name,delete this.fragmentShaderSource,delete this.defines,delete this.uniforms,delete this.programs},e}();r.GPUProgram=a},404:(e,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Vector4=void 0;var t=function(){function e(e,r,t,n){void 0===e&&(e=0),void 0===r&&(r=0),void 0===t&&(t=0),void 0===n&&(n=1),this.x=e,this.y=r,this.z=t,this.w=n}return Object.defineProperty(e.prototype,"width",{get:function(){return this.z},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.w},enumerable:!1,configurable:!0}),e.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},e}();r.Vector4=t},581:(e,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getExtension=r.EXT_COLOR_BUFFER_FLOAT=r.WEBGL_DEPTH_TEXTURE=r.OES_TEXTURE_HAlF_FLOAT_LINEAR=r.OES_TEXTURE_FLOAT_LINEAR=r.OES_TEXTURE_HALF_FLOAT=r.OES_TEXTURE_FLOAT=void 0;var t={};r.OES_TEXTURE_FLOAT="OES_texture_float",r.OES_TEXTURE_HALF_FLOAT="OES_texture_half_float",r.OES_TEXTURE_FLOAT_LINEAR="OES_texture_float_linear",r.OES_TEXTURE_HAlF_FLOAT_LINEAR="OES_texture_half_float_linear",r.WEBGL_DEPTH_TEXTURE="WEBGL_depth_texture",r.EXT_COLOR_BUFFER_FLOAT="EXT_color_buffer_float",r.getExtension=function(e,r,n,i){if(void 0===i&&(i=!1),void 0!==t[r])return t[r];var o;try{o=e.getExtension(r)}catch(e){}return o?(t[r]=o,console.log("Loaded extension: "+r+".")):(t[r]=!1,console.warn("Unsupported "+(i?"optional ":"")+"extension: "+r+".")),o||i||n("Required extension unsupported by this device / browser: "+r+"."),o}},607:function(e,r,t){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,r,t,n){void 0===n&&(n=t),Object.defineProperty(e,n,{enumerable:!0,get:function(){return r[t]}})}:function(e,r,t,n){void 0===n&&(n=t),e[n]=r[t]}),i=this&&this.__exportStar||function(e,r){for(var t in e)"default"===t||Object.prototype.hasOwnProperty.call(r,t)||n(r,e,t)};Object.defineProperty(r,"__esModule",{value:!0}),r.getVertexMediumpPrecision=r.getFragmentMediumpPrecision=r.isWebGL2Supported=r.GPUProgram=r.GPULayer=r.GPUComposer=void 0;var o=t(593);Object.defineProperty(r,"isWebGL2Supported",{enumerable:!0,get:function(){return o.isWebGL2Supported}}),Object.defineProperty(r,"getFragmentMediumpPrecision",{enumerable:!0,get:function(){return o.getFragmentMediumpPrecision}}),Object.defineProperty(r,"getVertexMediumpPrecision",{enumerable:!0,get:function(){return o.getVertexMediumpPrecision}});var a=t(484);Object.defineProperty(r,"GPUComposer",{enumerable:!0,get:function(){return a.GPUComposer}});var s=t(355);Object.defineProperty(r,"GPULayer",{enumerable:!0,get:function(){return s.GPULayer}});var l=t(664);Object.defineProperty(r,"GPUProgram",{enumerable:!0,get:function(){return l.GPUProgram}}),i(t(738),r)},593:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.initSequentialFloatArray=r.isPowerOf2=r.getVertexMediumpPrecision=r.getFragmentMediumpPrecision=r.isWebGL2Supported=r.isWebGL2=r.initGLProgram=r.compileShader=r.insertDefinesAfterVersionDeclaration=void 0;var n=t(627),i=t(738);function o(e,r,t){var o=function(e){for(var r="",t=Object.keys(e),i=0;i<t.length;i++){var o=t[i];if(!n.isString(o)||!n.isString(e[o]))throw new Error("GPUProgram defines must be passed in as key value pairs that are both strings, got key value pair of type ["+typeof o+" : "+typeof e[o]+"].");r+="#define "+o+" "+e[o]+"\n"}return r}(t);return r=e===i.GLSL1?o+"\n"+r:r.replace("\n","\n"+o+"\n")}function a(e,r,t,n,i,a,s){s&&(t=o(r,t,s));var l=e.createShader(n);return l?(e.shaderSource(l,t),e.compileShader(l),e.getShaderParameter(l,e.COMPILE_STATUS)?l:(a("Could not compile "+(n===e.FRAGMENT_SHADER?"fragment":"vertex")+'\n\t\t\t shader for program "'+i+'": '+e.getShaderInfoLog(l)+"."),null)):(a("Unable to init gl shader."),null)}function s(e,r,t,n,i){var o=e.createProgram();if(o){if(e.attachShader(o,r),e.attachShader(o,t),e.linkProgram(o),e.getProgramParameter(o,e.LINK_STATUS))return o;i('GPUProgram "'+n+'" failed to link: '+e.getProgramInfoLog(o))}else i('Unable to init gl program for GPUProgram "'+n+'", gl.createProgram() has failed.')}r.insertDefinesAfterVersionDeclaration=o,r.compileShader=a,r.initGLProgram=s,r.isWebGL2=function(e){return"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext},r.isWebGL2Supported=function(){return!!document.createElement("canvas").getContext("webgl2")},r.getFragmentMediumpPrecision=function(){var e=function(e){throw new Error(e)},r=document.createElement("canvas").getContext("webgl");if(!r)throw new Error("Unable to init webgl context.");var t=a(r,i.GLSL1,"\nattribute vec4 position;  // needed because of another bug in Safari\nvoid main() {\n\tgl_Position = position;\n\tgl_PointSize = 1.0;\n}\n\t",r.VERTEX_SHADER,"mediumpPrecisionFragmentTest",e);if(!t)throw new Error("Unable to init vertex shader.");var n=a(r,i.GLSL1,"\nprecision mediump float;\nuniform mediump vec3 v;\nvoid main() {\n\tgl_FragColor = vec4(normalize(v) * 0.5 + 0.5, 1);\n}\n\t",r.FRAGMENT_SHADER,"mediumpPrecisionFragmentTest",e);if(!n)throw new Error("Unable to init fragment shader.");var o=s(r,n,t,"mediumpPrecisionFragmentTest",e);if(!o)throw new Error("Unable to init WebGLProgram.");var l=r.getAttribLocation(o,"position"),u=r.getUniformLocation(o,"v"),f=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,f),r.bufferData(r.ARRAY_BUFFER,1,r.STATIC_DRAW),r.enableVertexAttribArray(l),r.vertexAttribPointer(l,1,r.UNSIGNED_BYTE,!1,0,0),r.viewport(0,0,1,1),r.useProgram(o);var c=Math.pow(2,31)-1,p=Math.sqrt(c),h=255*(p/Math.sqrt(p*p*3)*.5+.5)|0;r.uniform3f(u,p,p,p),r.drawArrays(r.POINTS,0,1);var _=new Uint8Array(4);return r.readPixels(0,0,1,1,r.RGBA,r.UNSIGNED_BYTE,_),r.deleteProgram(o),r.deleteShader(t),r.deleteShader(n),r.deleteBuffer(f),Math.abs(_[0]-h)>16?i.PRECISION_MEDIUM_P:i.PRECISION_HIGH_P},r.getVertexMediumpPrecision=function(){var e=function(e){throw new Error(e)},r=document.createElement("canvas").getContext("webgl");if(!r)throw new Error("Unable to init webgl context.");var t=a(r,i.GLSL1,"\nattribute vec4 position;  // needed because of another bug in Safari\nuniform mediump vec3 v;\nvarying mediump vec4 v_result;\nvoid main() {\n\tgl_Position = position;\n\tgl_PointSize = 1.0;\n\tv_result = vec4(normalize(v) * 0.5 + 0.5, 1);\n}\n\t",r.VERTEX_SHADER,"mediumpPrecisionVertexTest",e);if(!t)throw new Error("Unable to init vertex shader.");var n=a(r,i.GLSL1,"\nprecision mediump float;\nvarying mediump vec4 v_result;\nvoid main() {\n\tgl_FragColor = v_result;\n}\n\t",r.FRAGMENT_SHADER,"mediumpPrecisionVertexTest",e);if(!n)throw new Error("Unable to init fragment shader.");var o=s(r,n,t,"mediumpPrecisionVertexTest",e);if(!o)throw new Error("Unable to init WebGLProgram.");var l=r.getAttribLocation(o,"position"),u=r.getUniformLocation(o,"v");r.bindBuffer(r.ARRAY_BUFFER,r.createBuffer()),r.bufferData(r.ARRAY_BUFFER,1,r.STATIC_DRAW),r.enableVertexAttribArray(l),r.vertexAttribPointer(l,1,r.UNSIGNED_BYTE,!1,0,0),r.viewport(0,0,1,1),r.useProgram(o);var f=Math.pow(2,31)-1,c=Math.sqrt(f),p=255*(c/Math.sqrt(c*c*3)*.5+.5)|0;r.uniform3f(u,c,c,c),r.drawArrays(r.POINTS,0,1);var h=new Uint8Array(4);return r.readPixels(0,0,1,1,r.RGBA,r.UNSIGNED_BYTE,h),Math.abs(h[0]-p)>16?i.PRECISION_MEDIUM_P:i.PRECISION_HIGH_P},r.isPowerOf2=function(e){return 0==(e&e-1)},r.initSequentialFloatArray=function(e){for(var r=new Float32Array(e),t=0;t<e;t++)r[t]=t;return r}},158:e=>{e.exports="#version 300 es\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;precision highp int;\n#else\nprecision mediump float;precision mediump int;\n#endif\nprecision lowp sampler2D;precision lowp isampler2D;precision lowp usampler2D;in vec2 v_UV;\n#ifdef FLOAT\nuniform sampler2D u_state;\n#endif\n#ifdef INT\nuniform isampler2D u_state;\n#endif\n#ifdef UINT\nuniform usampler2D u_state;\n#endif\n#ifdef FLOAT\nout vec4 out_fragOut;\n#endif\n#ifdef INT\nout ivec4 out_fragOut;\n#endif\n#ifdef UINT\nout uvec4 out_fragOut;\n#endif\nvoid main(){out_fragOut=A(u_state,v_UV);}"},148:e=>{e.exports="#version 300 es\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;precision highp int;\n#else\nprecision mediump float;precision mediump int;\n#endif\nprecision lowp sampler2D;precision lowp isampler2D;precision lowp usampler2D;\n#ifdef FLOAT\nuniform vec4 u_value;\n#endif\n#ifdef INT\nuniform ivec4 u_value;\n#endif\n#ifdef UINT\nuniform uvec4 u_value;\n#endif\n#ifdef FLOAT\nout vec4 out_fragOut;\n#endif\n#ifdef INT\nout ivec4 out_fragOut;\n#endif\n#ifdef UINT\nout uvec4 out_fragOut;\n#endif\nvoid main(){out_fragOut=u_value;}"},723:e=>{e.exports="#version 300 es\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;precision highp int;\n#else\nprecision mediump float;precision mediump int;\n#endif\nprecision lowp sampler2D;precision lowp isampler2D;precision lowp usampler2D;in vec2 v_UV;uniform vec3 u_color;uniform float u_scale;\n#ifdef FLOAT\nuniform sampler2D u_internal_data;\n#endif\n#ifdef INT\nuniform isampler2D u_internal_data;\n#endif\n#ifdef UINT\nuniform usampler2D u_internal_data;\n#endif\nout vec4 out_fragOut;void main(){uvec4 A=B(u_internal_data,v_UV);float C=length(A);out_fragOut=vec4(C*u_scale*u_color,1);}"},598:e=>{e.exports="#version 300 es\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;precision highp int;\n#else\nprecision mediump float;precision mediump int;\n#endif\nprecision lowp sampler2D;precision lowp isampler2D;precision lowp usampler2D;in vec2 v_lineWrapping;uniform vec4 u_value;out vec4 out_fragOut;void main(){if((v_lineWrapping.x!=0.&&v_lineWrapping.x!=1.)||(v_lineWrapping.y!=0.&&v_lineWrapping.y!=1.)){discard;return;}out_fragOut=vec4(u_value);}"},288:e=>{e.exports="#version 300 es\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;precision highp int;\n#else\nprecision mediump float;precision mediump int;\n#endif\nprecision lowp sampler2D;precision lowp isampler2D;precision lowp usampler2D;in vec2 a_internal_position;\n#ifdef UV_ATTRIBUTE\nin vec2 a_internal_uv;\n#endif\n#ifdef NORMAL_ATTRIBUTE\nin vec2 a_internal_normal;\n#endif\nuniform vec2 u_internal_scale;uniform vec2 u_internal_translation;out vec2 v_UV;out vec2 v_UV_local;\n#ifdef NORMAL_ATTRIBUTE\nout vec2 v_normal;\n#endif\nvoid main(){\n#ifdef UV_ATTRIBUTE\nv_UV_local=a_internal_uv;\n#else\nv_UV_local=a_internal_position;\n#endif\n#ifdef NORMAL_ATTRIBUTE\nv_normal=a_internal_normal;\n#endif\nvec2 A=u_internal_scale*a_internal_position+u_internal_translation;v_UV=0.5*(A+1.);gl_Position=vec4(A,0,1);}"},629:e=>{e.exports="#version 300 es\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;precision highp int;\n#else\nprecision mediump float;precision mediump int;\n#endif\nprecision lowp sampler2D;precision lowp isampler2D;precision lowp usampler2D;float A(float B,float C){float D=B-floor((B+0.5)/C)*C;return floor(D+0.5);}in float a_internal_index;uniform sampler2D u_internal_positions;uniform vec2 u_internal_positionsDimensions;uniform vec2 u_internal_scale;uniform bool u_internal_positionWithAccumulation;uniform bool u_internal_wrapX;uniform bool u_internal_wrapY;out vec2 v_UV;out vec2 v_lineWrapping;out float v_index;void main(){vec2 E=vec2(A(a_internal_index,u_internal_positionsDimensions.x),floor(floor(a_internal_index+0.5)/u_internal_positionsDimensions.x))/u_internal_positionsDimensions;vec4 F=texture2D(u_internal_positions,E);vec2 G=F.rg;if(u_internal_positionWithAccumulation)G+=F.ba;v_UV=G*u_internal_scale;v_lineWrapping=vec2(0.);if(u_internal_wrapX){if(v_UV.x<0.){v_UV.x+=1.;v_lineWrapping.x=1.;}else if(v_UV.x>1.){v_UV.x-=1.;v_lineWrapping.x=1.;}}if(u_internal_wrapY){if(v_UV.y<0.){v_UV.y+=1.;v_lineWrapping.y=1.;}else if(v_UV.y>1.){v_UV.y-=1.;v_lineWrapping.y=1.;}}vec2 H=v_UV*2.-1.;v_index=a_internal_index;gl_Position=vec4(H,0,1);}"},62:e=>{e.exports="#version 300 es\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;precision highp int;\n#else\nprecision mediump float;precision mediump int;\n#endif\nprecision lowp sampler2D;precision lowp isampler2D;precision lowp usampler2D;float A(float B,float C){float D=B-floor((B+0.5)/C)*C;return floor(D+0.5);}in float a_internal_index;uniform sampler2D u_internal_positions;uniform vec2 u_internal_positionsDimensions;uniform vec2 u_internal_scale;uniform float u_internal_pointSize;uniform bool u_internal_positionWithAccumulation;uniform bool u_internal_wrapX;uniform bool u_internal_wrapY;out vec2 v_UV;out float v_index;void main(){vec2 E=vec2(A(a_internal_index,u_internal_positionsDimensions.x),floor(floor(a_internal_index+0.5)/u_internal_positionsDimensions.x))/u_internal_positionsDimensions;vec4 F=texture2D(u_internal_positions,E);vec2 G=F.rg;if(u_internal_positionWithAccumulation)G+=F.ba;v_UV=G*u_internal_scale;if(u_internal_wrapX){if(v_UV.x<0.)v_UV.x+=1.;if(v_UV.x>1.)v_UV.x-=1.;}if(u_internal_wrapY){if(v_UV.y<0.)v_UV.y+=1.;if(v_UV.y>1.)v_UV.y-=1.;}vec2 H=v_UV*2.-1.;v_index=a_internal_index;gl_PointSize=u_internal_pointSize;gl_Position=vec4(H,0,1);}"},430:e=>{e.exports="#version 300 es\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;precision highp int;\n#else\nprecision mediump float;precision mediump int;\n#endif\nprecision lowp sampler2D;precision lowp isampler2D;precision lowp usampler2D;float A(float B,float C){float D=B-floor((B+0.5)/C)*C;return floor(D+0.5);}in float a_internal_index;uniform sampler2D u_internal_vectors;uniform vec2 u_internal_dimensions;uniform vec2 u_internal_scale;out vec2 v_UV;out float v_index;void main(){float E=floor((a_internal_index+0.5)/2.);v_UV=vec2(A(E,u_internal_dimensions.x),floor(floor(E+0.5)/u_internal_dimensions.x))/u_internal_dimensions;if(A(a_internal_index,2.)>0.){vec2 F=texture2D(u_internal_vectors,v_UV).xy;v_UV+=F*u_internal_scale;}vec2 G=v_UV*2.-1.;v_index=a_internal_index;gl_Position=vec4(G,0,1);}"},974:e=>{e.exports="#version 300 es\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;precision highp int;\n#else\nprecision mediump float;precision mediump int;\n#endif\nprecision lowp sampler2D;precision lowp isampler2D;precision lowp usampler2D;in vec2 a_internal_position;uniform float u_internal_halfThickness;uniform vec2 u_internal_scale;uniform float u_internal_length;uniform float u_internal_rotation;uniform vec2 u_internal_translation;out vec2 v_UV_local;out vec2 v_UV;mat2 A(float B){return mat2(cos(B),-sin(B),sin(B),cos(B));}void main(){v_UV_local=0.5*(a_internal_position+1.);vec2 C=a_internal_position;C*=u_internal_halfThickness;if(C.x<0.){C.x-=u_internal_length/2.;v_UV_local.x=0.;}else if(C.x>0.){C.x+=u_internal_length/2.;v_UV_local.x=1.;}C=u_internal_scale*(A(-u_internal_rotation)*C)+u_internal_translation;v_UV=0.5*(C+1.);gl_Position=vec4(C,0,1);}"}},r={};function t(n){var i=r[n];if(void 0!==i)return i.exports;var o=r[n]={id:n,loaded:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}return t.d=(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),t.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),t.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),t.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t(607)})()}));
//# sourceMappingURL=webgl-compute.min.js.map
!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports.WebGLCompute=r():e.WebGLCompute=r()}(self,(function(){return(()=>{var e={501:(e,r,t)=>{"use strict";t.r(r),t.d(r,{Float16Array:()=>De,getFloat16:()=>ke,hfround:()=>h,setFloat16:()=>He});const n=new ArrayBuffer(4),i=new Float32Array(n),o=new Uint32Array(n),a=new Uint32Array(512),s=new Uint32Array(512);for(let e=0;e<256;++e){const r=e-127;r<-27?(a[0|e]=0,a[256|e]=32768,s[0|e]=24,s[256|e]=24):r<-14?(a[0|e]=1024>>-r-14,a[256|e]=1024>>-r-14|32768,s[0|e]=-r-1,s[256|e]=-r-1):r<=15?(a[0|e]=r+15<<10,a[256|e]=r+15<<10|32768,s[0|e]=13,s[256|e]=13):r<128?(a[0|e]=31744,a[256|e]=64512,s[0|e]=24,s[256|e]=24):(a[0|e]=31744,a[256|e]=64512,s[0|e]=13,s[256|e]=13)}function u(e){i[0]=e;const r=o[0],t=r>>23&511;return a[t]+((8388607&r)>>s[t])}const l=new Uint32Array(2048),f=new Uint32Array(64),c=new Uint32Array(64);l[0]=0;for(let e=1;e<1024;++e){let r=e<<13,t=0;for(;0==(8388608&r);)t-=8388608,r<<=1;r&=-8388609,t+=947912704,l[e]=r|t}for(let e=1024;e<2048;++e)l[e]=939524096+(e-1024<<13);f[0]=0;for(let e=1;e<31;++e)f[e]=e<<23;f[31]=1199570944,f[32]=2147483648;for(let e=33;e<63;++e)f[e]=2147483648+(e-32<<23);f[63]=3347054592,c[0]=0;for(let e=1;e<64;++e)c[e]=32===e?0:1024;function p(e){const r=e>>10;return o[0]=l[c[r]+(1023&e)]+f[r],i[0]}function h(e){if(e=Number(e),!Number.isFinite(e)||0===e)return e;return p(u(e))}var _=t(277),d="object"==typeof self&&self&&self.Object===Object&&self;const m=_.Z||d||Function("return this")();const g=m.Symbol;var E=Object.prototype,v=E.hasOwnProperty,T=E.toString,y=g?g.toStringTag:void 0;const A=function(e){var r=v.call(e,y),t=e[y];try{e[y]=void 0;var n=!0}catch(e){}var i=T.call(e);return n&&(r?e[y]=t:delete e[y]),i};var b=Object.prototype.toString;const U=function(e){return b.call(e)};var L=g?g.toStringTag:void 0;const P=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":L&&L in Object(e)?A(e):U(e)};const R=function(e){var r=typeof e;return null!=e&&("object"==r||"function"==r)};const w=function(e){if(!R(e))return!1;var r=P(e);return"[object Function]"==r||"[object GeneratorFunction]"==r||"[object AsyncFunction]"==r||"[object Proxy]"==r};const O=m["__core-js_shared__"];var I,F=(I=/[^.]+$/.exec(O&&O.keys&&O.keys.IE_PROTO||""))?"Symbol(src)_1."+I:"";const N=function(e){return!!F&&F in e};var G=Function.prototype.toString;const S=function(e){if(null!=e){try{return G.call(e)}catch(e){}try{return e+""}catch(e){}}return""};var x=/^\[object .+?Constructor\]$/,B=Function.prototype,C=Object.prototype,M=B.toString,D=C.hasOwnProperty,V=RegExp("^"+M.call(D).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const W=function(e){return!(!R(e)||N(e))&&(w(e)?V:x).test(S(e))};const k=function(e,r){return null==e?void 0:e[r]};const H=function(e,r){var t=k(e,r);return W(t)?t:void 0};const j=H(Object,"create");const X=function(){this.__data__=j?j(null):{},this.size=0};const Y=function(e){var r=this.has(e)&&delete this.__data__[e];return this.size-=r?1:0,r};var z=Object.prototype.hasOwnProperty;const q=function(e){var r=this.__data__;if(j){var t=r[e];return"__lodash_hash_undefined__"===t?void 0:t}return z.call(r,e)?r[e]:void 0};var K=Object.prototype.hasOwnProperty;const J=function(e){var r=this.__data__;return j?void 0!==r[e]:K.call(r,e)};const Z=function(e,r){var t=this.__data__;return this.size+=this.has(e)?0:1,t[e]=j&&void 0===r?"__lodash_hash_undefined__":r,this};function $(e){var r=-1,t=null==e?0:e.length;for(this.clear();++r<t;){var n=e[r];this.set(n[0],n[1])}}$.prototype.clear=X,$.prototype.delete=Y,$.prototype.get=q,$.prototype.has=J,$.prototype.set=Z;const Q=$;const ee=function(){this.__data__=[],this.size=0};const re=function(e,r){return e===r||e!=e&&r!=r};const te=function(e,r){for(var t=e.length;t--;)if(re(e[t][0],r))return t;return-1};var ne=Array.prototype.splice;const ie=function(e){var r=this.__data__,t=te(r,e);return!(t<0)&&(t==r.length-1?r.pop():ne.call(r,t,1),--this.size,!0)};const oe=function(e){var r=this.__data__,t=te(r,e);return t<0?void 0:r[t][1]};const ae=function(e){return te(this.__data__,e)>-1};const se=function(e,r){var t=this.__data__,n=te(t,e);return n<0?(++this.size,t.push([e,r])):t[n][1]=r,this};function ue(e){var r=-1,t=null==e?0:e.length;for(this.clear();++r<t;){var n=e[r];this.set(n[0],n[1])}}ue.prototype.clear=ee,ue.prototype.delete=ie,ue.prototype.get=oe,ue.prototype.has=ae,ue.prototype.set=se;const le=ue;const fe=H(m,"Map");const ce=function(){this.size=0,this.__data__={hash:new Q,map:new(fe||le),string:new Q}};const pe=function(e){var r=typeof e;return"string"==r||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==e:null===e};const he=function(e,r){var t=e.__data__;return pe(r)?t["string"==typeof r?"string":"hash"]:t.map};const _e=function(e){var r=he(this,e).delete(e);return this.size-=r?1:0,r};const de=function(e){return he(this,e).get(e)};const me=function(e){return he(this,e).has(e)};const ge=function(e,r){var t=he(this,e),n=t.size;return t.set(e,r),this.size+=t.size==n?0:1,this};function Ee(e){var r=-1,t=null==e?0:e.length;for(this.clear();++r<t;){var n=e[r];this.set(n[0],n[1])}}Ee.prototype.clear=ce,Ee.prototype.delete=_e,Ee.prototype.get=de,Ee.prototype.has=me,Ee.prototype.set=ge;const ve=Ee;function Te(e,r){if("function"!=typeof e||null!=r&&"function"!=typeof r)throw new TypeError("Expected a function");var t=function(){var n=arguments,i=r?r.apply(this,n):n[0],o=t.cache;if(o.has(i))return o.get(i);var a=e.apply(this,n);return t.cache=o.set(i,a)||o,a};return t.cache=new(Te.Cache||ve),t}Te.Cache=ve;const ye=Te,Ae=Object.getOwnPropertyDescriptor(new Uint8Array(1),0).writable;function be(e){let r="number"!=typeof e?Number(e):e;return Number.isNaN(r)&&(r=0),Math.trunc(r)}function Ue(e,r){const[t,n]=[Number.isNaN(e),Number.isNaN(r)];if(t&&n)return 0;if(t)return 1;if(n)return-1;if(e<r)return-1;if(e>r)return 1;if(0===e&&0===r){const[t,n]=[Object.is(e,0),Object.is(r,0)];if(!t&&n)return-1;if(t&&!n)return 1}return 0}function Le(e){return e instanceof DataView}function Pe(e){return"string"==typeof e&&e===be(e)+""}const Re=function(e){return null!=e&&"object"==typeof e};const we=function(e){return Re(e)&&"[object ArrayBuffer]"==P(e)};const Oe=function(e){return function(r){return e(r)}};var Ie=t(730),Fe=Ie.Z&&Ie.Z.isArrayBuffer;const Ne=Fe?Oe(Fe):we;const Ge=function(){const e=new WeakMap;return r=>{let t=e.get(r);return t||(t=Object.create(null),e.set(r,t),t)}}();function Se(e){return e instanceof De}function xe(e){if(!Se(e))throw new TypeError("This is not a Float16Array")}function Be(e){const r=e.length,t=new Array(r);for(let n=0;n<r;++n)t[n]=p(e[n]);return t}const Ce={apply(e,r,t){return Se(r)&&("function"==typeof(n=e)&&We.has(n))?Reflect.apply(e,Ge(r).target,t):Reflect.apply(e,r,t);var n}},Me={get(e,r){let t=null;if(Ae||(t=e,e=Ge(t).target),Pe(r))return Reflect.has(e,r)?p(Reflect.get(e,r)):void 0;{const n=null!==t&&Reflect.has(t,r)?Reflect.get(t,r):Reflect.get(e,r);if("function"!=typeof n)return n;let i=Ge(n).proxy;return void 0===i&&(i=Ge(n).proxy=new Proxy(n,Ce)),i}},set(e,r,t){let n=null;return Ae||(n=e,e=Ge(n).target),Pe(r)?Reflect.set(e,r,u(t)):null===n||Reflect.has(e,r)&&!Object.isFrozen(n)?Reflect.set(e,r,t):Reflect.set(n,r,t)}};Ae||(Me.getPrototypeOf=e=>Reflect.getPrototypeOf(Ge(e).target),Me.setPrototypeOf=(e,r)=>Reflect.setPrototypeOf(Ge(e).target,r),Me.defineProperty=(e,r,t)=>{const n=Ge(e).target;return!Reflect.has(n,r)||Object.isFrozen(e)?Reflect.defineProperty(e,r,t):Reflect.defineProperty(n,r,t)},Me.deleteProperty=(e,r)=>{const t=Ge(e).target;return Reflect.has(e,r)?Reflect.deleteProperty(e,r):Reflect.deleteProperty(t,r)},Me.has=(e,r)=>Reflect.has(e,r)||Reflect.has(Ge(e).target,r),Me.isExtensible=e=>Reflect.isExtensible(e),Me.preventExtensions=e=>Reflect.preventExtensions(e),Me.getOwnPropertyDescriptor=(e,r)=>Reflect.getOwnPropertyDescriptor(e,r),Me.ownKeys=e=>Reflect.ownKeys(e));class De extends Uint16Array{constructor(e,r,t){if(Se(e))super(Ge(e).target);else if(null===e||"object"!=typeof e||Ne(e))switch(arguments.length){case 0:super();break;case 1:super(e);break;case 2:super(e,r);break;case 3:super(e,r,t);break;default:super(...arguments)}else{const r=Reflect.has(e,"length")||void 0===e[Symbol.iterator]?e:[...e],t=r.length;super(t);for(let e=0;e<t;++e)this[e]=u(r[e])}let n;if(Ae)n=new Proxy(this,Me);else{const e=Object.create(null);Ge(e).target=this,n=new Proxy(e,Me)}return Ge(n).target=this,Ge(this).proxy=n,n}static from(e,...r){if(0===r.length)return new De(Uint16Array.from(e,u).buffer);const t=r[0],n=r[1];return new De(Uint16Array.from(e,(function(e,...r){return u(t.call(this,e,...r))}),n).buffer)}static of(...e){return new De(e)}*[Symbol.iterator](){for(const e of super[Symbol.iterator]())yield p(e)}keys(){return super.keys()}*values(){for(const e of super.values())yield p(e)}*entries(){for(const[e,r]of super.entries())yield[e,p(r)]}map(e,...r){xe(this);const t=r[0],n=[];for(let r=0,i=this.length;r<i;++r){const i=p(this[r]);n.push(e.call(t,i,r,Ge(this).proxy))}return new De(n)}filter(e,...r){xe(this);const t=r[0],n=[];for(let r=0,i=this.length;r<i;++r){const i=p(this[r]);e.call(t,i,r,Ge(this).proxy)&&n.push(i)}return new De(n)}reduce(e,...r){let t,n;xe(this),0===r.length?(t=p(this[0]),n=1):(t=r[0],n=0);for(let r=n,i=this.length;r<i;++r)t=e(t,p(this[r]),r,Ge(this).proxy);return t}reduceRight(e,...r){let t,n;xe(this);const i=this.length;0===r.length?(t=p(this[i-1]),n=i-1):(t=r[0],n=i);for(let r=n;r--;)t=e(t,p(this[r]),r,Ge(this).proxy);return t}forEach(e,...r){xe(this);const t=r[0];for(let r=0,n=this.length;r<n;++r)e.call(t,p(this[r]),r,Ge(this).proxy)}find(e,...r){xe(this);const t=r[0];for(let r=0,n=this.length;r<n;++r){const n=p(this[r]);if(e.call(t,n,r,Ge(this).proxy))return n}}findIndex(e,...r){xe(this);const t=r[0];for(let r=0,n=this.length;r<n;++r){const n=p(this[r]);if(e.call(t,n,r,Ge(this).proxy))return r}return-1}every(e,...r){xe(this);const t=r[0];for(let r=0,n=this.length;r<n;++r)if(!e.call(t,p(this[r]),r,Ge(this).proxy))return!1;return!0}some(e,...r){xe(this);const t=r[0];for(let r=0,n=this.length;r<n;++r)if(e.call(t,p(this[r]),r,Ge(this).proxy))return!0;return!1}set(e,...r){xe(this);const t=r[0];let n;if(Se(e))n=Ge(e).target;else{const r=Reflect.has(e,"length")||void 0===e[Symbol.iterator]?e:[...e],t=r.length;n=new Uint16Array(t);for(let e=0,t=r.length;e<t;++e)n[e]=u(r[e])}super.set(n,t)}reverse(){return xe(this),super.reverse(),Ge(this).proxy}fill(e,...r){return xe(this),super.fill(u(e),...r),Ge(this).proxy}copyWithin(e,r,...t){return xe(this),super.copyWithin(e,r,...t),Ge(this).proxy}sort(...e){xe(this);let r=e[0];void 0===r&&(r=Ue);const t=ye(p);return super.sort(((e,n)=>r(t(e),t(n)))),Ge(this).proxy}slice(...e){let r;xe(this);try{r=super.slice(...e)}catch(t){if(!(t instanceof TypeError))throw t;r=new Uint16Array(this.buffer,this.byteOffset,this.length).slice(...e)}return new De(r.buffer)}subarray(...e){let r;xe(this);try{r=super.subarray(...e)}catch(t){if(!(t instanceof TypeError))throw t;r=new Uint16Array(this.buffer,this.byteOffset,this.length).subarray(...e)}return new De(r.buffer,r.byteOffset,r.length)}indexOf(e,...r){xe(this);const t=this.length;let n=be(r[0]);n<0&&(n+=t,n<0&&(n=0));for(let r=n,i=t;r<i;++r)if(p(this[r])===e)return r;return-1}lastIndexOf(e,...r){xe(this);const t=this.length;let n=be(r[0]);n=0===n?t:n+1,n>=0?n=n<t?n:t:n+=t;for(let r=n;r--;)if(p(this[r])===e)return r;return-1}includes(e,...r){xe(this);const t=this.length;let n=be(r[0]);n<0&&(n+=t,n<0&&(n=0));const i=Number.isNaN(e);for(let r=n,o=t;r<o;++r){const t=p(this[r]);if(i&&Number.isNaN(t))return!0;if(t===e)return!0}return!1}join(...e){xe(this);return Be(this).join(...e)}toLocaleString(...e){xe(this);return Be(this).toLocaleString(...e)}get[Symbol.toStringTag](){if(Se(this))return"Float16Array"}}const Ve=De.prototype,We=new WeakSet;for(const e of Reflect.ownKeys(Ve)){const r=Ve[e];"function"==typeof r&&We.add(r)}function ke(e,r,...t){if(!Le(e))throw new TypeError("First argument to getFloat16 function must be a DataView");return p(e.getUint16(r,...t))}function He(e,r,t,...n){if(!Le(e))throw new TypeError("First argument to setFloat16 function must be a DataView");e.setUint16(r,u(t),...n)}},809:(e,r)=>{"use strict";function t(e){var r=-1;n||(n=function(){for(var e=new Int32Array(256),r=0;r<256;r++){for(var t=r,n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[r]=t}return e}());for(var t=0;t<e.length;t++)r=n[255&(r^e[t])]^r>>>8;return-1^r}Object.defineProperty(r,"__esModule",{value:!0}),r.changeDpiBlob=function(e,r){var t=e.slice(0,33);return new Promise((function(n,i){var o=new FileReader;o.onload=function(){var t=new Uint8Array(o.result),i=e.slice(33),a=h(t,r,e.type);n(new Blob([a,i],{type:e.type}))},o.readAsArrayBuffer(t)}))},r.changeDpiDataUrl=function(e,r){var t=e.split(","),n=t[0],l=t[1],f=void 0,c=void 0,p=!1;if(-1!==n.indexOf(i)){f=i;var _=function(e){var r=e.indexOf(a);-1===r&&(r=e.indexOf(s));-1===r&&(r=e.indexOf(u));return r}(l);_>=0?(c=4*Math.ceil((_+28)/3),p=!0):c=44}-1!==n.indexOf(o)&&(f=o,c=24);for(var d=l.substring(0,c),m=l.substring(c),g=atob(d),E=new Uint8Array(g.length),v=0;v<E.length;v++)E[v]=g.charCodeAt(v);var T=h(E,r,f,p),y=btoa(String.fromCharCode.apply(String,function(e){if(Array.isArray(e)){for(var r=0,t=Array(e.length);r<e.length;r++)t[r]=e[r];return t}return Array.from(e)}(T)));return[n,",",y,m].join("")};var n=void 0,i="image/png",o="image/jpeg",a="AAlwSFlz",s="AAAJcEhZ",u="AAAACXBI",l="p".charCodeAt(0),f="H".charCodeAt(0),c="Y".charCodeAt(0),p="s".charCodeAt(0);function h(e,r,n,a){if(n===o)return e[13]=1,e[14]=r>>8,e[15]=255&r,e[16]=r>>8,e[17]=255&r,e;if(n===i){var s=new Uint8Array(13);r*=39.3701,s[0]=l,s[1]=f,s[2]=c,s[3]=p,s[4]=r>>>24,s[5]=r>>>16,s[6]=r>>>8,s[7]=255&r,s[8]=s[4],s[9]=s[5],s[10]=s[6],s[11]=s[7],s[12]=1;var u=t(s),h=new Uint8Array(4);if(h[0]=u>>>24,h[1]=u>>>16,h[2]=u>>>8,h[3]=255&u,a){var _=function(e){for(var r=e.length-1;r>=4;r--)if(9===e[r-4]&&e[r-3]===l&&e[r-2]===f&&e[r-1]===c&&e[r]===p)return r-3}(e);return e.set(s,_),e.set(h,_+13),e}var d=new Uint8Array(4);d[0]=0,d[1]=0,d[2]=0,d[3]=9;var m=new Uint8Array(54);return m.set(e,0),m.set(d,33),m.set(s,37),m.set(h,50),m}}},162:function(e,r,t){var n,i,o;i=[],void 0===(o="function"==typeof(n=function(){"use strict";function r(e,r){return void 0===r?r={autoBom:!1}:"object"!=typeof r&&(console.warn("Deprecated: Expected third argument to be a object"),r={autoBom:!r}),r.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}function n(e,r,t){var n=new XMLHttpRequest;n.open("GET",e),n.responseType="blob",n.onload=function(){u(n.response,r,t)},n.onerror=function(){console.error("could not download file")},n.send()}function i(e){var r=new XMLHttpRequest;r.open("HEAD",e,!1);try{r.send()}catch(e){}return 200<=r.status&&299>=r.status}function o(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(t){var r=document.createEvent("MouseEvents");r.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(r)}}var a="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof t.g&&t.g.global===t.g?t.g:void 0,s=a.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),u=a.saveAs||("object"!=typeof window||window!==a?function(){}:"download"in HTMLAnchorElement.prototype&&!s?function(e,r,t){var s=a.URL||a.webkitURL,u=document.createElement("a");r=r||e.name||"download",u.download=r,u.rel="noopener","string"==typeof e?(u.href=e,u.origin===location.origin?o(u):i(u.href)?n(e,r,t):o(u,u.target="_blank")):(u.href=s.createObjectURL(e),setTimeout((function(){s.revokeObjectURL(u.href)}),4e4),setTimeout((function(){o(u)}),0))}:"msSaveOrOpenBlob"in navigator?function(e,t,a){if(t=t||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(r(e,a),t);else if(i(e))n(e,t,a);else{var s=document.createElement("a");s.href=e,s.target="_blank",setTimeout((function(){o(s)}))}}:function(e,r,t,i){if((i=i||open("","_blank"))&&(i.document.title=i.document.body.innerText="downloading..."),"string"==typeof e)return n(e,r,t);var o="application/octet-stream"===e.type,u=/constructor/i.test(a.HTMLElement)||a.safari,l=/CriOS\/[\d]+/.test(navigator.userAgent);if((l||o&&u||s)&&"undefined"!=typeof FileReader){var f=new FileReader;f.onloadend=function(){var e=f.result;e=l?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),i?i.location.href=e:location=e,i=null},f.readAsDataURL(e)}else{var c=a.URL||a.webkitURL,p=c.createObjectURL(e);i?i.location=p:location.href=p,i=null,setTimeout((function(){c.revokeObjectURL(p)}),4e4)}});a.saveAs=u.saveAs=u,e.exports=u})?n.apply(r,i):n)||(e.exports=o)},277:(e,r,t)=>{"use strict";t.d(r,{Z:()=>n});const n="object"==typeof t.g&&t.g&&t.g.Object===Object&&t.g},730:(e,r,t)=>{"use strict";t.d(r,{Z:()=>s});var n=t(277);e=t.hmd(e);var i="object"==typeof exports&&exports&&!exports.nodeType&&exports,o=i&&e&&!e.nodeType&&e,a=o&&o.exports===i&&n.Z.process;const s=function(){try{var e=o&&o.require&&o.require("util").types;return e||a&&a.binding&&a.binding("util")}catch(e){}}()},484:function(e,r,t){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++)for(var i in r=arguments[t])Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i]);return e}).apply(this,arguments)},i=this&&this.__spreadArrays||function(){for(var e=0,r=0,t=arguments.length;r<t;r++)e+=arguments[r].length;var n=Array(e),i=0;for(r=0;r<t;r++)for(var o=arguments[r],a=0,s=o.length;a<s;a++,i++)n[i]=o[a];return n};Object.defineProperty(r,"__esModule",{value:!0}),r.GPUComposer=void 0;var o=t(355),a=t(601),s=t(664),u=t(404),l=t(593),f=t(707),c=t(288),p=function(){function e(e){var r;this.errorState=!1,this._circlePositionsBuffer={},this.copyPrograms={src:t(158)},this.setValuePrograms={src:t(148)},this.vectorMagnitudePrograms={src:t(723)},this._vertexShaders=((r={})[a.DEFAULT_PROGRAM_NAME]={src:c},r[a.DEFAULT_W_UV_PROGRAM_NAME]={src:c,defines:{WEBGLCOMPUTE_UV_ATTRIBUTE:"1"}},r[a.DEFAULT_W_NORMAL_PROGRAM_NAME]={src:c,defines:{WEBGLCOMPUTE_NORMAL_ATTRIBUTE:"1"}},r[a.DEFAULT_W_UV_NORMAL_PROGRAM_NAME]={src:c,defines:{WEBGLCOMPUTE_UV_ATTRIBUTE:"1",WEBGLCOMPUTE_NORMAL_ATTRIBUTE:"1"}},r[a.SEGMENT_PROGRAM_NAME]={src:t(974)},r[a.DATA_LAYER_POINTS_PROGRAM_NAME]={src:t(62)},r[a.DATA_LAYER_VECTOR_FIELD_PROGRAM_NAME]={src:t(430)},r[a.DATA_LAYER_LINES_PROGRAM_NAME]={src:t(629)},r),this.verboseLogging=!1;var n=["canvas","context","contextID","contextOptions","glslVersion","verboseLogging","errorCallback"],i=Object.keys(e);i.forEach((function(e){if(n.indexOf(e)<0)throw new Error('Invalid key "'+e+'" passed to new GPUComposer(params).  Valid keys are '+n.join(", ")+".")})),["canvas"].forEach((function(e){if(i.indexOf(e)<0)throw new Error('Required params key "'+e+'" was not passed to new GPUComposer(params).')})),void 0!==e.verboseLogging&&(this.verboseLogging=e.verboseLogging);var o=this;this._errorCallback=function(r){o.errorState||(o.errorState=!0,e.errorCallback?e.errorCallback(r):a.DEFAULT_ERROR_CALLBACK(r))};var s=e.canvas,u=e.context;if(u||(e.contextID&&((u=s.getContext(e.contextID,e.contextOptions))||console.warn("Unable to initialize WebGL context with contextID: "+e.contextID+".")),u||(u=s.getContext(a.WEBGL2,e.contextOptions)||s.getContext(a.WEBGL1,e.contextOptions)||s.getContext(a.EXPERIMENTAL_WEBGL,e.contextOptions)),null!==u)){l.isWebGL2(u)?this.verboseLogging&&console.log("Using WebGL 2.0 context."):this.verboseLogging&&console.log("Using WebGL 1.0 context."),this.gl=u;var f=e.glslVersion||(l.isWebGL2(u)?a.GLSL3:a.GLSL1);l.isWebGL2(u)||f!==a.GLSL3||(console.warn("GLSL3.x is incompatible with WebGL1.0 contexts, falling back to GLSL1."),f=a.GLSL1),this.glslVersion=f,this.intPrecision=e.intPrecision||a.PRECISION_HIGH_P,this.floatPrecision=e.floatPrecision||a.PRECISION_HIGH_P,u.disable(u.DEPTH_TEST),u.pixelStorei(u.UNPACK_ALIGNMENT,1),u.bindBuffer(u.ARRAY_BUFFER,null),this.onResize(s),this.maxNumTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.verboseLogging&&console.log(this.maxNumTextures+" textures max.")}else this._errorCallback("Unable to initialize WebGL context.")}return e.initWithThreeRenderer=function(r,t){var i=new e(n(n({floatPrecision:r.capabilities.precision||a.PRECISION_HIGH_P,intPrecision:r.capabilities.precision||a.PRECISION_HIGH_P},t),{canvas:r.domElement,context:r.getContext(),glslVersion:r.capabilities.isWebGL2?a.GLSL3:a.GLSL1}));return i.renderer=r,i},e.prototype.isWebGL2=function(){return l.isWebGL2(this.gl)},e.prototype.glslKeyForType=function(e){if(this.glslVersion===a.GLSL1)return a.FLOAT;switch(e){case a.HALF_FLOAT:case a.FLOAT:return a.FLOAT;case a.UNSIGNED_BYTE:case a.UNSIGNED_SHORT:case a.UNSIGNED_INT:return a.UINT;case a.BYTE:case a.SHORT:case a.INT:return a.INT;default:throw new Error("Invalid type: "+e+" passed to GPUComposer.copyProgramForType.")}},e.prototype._setValueProgramForType=function(e){var r,t=this.glslKeyForType(e);if(void 0===this.setValuePrograms[t]){var n=new s.GPUProgram(this,{name:"setValue-"+t,fragmentShader:this.setValuePrograms.src,uniforms:[{name:"u_value",value:[0,0,0,0],type:t===a.UINT?a.INT:t}],defines:(r={},r["WEBGLCOMPUTE_"+t]="1",r)});this.setValuePrograms[t]=n}return this.setValuePrograms[t]},e.prototype.copyProgramForType=function(e){var r,t=this.glslKeyForType(e);if(void 0===this.copyPrograms[t]){var n=new s.GPUProgram(this,{name:"copy-"+t,fragmentShader:this.copyPrograms.src,uniforms:[{name:"u_state",value:0,type:a.INT}],defines:(r={},r["WEBGLCOMPUTE_"+t]="1",r)});this.copyPrograms[t]=n}return this.copyPrograms[t]},Object.defineProperty(e.prototype,"wrappedLineColorProgram",{get:function(){if(void 0===this._wrappedLineColorProgram){var e=new s.GPUProgram(this,{name:"wrappedLineColor",fragmentShader:t(598)});this._wrappedLineColorProgram=e}return this._wrappedLineColorProgram},enumerable:!1,configurable:!0}),e.prototype.vectorMagnitudeProgramForType=function(e){var r,t=this.glslKeyForType(e);if(void 0===this.vectorMagnitudePrograms[t]){var n=new s.GPUProgram(this,{name:"vectorMagnitude-"+t,fragmentShader:this.vectorMagnitudePrograms.src,defines:(r={},r["WEBGLCOMPUTE_"+t]="1",r)});this.vectorMagnitudePrograms[t]=n}return this.vectorMagnitudePrograms[t]},Object.defineProperty(e.prototype,"quadPositionsBuffer",{get:function(){if(void 0===this._quadPositionsBuffer){var e=new Float32Array([-1,-1,1,-1,-1,1,1,1]);this._quadPositionsBuffer=this.initVertexBuffer(e)}return this._quadPositionsBuffer},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"boundaryPositionsBuffer",{get:function(){if(void 0===this._boundaryPositionsBuffer){var e=new Float32Array([-1,-1,1,-1,1,1,-1,1,-1,-1]);this._boundaryPositionsBuffer=this.initVertexBuffer(e)}return this._boundaryPositionsBuffer},enumerable:!1,configurable:!0}),e.prototype.getCirclePositionsBuffer=function(e){if(null==this._circlePositionsBuffer[e]){for(var r=[0,0],t=0;t<=e;t++)r.push(Math.cos(2*Math.PI*t/e),Math.sin(2*Math.PI*t/e));var n=new Float32Array(r),i=this.initVertexBuffer(n);this._circlePositionsBuffer[e]=i}return this._circlePositionsBuffer[e]},e.prototype.initVertexBuffer=function(e){var r=this._errorCallback,t=this.gl,n=t.createBuffer();if(n)return t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),n;r("Unable to allocate gl buffer.")},e.prototype._cloneGPULayer=function(e,r){var t=0;try{t=e.length}catch(r){t=[e.width,e.height]}var n=e.writable?void 0:e.getValues(),i=new o.GPULayer(this,{name:r||e.name+"-clone",dimensions:t,type:e.type,numComponents:e.numComponents,array:n,filter:e.filter,wrapS:e.wrapS,wrapT:e.wrapT,writable:e.writable,numBuffers:e.numBuffers});if(e.writable){for(var a=0;a<e.numBuffers-1;a++)this.step({program:this.copyProgramForType(e.type),input:e.getStateAtIndex((e.bufferIndex+a+1)%e.numBuffers),output:i});this.step({program:this.copyProgramForType(e.type),input:e.currentState,output:i})}return i},e.prototype.initTexture=function(e){var r=["name","url","filter","wrapS","wrapT","format","type","onLoad"];Object.keys(e).forEach((function(t){if(r.indexOf(t)<0)throw new Error('Invalid key "'+t+'" passed to GPUComposer.initTexture with name "'+e.name+'".  Valid keys are '+r.join(", ")+".")}));var t=e.url,n=e.name;if(!f.isString(t))throw new Error("Expected GPUComposer.initTexture params to have url of type string, got "+t+" of type "+typeof t+".");if(!f.isString(n))throw new Error("Expected GPUComposer.initTexture params to have name of type string, got "+n+" of type "+typeof n+".");var i=void 0!==e.filter?e.filter:a.NEAREST;if(!f.isValidFilter(i))throw new Error("Invalid filter: "+i+' for GPULayer "'+n+'", must be '+a.validFilters.join(", ")+".");var o=void 0!==e.wrapS?e.wrapS:a.CLAMP_TO_EDGE;if(!f.isValidWrap(o))throw new Error("Invalid wrapS: "+o+' for GPULayer "'+n+'", must be '+a.validWraps.join(", ")+".");var s=void 0!==e.wrapT?e.wrapT:a.CLAMP_TO_EDGE;if(!f.isValidWrap(s))throw new Error("Invalid wrapT: "+s+' for GPULayer "'+n+'", must be '+a.validWraps.join(", ")+".");var u=void 0!==e.format?e.format:a.RGBA;if(!f.isValidTextureFormat(u))throw new Error("Invalid format: "+u+' for GPULayer "'+n+'", must be '+a.validTextureFormats.join(", ")+".");var c=void 0!==e.type?e.type:a.UNSIGNED_BYTE;if(!f.isValidTextureType(c))throw new Error("Invalid type: "+c+' for GPULayer "'+n+'", must be '+a.validTextureTypes.join(", ")+".");var p=this.gl,h=this._errorCallback,_=p.createTexture();if(null===_)throw new Error("Unable to init glTexture.");p.bindTexture(p.TEXTURE_2D,_);var d=p.RGBA,m=p[u],g=p[c],E=new Uint8Array([0,0,0,0]);p.texImage2D(p.TEXTURE_2D,0,d,1,1,0,m,g,E);var v=new Image;return v.onload=function(){p.bindTexture(p.TEXTURE_2D,_),p.texImage2D(p.TEXTURE_2D,0,d,m,g,v),l.isPowerOf2(v.width)&&l.isPowerOf2(v.height)||console.warn("Texture "+n+" dimensions ["+v.width+", "+v.height+"] are not power of 2."),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p[o]),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p[s]),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p[i]),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p[i]),e.onLoad&&e.onLoad(_)},v.onerror=function(e){h("Error loading image "+n+": "+e)},v.src=t,_},e.prototype.onResize=function(e){var r=e.clientWidth,t=e.clientHeight;e.width=r,e.height=t,this.width=r,this.height=t},e.prototype.drawSetup=function(e,r,t,n){var i=this.gl;if(e){var a=[];if(t)if(t.constructor===WebGLTexture)a.push(t);else if(t.constructor===o.GPULayer)a.push(t.currentState);else for(var s=0;s<t.length;s++){var u=t[s];a.push(u.currentState?u.currentState:u)}this.setOutputLayer(r,t,n),i.useProgram(e);for(s=0;s<a.length;s++)i.activeTexture(i.TEXTURE0+s),i.bindTexture(i.TEXTURE_2D,a[s])}},e.prototype.setBlendMode=function(e){var r=this.gl;e&&(r.enable(r.BLEND),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA))},e.prototype.addLayerToInputs=function(e,r){var t=r;if(f.isArray(t))t.indexOf(e)<0&&t.push(e);else if(t!==e){var n=t;t=[],n&&t.push(n),t.push(e)}else t=[t];return t},e.prototype.passThroughLayerDataFromInputToOutput=function(e){var r=this.copyProgramForType(e.internalType);this.step({program:r,input:e,output:e})},e.prototype.setOutputLayer=function(e,r,t){var n=this.gl;if(t){if(r&&(r===t||f.isArray(r)&&r.indexOf(t)>-1)){if(1===t.numBuffers)throw new Error("Cannot use same buffer for input and output of a program. Try increasing the number of buffers in your output layer to at least 2 so you can render to nextState using currentState as an input.");e?t._bindOutputBufferForWrite(!0):(this.passThroughLayerDataFromInputToOutput(t),t._bindOutputBufferForWrite(!1))}else e||t._usingTextureOverrideForCurrentBuffer()&&this.passThroughLayerDataFromInputToOutput(t),t._bindOutputBufferForWrite(!1);var i=t.width,o=t.height;n.viewport(0,0,i,o)}else{n.bindFramebuffer(n.FRAMEBUFFER,null);var a=this.width,s=this.height;n.viewport(0,0,a,s)}},e.prototype.setVertexAttribute=function(e,r,t,n){var i=this.gl,o=i.getAttribLocation(e,r);if(o<0)throw new Error('Unable to find vertex attribute "'+r+'" in program "'+n+'".');i.vertexAttribPointer(o,t,i.FLOAT,!1,0,0),i.enableVertexAttribArray(o)},e.prototype.setPositionAttribute=function(e,r){this.setVertexAttribute(e,"a_internal_position",2,r)},e.prototype.setIndexAttribute=function(e,r){this.setVertexAttribute(e,"a_internal_index",1,r)},e.prototype.setUVAttribute=function(e,r){this.setVertexAttribute(e,"a_internal_uv",2,r)},e.prototype.step=function(e){var r=this,t=r.gl,n=r.errorState,i=r.quadPositionsBuffer,o=e.program,s=e.input,u=e.output;if(!n){var l=o._defaultProgram;this.drawSetup(l,!0,s,u),o._setVertexUniform(l,"u_internal_scale",[1,1],a.FLOAT),o._setVertexUniform(l,"u_internal_translation",[0,0],a.FLOAT),t.bindBuffer(t.ARRAY_BUFFER,i),this.setPositionAttribute(l,o.name),this.setBlendMode(e.shouldBlendAlpha),t.drawArrays(t.TRIANGLE_STRIP,0,4),t.disable(t.BLEND)}},e.prototype.stepBoundary=function(e){var r=this,t=r.gl,n=r.errorState,i=r.boundaryPositionsBuffer,o=e.program,s=e.input,u=e.output,l=u?u.width:this.width,f=u?u.height:this.height;if(!n){var c=o._defaultProgram;this.drawSetup(c,!1,s,u);var p=[1/l,1/f];if(o._setVertexUniform(c,"u_internal_scale",[1-p[0],1-p[1]],a.FLOAT),o._setVertexUniform(c,"u_internal_translation",p,a.FLOAT),t.bindBuffer(t.ARRAY_BUFFER,i),this.setPositionAttribute(c,o.name),this.setBlendMode(e.shouldBlendAlpha),e.singleEdge)switch(e.singleEdge){case"LEFT":t.drawArrays(t.LINES,3,2);break;case"RIGHT":t.drawArrays(t.LINES,1,2);break;case"TOP":t.drawArrays(t.LINES,2,2);break;case"BOTTOM":t.drawArrays(t.LINES,0,2);break;default:throw new Error("Unknown boundary edge type: "+e.singleEdge+".")}else t.drawArrays(t.LINE_LOOP,0,4);t.disable(t.BLEND)}},e.prototype.stepNonBoundary=function(e){var r=this,t=r.gl,n=r.errorState,i=r.quadPositionsBuffer,o=e.program,s=e.input,u=e.output,l=u?u.width:this.width,f=u?u.height:this.height;if(!n){var c=o._defaultProgram;this.drawSetup(c,!1,s,u);var p=[1/l,1/f];o._setVertexUniform(c,"u_internal_scale",[1-2*p[0],1-2*p[1]],a.FLOAT),o._setVertexUniform(c,"u_internal_translation",p,a.FLOAT),t.bindBuffer(t.ARRAY_BUFFER,i),this.setPositionAttribute(c,o.name),this.setBlendMode(e.shouldBlendAlpha),t.drawArrays(t.TRIANGLE_STRIP,0,4),t.disable(t.BLEND)}},e.prototype.stepCircle=function(e){var r=this,t=r.gl,n=r.errorState,i=r.width,o=r.height,s=e.program,u=e.position,l=e.radius,f=e.input,c=e.output;if(!n){var p=s._defaultProgram;this.drawSetup(p,!1,f,c),s._setVertexUniform(p,"u_internal_scale",[2*l/i,2*l/o],a.FLOAT),s._setVertexUniform(p,"u_internal_translation",[2*u[0]/i-1,2*u[1]/o-1],a.FLOAT);var h=e.numSegments?e.numSegments:a.DEFAULT_CIRCLE_NUM_SEGMENTS;if(h<3)throw new Error("numSegments for GPUComposer.stepCircle must be greater than 2, got "+h+".");t.bindBuffer(t.ARRAY_BUFFER,this.getCirclePositionsBuffer(h)),this.setPositionAttribute(p,s.name),this.setBlendMode(e.shouldBlendAlpha),t.drawArrays(t.TRIANGLE_FAN,0,h+2),t.disable(t.BLEND)}},e.prototype.stepSegment=function(e){var r=this.gl,t=this.errorState,n=e.program,i=e.position1,o=e.position2,s=e.thickness,u=e.input,l=e.output,f=l?l.width:this.width,c=l?l.height:this.height;if(!t){var p=n._segmentProgram;this.drawSetup(p,!1,u,l),n._setVertexUniform(p,"u_internal_halfThickness",s/2,a.FLOAT),n._setVertexUniform(p,"u_internal_scale",[2/f,2/c],a.FLOAT);var h=i[0]-o[0],_=i[1]-o[1],d=Math.atan2(_,h);n._setVertexUniform(p,"u_internal_rotation",d,a.FLOAT);var m=(i[0]+o[0])/2,g=(i[1]+o[1])/2;n._setVertexUniform(p,"u_internal_translation",[2*m/this.width-1,2*g/this.height-1],a.FLOAT);var E=Math.sqrt(h*h+_*_),v=e.numCapSegments?2*e.numCapSegments:a.DEFAULT_CIRCLE_NUM_SEGMENTS;if(e.endCaps){if(v<6||v%6!=0)throw new Error("numSegments for GPUComposer.stepSegment must be divisible by 6, got "+v+".");n._setVertexUniform(p,"u_internal_length",E-s*Math.sin(Math.PI/v),a.FLOAT),r.bindBuffer(r.ARRAY_BUFFER,this.getCirclePositionsBuffer(v))}else n._setVertexUniform(p,"u_internal_length",E-s,a.FLOAT),r.bindBuffer(r.ARRAY_BUFFER,this.quadPositionsBuffer);this.setPositionAttribute(p,n.name),this.setBlendMode(e.shouldBlendAlpha),e.endCaps?r.drawArrays(r.TRIANGLE_FAN,0,v+2):r.drawArrays(r.TRIANGLE_STRIP,0,4),r.disable(r.BLEND)}},e.prototype.stepPolyline=function(e){var r=e.program,t=e.input,n=e.output,i=e.positions,o=!!e.closeLoop,s=this,u=s.gl,l=s.width,f=s.height;if(!s.errorState){for(var c=e.thickness/2,p=o?4*i.length+2:4*(i.length-1),h=new Float32Array(2*p),_=e.includeUVs?new Float32Array(2*p):void 0,d=e.includeNormals?new Float32Array(2*p):void 0,m=[0,0],g=[0,0],E=[0,0],v=[0,0],T=[0,0],y=0;y<i.length;y++)if(o||y!==i.length-1){var A=i[y],b=i[(y+1)%i.length];m[0]=b[0]-A[0],m[1]=b[1]-A[1];var U=Math.sqrt(m[0]*m[0]+m[1]*m[1]);E[0]=m[1]/U,E[1]=-m[0]/U;var L=4*y+2;o||0!==y||(h[0]=A[0]+E[0]*c,h[1]=A[1]+E[1]*c,h[2]=A[0]-E[0]*c,h[3]=A[1]-E[1]*c,_&&(_[0]=0,_[1]=1,_[2]=0,_[3]=0),d&&(d[0]=E[0],d[1]=E[1],d[2]=E[0],d[3]=E[1]));var P=(y+1)/(i.length-1);if(h[2*L]=b[0]+E[0]*c,h[2*L+1]=b[1]+E[1]*c,h[2*L+2]=b[0]-E[0]*c,h[2*L+3]=b[1]-E[1]*c,_&&(_[2*L]=P,_[2*L+1]=1,_[2*L+2]=P,_[2*L+3]=0),d&&(d[2*L]=E[0],d[2*L+1]=E[1],d[2*L+2]=E[0],d[2*L+3]=E[1]),y<i.length-2||o){var R=i[(y+1)%i.length],w=i[(y+2)%i.length];g[0]=w[0]-R[0],g[1]=w[1]-R[1];var O=Math.sqrt(g[0]*g[0]+g[1]*g[1]);v[0]=g[1]/O,v[1]=-g[0]/O,h[(L+2)%(4*i.length)*2]=R[0]+v[0]*c,h[(L+2)%(4*i.length)*2+1]=R[1]+v[1]*c,h[(L+2)%(4*i.length)*2+2]=R[0]-v[0]*c,h[(L+2)%(4*i.length)*2+3]=R[1]-v[1]*c,_&&(_[(L+2)%(4*i.length)*2]=P,_[(L+2)%(4*i.length)*2+1]=1,_[(L+2)%(4*i.length)*2+2]=P,_[(L+2)%(4*i.length)*2+3]=0),d&&(d[(L+2)%(4*i.length)*2]=v[0],d[(L+2)%(4*i.length)*2+1]=v[1],d[(L+2)%(4*i.length)*2+2]=v[0],d[(L+2)%(4*i.length)*2+3]=v[1]);var I=E[0]*v[1]-E[1]*v[0];if(Math.abs(I)<1e-6)continue;T[0]=E[0]+v[0],T[1]=E[1]+v[1];var F=Math.sqrt(T[0]*T[0]+T[1]*T[1]);T[0]/=F,T[1]/=F;var N=Math.acos(E[0]*v[0]+E[1]*v[1]),G=c/Math.cos(N/2);I<0?(h[2*L]=b[0]+T[0]*G,h[2*L+1]=b[1]+T[1]*G,h[(L+2)%(4*i.length)*2]=h[2*L],h[(L+2)%(4*i.length)*2+1]=h[2*L+1]):(h[2*L+2]=b[0]-T[0]*G,h[2*L+3]=b[1]-T[1]*G,h[(L+2)%(4*i.length)*2+2]=h[2*L+2],h[(L+2)%(4*i.length)*2+3]=h[2*L+3])}}o&&(h[8*i.length]=h[0],h[8*i.length+1]=h[1],h[8*i.length+2]=h[2],h[8*i.length+3]=h[3],_&&(_[8*i.length]=_[0],_[8*i.length+1]=_[1],_[8*i.length+2]=_[2],_[8*i.length+3]=_[3]),d&&(d[8*i.length]=d[0],d[8*i.length+1]=d[1],d[8*i.length+2]=d[2],d[8*i.length+3]=d[3]));var S=_?d?r._defaultProgramWithUVNormal:r._defaultProgramWithUV:d?r._defaultProgramWithNormal:r._defaultProgram;this.drawSetup(S,!1,t,n),r._setVertexUniform(S,"u_internal_scale",[2/l,2/f],a.FLOAT),r._setVertexUniform(S,"u_internal_translation",[-1,-1],a.FLOAT),u.bindBuffer(u.ARRAY_BUFFER,this.initVertexBuffer(h)),this.setPositionAttribute(S,r.name),_&&(u.bindBuffer(u.ARRAY_BUFFER,this.initVertexBuffer(_)),this.setUVAttribute(S,r.name)),d&&(u.bindBuffer(u.ARRAY_BUFFER,this.initVertexBuffer(d)),this.setVertexAttribute(S,"a_internal_normal",2,r.name)),this.setBlendMode(e.shouldBlendAlpha),u.drawArrays(u.TRIANGLE_STRIP,0,p),u.disable(u.BLEND)}},e.prototype.stepTriangleStrip=function(e){var r=e.program,t=e.input,n=e.output,i=e.positions,o=e.uvs,s=e.normals,u=this,l=u.gl,f=u.width,c=u.height;if(!u.errorState){var p=o?s?r._defaultProgramWithUVNormal:r._defaultProgramWithUV:s?r._defaultProgramWithNormal:r._defaultProgram;this.drawSetup(p,!1,t,n),r._setVertexUniform(p,"u_internal_scale",[2/f,2/c],a.FLOAT),r._setVertexUniform(p,"u_internal_translation",[-1,-1],a.FLOAT),l.bindBuffer(l.ARRAY_BUFFER,this.initVertexBuffer(i)),this.setPositionAttribute(p,r.name),o&&(l.bindBuffer(l.ARRAY_BUFFER,this.initVertexBuffer(o)),this.setUVAttribute(p,r.name)),s&&(l.bindBuffer(l.ARRAY_BUFFER,this.initVertexBuffer(s)),this.setVertexAttribute(p,"a_internal_normal",2,r.name));var h=e.count?e.count:i.length/2;this.setBlendMode(e.shouldBlendAlpha),l.drawArrays(l.TRIANGLE_STRIP,0,h),l.disable(l.BLEND)}},e.prototype.stepLines=function(e){var r=this,t=r.gl,n=r.errorState,i=r.width,o=r.height,s=e.indices,u=e.uvs,l=e.normals,f=e.input,c=e.output,p=e.program;if(!n){if(e.closeLoop&&s)throw new Error("GPUComposer.stepLines() can't be called with closeLoop == true and indices.");var h=u?l?p._defaultProgramWithUVNormal:p._defaultProgramWithUV:l?p._defaultProgramWithNormal:p._defaultProgram;this.drawSetup(h,!1,f,c);var _=e.count?e.count:s?s.length:e.positions.length/2;if(p._setVertexUniform(h,"u_internal_scale",[2/i,2/o],a.FLOAT),p._setVertexUniform(h,"u_internal_translation",[-1,-1],a.FLOAT),s){for(var d=new Float32Array(2*_),m=0;m<_;m++){var g=s[m];d[2*m]=e.positions[2*g],d[2*m+1]=e.positions[2*g+1]}t.bindBuffer(t.ARRAY_BUFFER,this.initVertexBuffer(d))}else t.bindBuffer(t.ARRAY_BUFFER,this.initVertexBuffer(e.positions));this.setPositionAttribute(h,p.name),u&&(t.bindBuffer(t.ARRAY_BUFFER,this.initVertexBuffer(u)),this.setUVAttribute(h,p.name)),l&&(t.bindBuffer(t.ARRAY_BUFFER,this.initVertexBuffer(l)),this.setVertexAttribute(h,"a_internal_normal",2,p.name)),this.setBlendMode(e.shouldBlendAlpha),e.indices?t.drawArrays(t.LINES,0,_):e.closeLoop?t.drawArrays(t.LINE_LOOP,0,_):t.drawArrays(t.LINE_STRIP,0,_),t.disable(t.BLEND)}},e.prototype.drawLayerAsPoints=function(e){var r=this,t=r.gl,n=r.errorState,o=r.pointIndexArray,s=r.width,u=r.height,f=e.positions,c=e.output;if(!n){if(2!==f.numComponents&&4!==f.numComponents)throw new Error('GPUComposer.drawPoints() must be passed a position GPULayer with either 2 or 4 components, got position GPULayer "'+f.name+'" with '+f.numComponents+" components.");var p=f.length,h=e.count||p;if(h>p)throw new Error("Invalid count "+h+" for position GPULayer of length "+p+".");var _=e.program;if(void 0===_){_=this._setValueProgramForType(a.FLOAT);var d=e.color||[1,0,0];_.setUniform("u_value",i(d,[1]),a.FLOAT)}var m=_._GPULayerPointsProgram,g=this.addLayerToInputs(f,e.input);this.drawSetup(m,!1,g,c),_._setVertexUniform(m,"u_internal_positions",g.indexOf(f),a.INT),_._setVertexUniform(m,"u_internal_scale",[1/s,1/u],a.FLOAT),_._setVertexUniform(m,"u_internal_positionWithAccumulation",4===f.numComponents?1:0,a.INT);var E=e.pointSize||1;_._setVertexUniform(m,"u_internal_pointSize",E,a.FLOAT);var v=[f.width,f.height];if(_._setVertexUniform(m,"u_internal_positionsDimensions",v,a.FLOAT),_._setVertexUniform(m,"u_internal_wrapX",e.wrapX?1:0,a.INT),_._setVertexUniform(m,"u_internal_wrapY",e.wrapY?1:0,a.INT),void 0===this.pointIndexBuffer||o&&o.length<h){var T=l.initSequentialFloatArray(p);this.pointIndexArray=T,this.pointIndexBuffer=this.initVertexBuffer(T)}t.bindBuffer(t.ARRAY_BUFFER,this.pointIndexBuffer),this.setIndexAttribute(m,_.name),this.setBlendMode(e.shouldBlendAlpha),t.drawArrays(t.POINTS,0,h),t.disable(t.BLEND)}},e.prototype.drawLayerAsLines=function(e){var r=this,t=r.gl,n=r.errorState,o=r.width,s=r.height,u=e.positions,f=e.output;if(!n){if(2!==u.numComponents&&4!==u.numComponents)throw new Error('GPUComposer.drawLayerAsLines() must be passed a position GPULayer with either 2 or 4 components, got position GPULayer "'+u.name+'" with '+u.numComponents+" components.");if(e.closeLoop&&e.indices)throw new Error("GPUComposer.drawLayerAsLines() can't be called with closeLoop == true and indices.");var c=e.program;if(void 0===c){c=e.wrapX||e.wrapY?this.wrappedLineColorProgram:this._setValueProgramForType(a.FLOAT);var p=e.color||[1,0,0];c.setUniform("u_value",i(p,[1]),a.FLOAT)}var h=c._GPULayerLinesProgram,_=this.addLayerToInputs(u,e.input);this.drawSetup(h,!1,_,f);var d=e.indices?e.indices:l.initSequentialFloatArray(e.count||u.length),m=e.count?e.count:d.length;c._setVertexUniform(h,"u_internal_positions",_.indexOf(u),a.INT),c._setVertexUniform(h,"u_internal_scale",[1/o,1/s],a.FLOAT),c._setVertexUniform(h,"u_internal_positionWithAccumulation",4===u.numComponents?1:0,a.INT);var g=[u.width,u.height];if(c._setVertexUniform(h,"u_internal_positionsDimensions",g,a.FLOAT),c._setVertexUniform(h,"u_internal_wrapX",e.wrapX?1:0,a.INT),c._setVertexUniform(h,"u_internal_wrapY",e.wrapY?1:0,a.INT),void 0===this.indexedLinesIndexBuffer){var E=void 0;if(d.constructor!==Float32Array){E=new Float32Array(d.length);for(var v=0;v<m;v++)E[v]=d[v];console.warn("Converting indices array of type "+d.constructor+" to Float32Array in GPUComposer.drawIndexedLines for WebGL compatibility, you may want to use a Float32Array to store this information so the conversion is not required.")}else E=d;this.indexedLinesIndexBuffer=this.initVertexBuffer(E)}else t.bindBuffer(t.ARRAY_BUFFER,this.indexedLinesIndexBuffer),t.bufferData(t.ARRAY_BUFFER,d,t.STATIC_DRAW);this.setIndexAttribute(h,c.name),this.setBlendMode(e.shouldBlendAlpha),e.indices?t.drawArrays(t.LINES,0,m):e.closeLoop?t.drawArrays(t.LINE_LOOP,0,m):t.drawArrays(t.LINE_STRIP,0,m),t.disable(t.BLEND)}},e.prototype.drawLayerAsVectorField=function(e){var r=this,t=r.gl,n=r.errorState,o=r.vectorFieldIndexArray,s=r.width,u=r.height,f=e.data,c=e.output;if(!n){if(2!==f.numComponents)throw new Error('GPUComposer.drawLayerAsVectorField() must be passed a fieldLayer with 2 components, got fieldLayer "'+f.name+'" with '+f.numComponents+" components.");var p=e.program;if(void 0===p){p=this._setValueProgramForType(a.FLOAT);var h=e.color||[1,0,0];p.setUniform("u_value",i(h,[1]),a.FLOAT)}var _=p._GPULayerVectorFieldProgram,d=this.addLayerToInputs(f,e.input);this.drawSetup(_,!1,d,c),p._setVertexUniform(_,"u_internal_vectors",d.indexOf(f),a.INT);var m=e.vectorScale||1;p._setVertexUniform(_,"u_internal_scale",[m/s,m/u],a.FLOAT);var g=e.vectorSpacing||10,E=[Math.floor(s/g),Math.floor(u/g)];p._setVertexUniform(_,"u_internal_dimensions",E,a.FLOAT);var v=2*E[0]*E[1];if(void 0===this.vectorFieldIndexBuffer||o&&o.length<v){var T=l.initSequentialFloatArray(v);this.vectorFieldIndexArray=T,this.vectorFieldIndexBuffer=this.initVertexBuffer(T)}t.bindBuffer(t.ARRAY_BUFFER,this.vectorFieldIndexBuffer),this.setIndexAttribute(_,p.name),this.setBlendMode(e.shouldBlendAlpha),t.drawArrays(t.LINES,0,v),t.disable(t.BLEND)}},e.prototype.drawLayerMagnitude=function(e){var r=this,t=r.gl,n=r.errorState,i=r.quadPositionsBuffer,o=e.data,s=e.output;if(!n){var u=this.vectorMagnitudeProgramForType(o.type),l=e.color||[1,0,0];u.setUniform("u_color",l,a.FLOAT);var f=e.scale||1;u.setUniform("u_scale",f,a.FLOAT),u.setUniform("u_internal_numDimensions",o.numComponents,a.INT);var c=u._defaultProgram,p=this.addLayerToInputs(o,e.input);this.drawSetup(c,!0,p,s),u._setVertexUniform(c,"u_internal_data",p.indexOf(o),a.INT),u._setVertexUniform(c,"u_internal_scale",[1,1],a.FLOAT),u._setVertexUniform(c,"u_internal_translation",[0,0],a.FLOAT),t.bindBuffer(t.ARRAY_BUFFER,i),this.setPositionAttribute(c,u.name),this.setBlendMode(e.shouldBlendAlpha),t.drawArrays(t.TRIANGLE_STRIP,0,4),t.disable(t.BLEND)}},e.prototype.attachGPULayerToThreeTexture=function(e,r){if(!this.renderer)throw new Error("GPUComposer was not inited with a renderer.");if(e.numBuffers>1)throw new Error('GPULayer "'+e.name+'" contains multiple WebGL textures (one for each buffer) that are flip-flopped during compute cycles, please choose a GPULayer with one buffer.');var t=this.renderer.properties.get(r);t.__webglTexture=e.currentState,t.__webglInit=!0},e.prototype.resetThreeState=function(){if(!this.renderer)throw new Error("GPUComposer was not inited with a renderer, use GPUComposer.initWithThreeRenderer() to initialize GPUComposer instead.");var e=this.gl,r=this.renderer.getViewport(new u.Vector4);e.viewport(r.x,r.y,r.width,r.height),this.renderer.setRenderTarget(null),this.renderer.resetState()},e.prototype.dispose=function(){var e,r=this,t=r.gl,n=r.verboseLogging,i=r._vertexShaders,o=r.copyPrograms,a=r.setValuePrograms,s=r.vectorMagnitudePrograms;n&&console.log("Deallocating GPUComposer."),Object.values(i).forEach((function(e){e.shader&&(t.deleteShader(e.shader),delete e.shader)})),Object.values(o).forEach((function(e){e.dispose&&e.dispose()})),Object.keys(o).forEach((function(e){delete o[e]})),Object.values(a).forEach((function(e){e.dispose&&e.dispose()})),Object.keys(a).forEach((function(e){delete a[e]})),Object.values(s).forEach((function(e){e.dispose&&e.dispose()})),Object.keys(s).forEach((function(e){delete s[e]})),null===(e=this._wrappedLineColorProgram)||void 0===e||e.dispose(),delete this._wrappedLineColorProgram,delete this.renderer,delete this.gl},e}();r.GPUComposer=p},355:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.GPULayer=void 0;var n=t(501),i=t(809),o=t(162),a=t(707),s=t(601),u=t(593),l=t(191),f=function(){function e(e,r){this._bufferIndex=0,this.buffers=[];var t=(r||{}).name;if(!e)throw new Error('Error initing GPULayer "'+t+'": must pass GPUComposer instance to GPULayer(composer, params).');var n=["name","dimensions","type","numComponents","array","filter","wrapS","wrapT","writable","numBuffers","clearValue"],i=Object.keys(r);i.forEach((function(e){if(n.indexOf(e)<0)throw new Error('Invalid params key "'+e+'" passed to GPULayer(composer, params) with name "'+r.name+'".  Valid keys are '+n.join(", ")+".")})),["name","dimensions","type","numComponents"].forEach((function(e){if(i.indexOf(e)<0)throw new Error('Required params key "'+e+'" was not passed to GPUProgram(composer, params) with name "'+t+'".')}));var o=r.dimensions,u=r.type,f=r.numComponents,c=r.array,p=e.gl,h=e._errorCallback,_=e.glslVersion;if(this.composer=e,this.name=t,!a.isPositiveInteger(f)||f>4)throw new Error("Invalid numComponents: "+f+' for GPULayer "'+t+'".');this.numComponents=f;var d=!!r.writable;this.writable=d;var m=l.calcGPULayerSize(o,t,e.verboseLogging),g=m.length,E=m.width,v=m.height;if(this._length=g,!a.isPositiveInteger(E))throw new Error("Invalid width: "+E+' for GPULayer "'+t+'".');if(this._width=E,!a.isPositiveInteger(v))throw new Error("Invalid length: "+v+' for GPULayer "'+t+'".');this._height=v;var T=g?s.NEAREST:u===s.FLOAT||u==s.HALF_FLOAT?s.LINEAR:s.NEAREST,y=void 0!==r.filter?r.filter:T;if(!a.isValidFilter(y))throw new Error("Invalid filter: "+y+' for GPULayer "'+t+'", must be one of ['+s.validFilters.join(", ")+"].");if(y===s.LINEAR&&u!==s.FLOAT&&u!=s.HALF_FLOAT)throw new Error('LINEAR filtering is not supported on integer types, please use NEAREST filtering for GPULayer "'+t+'" with type: '+u+".");this.filter=y;var A=void 0!==r.wrapS?r.wrapS:s.CLAMP_TO_EDGE;if(!a.isValidWrap(A))throw new Error("Invalid wrapS: "+A+' for GPULayer "'+t+'", must be one of ['+s.validWraps.join(", ")+"].");this.wrapS=A;var b=void 0!==r.wrapT?r.wrapT:s.CLAMP_TO_EDGE;if(!a.isValidWrap(b))throw new Error("Invalid wrapT: "+b+' for GPULayer "'+t+'", must be one of ['+s.validWraps.join(", ")+"].");if(this.wrapT=b,!a.isValidDataType(u))throw new Error("Invalid type: "+u+' for GPULayer "'+t+'", must be one of ['+s.validDataTypes.join(", ")+"].");this.type=u;var U=l.getGPULayerInternalType({gl:p,type:u,glslVersion:_,writable:d,name:t,errorCallback:h});this.internalType=U;var L=l.getGLTextureParameters({gl:p,name:t,numComponents:f,writable:d,internalType:U,glslVersion:_,errorCallback:h}),P=L.glFormat,R=L.glInternalFormat,w=L.glType,O=L.glNumChannels;this.glInternalFormat=R,this.glFormat=P,this.glType=w,this.glNumChannels=O,this.internalFilter=l.getGPULayerInternalFilter({gl:p,filter:y,internalType:U,name:t,errorCallback:h}),this.glFilter=p[this.internalFilter],this.internalWrapS=l.getGPULayerInternalWrap({gl:p,wrap:A,name:t}),this.glWrapS=p[this.internalWrapS],this.internalWrapT=l.getGPULayerInternalWrap({gl:p,wrap:b,name:t}),this.glWrapT=p[this.internalWrapT];var I=void 0!==r.numBuffers?r.numBuffers:1;if(!a.isPositiveInteger(I))throw new Error("Invalid numBuffers: "+I+' for GPULayer "'+t+'", must be positive integer.');this.numBuffers=I;var F=void 0!==r.clearValue?r.clearValue:0;this.clearValue=F,this.initBuffers(c)}return Object.defineProperty(e.prototype,"bufferIndex",{get:function(){return this._bufferIndex},enumerable:!1,configurable:!0}),e.prototype.saveCurrentStateToGPULayer=function(e){if(this.numBuffers<2)throw new Error("Can't call GPULayer.saveCurrentStateToGPULayer on GPULayer \""+this.name+'" with less than 2 buffers.');if(!this.writable)throw new Error("Can't call GPULayer.saveCurrentStateToGPULayer on read-only GPULayer \""+this.name+'".');if(e.writable)throw new Error("Can't call GPULayer.saveCurrentStateToGPULayer on GPULayer \""+this.name+'" using writable GPULayer "'+e.name+'".');if(e.glWrapS!==this.glWrapS||e.glWrapT!==this.glWrapT||e.wrapS!==this.wrapS||e.wrapT!==this.wrapT||e.width!==this.width||e.height!==this.height||e.glFilter!==this.glFilter||e.filter!==this.filter||e.glNumChannels!==this.glNumChannels||e.numComponents!==this.numComponents||e.glType!==this.glType||e.type!==this.type||e.glFormat!==this.glFormat||e.glInternalFormat!==this.glInternalFormat)throw new Error('Incompatible texture params between GPULayers "'+e.name+'" and "'+this.name+'".');if(!this.textureOverrides){this.textureOverrides=[];for(var r=0;r<this.numBuffers;r++)this.textureOverrides.push(void 0)}if(this.textureOverrides[this.bufferIndex])throw new Error("Can't call GPULayer.saveCurrentStateToGPULayer on GPULayer \""+this.name+'", this GPULayer has not written new state since last call to GPULayer.saveCurrentStateToGPULayer.');var t=this.currentState;this.textureOverrides[this.bufferIndex]=t,this.buffers[this.bufferIndex].texture=e.currentState,e._setCurrentStateTexture(t);var n=this.composer.gl,i=this.buffers[this.bufferIndex],o=i.framebuffer,a=i.texture;if(!o)throw new Error('No framebuffer for writable GPULayer "'+this.name+'".');n.bindFramebuffer(n.FRAMEBUFFER,o),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,a,0),n.bindFramebuffer(n.FRAMEBUFFER,null)},e.prototype._setCurrentStateTexture=function(e){if(this.writable)throw new Error("Can't call GPULayer._setCurrentStateTexture on writable texture \""+this.name+'".');this.buffers[this.bufferIndex].texture=e},e.prototype.validateDataArray=function(e){var r=this,t=r.numComponents,i=r.glNumChannels,o=r.internalType,a=r.width,u=r.height,f=this._length;if(e.length!==a*u*t&&(!f||f&&e.length!==f*t))throw new Error("Invalid data length: "+e.length+' for GPULayer "'+this.name+'" of '+(f?"length "+f+" and ":"")+"dimensions: ["+a+", "+u+"] and numComponents: "+t+".");var c=!1;switch(e.constructor){case Array:c=!0;break;case Float32Array:c=o!==s.FLOAT;break;case Uint8Array:c=o!==s.UNSIGNED_BYTE;break;case Int8Array:c=o!==s.BYTE;break;case Uint16Array:c=o!==s.UNSIGNED_SHORT;break;case Int16Array:c=o!==s.SHORT;break;case Uint32Array:c=o!==s.UNSIGNED_INT;break;case Int32Array:c=o!==s.INT;break;default:throw new Error("Invalid array type: "+e.constructor.name+' for GPULayer "'+this.name+'", please use one of ['+s.validArrayTypes.map((function(e){return e.name})).join(", ")+"].")}var p=a*u*i,h=e.length!==p,_=o===s.HALF_FLOAT,d=e;if(c||h||_){d=l.initArrayForType(o,p);for(var m=_?new DataView(d.buffer):null,g=0,E=e.length/t;g<E;g++)for(var v=0;v<t;v++){var T=e[g*t+v],y=g*i+v;_?n.setFloat16(m,2*y,T,!0):d[y]=T}}return d},e.prototype.initBuffers=function(e){for(var r=this,t=r.name,n=r.numBuffers,i=r.composer,o=r.glInternalFormat,a=r.glFormat,s=r.glType,u=r.glFilter,l=r.glWrapS,f=r.glWrapT,c=r.writable,p=r.width,h=r.height,_=i.gl,d=i._errorCallback,m=e?this.validateDataArray(e):void 0,g=0;g<n;g++){var E=_.createTexture();if(!E)return void d('Could not init texture for GPULayer "'+t+'": '+_.getError()+".");_.bindTexture(_.TEXTURE_2D,E),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,l),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,f),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,u),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,u),_.texImage2D(_.TEXTURE_2D,0,o,p,h,0,a,s,m||null);var v={texture:E};if(c){var T=_.createFramebuffer();if(!T)return void d('Could not init framebuffer for GPULayer "'+t+'": '+_.getError()+".");_.bindFramebuffer(_.FRAMEBUFFER,T),_.framebufferTexture2D(_.FRAMEBUFFER,_.COLOR_ATTACHMENT0,_.TEXTURE_2D,E,0);var y=_.checkFramebufferStatus(_.FRAMEBUFFER);y!=_.FRAMEBUFFER_COMPLETE&&d('Invalid status for framebuffer for GPULayer "'+t+'": '+y+"."),v.framebuffer=T}this.buffers.push(v)}_.bindTexture(_.TEXTURE_2D,null),_.bindFramebuffer(_.FRAMEBUFFER,null)},e.prototype.getStateAtIndex=function(e){if(e<0||e>=this.numBuffers)throw new Error("Invalid buffer index: "+e+' for GPULayer "'+this.name+'" with '+this.numBuffers+" buffer"+(this.numBuffers>1?"s":"")+".");return this.textureOverrides&&this.textureOverrides[e]?this.textureOverrides[e]:this.buffers[e].texture},Object.defineProperty(e.prototype,"currentState",{get:function(){return this.getStateAtIndex(this.bufferIndex)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastState",{get:function(){if(1===this.numBuffers)throw new Error('Cannot access lastState on GPULayer "'+this.name+'" with only one buffer.');return this.getStateAtIndex((this.bufferIndex-1+this.numBuffers)%this.numBuffers)},enumerable:!1,configurable:!0}),e.prototype._usingTextureOverrideForCurrentBuffer=function(){return this.textureOverrides&&this.textureOverrides[this.bufferIndex]},e.prototype.incrementBufferIndex=function(){this._bufferIndex=(this.bufferIndex+1)%this.numBuffers},e.prototype._bindOutputBufferForWrite=function(e){e&&this.incrementBufferIndex(),this._bindOutputBuffer(),this.textureOverrides&&(this.textureOverrides[this.bufferIndex]=void 0)},e.prototype._bindOutputBuffer=function(){var e=this.composer.gl,r=this.buffers[this.bufferIndex].framebuffer;if(!r)throw new Error('GPULayer "'+this.name+'" is not writable.');e.bindFramebuffer(e.FRAMEBUFFER,r)},e.prototype.setFromArray=function(e,r){void 0===r&&(r=!1);for(var t=this,n=t.composer,i=t.glInternalFormat,o=t.glFormat,a=t.glType,s=t.numBuffers,u=t.width,l=t.height,f=t.bufferIndex,c=n.gl,p=this.validateDataArray(e),h=r?s:f+1,_=r?0:f;_<h;_++){var d=this.getStateAtIndex(_);c.bindTexture(c.TEXTURE_2D,d),c.texImage2D(c.TEXTURE_2D,0,i,u,l,0,o,a,p)}c.bindTexture(c.TEXTURE_2D,null)},e.prototype.resize=function(e,r){var t=this.name,n=this.composer.verboseLogging;n&&console.log('Resizing GPULayer "'+t+'" to '+JSON.stringify(e)+".");var i=l.calcGPULayerSize(e,t,n),o=i.length,a=i.width,s=i.height;this._length=o,this._width=a,this._height=s,this.destroyBuffers(),this.initBuffers(r)},Object.defineProperty(e.prototype,"clearValue",{get:function(){return this._clearValue},set:function(e){var r=this.numComponents,t=this.type;if(!a.isValidClearValue(e,r,t))throw new Error("Invalid clearValue: "+JSON.stringify(e)+' for GPULayer "'+this.name+'", expected '+t+" or array of "+t+" of length "+r+".");this._clearValue=e},enumerable:!1,configurable:!0}),e.prototype.clear=function(e){void 0===e&&(e=!1);var r=this,t=r.name,i=r.composer,o=r.clearValue,u=r.numBuffers,f=r.bufferIndex,c=r.type;i.verboseLogging&&console.log('Clearing GPULayer "'+t+'".');var p=[];if(a.isNumber(o))p.push(o,o,o,o);else{p.push.apply(p,o);for(var h=p.length;h<4;h++)p.push(0)}var _=e?0:f,d=e?u:f+1;if(this.writable){var m=i._setValueProgramForType(c);m.setUniform("u_value",p);for(var g=_;g<d;g++)i.step({program:m,output:this})}else{var E=this,v=E.width,T=E.height,y=E.glNumChannels,A=E.internalType,b=E.glInternalFormat,U=E.glFormat,L=E.glType,P=i.gl,R=this._length?this._length:v*T,w=l.initArrayForType(A,v*T*y),O=A===s.HALF_FLOAT?new DataView(w.buffer):null;for(h=0;h<R;h++)for(var I=0;I<y;I++){var F=h*y+I;A===s.HALF_FLOAT?n.setFloat16(O,2*F,p[I],!0):w[F]=p[I]}for(g=_;g<d;g++){var N=this.getStateAtIndex(g);P.bindTexture(P.TEXTURE_2D,N),P.texImage2D(P.TEXTURE_2D,0,b,v,T,0,U,L,w)}P.bindTexture(P.TEXTURE_2D,null)}},Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){if(!this._length)throw new Error('Cannot access length on 2D GPULayer "'+this.name+'".');return this._length},enumerable:!1,configurable:!0}),e.prototype.getValues=function(){var e=this,r=e.width,t=e.height,i=e.composer,o=e.numComponents,a=e.type,f=i.gl,c=i.glslVersion;this._bindOutputBuffer();var p,h=this,_=h.glNumChannels,d=h.glType,m=h.glFormat,g=h.internalType;switch(g){case s.HALF_FLOAT:void 0!==f.FLOAT?(_=4,m=f.RGBA,d=f.FLOAT,p=new Float32Array(r*t*_)):p=new Uint16Array(r*t*_);break;case s.FLOAT:_=4,m=f.RGBA,p=new Float32Array(r*t*_);break;case s.UNSIGNED_BYTE:if(c===s.GLSL1){_=4,m=f.RGBA,p=new Uint8Array(r*t*_);break}_=4,m=f.RGBA_INTEGER,d=f.UNSIGNED_INT,p=new Uint32Array(r*t*_);break;case s.UNSIGNED_SHORT:_=4,m=f.RGBA_INTEGER,d=f.UNSIGNED_INT,p=new Uint32Array(r*t*_);break;case s.UNSIGNED_INT:_=4,m=f.RGBA_INTEGER,p=new Uint32Array(r*t*_);break;case s.BYTE:case s.SHORT:_=4,m=f.RGBA_INTEGER,d=f.INT,p=new Int32Array(r*t*_);break;case s.INT:_=4,m=f.RGBA_INTEGER,p=new Int32Array(r*t*_);break;default:throw new Error("Unsupported internalType "+g+" for getValues().")}if(u.readyToRead(f)){f.readPixels(0,0,r,t,m,d,p);var E=(this._length?this._length:r*t)*o,v=g===s.HALF_FLOAT&&p.constructor===Uint16Array,T=v?new DataView(p.buffer):void 0,y=g===a?p:l.initArrayForType(a,E,!0);if(v||y!==p||o!==_)for(var A=0,b=r*t;A<b;A++){var U=A*_,L=A*o;if(L>=E)break;for(var P=0;P<o;P++)y[L+P]=v?n.getFloat16(T,2*(U+P),!0):p[U+P]}return y.length!==E&&(y=y.slice(0,E)),y}throw new Error("Unable to read values from Buffer with status: "+f.checkFramebufferStatus(f.FRAMEBUFFER)+".")},e.prototype.savePNG=function(e){var r=this.getValues(),t=this,n=t.width,a=t.height,u=t.type,l=t.name,f=t.numComponents,c=e.dpi,p=e.callback||o.saveAs,h=e.filename||l,_=e.multiplier||u===s.FLOAT||u===s.HALF_FLOAT?255:1,d=document.createElement("canvas");d.width=n,d.height=a;for(var m=d.getContext("2d"),g=m.getImageData(0,0,n,a),E=g.data,v=0;v<a;v++)for(var T=0;T<n;T++){for(var y=v*n+T,A=(a-1-v)*n+T,b=0;b<f;b++)E[4*A+b]=r[f*y+b]*_;1===f&&(E[4*A+1]=E[4*A],E[4*A+2]=E[4*A]),f<4&&(E[4*A+3]=255)}m.putImageData(g,0,0),d.toBlob((function(e){e?c?i.changeDpiBlob(e,c).then((function(e){p(e,h+".png")})):p(e,h+".png"):console.warn('Problem saving PNG from GPULayer "'+l+'", unable to init blob.')}),"image/png")},e.prototype.destroyBuffers=function(){var e=this.composer,r=this.buffers,t=e.gl;r.forEach((function(e){var r=e.framebuffer,n=e.texture;t.deleteTexture(n),r&&t.deleteFramebuffer(r),delete e.texture,delete e.framebuffer})),r.length=0,delete this.textureOverrides},e.prototype.dispose=function(){var e=this.name;this.composer.verboseLogging&&console.log('Deallocating GPULayer "'+e+'".'),this.destroyBuffers(),delete this.composer},e.prototype.clone=function(e){return this.composer._cloneGPULayer(this,e)},e}();r.GPULayer=f},191:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getGPULayerInternalType=r.getGLTextureParameters=r.getGPULayerInternalFilter=r.getGPULayerInternalWrap=r.calcGPULayerSize=r.initArrayForType=void 0;var n=t(707),i=t(601),o=t(581),a=t(593),s={framebufferWriteSupport:{}};function u(e){var r,t,n,s,u=e.gl,l=e.errorCallback,f=e.name,c=e.numComponents,p=e.internalType,h=e.writable,_=e.glslVersion;if(a.isWebGL2(u)){if(s=c,3===c&&h&&(s=4),p===i.FLOAT||p===i.HALF_FLOAT)switch(s){case 1:t=u.RED;break;case 2:t=u.RG;break;case 3:t=u.RGB;break;case 4:t=u.RGBA;break;default:throw new Error("Unsupported glNumChannels: "+s+' for GPULayer "'+f+'".')}else if(_===i.GLSL1&&p===i.UNSIGNED_BYTE)switch(h&&(s=4),s){case 1:case 2:case 3:t=u.RGB,s=3;break;case 4:t=u.RGBA,s=4;break;default:throw new Error("Unsupported glNumChannels: "+s+' for GPULayer "'+f+'".')}else switch(s){case 1:t=u.RED_INTEGER;break;case 2:t=u.RG_INTEGER;break;case 3:t=u.RGB_INTEGER;break;case 4:t=u.RGBA_INTEGER;break;default:throw new Error("Unsupported glNumChannels: "+s+' for GPULayer "'+f+'".')}switch(p){case i.HALF_FLOAT:switch(r=u.HALF_FLOAT,s){case 1:n=u.R16F;break;case 2:n=u.RG16F;break;case 3:n=u.RGB16F;break;case 4:n=u.RGBA16F;break;default:throw new Error("Unsupported glNumChannels: "+s+' for GPULayer "'+f+'".')}break;case i.FLOAT:switch(r=u.FLOAT,s){case 1:n=u.R32F;break;case 2:n=u.RG32F;break;case 3:n=u.RGB32F;break;case 4:n=u.RGBA32F;break;default:throw new Error("Unsupported glNumChannels: "+s+' for GPULayer "'+f+'".')}break;case i.UNSIGNED_BYTE:if(r=u.UNSIGNED_BYTE,_===i.GLSL1&&p===i.UNSIGNED_BYTE)n=t;else switch(s){case 1:n=u.R8UI;break;case 2:n=u.RG8UI;break;case 3:n=u.RGB8UI;break;case 4:n=u.RGBA8UI;break;default:throw new Error("Unsupported glNumChannels: "+s+' for GPULayer "'+f+'".')}break;case i.BYTE:switch(r=u.BYTE,s){case 1:n=u.R8I;break;case 2:n=u.RG8I;break;case 3:n=u.RGB8I;break;case 4:n=u.RGBA8I;break;default:throw new Error("Unsupported glNumChannels: "+s+' for GPULayer "'+f+'".')}break;case i.SHORT:switch(r=u.SHORT,s){case 1:n=u.R16I;break;case 2:n=u.RG16I;break;case 3:n=u.RGB16I;break;case 4:n=u.RGBA16I;break;default:throw new Error("Unsupported glNumChannels: "+s+' for GPULayer "'+f+'".')}break;case i.UNSIGNED_SHORT:switch(r=u.UNSIGNED_SHORT,s){case 1:n=u.R16UI;break;case 2:n=u.RG16UI;break;case 3:n=u.RGB16UI;break;case 4:n=u.RGBA16UI;break;default:throw new Error("Unsupported glNumChannels: "+s+' for GPULayer "'+f+'".')}break;case i.INT:switch(r=u.INT,s){case 1:n=u.R32I;break;case 2:n=u.RG32I;break;case 3:n=u.RGB32I;break;case 4:n=u.RGBA32I;break;default:throw new Error("Unsupported glNumChannels: "+s+' for GPULayer "'+f+'".')}break;case i.UNSIGNED_INT:switch(r=u.UNSIGNED_INT,s){case 1:n=u.R32UI;break;case 2:n=u.RG32UI;break;case 3:n=u.RGB32UI;break;case 4:n=u.RGBA32UI;break;default:throw new Error("Unsupported glNumChannels: "+s+' for GPULayer "'+f+'".')}break;default:throw new Error("Unsupported type: "+p+' for GPULayer "'+f+'".')}}else{switch(h&&(s=4),c){case 1:case 2:case 3:t=u.RGB,n=u.RGB,s=3;break;case 4:t=u.RGBA,n=u.RGBA,s=4;break;default:throw new Error("Unsupported numComponents: "+c+' for GPULayer "'+f+'".')}switch(p){case i.FLOAT:r=u.FLOAT;break;case i.HALF_FLOAT:r=u.HALF_FLOAT||o.getExtension(u,o.OES_TEXTURE_HALF_FLOAT,l).HALF_FLOAT_OES;break;case i.UNSIGNED_BYTE:r=u.UNSIGNED_BYTE;break;default:throw new Error("Unsupported type: "+p+' in WebGL 1.0 for GPULayer "'+f+'".')}}if(void 0===r||void 0===t||void 0===n){var d=[];throw void 0===r&&d.push("glType"),void 0===t&&d.push("glFormat"),void 0===n&&d.push("glInternalFormat"),new Error("Invalid type: "+p+" for numComponents: "+c+", unable to init parameter"+(d.length>1?"s":"")+" "+d.join(", ")+' for GPULayer "'+f+'".')}if(void 0===s||c<1||c>4||s<c)throw new Error("Invalid numChannels: "+s+" for numComponents: "+c+' for GPULayer "'+f+'".');return{glFormat:t,glInternalFormat:n,glType:r,glNumChannels:s}}function l(e){var r=e.gl,t=e.type,n=e.glslVersion,o=""+(a.isWebGL2(r),n);if(void 0!==s.framebufferWriteSupport[o])return s.framebufferWriteSupport[o];var l=r.createTexture();if(!l)return s.framebufferWriteSupport[o]=!1,s.framebufferWriteSupport[o];r.bindTexture(r.TEXTURE_2D,l);var f=r[i.CLAMP_TO_EDGE],c=r[i.CLAMP_TO_EDGE],p=r[i.NEAREST];r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,f),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,c),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,p),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,p);var h=u({gl:r,name:"testFramebufferWrite",numComponents:1,writable:!0,internalType:t,glslVersion:n,errorCallback:function(){}}),_=h.glInternalFormat,d=h.glFormat,m=h.glType;r.texImage2D(r.TEXTURE_2D,0,_,100,100,0,d,m,null);var g=r.createFramebuffer();if(!g)return r.deleteTexture(l),s.framebufferWriteSupport[o]=!1,s.framebufferWriteSupport[o];r.bindFramebuffer(r.FRAMEBUFFER,g),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,l,0);var E=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.deleteTexture(l),r.deleteFramebuffer(g),s.framebufferWriteSupport[o]=E,s.framebufferWriteSupport[o]}r.initArrayForType=function(e,r,t){switch(void 0===t&&(t=!1),e){case i.HALF_FLOAT:return t?new Float32Array(r):new Uint16Array(r);case i.FLOAT:return new Float32Array(r);case i.UNSIGNED_BYTE:return new Uint8Array(r);case i.BYTE:return new Int8Array(r);case i.UNSIGNED_SHORT:return new Uint16Array(r);case i.SHORT:return new Int16Array(r);case i.UNSIGNED_INT:return new Uint32Array(r);case i.INT:return new Int32Array(r);default:throw new Error("Unsupported type: "+e+".")}},r.calcGPULayerSize=function(e,r,t){var i,o,a;if(n.isNumber(e)){if(!n.isPositiveInteger(e))throw new Error("Invalid length: "+e+' for GPULayer "'+r+'", must be positive integer.');for(var s=1,u=i=e;u>2;)s++,u/=2;o=Math.pow(2,Math.floor(s/2)+s%2),a=Math.pow(2,Math.floor(s/2)),t&&console.log("Using ["+o+", "+a+"] for 1D array of length "+e+' in GPULayer "'+r+'".')}else{if(o=e[0],!n.isPositiveInteger(o))throw new Error("Invalid width: "+o+' for GPULayer "'+r+'", must be positive integer.');if(a=e[1],!n.isPositiveInteger(a))throw new Error("Invalid height: "+a+' for GPULayer "'+r+'", must be positive integer.')}return{width:o,height:a,length:i}},r.getGPULayerInternalWrap=function(e){var r=e.gl,t=e.wrap,n=e.name;return a.isWebGL2(r)||t===i.CLAMP_TO_EDGE||a.isWebGL2(r)?t:(console.warn('Falling back to CLAMP_TO_EDGE wrapping for GPULayer "'+n+'" for WebGL 1.'),i.CLAMP_TO_EDGE)},r.getGPULayerInternalFilter=function(e){var r=e.gl,t=e.errorCallback,n=e.internalType,a=e.name,s=e.filter;return s===i.NEAREST||(n===i.HALF_FLOAT&&(o.getExtension(r,o.OES_TEXTURE_HAlF_FLOAT_LINEAR,t,!0)||o.getExtension(r,o.OES_TEXTURE_FLOAT_LINEAR,t,!0)||(console.warn('Falling back to NEAREST filter for GPULayer "'+a+'".'),s=i.NEAREST)),n===i.FLOAT&&(o.getExtension(r,o.OES_TEXTURE_FLOAT_LINEAR,t,!0)||(console.warn('Falling back to NEAREST filter for GPULayer "'+a+'".'),s=i.NEAREST))),s},r.getGLTextureParameters=u,r.getGPULayerInternalType=function(e){var r=e.gl,t=e.errorCallback,n=e.writable,s=e.name,u=e.glslVersion,f=e.type;if(function(e){var r=e.gl,t=e.type;return!(e.glslVersion===i.GLSL3&&a.isWebGL2(r)||t!==i.BYTE&&t!==i.SHORT&&t!==i.INT&&t!==i.UNSIGNED_SHORT&&t!==i.UNSIGNED_INT)}(e)&&(f===i.UNSIGNED_BYTE||f===i.BYTE?f=i.HALF_FLOAT:(console.warn("Falling back "+f+' type to FLOAT type for glsl1.x support for GPULayer "'+s+'".\nLarge UNSIGNED_INT or INT with absolute value > 16,777,216 are not supported, on mobile UNSIGNED_INT, INT, UNSIGNED_SHORT, and SHORT with absolute value > 2,048 may not be supported.'),f=i.FLOAT)),!a.isWebGL2(r)){if(f===i.FLOAT)if(o.getExtension(r,o.OES_TEXTURE_FLOAT,t,!0)||(console.warn('FLOAT not supported, falling back to HALF_FLOAT type for GPULayer "'+s+'".'),f=i.HALF_FLOAT),n)l({gl:r,type:f,glslVersion:u})||f===i.HALF_FLOAT||(console.warn('FLOAT not supported for writing operations, falling back to HALF_FLOAT type for GPULayer "'+s+'".'),f=i.HALF_FLOAT);if(f===i.HALF_FLOAT)if(o.getExtension(r,o.OES_TEXTURE_HALF_FLOAT,t),n)l({gl:r,type:f,glslVersion:u})||t("This browser does not support rendering to HALF_FLOAT textures.")}return n&&a.isWebGL2(r)&&(f===i.HALF_FLOAT||f===i.FLOAT)&&o.getExtension(r,o.EXT_COLOR_BUFFER_FLOAT,t),f}},664:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.GPUProgram=void 0;var n=t(707),i=t(601),o=t(593),a=function(){function e(e,r){this.defines={},this.uniforms={},this.programs={};var t=(r||{}).name;if(!e)throw new Error('Error initing GPUProgram "'+t+'": must pass GPUComposer instance to GPUProgram(composer, params).');if(!r)throw new Error("Error initing GPUProgram: must pass params to GPUProgram(composer, params).");if(!n.isObject(r))throw new Error("Error initing GPUProgram: must pass valid params object to GPUProgram(composer, params), got "+JSON.stringify(r)+".");var i=["name","fragmentShader","uniforms","defines"],a=Object.keys(r);a.forEach((function(e){if(i.indexOf(e)<0)throw new Error('Invalid params key "'+e+'" passed to GPUProgram(composer, params) with name "'+t+'".  Valid keys are '+JSON.stringify(i)+".")})),["name","fragmentShader"].forEach((function(e){if(a.indexOf(e)<0)throw new Error('Required params key "'+e+'" was not passed to GPUProgram(composer, params) with name "'+t+'".')}));var s=r.fragmentShader,u=r.uniforms,l=r.defines;this.composer=e,this.name=t;var f=n.isString(s)?s:s.join("\n");if(this.fragmentShaderSource=o.preprocessFragmentShader(f,e.glslVersion),this.recompile(l||this.defines),u)for(var c=0;c<u.length;c++){var p=u[c],h=p.name,_=p.value,d=p.type;this.setUniform(h,_,d)}}return e.prototype.recompile=function(e){for(var r=this,t=r.composer,n=r.name,i=r.fragmentShaderSource,a=t.gl,s=t._errorCallback,u=t.verboseLogging,l=t.glslVersion,f=t.floatPrecision,c=t.intPrecision,p=!1,h=Object.keys(e),_=0;_<h.length;_++){var d=h[_];this.defines[d]!==e[d]&&(p=!0,this.defines[d]=e[d])}if(!this.fragmentShader||p){u&&console.log('Compiling fragment shader for GPUProgram "'+n+'" with defines: '+JSON.stringify(this.defines));var m=o.compileShader(a,l,c,f,i,a.FRAGMENT_SHADER,n,s,this.defines);m?this.fragmentShader=m:s('Unable to compile fragment shader for GPUProgram "'+n+'".')}},e.prototype.getProgramWithName=function(e){if(this.programs[e])return this.programs[e];var r=this,t=r.composer,n=r.uniforms,i=r.fragmentShader,a=t._errorCallback,s=t._vertexShaders,u=t.gl,l=t.glslVersion,f=t.intPrecision,c=t.floatPrecision,p=s[e];if(void 0===p.shader){var h=this.composer.gl;if(""===p.src)throw new Error("No source for vertex shader "+this.name+" : "+e);var _=o.preprocessVertexShader(p.src,l),d=o.compileShader(h,l,f,c,_,h.VERTEX_SHADER,this.name,a,p.defines);if(!d)return void a('Unable to compile "'+e+'" vertex shader for GPUProgram "'+this.name+'".');p.shader=d}var m=o.initGLProgram(u,i,p.shader,this.name,a);if(void 0!==m){for(var g=Object.keys(n),E=0;E<g.length;E++){var v=g[E],T=n[v],y=T.value,A=T.type;this.setProgramUniform(m,e,v,y,A)}return this.programs[e]=m,m}a('Unable to init program "'+e+'" for GPUProgram "'+this.name+'".')},Object.defineProperty(e.prototype,"_defaultProgram",{get:function(){return this.getProgramWithName(i.DEFAULT_PROGRAM_NAME)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_defaultProgramWithUV",{get:function(){return this.getProgramWithName(i.DEFAULT_W_UV_PROGRAM_NAME)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_defaultProgramWithNormal",{get:function(){return this.getProgramWithName(i.DEFAULT_W_NORMAL_PROGRAM_NAME)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_defaultProgramWithUVNormal",{get:function(){return this.getProgramWithName(i.DEFAULT_W_UV_NORMAL_PROGRAM_NAME)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_segmentProgram",{get:function(){return this.getProgramWithName(i.SEGMENT_PROGRAM_NAME)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_GPULayerPointsProgram",{get:function(){return this.getProgramWithName(i.DATA_LAYER_POINTS_PROGRAM_NAME)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_GPULayerVectorFieldProgram",{get:function(){return this.getProgramWithName(i.DATA_LAYER_VECTOR_FIELD_PROGRAM_NAME)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_GPULayerLinesProgram",{get:function(){return this.getProgramWithName(i.DATA_LAYER_LINES_PROGRAM_NAME)},enumerable:!1,configurable:!0}),e.prototype.setProgramUniform=function(e,r,t,o,a){var s,u=this.composer,l=this.uniforms,f=u.gl,c=u._errorCallback;f.useProgram(e);var p=null===(s=l[t])||void 0===s?void 0:s.location[r];if(void 0===p){var h=f.getUniformLocation(e,t);if(!h)return void c('Could not init uniform "'+t+'" for program "'+this.name+'".\nCheck that uniform is present in shader code, unused uniforms may be removed by compiler.\nAlso check that uniform type in shader code matches type '+a+".\nError code: "+f.getError()+".");p=h,l[t]&&(l[t].location[r]=p)}switch(a){case i.FLOAT_1D_UNIFORM:f.uniform1f(p,o);break;case i.FLOAT_2D_UNIFORM:f.uniform2fv(p,o);break;case i.FLOAT_3D_UNIFORM:f.uniform3fv(p,o);break;case i.FLOAT_4D_UNIFORM:f.uniform4fv(p,o);break;case i.INT_1D_UNIFORM:n.isBoolean(o)?f.uniform1i(p,o?1:0):f.uniform1i(p,o);break;case i.INT_2D_UNIFORM:f.uniform2iv(p,o);break;case i.INT_3D_UNIFORM:f.uniform3iv(p,o);break;case i.INT_4D_UNIFORM:f.uniform4iv(p,o);break;case i.UINT_1D_UNIFORM:f.uniform1ui(p,o);break;case i.UINT_2D_UNIFORM:f.uniform2uiv(p,o);break;case i.UINT_3D_UNIFORM:f.uniform3uiv(p,o);break;case i.UINT_4D_UNIFORM:f.uniform4uiv(p,o);break;default:throw new Error("Unknown uniform type "+a+' for GPUProgram "'+this.name+'".')}},e.prototype.setUniform=function(e,r,t){var a,s=this,u=s.programs,l=s.uniforms,f=s.composer,c=f.verboseLogging;if((o.isWebGL2(f.gl)||t!==i.UINT||(t=i.INT),n.isArray(r))&&r.length>4)throw new Error("Invalid uniform value: ["+r.join(", ")+'] passed to GPUProgram "'+this.name+', uniforms must be of type number[] with length <= 4, number, or boolean."');var p=null===(a=l[e])||void 0===a?void 0:a.type;if(t){var h=o.uniformInternalTypeForValue(r,t,this.name);if(void 0===p)p=h;else if(p!==h)throw new Error('Uniform "'+e+'" for GPUProgram "'+this.name+'" cannot change from type '+p+" to type "+h+".")}if(void 0===p)throw new Error('Unknown type for uniform "'+e+'", please pass in type to GPUProgram.setUniform(name, value, type) when initing a new uniform.');if(l[e]){if(n.isArray(r)){for(var _=!0,d=0;d<r.length;d++)if(l[e].value!==r){_=!0;break}if(!_)return}else if(l[e].value===r)return;l[e].value=r}else l[e]={type:p,location:{},value:r};c&&console.log('Setting uniform "'+e+'" for program "'+this.name+'" to value '+JSON.stringify(r)+" with type "+p+".");var m=Object.keys(u);for(d=0;d<m.length;d++){var g=m[d];this.setProgramUniform(u[g],g,e,r,p)}},e.prototype._setVertexUniform=function(e,r,t,n){var i=this;if(!e)throw new Error("Must pass in valid WebGLProgram to setVertexUniform, got undefined.");var a=Object.keys(this.programs).find((function(r){return i.programs[r]===e}));if(!a)throw new Error('Could not find valid vertex programName for WebGLProgram in GPUProgram "'+this.name+'".');var s=o.uniformInternalTypeForValue(t,n,this.name);this.setProgramUniform(e,a,r,t,s)},e.prototype.dispose=function(){var e=this,r=this,t=r.composer,n=r.fragmentShader,i=r.programs,o=t.gl;t.verboseLogging&&console.log('Deallocating GPUProgram "'+this.name+'".'),Object.values(i).forEach((function(e){e&&o.deleteProgram(e)})),Object.keys(this.programs).forEach((function(r){delete e.programs[r]})),o.deleteShader(n),delete this.fragmentShader,delete this.composer,delete this.name,delete this.fragmentShaderSource,delete this.defines,delete this.uniforms,delete this.programs},e}();r.GPUProgram=a},404:(e,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Vector4=void 0;var t=function(){function e(e,r,t,n){void 0===e&&(e=0),void 0===r&&(r=0),void 0===t&&(t=0),void 0===n&&(n=1),this.x=e,this.y=r,this.z=t,this.w=n}return Object.defineProperty(e.prototype,"width",{get:function(){return this.z},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.w},enumerable:!1,configurable:!0}),e.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},e}();r.Vector4=t},707:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.isBoolean=r.isObject=r.isArray=r.isString=r.isNonNegativeInteger=r.isPositiveInteger=r.isInteger=r.isNumber=r.isNumberOfType=r.isValidClearValue=r.isValidTextureType=r.isValidTextureFormat=r.isValidWrap=r.isValidFilter=r.isValidDataType=void 0;var n=t(601);function i(e,r){switch(r){case n.HALF_FLOAT:case n.FLOAT:return o(e);case n.BYTE:return!(e<-128)&&(!(e>127)&&a(e));case n.SHORT:return!(e<-32768)&&(!(e>32767)&&a(e));case n.INT:return!(e<-2147483648)&&(!(e>2147483647)&&a(e));case n.UNSIGNED_BYTE:return!(e>255)&&s(e);case n.UNSIGNED_SHORT:return!(e>65535)&&s(e);case n.UNSIGNED_INT:return!(e>4294967295)&&s(e);default:throw new Error("Unknown type "+r)}}function o(e){return!Number.isNaN(e)&&"number"==typeof e&&Number.isFinite(e)}function a(e){return o(e)&&e%1==0}function s(e){return a(e)&&e>=0}function u(e){return Array.isArray(e)}r.isValidDataType=function(e){return n.validDataTypes.indexOf(e)>-1},r.isValidFilter=function(e){return n.validFilters.indexOf(e)>-1},r.isValidWrap=function(e){return n.validWraps.indexOf(e)>-1},r.isValidTextureFormat=function(e){return n.validTextureFormats.indexOf(e)>-1},r.isValidTextureType=function(e){return n.validTextureTypes.indexOf(e)>-1},r.isValidClearValue=function(e,r,t){if(u(e)){if(e.length!==r)return!1;for(var n=0;n<e.length;n++)if(!i(e[n],t))return!1}else if(!i(e,t))return!1;return!0},r.isNumberOfType=i,r.isNumber=o,r.isInteger=a,r.isPositiveInteger=function(e){return a(e)&&e>0},r.isNonNegativeInteger=s,r.isString=function(e){return"string"==typeof e},r.isArray=u,r.isObject=function(e){return"object"==typeof e&&!u(e)&&null!==e},r.isBoolean=function(e){return"boolean"==typeof e}},601:(e,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.DEFAULT_CIRCLE_NUM_SEGMENTS=r.DEFAULT_ERROR_CALLBACK=r.DATA_LAYER_VECTOR_FIELD_PROGRAM_NAME=r.DATA_LAYER_LINES_PROGRAM_NAME=r.DATA_LAYER_POINTS_PROGRAM_NAME=r.SEGMENT_PROGRAM_NAME=r.DEFAULT_W_UV_NORMAL_PROGRAM_NAME=r.DEFAULT_W_NORMAL_PROGRAM_NAME=r.DEFAULT_W_UV_PROGRAM_NAME=r.DEFAULT_PROGRAM_NAME=r.UINT_4D_UNIFORM=r.UINT_3D_UNIFORM=r.UINT_2D_UNIFORM=r.UINT_1D_UNIFORM=r.INT_4D_UNIFORM=r.INT_3D_UNIFORM=r.INT_2D_UNIFORM=r.INT_1D_UNIFORM=r.FLOAT_4D_UNIFORM=r.FLOAT_3D_UNIFORM=r.FLOAT_2D_UNIFORM=r.FLOAT_1D_UNIFORM=r.PRECISION_HIGH_P=r.PRECISION_MEDIUM_P=r.PRECISION_LOW_P=r.EXPERIMENTAL_WEBGL=r.WEBGL1=r.WEBGL2=r.GLSL1=r.GLSL3=r.validTextureTypes=r.validTextureFormats=r.validWraps=r.validFilters=r.validDataTypes=r.validArrayTypes=r.RGBA=r.RGB=r.CLAMP_TO_EDGE=r.REPEAT=r.NEAREST=r.LINEAR=r.UINT=r.BOOL=r.INT=r.UNSIGNED_INT=r.SHORT=r.UNSIGNED_SHORT=r.BYTE=r.UNSIGNED_BYTE=r.FLOAT=r.HALF_FLOAT=void 0,r.HALF_FLOAT="HALF_FLOAT",r.FLOAT="FLOAT",r.UNSIGNED_BYTE="UNSIGNED_BYTE",r.BYTE="BYTE",r.UNSIGNED_SHORT="UNSIGNED_SHORT",r.SHORT="SHORT",r.UNSIGNED_INT="UNSIGNED_INT",r.INT="INT",r.BOOL="BOOL",r.UINT="UINT",r.LINEAR="LINEAR",r.NEAREST="NEAREST",r.REPEAT="REPEAT",r.CLAMP_TO_EDGE="CLAMP_TO_EDGE",r.RGB="RGB",r.RGBA="RGBA",r.validArrayTypes=[Float32Array,Uint8Array,Int8Array,Uint16Array,Int16Array,Uint32Array,Int32Array,Array],r.validDataTypes=[r.HALF_FLOAT,r.FLOAT,r.UNSIGNED_BYTE,r.BYTE,r.UNSIGNED_SHORT,r.SHORT,r.UNSIGNED_INT,r.INT],r.validFilters=[r.LINEAR,r.NEAREST],r.validWraps=[r.CLAMP_TO_EDGE,r.REPEAT],r.validTextureFormats=[r.RGB,r.RGBA],r.validTextureTypes=[r.UNSIGNED_BYTE],r.GLSL3="300 es",r.GLSL1="100",r.WEBGL2="webgl2",r.WEBGL1="webgl",r.EXPERIMENTAL_WEBGL="experimental-webgl",r.PRECISION_LOW_P="lowp",r.PRECISION_MEDIUM_P="mediump",r.PRECISION_HIGH_P="highp",r.FLOAT_1D_UNIFORM="1f",r.FLOAT_2D_UNIFORM="2f",r.FLOAT_3D_UNIFORM="3f",r.FLOAT_4D_UNIFORM="4f",r.INT_1D_UNIFORM="1i",r.INT_2D_UNIFORM="2i",r.INT_3D_UNIFORM="3i",r.INT_4D_UNIFORM="4i",r.UINT_1D_UNIFORM="1ui",r.UINT_2D_UNIFORM="2ui",r.UINT_3D_UNIFORM="3ui",r.UINT_4D_UNIFORM="4ui",r.DEFAULT_PROGRAM_NAME="DEFAULT",r.DEFAULT_W_UV_PROGRAM_NAME="DEFAULT_W_UV",r.DEFAULT_W_NORMAL_PROGRAM_NAME="DEFAULT_W_NORMAL",r.DEFAULT_W_UV_NORMAL_PROGRAM_NAME="DEFAULT_W_UV_NORMAL",r.SEGMENT_PROGRAM_NAME="SEGMENT",r.DATA_LAYER_POINTS_PROGRAM_NAME="DATA_LAYER_POINTS",r.DATA_LAYER_LINES_PROGRAM_NAME="DATA_LAYER_LINES",r.DATA_LAYER_VECTOR_FIELD_PROGRAM_NAME="DATA_LAYER_VECTOR_FIELD",r.DEFAULT_ERROR_CALLBACK=function(e){throw new Error(e)},r.DEFAULT_CIRCLE_NUM_SEGMENTS=18},581:(e,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getExtension=r.EXT_COLOR_BUFFER_FLOAT=r.WEBGL_DEPTH_TEXTURE=r.OES_TEXTURE_HAlF_FLOAT_LINEAR=r.OES_TEXTURE_FLOAT_LINEAR=r.OES_TEXTURE_HALF_FLOAT=r.OES_TEXTURE_FLOAT=void 0;var t={};r.OES_TEXTURE_FLOAT="OES_texture_float",r.OES_TEXTURE_HALF_FLOAT="OES_texture_half_float",r.OES_TEXTURE_FLOAT_LINEAR="OES_texture_float_linear",r.OES_TEXTURE_HAlF_FLOAT_LINEAR="OES_texture_half_float_linear",r.WEBGL_DEPTH_TEXTURE="WEBGL_depth_texture",r.EXT_COLOR_BUFFER_FLOAT="EXT_color_buffer_float",r.getExtension=function(e,r,n,i){if(void 0===i&&(i=!1),void 0!==t[r])return t[r];var o;try{o=e.getExtension(r)}catch(e){}return o?(t[r]=o,console.log("Loaded extension: "+r+".")):(t[r]=!1,console.warn("Unsupported "+(i?"optional ":"")+"extension: "+r+".")),o||i||n("Required extension unsupported by this device / browser: "+r+"."),o}},607:function(e,r,t){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++)for(var i in r=arguments[t])Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i]);return e}).apply(this,arguments)},i=this&&this.__createBinding||(Object.create?function(e,r,t,n){void 0===n&&(n=t),Object.defineProperty(e,n,{enumerable:!0,get:function(){return r[t]}})}:function(e,r,t,n){void 0===n&&(n=t),e[n]=r[t]}),o=this&&this.__exportStar||function(e,r){for(var t in e)"default"===t||Object.prototype.hasOwnProperty.call(r,t)||i(r,e,t)};Object.defineProperty(r,"__esModule",{value:!0}),r._testing=r.getFragmentShaderMediumpPrecision=r.getVertexShaderMediumpPrecision=r.isHighpSupportedInFragmentShader=r.isHighpSupportedInVertexShader=r.isWebGL2Supported=r.isWebGL2=r.GPUProgram=r.GPULayer=r.GPUComposer=void 0;var a=t(593);Object.defineProperty(r,"isWebGL2",{enumerable:!0,get:function(){return a.isWebGL2}}),Object.defineProperty(r,"isWebGL2Supported",{enumerable:!0,get:function(){return a.isWebGL2Supported}}),Object.defineProperty(r,"isHighpSupportedInVertexShader",{enumerable:!0,get:function(){return a.isHighpSupportedInVertexShader}}),Object.defineProperty(r,"isHighpSupportedInFragmentShader",{enumerable:!0,get:function(){return a.isHighpSupportedInFragmentShader}}),Object.defineProperty(r,"getVertexShaderMediumpPrecision",{enumerable:!0,get:function(){return a.getVertexShaderMediumpPrecision}}),Object.defineProperty(r,"getFragmentShaderMediumpPrecision",{enumerable:!0,get:function(){return a.getFragmentShaderMediumpPrecision}});var s=t(484);Object.defineProperty(r,"GPUComposer",{enumerable:!0,get:function(){return s.GPUComposer}});var u=t(355);Object.defineProperty(r,"GPULayer",{enumerable:!0,get:function(){return u.GPULayer}});var l=t(664);Object.defineProperty(r,"GPUProgram",{enumerable:!0,get:function(){return l.GPUProgram}});var f=t(707),c=n({makeShaderHeader:a.makeShaderHeader,compileShader:a.compileShader,initGLProgram:a.initGLProgram,readyToRead:a.readyToRead,preprocessVertexShader:a.preprocessVertexShader,preprocessFragmentShader:a.preprocessFragmentShader,isPowerOf2:a.isPowerOf2,initSequentialFloatArray:a.initSequentialFloatArray,uniformInternalTypeForValue:a.uniformInternalTypeForValue},f);r._testing=c,o(t(601),r)},593:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.uniformInternalTypeForValue=r.preprocessFragmentShader=r.preprocessVertexShader=r.initSequentialFloatArray=r.isPowerOf2=r.getFragmentShaderMediumpPrecision=r.getVertexShaderMediumpPrecision=r.isHighpSupportedInFragmentShader=r.isHighpSupportedInVertexShader=r.readyToRead=r.isWebGL2Supported=r.isWebGL2=r.initGLProgram=r.compileShader=r.makeShaderHeader=void 0;var n=t(707),i=t(601),o=t(937),a={supportsWebGL2:void 0,supportsHighpVertex:void 0,supportsHighpFragment:void 0,mediumpVertexPrecision:void 0,mediumpFragmentPrecision:void 0};function s(e){return e===i.PRECISION_HIGH_P?2:e===i.PRECISION_MEDIUM_P?1:0}function u(e){for(var r="",t=Object.keys(e),i=0;i<t.length;i++){var o=t[i];if(!n.isString(o)||!n.isString(e[o]))throw new Error("GPUProgram defines must be passed in as key value pairs that are both strings, got key value pair of type ["+typeof o+" : "+typeof e[o]+"].");r+="#define "+o+" "+e[o]+"\n"}return r}function l(e,r,t,n){return""+(e===i.GLSL3?"#version "+i.GLSL3+"\n":"")+(n?u(n):"")+u({WEBGLCOMPUTE_INT_PRECISION:""+s(r),WEBGLCOMPUTE_FLOAT_PRECISION:""+s(t)})+o}function f(e,r,t,n,i,o,a,s,u){i=""+l(r,t,n,u)+i;var f=e.createShader(o);return f?(e.shaderSource(f,i),e.compileShader(f),e.getShaderParameter(f,e.COMPILE_STATUS)?f:(s("Could not compile "+(o===e.FRAGMENT_SHADER?"fragment":"vertex")+'\n\t\t\t shader for program "'+a+'": '+e.getShaderInfoLog(f)+"."),null)):(s("Unable to init gl shader."),null)}function c(e,r,t,n,i){var o=e.createProgram();if(o){if(e.attachShader(o,r),e.attachShader(o,t),e.linkProgram(o),e.getProgramParameter(o,e.LINK_STATUS))return o;i('GPUProgram "'+n+'" failed to link: '+e.getProgramInfoLog(o))}else i('Unable to init gl program for GPUProgram "'+n+'", gl.createProgram() has failed.')}function p(e,r){var t=document.createElement("canvas").getContext(i.WEBGL1);if(!t)throw new Error("Unable to init webgl context.");try{var n=f(t,i.GLSL1,i.PRECISION_HIGH_P,i.PRECISION_HIGH_P,e,t.VERTEX_SHADER,"highpFragmentTest",i.DEFAULT_ERROR_CALLBACK),o=f(t,i.GLSL1,i.PRECISION_HIGH_P,i.PRECISION_HIGH_P,r,t.FRAGMENT_SHADER,"highpFragmentTest",i.DEFAULT_ERROR_CALLBACK),a=c(t,o,n,"highpFragmentTest",i.DEFAULT_ERROR_CALLBACK);t.deleteProgram(a),t.deleteShader(n),t.deleteShader(o)}catch(e){return!1}return!0}function h(){if(void 0===a.supportsHighpVertex){var e=p("void main() { highp float test = 0.524; gl_Position = vec4(test, test, 0, 1); }","void main() { gl_FragColor = vec4(0); }");a.supportsHighpVertex=e}return a.supportsHighpVertex}function _(){if(void 0===a.supportsHighpFragment){var e=p("void main() { gl_Position = vec4(0.5, 0.5, 0, 1); }","void main() { highp float test = 1.35; gl_FragColor = vec4(test); }");a.supportsHighpFragment=e}return a.supportsHighpFragment}function d(e,r,t,n,o){var a=c(r,t,n,e,i.DEFAULT_ERROR_CALLBACK);if(!a)throw new Error("Unable to init WebGLProgram.");var s=r.getAttribLocation(a,"position"),u=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,u),r.bufferData(r.ARRAY_BUFFER,1,r.STATIC_DRAW),r.enableVertexAttribArray(s),r.vertexAttribPointer(s,1,r.UNSIGNED_BYTE,!1,0,0),r.viewport(0,0,1,1),r.useProgram(a),o(a),r.drawArrays(r.POINTS,0,1);var l=new Uint8Array(4);return r.readPixels(0,0,1,1,r.RGBA,r.UNSIGNED_BYTE,l),r.deleteProgram(a),r.deleteShader(n),r.deleteShader(t),r.deleteBuffer(u),l}function m(e){var r=e.slice();return(e=e.replace(/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/,""))!==r&&console.warn("WebGLCompute expects shader source that does not contain #version declarations, removing..."),r=e.slice(),(e=e.replace(/\s*precision\s+((highp)|(mediump)|(lowp))\s+[a-zA-Z0-9]+\s*;/g,""))!==r&&console.warn("WebGLCompute expects shader source that does not contain precision declarations, removing..."),e}function g(e){return e=(e=(e=(e=(e=(e=(e=e.replace(/((\bisampler2D\b)|(\busampler2D\b))/g,"sampler2D")).replace(/((\bivec2\b)|(\buvec2\b))/g,"vec2")).replace(/((\bivec3\b)|(\buvec3\b))/g,"vec3")).replace(/((\bivec4\b)|(\buvec4\b))/g,"vec4")).replace(/\buint\b/g,"int")).replace(/\buint\(/g,"int(")).replace(/\btexture\(/g,"texture2D(")}r.makeShaderHeader=l,r.compileShader=f,r.initGLProgram=c,r.isWebGL2=function(e){return"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext},r.isWebGL2Supported=function(){if(void 0===a.supportsWebGL2){var e=document.createElement("canvas").getContext(i.WEBGL2);return a.supportsWebGL2=!!e,!0}return a.supportsWebGL2},r.readyToRead=function(e){return e.checkFramebufferStatus(e.FRAMEBUFFER)==e.FRAMEBUFFER_COMPLETE},r.isHighpSupportedInVertexShader=h,r.isHighpSupportedInFragmentShader=_,r.getVertexShaderMediumpPrecision=function(){if(void 0===a.mediumpVertexPrecision){var e=document.createElement("canvas").getContext("webgl");if(!e)throw new Error("Unable to init webgl context.");var r=f(e,i.GLSL1,i.PRECISION_MEDIUM_P,i.PRECISION_MEDIUM_P,"\n\tattribute vec4 position;  // needed because of another bug in Safari\n\tuniform mediump vec3 v;\n\tvarying mediump vec4 v_result;\n\tvoid main() {\n\t\tgl_Position = position;\n\t\tgl_PointSize = 1.0;\n\t\tv_result = vec4(normalize(v) * 0.5 + 0.5, 1);\n\t}\n\t\t",e.VERTEX_SHADER,"mediumpPrecisionVertexTest",i.DEFAULT_ERROR_CALLBACK);if(!r)throw new Error("Unable to init vertex shader.");var t=f(e,i.GLSL1,i.PRECISION_MEDIUM_P,i.PRECISION_MEDIUM_P,"\n\tvarying mediump vec4 v_result;\n\tvoid main() {\n\t\tgl_FragColor = v_result;\n\t}\n\t\t",e.FRAGMENT_SHADER,"mediumpPrecisionVertexTest",i.DEFAULT_ERROR_CALLBACK);if(!t)throw new Error("Unable to init fragment shader.");var n=Math.pow(2,31)-1,o=Math.sqrt(n),s=255*(o/Math.sqrt(o*o*3)*.5+.5)|0,u=d("mediumpPrecisionVertexTest",e,t,r,(function(r){var t=e.getUniformLocation(r,"v");e.uniform3f(t,o,o,o)})),l=Math.abs(u[0]-s)>16;a.mediumpVertexPrecision=l?i.PRECISION_MEDIUM_P:i.PRECISION_HIGH_P}return a.mediumpVertexPrecision},r.getFragmentShaderMediumpPrecision=function(){if(void 0===a.mediumpFragmentPrecision){var e=document.createElement("canvas").getContext("webgl");if(!e)throw new Error("Unable to init webgl context.");var r=f(e,i.GLSL1,i.PRECISION_MEDIUM_P,i.PRECISION_MEDIUM_P,"\n\tattribute vec4 position;  // needed because of another bug in Safari\n\tvoid main() {\n\t\tgl_Position = position;\n\t\tgl_PointSize = 1.0;\n\t}\n\t\t",e.VERTEX_SHADER,"mediumpPrecisionFragmentTest",i.DEFAULT_ERROR_CALLBACK);if(!r)throw new Error("Unable to init vertex shader.");var t=f(e,i.GLSL1,i.PRECISION_MEDIUM_P,i.PRECISION_MEDIUM_P,"\n\tuniform mediump vec3 v;\n\tvoid main() {\n\t\tgl_FragColor = vec4(normalize(v) * 0.5 + 0.5, 1);\n\t}\n\t\t",e.FRAGMENT_SHADER,"mediumpPrecisionFragmentTest",i.DEFAULT_ERROR_CALLBACK);if(!t)throw new Error("Unable to init fragment shader.");var n=Math.pow(2,31)-1,o=Math.sqrt(n),s=255*(o/Math.sqrt(o*o*3)*.5+.5)|0,u=d("mediumpPrecisionFragmentTest",e,t,r,(function(r){var t=e.getUniformLocation(r,"v");e.uniform3f(t,o,o,o)})),l=Math.abs(u[0]-s)>16;a.mediumpFragmentPrecision=l?i.PRECISION_MEDIUM_P:i.PRECISION_HIGH_P}return a.mediumpFragmentPrecision},r.isPowerOf2=function(e){return e>0&&0==(e&e-1)},r.initSequentialFloatArray=function(e){for(var r=new Float32Array(e),t=0;t<e;t++)r[t]=t;return r},r.preprocessVertexShader=function(e,r){return e=m(e),h()||(console.warn("highp not supported in vertex shader, falling back to mediump."),e=e.replace(/\bhighp\b/,"mediump")),r===i.GLSL3?e:function(e){return(e=(e=g(e)).replace(/\bin\b/,"attribute")).replace(/\bout\b/g,"varying")}(e)},r.preprocessFragmentShader=function(e,r){return e=m(e),_()||(console.warn("highp not supported in fragment shader, falling back to mediump."),e=e.replace(/\bhighp\b/,"mediump")),r===i.GLSL3?e:function(e){return(e=(e=(e=g(e)).replace(/\bin\b/g,"varying")).replace(/\bout \w+ out_fragColor;/g,"")).replace(/\bout_fragColor\s+=/,"gl_FragColor =")}(e)},r.uniformInternalTypeForValue=function(e,r,t){if(r===i.FLOAT){if(n.isArray(e)){for(var o=0;o<e.length;o++)if(!n.isNumber(e[o]))throw new Error("Invalid uniform value: "+JSON.stringify(e)+' for program "'+t+'", expected float or float[] of length 1-4.')}else if(!n.isNumber(e))throw new Error("Invalid uniform value: "+JSON.stringify(e)+' for program "'+t+'", expected float or float[] of length 1-4.');if(!n.isArray(e)||1===e.length)return i.FLOAT_1D_UNIFORM;if(2===e.length)return i.FLOAT_2D_UNIFORM;if(3===e.length)return i.FLOAT_3D_UNIFORM;if(4===e.length)return i.FLOAT_4D_UNIFORM;throw new Error("Invalid uniform value: "+JSON.stringify(e)+' for program "'+t+'", expected float or float[] of length 1-4.')}if(r===i.INT){if(n.isArray(e)){for(o=0;o<e.length;o++)if(!n.isInteger(e[o]))throw new Error("Invalid uniform value: "+JSON.stringify(e)+' for program "'+t+'", expected int or int[] of length 1-4.')}else if(!n.isInteger(e))throw new Error("Invalid uniform value: "+JSON.stringify(e)+' for program "'+t+'", expected int or int[] of length 1-4.');if(!n.isArray(e)||1===e.length)return i.INT_1D_UNIFORM;if(2===e.length)return i.INT_2D_UNIFORM;if(3===e.length)return i.INT_3D_UNIFORM;if(4===e.length)return i.INT_4D_UNIFORM;throw new Error("Invalid uniform value: "+JSON.stringify(e)+' for program "'+t+'", expected int or int[] of length 1-4.')}if(r===i.UINT){if(n.isArray(e)){for(o=0;o<e.length;o++)if(!n.isNonNegativeInteger(e[o]))throw new Error("Invalid uniform value: "+JSON.stringify(e)+' for program "'+t+'", expected uint or uint[] of length 1-4.')}else if(!n.isNonNegativeInteger(e))throw new Error("Invalid uniform value: "+JSON.stringify(e)+' for program "'+t+'", expected uint or uint[] of length 1-4.');if(!n.isArray(e)||1===e.length)return i.UINT_1D_UNIFORM;if(2===e.length)return i.UINT_2D_UNIFORM;if(3===e.length)return i.UINT_3D_UNIFORM;if(4===e.length)return i.UINT_4D_UNIFORM;throw new Error("Invalid uniform value: "+JSON.stringify(e)+' for program "'+t+'", expected uint or uint[] of length 1-4.')}if(r===i.BOOL){if(n.isBoolean(e))return i.INT_1D_UNIFORM;throw new Error("Invalid uniform value: "+JSON.stringify(e)+' for program "'+t+'", expected boolean.')}throw new Error("Invalid uniform type: "+r+' for program "'+t+'", expected '+i.FLOAT+" or "+i.INT+" of "+i.BOOL+".")}},937:e=>{e.exports="#if (WEBGLCOMPUTE_INT_PRECISION == 2)\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp int;\n#if (__VERSION__ == 300)\nprecision highp isampler2D;precision highp usampler2D;\n#endif\n#else\nprecision mediump int;\n#if (__VERSION__ == 300)\nprecision mediump isampler2D;precision mediump usampler2D;\n#endif\n#endif\n#endif\n#if (WEBGLCOMPUTE_INT_PRECISION == 1)\nprecision mediump int;\n#if (__VERSION__ == 300)\nprecision mediump isampler2D;precision mediump usampler2D;\n#endif\n#endif\n#if (WEBGLCOMPUTE_INT_PRECISION == 0)\nprecision lowp int;\n#if (__VERSION__ == 300)\nprecision lowp isampler2D;precision lowp usampler2D;\n#endif\n#endif\n#if (WEBGLCOMPUTE_FLOAT_PRECISION == 2)\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;precision highp sampler2D;\n#else\nprecision mediump float;precision mediump sampler2D;\n#endif\n#endif\n#if (WEBGLCOMPUTE_FLOAT_PRECISION == 1)\nprecision mediump float;precision mediump sampler2D;\n#endif\n#if (WEBGLCOMPUTE_FLOAT_PRECISION == 0)\nprecision lowp float;precision lowp sampler2D;\n#endif\n"},158:e=>{e.exports="in vec2 v_UV;\n#ifdef WEBGLCOMPUTE_FLOAT\nuniform sampler2D u_state;\n#endif\n#ifdef WEBGLCOMPUTE_INT\nuniform isampler2D u_state;\n#endif\n#ifdef WEBGLCOMPUTE_UINT\nuniform usampler2D u_state;\n#endif\n#ifdef WEBGLCOMPUTE_FLOAT\nout vec4 out_fragColor;\n#endif\n#ifdef WEBGLCOMPUTE_INT\nout ivec4 out_fragColor;\n#endif\n#ifdef WEBGLCOMPUTE_UINT\nout uvec4 out_fragColor;\n#endif\nvoid main(){out_fragColor=A(u_state,v_UV);}"},148:e=>{e.exports="#ifdef WEBGLCOMPUTE_FLOAT\nuniform vec4 u_value;\n#endif\n#ifdef WEBGLCOMPUTE_INT\nuniform ivec4 u_value;\n#endif\n#ifdef WEBGLCOMPUTE_UINT\nuniform uvec4 u_value;\n#endif\n#ifdef WEBGLCOMPUTE_FLOAT\nout vec4 out_fragColor;\n#endif\n#ifdef WEBGLCOMPUTE_INT\nout ivec4 out_fragColor;\n#endif\n#ifdef WEBGLCOMPUTE_UINT\nout uvec4 out_fragColor;\n#endif\nvoid main(){out_fragColor=u_value;}"},723:e=>{e.exports="in vec2 v_UV;uniform vec3 u_color;uniform float u_scale;\n#ifdef WEBGLCOMPUTE_FLOAT\nuniform sampler2D u_internal_data;\n#endif\n#ifdef WEBGLCOMPUTE_INT\nuniform isampler2D u_internal_data;\n#endif\n#ifdef WEBGLCOMPUTE_UINT\nuniform usampler2D u_internal_data;\n#endif\nout vec4 out_fragColor;void main(){uvec4 A=B(u_internal_data,v_UV);float C=length(A);out_fragColor=vec4(C*u_scale*u_color,1);}"},598:e=>{e.exports="in vec2 v_lineWrapping;uniform vec4 u_value;out vec4 out_fragColor;void main(){if((v_lineWrapping.x!=0.&&v_lineWrapping.x!=1.)||(v_lineWrapping.y!=0.&&v_lineWrapping.y!=1.)){discard;return;}out_fragColor=vec4(u_value);}"},288:e=>{e.exports="in vec2 a_internal_position;\n#ifdef WEBGLCOMPUTE_UV_ATTRIBUTE\nin vec2 a_internal_uv;\n#endif\n#ifdef WEBGLCOMPUTE_NORMAL_ATTRIBUTE\nin vec2 a_internal_normal;\n#endif\nuniform vec2 u_internal_scale;uniform vec2 u_internal_translation;out vec2 v_UV;out vec2 v_UV_local;\n#ifdef WEBGLCOMPUTE_NORMAL_ATTRIBUTE\nout vec2 v_normal;\n#endif\nvoid main(){\n#ifdef WEBGLCOMPUTE_UV_ATTRIBUTE\nv_UV_local=a_internal_uv;\n#else\nv_UV_local=a_internal_position;\n#endif\n#ifdef WEBGLCOMPUTE_NORMAL_ATTRIBUTE\nv_normal=a_internal_normal;\n#endif\nvec2 A=u_internal_scale*a_internal_position+u_internal_translation;v_UV=0.5*(A+1.);gl_Position=vec4(A,0,1);}"},629:e=>{e.exports="float A(float B,float C){float D=B-floor((B+0.5)/C)*C;return floor(D+0.5);}in float a_internal_index;uniform sampler2D u_internal_positions;uniform vec2 u_internal_positionsDimensions;uniform vec2 u_internal_scale;uniform bool u_internal_positionWithAccumulation;uniform bool u_internal_wrapX;uniform bool u_internal_wrapY;out vec2 v_UV;out vec2 v_lineWrapping;out float v_index;void main(){vec2 E=vec2(A(a_internal_index,u_internal_positionsDimensions.x),floor(floor(a_internal_index+0.5)/u_internal_positionsDimensions.x))/u_internal_positionsDimensions;vec4 F=G(u_internal_positions,E);vec2 H=F.rg;if(u_internal_positionWithAccumulation)H+=F.ba;v_UV=H*u_internal_scale;v_lineWrapping=vec2(0.);if(u_internal_wrapX){if(v_UV.x<0.){v_UV.x+=1.;v_lineWrapping.x=1.;}else if(v_UV.x>1.){v_UV.x-=1.;v_lineWrapping.x=1.;}}if(u_internal_wrapY){if(v_UV.y<0.){v_UV.y+=1.;v_lineWrapping.y=1.;}else if(v_UV.y>1.){v_UV.y-=1.;v_lineWrapping.y=1.;}}vec2 I=v_UV*2.-1.;v_index=a_internal_index;gl_Position=vec4(I,0,1);}"},62:e=>{e.exports="float A(float B,float C){float D=B-floor((B+0.5)/C)*C;return floor(D+0.5);}in float a_internal_index;uniform sampler2D u_internal_positions;uniform vec2 u_internal_positionsDimensions;uniform vec2 u_internal_scale;uniform float u_internal_pointSize;uniform bool u_internal_positionWithAccumulation;uniform bool u_internal_wrapX;uniform bool u_internal_wrapY;out vec2 v_UV;out float v_index;void main(){vec2 E=vec2(A(a_internal_index,u_internal_positionsDimensions.x),floor(floor(a_internal_index+0.5)/u_internal_positionsDimensions.x))/u_internal_positionsDimensions;vec4 F=G(u_internal_positions,E);vec2 H=F.rg;if(u_internal_positionWithAccumulation)H+=F.ba;v_UV=H*u_internal_scale;if(u_internal_wrapX){if(v_UV.x<0.)v_UV.x+=1.;if(v_UV.x>1.)v_UV.x-=1.;}if(u_internal_wrapY){if(v_UV.y<0.)v_UV.y+=1.;if(v_UV.y>1.)v_UV.y-=1.;}vec2 I=v_UV*2.-1.;v_index=a_internal_index;gl_PointSize=u_internal_pointSize;gl_Position=vec4(I,0,1);}"},430:e=>{e.exports="float A(float B,float C){float D=B-floor((B+0.5)/C)*C;return floor(D+0.5);}in float a_internal_index;uniform sampler2D u_internal_vectors;uniform vec2 u_internal_dimensions;uniform vec2 u_internal_scale;out vec2 v_UV;out float v_index;void main(){float E=floor((a_internal_index+0.5)/2.);v_UV=vec2(A(E,u_internal_dimensions.x),floor(floor(E+0.5)/u_internal_dimensions.x))/u_internal_dimensions;if(A(a_internal_index,2.)>0.){vec2 F=G(u_internal_vectors,v_UV).xy;v_UV+=F*u_internal_scale;}vec2 H=v_UV*2.-1.;v_index=a_internal_index;gl_Position=vec4(H,0,1);}"},974:e=>{e.exports="in vec2 a_internal_position;uniform float u_internal_halfThickness;uniform vec2 u_internal_scale;uniform float u_internal_length;uniform float u_internal_rotation;uniform vec2 u_internal_translation;out vec2 v_UV_local;out vec2 v_UV;mat2 A(float B){return mat2(cos(B),-sin(B),sin(B),cos(B));}void main(){v_UV_local=0.5*(a_internal_position+1.);vec2 C=a_internal_position;C*=u_internal_halfThickness;if(C.x<0.){C.x-=u_internal_length/2.;v_UV_local.x=0.;}else if(C.x>0.){C.x+=u_internal_length/2.;v_UV_local.x=1.;}C=u_internal_scale*(A(-u_internal_rotation)*C)+u_internal_translation;v_UV=0.5*(C+1.);gl_Position=vec4(C,0,1);}"}},r={};function t(n){var i=r[n];if(void 0!==i)return i.exports;var o=r[n]={id:n,loaded:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}return t.d=(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),t.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),t.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),t.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t(607)})()}));
//# sourceMappingURL=webgl-compute.min.js.map
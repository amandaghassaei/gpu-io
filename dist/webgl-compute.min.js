!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.WebGLCompute=t():e.WebGLCompute=t()}(self,function(){return r={501:(e,t,r)=>{"use strict";r.r(t),r.d(t,{Float16Array:()=>de,getFloat16:()=>function(e,t,...r){if(ne(e))return c(e.getUint16(t,...r));throw new TypeError("First argument to getFloat16 function must be a DataView")},hfround:()=>function(e){if(e=Number(e),!Number.isFinite(e)||0===e)return e;e=u(e);return c(e)},setFloat16:()=>function(e,t,r,...n){if(!ne(e))throw new TypeError("First argument to setFloat16 function must be a DataView");e.setUint16(t,u(r),...n)}});var n=new ArrayBuffer(4);const i=new Float32Array(n),a=new Uint32Array(n),o=new Uint32Array(512),s=new Uint32Array(512);for(let e=0;e<256;++e){var l=e-127;l<-27?(o[0|e]=0,o[256|e]=32768,s[0|e]=24,s[256|e]=24):l<-14?(o[0|e]=1024>>-l-14,o[256|e]=1024>>-l-14|32768,s[0|e]=-l-1,s[256|e]=-l-1):l<=15?(o[0|e]=15+l<<10,o[256|e]=15+l<<10|32768,s[0|e]=13,s[256|e]=13):l<128?(o[0|e]=31744,o[256|e]=64512,s[0|e]=24,s[256|e]=24):(o[0|e]=31744,o[256|e]=64512,s[0|e]=13,s[256|e]=13)}function u(e){i[0]=e;var t=a[0],e=t>>23&511;return o[e]+((8388607&t)>>s[e])}const f=new Uint32Array(2048),h=new Uint32Array(64),p=new Uint32Array(64);f[0]=0;for(let r=1;r<1024;++r){let e=r<<13,t=0;for(;0==(8388608&e);)t-=8388608,e<<=1;e&=-8388609,t+=947912704,f[r]=e|t}for(let e=1024;e<2048;++e)f[e]=939524096+(e-1024<<13);h[0]=0;for(let e=1;e<31;++e)h[e]=e<<23;h[31]=1199570944,h[32]=2147483648;for(let e=33;e<63;++e)h[e]=2147483648+(e-32<<23);h[63]=3347054592,p[0]=0;for(let e=1;e<64;++e)32===e?p[e]=0:p[e]=1024;function c(e){var t=e>>10;return a[0]=f[p[t]+(1023&e)]+h[t],i[0]}var d=r(277),g="object"==typeof self&&self&&self.Object===Object&&self,_=d.Z||g||Function("return this")(),t=_.Symbol,n=Object.prototype,m=n.hasOwnProperty,y=n.toString,v=t?t.toStringTag:void 0;const T=function(e){var t=m.call(e,v),r=e[v];try{var n=!(e[v]=void 0)}catch(e){}var i=y.call(e);return n&&(t?e[v]=r:delete e[v]),i};var b=Object.prototype.toString;const E=function(e){return b.call(e)};var w=t?t.toStringTag:void 0;const A=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":(w&&w in Object(e)?T:E)(e)};const L=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};const F=function(e){return!!L(e)&&("[object Function]"==(e=A(e))||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e)},x=_["__core-js_shared__"];var R=(d=/[^.]+$/.exec(x&&x.keys&&x.keys.IE_PROTO||""))?"Symbol(src)_1."+d:"";const U=function(e){return!!R&&R in e};var O=Function.prototype.toString;const I=function(e){if(null!=e){try{return O.call(e)}catch(e){}try{return e+""}catch(e){}}return""};var N=/^\[object .+?Constructor\]$/,g=Function.prototype,n=Object.prototype,t=g.toString,d=n.hasOwnProperty,D=RegExp("^"+t.call(d).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const S=function(e){return!(!L(e)||U(e))&&(F(e)?D:N).test(I(e))};const B=function(e,t){return null==e?void 0:e[t]};const P=function(e,t){return t=B(e,t),S(t)?t:void 0},C=P(Object,"create");var g=function(e){return e=this.has(e)&&delete this.__data__[e],this.size-=e?1:0,e},G=Object.prototype.hasOwnProperty;var n=function(e){var t=this.__data__;if(C){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return G.call(t,e)?t[e]:void 0},V=Object.prototype.hasOwnProperty;t=function(e){var t=this.__data__;return C?void 0!==t[e]:V.call(t,e)};d=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=C&&void 0===t?"__lodash_hash_undefined__":t,this};function k(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}k.prototype.clear=function(){this.__data__=C?C(null):{},this.size=0},k.prototype.delete=g,k.prototype.get=n,k.prototype.has=t,k.prototype.set=d;const W=k;const M=function(e,t){return e===t||e!=e&&t!=t};const j=function(e,t){for(var r=e.length;r--;)if(M(e[r][0],t))return r;return-1};var H=Array.prototype.splice;g=function(e){var t=this.__data__;return!((e=j(t,e))<0)&&(e==t.length-1?t.pop():H.call(t,e,1),--this.size,!0)};n=function(e){var t=this.__data__;return(e=j(t,e))<0?void 0:t[e][1]};t=function(e){return-1<j(this.__data__,e)};d=function(e,t){var r=this.__data__,n=j(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};function X(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}X.prototype.clear=function(){this.__data__=[],this.size=0},X.prototype.delete=g,X.prototype.get=n,X.prototype.has=t,X.prototype.set=d;const Y=X,z=P(_,"Map");g=function(){this.size=0,this.__data__={hash:new W,map:new(z||Y),string:new W}};const q=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};const Z=function(e,t){return e=e.__data__,q(t)?e["string"==typeof t?"string":"hash"]:e.map};n=function(e){return e=Z(this,e).delete(e),this.size-=e?1:0,e};t=function(e){return Z(this,e).get(e)};d=function(e){return Z(this,e).has(e)};_=function(e,t){var r=Z(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};function K(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}K.prototype.clear=g,K.prototype.delete=n,K.prototype.get=t,K.prototype.has=d,K.prototype.set=_;const $=K;function J(n,i){if("function"!=typeof n||null!=i&&"function"!=typeof i)throw new TypeError("Expected a function");function a(){var e=arguments,t=i?i.apply(this,e):e[0],r=a.cache;return r.has(t)?r.get(t):(e=n.apply(this,e),a.cache=r.set(t,e)||r,e)}return a.cache=new(J.Cache||$),a}J.Cache=$;const Q=J,ee=Object.getOwnPropertyDescriptor(new Uint8Array(1),0).writable;function te(e){let t="number"!=typeof e?Number(e):e;return Number.isNaN(t)&&(t=0),Math.trunc(t)}function re(e,t){var[r,n]=[Number.isNaN(e),Number.isNaN(t)];if(r&&n)return 0;if(r)return 1;if(n)return-1;if(e<t)return-1;if(t<e)return 1;if(0===e&&0===t){var[e,t]=[Object.is(e,0),Object.is(t,0)];if(!e&&t)return-1;if(e&&!t)return 1}return 0}function ne(e){return e instanceof DataView}function ie(e){return"string"==typeof e&&e===te(e)+""}const ae=function(e){return null!=e&&"object"==typeof e};_=function(e){return ae(e)&&"[object ArrayBuffer]"==A(e)};const oe=function(t){return function(e){return t(e)}};r=r(730),r=r.Z&&r.Z.isArrayBuffer;const se=r?oe(r):_;const le=function(){const r=new WeakMap;return e=>{let t=r.get(e);return t||(t=Object.create(null),r.set(e,t),t)}}();function ue(e){return e instanceof de}function fe(e){if(!ue(e))throw new TypeError("This is not a Float16Array")}function he(t){var r=t.length;const n=new Array(r);for(let e=0;e<r;++e)n[e]=c(t[e]);return n}const pe={apply(e,t,r){return ue(t)&&("function"==typeof(n=e)&&_e.has(n))?Reflect.apply(e,le(t).target,r):Reflect.apply(e,t,r);var n}},ce={get(t,r){let n=null;if(ee||(n=t,t=le(n).target),ie(r))return Reflect.has(t,r)?c(Reflect.get(t,r)):void 0;{r=null!==n&&Reflect.has(n,r)?Reflect.get(n,r):Reflect.get(t,r);if("function"!=typeof r)return r;let e=le(r).proxy;return void 0===e&&(e=le(r).proxy=new Proxy(r,pe)),e}},set(e,t,r){let n=null;return ee||(n=e,e=le(n).target),ie(t)?Reflect.set(e,t,u(r)):null===n||Reflect.has(e,t)&&!Object.isFrozen(n)?Reflect.set(e,t,r):Reflect.set(n,t,r)}};ee||(ce.getPrototypeOf=e=>Reflect.getPrototypeOf(le(e).target),ce.setPrototypeOf=(e,t)=>Reflect.setPrototypeOf(le(e).target,t),ce.defineProperty=(e,t,r)=>{var n=le(e).target;return!Reflect.has(n,t)||Object.isFrozen(e)?Reflect.defineProperty(e,t,r):Reflect.defineProperty(n,t,r)},ce.deleteProperty=(e,t)=>{var r=le(e).target;return Reflect.has(e,t)?Reflect.deleteProperty(e,t):Reflect.deleteProperty(r,t)},ce.has=(e,t)=>Reflect.has(e,t)||Reflect.has(le(e).target,t),ce.isExtensible=e=>Reflect.isExtensible(e),ce.preventExtensions=e=>Reflect.preventExtensions(e),ce.getOwnPropertyDescriptor=(e,t)=>Reflect.getOwnPropertyDescriptor(e,t),ce.ownKeys=e=>Reflect.ownKeys(e));class de extends Uint16Array{constructor(e,t,r){if(ue(e))super(le(e).target);else if(null===e||"object"!=typeof e||se(e))switch(arguments.length){case 0:super();break;case 1:super(e);break;case 2:super(e,t);break;case 3:super(e,t,r);break;default:super(...arguments)}else{var n=Reflect.has(e,"length")||void 0===e[Symbol.iterator]?e:[...e];const r=n.length;super(r);for(let e=0;e<r;++e)this[e]=u(n[e])}let i;var a;return i=ee?new Proxy(this,ce):(a=Object.create(null),le(a).target=this,new Proxy(a,ce)),le(i).target=this,le(this).proxy=i,i}static from(e,...t){if(0===t.length)return new de(Uint16Array.from(e,u).buffer);const r=t[0];t=t[1];return new de(Uint16Array.from(e,function(e,...t){return u(r.call(this,e,...t))},t).buffer)}static of(...e){return new de(e)}*[Symbol.iterator](){for(const e of super[Symbol.iterator]())yield c(e)}keys(){return super.keys()}*values(){for(const e of super.values())yield c(e)}*entries(){for(var[e,t]of super.entries())yield[e,c(t)]}map(r,...e){fe(this);var n=e[0];const i=[];for(let e=0,t=this.length;e<t;++e){var a=c(this[e]);i.push(r.call(n,a,e,le(this).proxy))}return new de(i)}filter(r,...e){fe(this);var n=e[0];const i=[];for(let e=0,t=this.length;e<t;++e){var a=c(this[e]);r.call(n,a,e,le(this).proxy)&&i.push(a)}return new de(i)}reduce(r,...e){fe(this);let n,i;i=0===e.length?(n=c(this[0]),1):(n=e[0],0);for(let e=i,t=this.length;e<t;++e)n=r(n,c(this[e]),e,le(this).proxy);return n}reduceRight(t,...e){fe(this);let r,n;var i=this.length;n=0===e.length?(r=c(this[i-1]),i-1):(r=e[0],i);for(let e=n;e--;)r=t(r,c(this[e]),e,le(this).proxy);return r}forEach(r,...e){fe(this);var n=e[0];for(let e=0,t=this.length;e<t;++e)r.call(n,c(this[e]),e,le(this).proxy)}find(r,...e){fe(this);var n=e[0];for(let e=0,t=this.length;e<t;++e){var i=c(this[e]);if(r.call(n,i,e,le(this).proxy))return i}}findIndex(r,...e){fe(this);var n=e[0];for(let e=0,t=this.length;e<t;++e){var i=c(this[e]);if(r.call(n,i,e,le(this).proxy))return e}return-1}every(r,...e){fe(this);var n=e[0];for(let e=0,t=this.length;e<t;++e)if(!r.call(n,c(this[e]),e,le(this).proxy))return!1;return!0}some(r,...e){fe(this);var n=e[0];for(let e=0,t=this.length;e<t;++e)if(r.call(n,c(this[e]),e,le(this).proxy))return!0;return!1}set(e,...t){fe(this);t=t[0];let r;if(ue(e))r=le(e).target;else{var n=Reflect.has(e,"length")||void 0===e[Symbol.iterator]?e:[...e],e=n.length;r=new Uint16Array(e);for(let e=0,t=n.length;e<t;++e)r[e]=u(n[e])}super.set(r,t)}reverse(){return fe(this),super.reverse(),le(this).proxy}fill(e,...t){return fe(this),super.fill(u(e),...t),le(this).proxy}copyWithin(e,t,...r){return fe(this),super.copyWithin(e,t,...r),le(this).proxy}sort(...e){fe(this);let r=e[0];void 0===r&&(r=re);const n=Q(c);return super.sort((e,t)=>r(n(e),n(t))),le(this).proxy}slice(...t){fe(this);let r;try{r=super.slice(...t)}catch(e){if(!(e instanceof TypeError))throw e;{const n=new Uint16Array(this.buffer,this.byteOffset,this.length);r=n.slice(...t)}}return new de(r.buffer)}subarray(...t){fe(this);let r;try{r=super.subarray(...t)}catch(e){if(!(e instanceof TypeError))throw e;{const n=new Uint16Array(this.buffer,this.byteOffset,this.length);r=n.subarray(...t)}}return new de(r.buffer,r.byteOffset,r.length)}indexOf(r,...e){fe(this);var n=this.length;let i=te(e[0]);i<0&&(i+=n,i<0&&(i=0));for(let e=i,t=n;e<t;++e)if(c(this[e])===r)return e;return-1}lastIndexOf(t,...e){fe(this);var r=this.length;let n=te(e[0]);n=0===n?r:n+1,0<=n?n=n<r?n:r:n+=r;for(let e=n;e--;)if(c(this[e])===t)return e;return-1}includes(r,...e){fe(this);var n=this.length;let i=te(e[0]);i<0&&(i+=n,i<0&&(i=0));var a=Number.isNaN(r);for(let e=i,t=n;e<t;++e){var o=c(this[e]);if(a&&Number.isNaN(o))return!0;if(o===r)return!0}return!1}join(...e){fe(this);const t=he(this);return t.join(...e)}toLocaleString(...e){fe(this);const t=he(this);return t.toLocaleString(...e)}get[Symbol.toStringTag](){if(ue(this))return"Float16Array"}}var ge=de.prototype;const _e=new WeakSet;for(const ye of Reflect.ownKeys(ge)){var me=ge[ye];"function"==typeof me&&_e.add(me)}},809:(e,t)=>{"use strict";function o(e){var t=-1;n=n||function(){for(var e=new Int32Array(256),t=0;t<256;t++){for(var r=t,n=0;n<8;n++)r=1&r?3988292384^r>>>1:r>>>1;e[t]=r}return e}();for(var r=0;r<e.length;r++)t=n[255&(t^e[r])]^t>>>8;return-1^t}Object.defineProperty(t,"__esModule",{value:!0}),t.changeDpiBlob=function(i,a){var t=i.slice(0,33);return new Promise(function(r,e){var n=new FileReader;n.onload=function(){var e=new Uint8Array(n.result),t=i.slice(33),e=_(e,a,i.type);r(new Blob([e,t],{type:i.type}))},n.readAsArrayBuffer(t)})},t.changeDpiDataUrl=function(e,t){var r=e.split(","),n=r[0],i=r[1],a=void 0,e=void 0,r=!1;-1!==n.indexOf(f)&&(a=f,0<=(o=function(e){var t=e.indexOf(p);-1===t&&(t=e.indexOf(c));-1===t&&(t=e.indexOf(d));return t}(i))?(e=4*Math.ceil((o+28)/3),r=!0):e=44);-1!==n.indexOf(h)&&(a=h,e=24);for(var o=i.substring(0,e),e=i.substring(e),s=atob(o),l=new Uint8Array(s.length),u=0;u<l.length;u++)l[u]=s.charCodeAt(u);r=_(l,t,a,r),r=btoa(String.fromCharCode.apply(String,function(e){{if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}}(r)));return[n,",",r,e].join("")};var n=void 0,f="image/png",h="image/jpeg",p="AAlwSFlz",c="AAAJcEhZ",d="AAAACXBI",s="p".charCodeAt(0),l="H".charCodeAt(0),u="Y".charCodeAt(0),g="s".charCodeAt(0);function _(e,t,r,n){if(r===h)return e[13]=1,e[14]=t>>8,e[15]=255&t,e[16]=t>>8,e[17]=255&t,e;if(r===f){var i=new Uint8Array(13);t*=39.3701,i[0]=s,i[1]=l,i[2]=u,i[3]=g,i[4]=t>>>24,i[5]=t>>>16,i[6]=t>>>8,i[7]=255&t,i[8]=i[4],i[9]=i[5],i[10]=i[6],i[11]=i[7],i[12]=1;r=o(i),t=new Uint8Array(4);if(t[0]=r>>>24,t[1]=r>>>16,t[2]=r>>>8,t[3]=255&r,n){var a=function(e){for(var t=e.length-1;4<=t;t--)if(9===e[t-4]&&e[t-3]===s&&e[t-2]===l&&e[t-1]===u&&e[t]===g)return t-3}(e);return e.set(i,a),e.set(t,a+13),e}n=new Uint8Array(4);n[0]=0,n[1]=0,n[2]=0,n[3]=9;a=new Uint8Array(54);return a.set(e,0),a.set(n,33),a.set(i,37),a.set(t,50),a}}},162:function(e,t,r){var n;void 0===(n="function"==typeof(n=function(){"use strict";function i(e,t){return"undefined"==typeof t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}function f(e,t,r){var n=new XMLHttpRequest;n.open("GET",e),n.responseType="blob",n.onload=function(){s(n.response,t,r)},n.onerror=function(){console.error("could not download file")},n.send()}function a(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function o(t){try{t.dispatchEvent(new MouseEvent("click"))}catch(e){var r=document.createEvent("MouseEvents");r.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(r)}}var h="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof r.g&&r.g.global===r.g?r.g:void 0,p=h.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),s=h.saveAs||("object"!=typeof window||window!==h?function(){}:"download"in HTMLAnchorElement.prototype&&!p?function(e,t,r){var n=h.URL||h.webkitURL,i=document.createElement("a");t=t||e.name||"download",i.download=t,i.rel="noopener","string"==typeof e?(i.href=e,i.origin===location.origin?o(i):a(i.href)?f(e,t,r):o(i,i.target="_blank")):(i.href=n.createObjectURL(e),setTimeout(function(){n.revokeObjectURL(i.href)},4e4),setTimeout(function(){o(i)},0))}:"msSaveOrOpenBlob"in navigator?function(e,t,r){if(t=t||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(i(e,r),t);else if(a(e))f(e,t,r);else{var n=document.createElement("a");n.href=e,n.target="_blank",setTimeout(function(){o(n)})}}:function(e,t,r,n){if(n=n||open("","_blank"),n&&(n.document.title=n.document.body.innerText="downloading..."),"string"==typeof e)return f(e,t,r);var i="application/octet-stream"===e.type,a=/constructor/i.test(h.HTMLElement)||h.safari,o=/CriOS\/[\d]+/.test(navigator.userAgent);if((o||i&&a||p)&&"undefined"!=typeof FileReader){var s=new FileReader;s.onloadend=function(){var e=s.result;e=o?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),n?n.location.href=e:location=e,n=null},s.readAsDataURL(e)}else{var l=h.URL||h.webkitURL,u=l.createObjectURL(e);n?n.location=u:location.href=u,n=null,setTimeout(function(){l.revokeObjectURL(u)},4e4)}});h.saveAs=s.saveAs=s,true&&(e.exports=s)})?n.apply(t,[]):n)||(e.exports=n)},277:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});const n="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g},730:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});t=r(277);e=r.hmd(e);var r="object"==typeof exports&&exports&&!exports.nodeType&&exports,n=r&&e&&!e.nodeType&&e,i=n&&n.exports===r&&t.Z.process;const a=function(){try{var e=n&&n.require&&n.require("util").types;return e?e:i&&i.binding&&i.binding("util")}catch(e){}}()},627:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isBoolean=t.isArray=t.isString=t.isPositiveInteger=t.isInteger=t.isNumber=t.isValidTextureDataType=t.validTextureDataTypes=t.isValidTextureFormatType=t.validTextureFormatTypes=t.isValidWrapType=t.validWrapTypes=t.isValidFilterType=t.validFilterTypes=t.isValidDataType=t.validDataTypes=void 0;r=r(738);function n(e){return!isNaN(e)}function i(e){return n(e)&&e%1==0}t.validDataTypes=[r.HALF_FLOAT,r.FLOAT,r.UNSIGNED_BYTE,r.BYTE,r.UNSIGNED_SHORT,r.SHORT,r.UNSIGNED_INT,r.INT],t.isValidDataType=function(e){return-1<t.validDataTypes.indexOf(e)},t.validFilterTypes=[r.LINEAR,r.NEAREST],t.isValidFilterType=function(e){return-1<t.validFilterTypes.indexOf(e)},t.validWrapTypes=[r.CLAMP_TO_EDGE,r.REPEAT],t.isValidWrapType=function(e){return-1<t.validWrapTypes.indexOf(e)},t.validTextureFormatTypes=[r.RGB,r.RGBA],t.isValidTextureFormatType=function(e){return-1<t.validTextureFormatTypes.indexOf(e)},t.validTextureDataTypes=[r.UNSIGNED_BYTE],t.isValidTextureDataType=function(e){return-1<t.validTextureDataTypes.indexOf(e)},t.isNumber=n,t.isInteger=i,t.isPositiveInteger=function(e){return i(e)&&0<e},t.isString=function(e){return"string"==typeof e},t.isArray=function(e){return Array.isArray(e)},t.isBoolean=function(e){return"boolean"==typeof e}},738:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.INT_4D_UNIFORM=t.INT_3D_UNIFORM=t.INT_2D_UNIFORM=t.INT_1D_UNIFORM=t.FLOAT_4D_UNIFORM=t.FLOAT_3D_UNIFORM=t.FLOAT_2D_UNIFORM=t.FLOAT_1D_UNIFORM=t.GLSL1=t.GLSL3=t.RGBA=t.RGB=t.CLAMP_TO_EDGE=t.REPEAT=t.NEAREST=t.LINEAR=t.BOOL=t.INT=t.UNSIGNED_INT=t.SHORT=t.UNSIGNED_SHORT=t.BYTE=t.UNSIGNED_BYTE=t.FLOAT=t.HALF_FLOAT=void 0,t.HALF_FLOAT="HALF_FLOAT",t.FLOAT="FLOAT",t.UNSIGNED_BYTE="UNSIGNED_BYTE",t.BYTE="BYTE",t.UNSIGNED_SHORT="UNSIGNED_SHORT",t.SHORT="SHORT",t.UNSIGNED_INT="UNSIGNED_INT",t.INT="INT",t.BOOL="BOOL",t.LINEAR="LINEAR",t.NEAREST="NEAREST",t.REPEAT="REPEAT",t.CLAMP_TO_EDGE="CLAMP_TO_EDGE",t.RGB="RGB",t.RGBA="RGBA",t.GLSL3="300 es",t.GLSL1="100",t.FLOAT_1D_UNIFORM="1f",t.FLOAT_2D_UNIFORM="2f",t.FLOAT_3D_UNIFORM="3f",t.FLOAT_4D_UNIFORM="3f",t.INT_1D_UNIFORM="1i",t.INT_2D_UNIFORM="2i",t.INT_3D_UNIFORM="3i",t.INT_4D_UNIFORM="3i"},930:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DataLayer=void 0;var T=r(501),c=r(627),b=r(738),p=r(581),d=r(593),r=(g.calcSize=function(e,t){var r,n;if(isNaN(e)){if(r=e[0],!c.isPositiveInteger(r))throw new Error("Invalid width "+r+' for DataLayer "'+t+'".');if(n=e[1],!c.isPositiveInteger(n))throw new Error("Invalid height "+n+' for DataLayer "'+t+'".')}else{if(!c.isPositiveInteger(e))throw new Error("Invalid length "+e+' for DataLayer "'+t+'".');for(var i,a=1,o=i=e;2<o;)a++,o/=2;r=Math.pow(2,Math.floor(a/2)+a%2),n=Math.pow(2,Math.floor(a/2))}return{width:r,height:n,length:i}},g.getInternalWrap=function(e){var t=e.gl,r=e.wrap,e=e.name;return d.isWebGL2(t)||r===b.CLAMP_TO_EDGE||d.isWebGL2(t)?r:(console.warn('Falling back to CLAMP_TO_EDGE wrapping for DataLayer "'+e+'" for WebGL 1.'),b.CLAMP_TO_EDGE)},g.getInternalFilter=function(e){var t=e.gl,r=e.errorCallback,n=e.internalType,i=e.name,e=e.filter;return e===b.NEAREST||(n===b.HALF_FLOAT&&(p.getExtension(t,p.OES_TEXTURE_HAlF_FLOAT_LINEAR,r,!0)||p.getExtension(t,p.OES_TEXTURE_FLOAT_LINEAR,r,!0)||(console.warn('Falling back to NEAREST filter for DataLayer "'+i+'".'),e=b.NEAREST)),n===b.FLOAT&&(p.getExtension(t,p.OES_TEXTURE_FLOAT_LINEAR,r,!0)||(console.warn('Falling back to NEAREST filter for DataLayer "'+i+'".'),e=b.NEAREST))),e},g.getInternalType=function(e){var t=e.gl,r=e.errorCallback,n=e.writable,i=e.name,a=e.glslVersion,o=e.type;return g.shouldCastIntTypeAsFloat(e)&&(o=o===b.UNSIGNED_BYTE||o===b.BYTE?b.HALF_FLOAT:(o===b.INT||b.UNSIGNED_INT,console.warn("Falling back "+o+' type to FLOAT type for glsl1.x support for DataLayer "'+i+'".\nLarge UNSIGNED_INT or INT with absolute value > 16,777,216 are not supported, on mobile UNSIGNED_INT, INT, UNSIGNED_SHORT, and SHORT with absolute value > 2,048 may not be supported.'),b.FLOAT)),d.isWebGL2(t)||(o===b.FLOAT&&(p.getExtension(t,p.OES_TEXTURE_FLOAT,r,!0)||(console.warn('FLOAT not supported, falling back to HALF_FLOAT type for DataLayer "'+i+'".'),o=b.HALF_FLOAT),n&&(g.testFramebufferWrite({gl:t,type:o,glslVersion:a})||o===b.HALF_FLOAT||(console.warn('FLOAT not supported for writing operations, falling back to HALF_FLOAT type for DataLayer "'+i+'".'),o=b.HALF_FLOAT))),o===b.HALF_FLOAT&&(p.getExtension(t,p.OES_TEXTURE_HALF_FLOAT,r),n&&(g.testFramebufferWrite({gl:t,type:o,glslVersion:a})||r("This browser does not support rendering to HALF_FLOAT textures.")))),n&&d.isWebGL2(t)&&(o===b.HALF_FLOAT||o===b.FLOAT)&&p.getExtension(t,p.EXT_COLOR_BUFFER_FLOAT,r),o},g.shouldCastIntTypeAsFloat=function(e){var t=e.gl,r=e.type,n=e.filter;return(e.glslVersion!==b.GLSL3||!d.isWebGL2(t))&&(r===b.UNSIGNED_BYTE&&n===b.LINEAR||(r===b.BYTE||r===b.SHORT||r===b.INT||r===b.UNSIGNED_SHORT||r===b.UNSIGNED_INT))},g.getGLTextureParameters=function(e){var t,r,n,i,a=e.gl,o=e.errorCallback,s=e.name,l=e.numComponents,u=e.internalType,f=e.writable,h=e.glslVersion;if(d.isWebGL2(a)){if(3===(i=l)&&f&&(i=4),u===b.FLOAT||u===b.HALF_FLOAT)switch(i){case 1:r=a.RED;break;case 2:r=a.RG;break;case 3:r=a.RGB;break;case 4:r=a.RGBA;break;default:throw new Error("Unsupported glNumChannels "+i+' for DataLayer "'+s+'".')}else if(h===b.GLSL1&&u===b.UNSIGNED_BYTE)switch(i){case 1:if(!f){r=a.ALPHA;break}case 2:if(!f){r=a.LUMINANCE_ALPHA;break}case 3:r=a.RGB,i=3;break;case 4:r=a.RGBA,i=4;break;default:throw new Error("Unsupported glNumChannels "+i+' for DataLayer "'+s+'".')}else switch(i){case 1:r=a.RED_INTEGER;break;case 2:r=a.RG_INTEGER;break;case 3:r=a.RGB_INTEGER;break;case 4:r=a.RGBA_INTEGER;break;default:throw new Error("Unsupported glNumChannels "+i+' for DataLayer "'+s+'".')}switch(u){case b.HALF_FLOAT:switch(t=a.HALF_FLOAT,i){case 1:n=a.R16F;break;case 2:n=a.RG16F;break;case 3:n=a.RGB16F;break;case 4:n=a.RGBA16F;break;default:throw new Error("Unsupported glNumChannels "+i+' for DataLayer "'+s+'".')}break;case b.FLOAT:switch(t=a.FLOAT,i){case 1:n=a.R32F;break;case 2:n=a.RG32F;break;case 3:n=a.RGB32F;break;case 4:n=a.RGBA32F;break;default:throw new Error("Unsupported glNumChannels "+i+' for DataLayer "'+s+'".')}break;case b.UNSIGNED_BYTE:if(t=a.UNSIGNED_BYTE,h===b.GLSL1&&u===b.UNSIGNED_BYTE)n=r;else switch(i){case 1:n=a.R8UI;break;case 2:n=a.RG8UI;break;case 3:n=a.RGB8UI;break;case 4:n=a.RGBA8UI;break;default:throw new Error("Unsupported glNumChannels "+i+' for DataLayer "'+s+'".')}break;case b.BYTE:switch(t=a.BYTE,i){case 1:n=a.R8I;break;case 2:n=a.RG8I;break;case 3:n=a.RGB8I;break;case 4:n=a.RGBA8I;break;default:throw new Error("Unsupported glNumChannels "+i+' for DataLayer "'+s+'".')}break;case b.SHORT:switch(t=a.SHORT,i){case 1:n=a.R16I;break;case 2:n=a.RG16I;break;case 3:n=a.RGB16I;break;case 4:n=a.RGBA16I;break;default:throw new Error("Unsupported glNumChannels "+i+' for DataLayer "'+s+'".')}break;case b.UNSIGNED_SHORT:switch(t=a.UNSIGNED_SHORT,i){case 1:n=a.R16UI;break;case 2:n=a.RG16UI;break;case 3:n=a.RGB16UI;break;case 4:n=a.RGBA16UI;break;default:throw new Error("Unsupported glNumChannels "+i+' for DataLayer "'+s+'".')}break;case b.INT:switch(t=a.INT,i){case 1:n=a.R32I;break;case 2:n=a.RG32I;break;case 3:n=a.RGB32I;break;case 4:n=a.RGBA32I;break;default:throw new Error("Unsupported glNumChannels "+i+' for DataLayer "'+s+'".')}break;case b.UNSIGNED_INT:switch(t=a.UNSIGNED_INT,i){case 1:n=a.R32UI;break;case 2:n=a.RG32UI;break;case 3:n=a.RGB32UI;break;case 4:n=a.RGBA32UI;break;default:throw new Error("Unsupported glNumChannels "+i+' for DataLayer "'+s+'".')}break;default:throw new Error("Unsupported type "+u+' for DataLayer "'+s+'".')}}else{switch(l){case 1:if(!f){r=a.ALPHA;break}case 2:if(!f){r=a.LUMINANCE_ALPHA;break}case 3:r=a.RGB,n=a.RGB,i=3;break;case 4:r=a.RGBA,n=a.RGBA,i=4;break;default:throw new Error("Unsupported numComponents "+l+' for DataLayer "'+s+'".')}switch(u){case b.FLOAT:t=a.FLOAT;break;case b.HALF_FLOAT:t=a.HALF_FLOAT||p.getExtension(a,p.OES_TEXTURE_HALF_FLOAT,o).HALF_FLOAT_OES;break;case b.UNSIGNED_BYTE:t=a.UNSIGNED_BYTE;break;default:throw new Error("Unsupported type "+u+' in WebGL 1.0 for DataLayer "'+s+'".')}}if(void 0===t||void 0===r||void 0===n){e=[];throw void 0===t&&e.push("glType"),void 0===r&&e.push("glFormat"),void 0===n&&e.push("glInternalFormat"),new Error("Invalid type: "+u+" for numComponents "+l+", unable to init parameter"+(1<e.length?"s":"")+" "+e.join(", ")+' for DataLayer "'+s+'".')}if(void 0===i||l<1||4<l||i<l)throw new Error("Invalid numChannels "+i+" for numComponents "+l+' for DataLayer "'+s+'".');return{glFormat:r,glInternalFormat:n,glType:t,glNumChannels:i}},g.testFramebufferWrite=function(e){var t=e.gl,r=e.type,n=e.glslVersion,i=t.createTexture();if(!i)return!1;t.bindTexture(t.TEXTURE_2D,i);var a=t[b.CLAMP_TO_EDGE],o=t[b.CLAMP_TO_EDGE],e=t[b.NEAREST];t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,a),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,o),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,e);e=g.getGLTextureParameters({gl:t,name:"testFramebufferWrite",numComponents:1,writable:!0,internalType:r,glslVersion:n,errorCallback:function(){}}),r=e.glInternalFormat,n=e.glFormat,e=e.glType;t.texImage2D(t.TEXTURE_2D,0,r,100,100,0,n,e,null);n=t.createFramebuffer();if(!n)return t.deleteTexture(i),!1;t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0);e=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.deleteTexture(i),t.deleteFramebuffer(n),e},Object.defineProperty(g.prototype,"bufferIndex",{get:function(){return this._bufferIndex},enumerable:!1,configurable:!0}),g.prototype.saveCurrentStateToDataLayer=function(e){if(this.numBuffers<2)throw new Error("Can't call DataLayer.saveCurrentStateToDataLayer on DataLayer "+this.name+" with less than 2 buffers.");if(!this.writable)throw new Error("Can't call DataLayer.saveCurrentStateToDataLayer on read-only DataLayer "+this.name+".");if(e.writable)throw new Error("Can't call DataLayer.saveCurrentStateToDataLayer on DataLayer "+this.name+" using writable DataLayer "+e.name+".");if(e.glWrapS!==this.glWrapS||e.glWrapT!==this.glWrapT||e.wrapS!==this.wrapS||e.wrapT!==this.wrapT||e.width!==this.width||e.height!==this.height||e.glFilter!==this.glFilter||e.filter!==this.filter||e.glNumChannels!==this.glNumChannels||e.numComponents!==this.numComponents||e.glType!==this.glType||e.type!==this.type||e.glFormat!==this.glFormat||e.glInternalFormat!==this.glInternalFormat)throw new Error("Incompatible texture params between DataLayers "+e.name+" and "+this.name+".");if(!this.textureOverrides){this.textureOverrides=[];for(var t=0;t<this.numBuffers;t++)this.textureOverrides.push(void 0)}if(this.textureOverrides[this._bufferIndex])throw new Error("Can't call DataLayer.saveCurrentStateToDataLayer on DataLayer "+this.name+", this DataLayer has not written new state since last call to DataLayer.saveCurrentStateToDataLayer.");var r=this.getCurrentStateTexture();this.textureOverrides[this._bufferIndex]=r,this.buffers[this._bufferIndex].texture=e.getCurrentStateTexture(),e._setCurrentStateTexture(r);var n=this.gl,e=this.buffers[this._bufferIndex],r=e.framebuffer,e=e.texture;if(!r)throw new Error("No framebuffer for writable DataLayer "+this.name+".");n.bindFramebuffer(n.FRAMEBUFFER,r),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0),n.bindFramebuffer(n.FRAMEBUFFER,null)},g.prototype._setCurrentStateTexture=function(e){if(this.writable)throw new Error("Can't call DataLayer._setCurrentStateTexture on writable texture "+this.name+".");this.buffers[this._bufferIndex].texture=e},g.prototype.validateDataArray=function(e){if(e){var t=this,r=t.width,n=t.height,i=t.length,a=t.numComponents,o=t.glNumChannels,s=t.type,l=t.internalType,u=t.name;if(i&&e.length!==i*a||!i&&e.length!==r*n*a)throw new Error("Invalid data length "+e.length+' for DataLayer "'+u+'" of size '+(i||r+"x"+n)+"x"+a+".");var f=!1;switch(s){case b.HALF_FLOAT:case b.FLOAT:f=f||e.constructor!==Float32Array;break;case b.UNSIGNED_BYTE:f=f||e.constructor!==Uint8Array;break;case b.BYTE:f=f||e.constructor!==Int8Array;break;case b.UNSIGNED_SHORT:f=f||e.constructor!==Uint16Array;break;case b.SHORT:f=f||e.constructor!==Int16Array;break;case b.UNSIGNED_INT:f=f||e.constructor!==Uint32Array;break;case b.INT:f=f||e.constructor!==Int32Array;break;default:throw new Error('Error initing DataLayer "'+u+'".  Unsupported type "'+s+'" for WebGLCompute.initDataLayer.')}if(f)throw new Error("Invalid TypedArray of type "+e.constructor.name+' supplied to DataLayer "'+u+'" of type "'+s+'".');var h=e,p=r*n*o,n=h.length!==p,c=l===b.HALF_FLOAT;if(s!==l||n||c){switch(l){case b.HALF_FLOAT:h=new Uint16Array(p);break;case b.FLOAT:h=new Float32Array(p);break;case b.UNSIGNED_BYTE:h=new Uint8Array(p);break;case b.BYTE:h=new Int8Array(p);break;case b.UNSIGNED_SHORT:h=new Uint16Array(p);break;case b.SHORT:h=new Int16Array(p);break;case b.UNSIGNED_INT:h=new Uint32Array(p);break;case b.INT:h=new Int32Array(p);break;default:throw new Error("Error initing "+u+".  Unsupported internalType "+l+" for WebGLCompute.initDataLayer.")}for(var d=c?new DataView(h.buffer):null,g=0,_=e.length/a;g<_;g++)for(var m=0;m<a;m++){var y=e[g*a+m],v=g*o+m;c?T.setFloat16(d,2*v,y,!0):h[v]=y}}return h}},g.prototype.initBuffers=function(e){var t=this,r=t.name,n=t.numBuffers,i=t.gl,a=t.width,o=t.height,s=t.glInternalFormat,l=t.glFormat,u=t.glType,f=t.glFilter,h=t.glWrapS,p=t.glWrapT,c=t.writable,d=t.errorCallback;this.initializationData=e;for(var g=this.validateDataArray(e),_=0;_<n;_++){var m=i.createTexture();if(!m)return void d('Could not init texture for DataLayer "'+r+'": '+i.getError()+".");i.bindTexture(i.TEXTURE_2D,m),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,h),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,p),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,f),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,f),i.texImage2D(i.TEXTURE_2D,0,s,a,o,0,l,u,g||null);var y={texture:m};if(c){var v=i.createFramebuffer();if(!v)return void d('Could not init framebuffer for DataLayer "'+r+'": '+i.getError()+".");i.bindFramebuffer(i.FRAMEBUFFER,v),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,m,0);m=i.checkFramebufferStatus(i.FRAMEBUFFER);m!=i.FRAMEBUFFER_COMPLETE&&d('Invalid status for framebuffer for DataLayer "'+r+'": '+m+"."),y.framebuffer=v}this.buffers.push(y)}i.bindFramebuffer(i.FRAMEBUFFER,null)},g.prototype.getCurrentStateTexture=function(){return this.textureOverrides&&this.textureOverrides[this._bufferIndex]?this.textureOverrides[this._bufferIndex]:this.buffers[this._bufferIndex].texture},g.prototype.getPreviousStateTexture=function(e){if(void 0===e&&(e=-1),1===this.numBuffers)throw new Error('Cannot call getPreviousStateTexture on DataLayer "'+this.name+'" with only one buffer.');var t=this._bufferIndex+e;if(t<0&&(t+=this.numBuffers),t<0||t>=this.numBuffers)throw new Error("Invalid index "+e+" passed to getPreviousStateTexture on DataLayer "+this.name+" with "+this.numBuffers+" buffers.");return this.textureOverrides&&this.textureOverrides[t]?this.textureOverrides[t]:this.buffers[t].texture},g.prototype._usingTextureOverrideForCurrentBuffer=function(){return this.textureOverrides&&this.textureOverrides[this.bufferIndex]},g.prototype._bindOutputBufferForWrite=function(e){this.gl;e&&(this._bufferIndex=(this._bufferIndex+1)%this.numBuffers),this._bindOutputBuffer(),this.textureOverrides&&(this.textureOverrides[this._bufferIndex]=void 0)},g.prototype._bindOutputBuffer=function(){var e=this.gl,t=this.buffers[this._bufferIndex].framebuffer;if(!t)throw new Error('DataLayer "'+this.name+'" is not writable.');e.bindFramebuffer(e.FRAMEBUFFER,t)},g.prototype.setData=function(e){this.destroyBuffers(),this.initBuffers(e)},g.prototype.resize=function(e,t){var r=g.calcSize(e,this.name),n=r.length,e=r.width,r=r.height;this.length=n,this.width=e,this.height=r,this.destroyBuffers(),this.initBuffers(t)},g.prototype.clear=function(){this.destroyBuffers(),this.initBuffers()},g.prototype.getDimensions=function(){return[this.width,this.height]},g.prototype.getLength=function(){if(!this.length)throw new Error('Cannot call getLength() on 2D DataLayer "'+this.name+'".');return this.length},g.prototype.destroyBuffers=function(){var n=this.gl,e=this.buffers;e.forEach(function(e){var t=e.framebuffer,r=e.texture;n.deleteTexture(r),t&&n.deleteFramebuffer(t),delete e.texture,delete e.framebuffer}),e.length=0,delete this.textureOverrides},g.prototype.destroy=function(){this.destroyBuffers(),delete this.gl,delete this.errorCallback},g.prototype.clone=function(){},g);function g(e){this._bufferIndex=0,this.buffers=[];var t=e.gl,r=e.errorCallback,n=e.name,i=e.dimensions,a=e.type,o=e.numComponents,s=e.data,l=e.glslVersion;if(this.name=n,this.gl=t,this.errorCallback=r,!c.isPositiveInteger(o)||4<o)throw new Error("Invalid numComponents "+o+' for DataLayer "'+n+'".');this.numComponents=o;var u=!!e.writable;this.writable=u;var f=g.calcSize(i,n),h=f.length,p=f.width,i=f.height;if(this.length=h,!c.isPositiveInteger(p))throw new Error("Invalid width "+p+' for DataLayer "'+n+'".');if(this.width=p,!c.isPositiveInteger(i))throw new Error("Invalid length "+i+' for DataLayer "'+n+'".');this.height=i;f=void 0!==e.filter?e.filter:h?b.NEAREST:b.LINEAR;if(!c.isValidFilterType(f))throw new Error("Invalid filter: "+f+' for DataLayer "'+n+'", must be '+c.validFilterTypes.join(", ")+".");this.filter=f;p=void 0!==e.wrapS?e.wrapS:b.CLAMP_TO_EDGE;if(!c.isValidWrapType(p))throw new Error("Invalid wrapS: "+p+' for DataLayer "'+n+'", must be '+c.validWrapTypes.join(", ")+".");this.wrapS=p;i=void 0!==e.wrapT?e.wrapT:b.CLAMP_TO_EDGE;if(!c.isValidWrapType(i))throw new Error("Invalid wrapT: "+i+' for DataLayer "'+n+'", must be '+c.validWrapTypes.join(", ")+".");if(this.wrapT=i,!c.isValidDataType(a))throw new Error("Invalid type "+a+' for DataLayer "'+n+'", must be one of '+c.validDataTypes.join(", ")+".");this.type=a;h=g.getInternalType({gl:t,type:a,glslVersion:l,writable:u,filter:f,name:n,errorCallback:r});this.internalType=h;a=g.getGLTextureParameters({gl:t,name:n,numComponents:o,writable:u,internalType:h,glslVersion:l,errorCallback:r}),o=a.glFormat,u=a.glInternalFormat,l=a.glType,a=a.glNumChannels;this.glInternalFormat=u,this.glFormat=o,this.glType=l,this.glNumChannels=a,this.internalFilter=g.getInternalFilter({gl:t,filter:f,internalType:h,name:n,errorCallback:r}),this.glFilter=t[this.internalFilter],this.internalWrapS=g.getInternalWrap({gl:t,wrap:p,name:n}),this.glWrapS=t[this.internalWrapS],this.internalWrapT=g.getInternalWrap({gl:t,wrap:i,name:n}),this.glWrapT=t[this.internalWrapT];e=void 0!==e.numBuffers?e.numBuffers:1;if(!c.isPositiveInteger(e))throw new Error("Invalid numBuffers: "+e+' for DataLayer "'+n+'", must be positive integer.');this.numBuffers=e,this.initBuffers(s)}t.DataLayer=r},664:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GPUProgram=void 0;var n=r(607),f=r(627),h=r(738),p=r(593),o="DEFAULT",i="DEFAULT_W_UV",a="DEFAULT_W_NORMAL",s="DEFAULT_W_UV_NORMAL",l="SEGMENT",u="DATA_LAYER_POINTS",c="DATA_LAYER_LINES",d="DATA_LAYER_VECTOR_FIELD",g=((_={})[o]={src_1:r(790),src_3:""},_[i]={src_1:r(790),src_3:"",defines:{UV_ATTRIBUTE:"1"}},_[a]={src_1:r(790),src_3:"",defines:{NORMAL_ATTRIBUTE:"1"}},_[s]={src_1:r(790),src_3:"",defines:{UV_ATTRIBUTE:"1",NORMAL_ATTRIBUTE:"1"}},_[l]={src_1:r(852),src_3:""},_[u]={src_1:r(87),src_3:""},_[d]={src_1:r(444),src_3:""},_[c]={src_1:r(328),src_3:""},_),_=(m.convertDefinesToString=function(e){for(var t="",r=Object.keys(e),n=0;n<r.length;n++){var i=r[n];if(!f.isString(i)||!f.isString(e[i]))throw new Error("GPUProgram defines must be passed in as key value pairs that are both strings, got key value pair of type "+typeof i+" : "+typeof e[i]+".");t+="#define "+i+" "+e[i]+"\n"}return t},m.prototype.initProgram=function(e,t){var r=this.gl,n=this.fragmentShader,i=this.errorCallback,a=this.uniforms,o=r.createProgram();if(o){if(r.attachShader(o,n),r.attachShader(o,e),r.linkProgram(o),r.getProgramParameter(o,r.LINK_STATUS)){for(var s=Object.keys(a),l=0;l<s.length;l++){var u=s[l],f=a[u],h=f.value,f=f.type;this.setProgramUniform(o,t,u,h,f)}return o}i('Program "'+name+'" failed to link: '+r.getProgramInfoLog(o))}else i("Unable to init gl program: "+name+".")},m.prototype.getProgramWithName=function(e){if(this.programs[e])return this.programs[e];var t=this.errorCallback,r=g[e];if(void 0===r.shader){var n=this.gl,i=this.name,a=this.glslVersion===h.GLSL3?r.src_3:r.src_1;if(""===a)throw new Error("No source for vertex shader "+this.name+" : "+i);r.defines&&(a=m.convertDefinesToString(r.defines)+a);n=p.compileShader(n,t,a,n.VERTEX_SHADER,i);if(!n)return void t('Unable to compile default vertex shader for program "'+i+'".');r.shader=n}r=this.initProgram(r.shader,o);if(void 0!==r)return this.programs[e]=r;t('Unable to init program "'+e+'".')},Object.defineProperty(m.prototype,"defaultProgram",{get:function(){return this.getProgramWithName(o)},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"defaultProgramWithUV",{get:function(){return this.getProgramWithName(i)},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"defaultProgramWithNormal",{get:function(){return this.getProgramWithName(a)},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"defaultProgramWithUVNormal",{get:function(){return this.getProgramWithName(s)},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"segmentProgram",{get:function(){return this.getProgramWithName(l)},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"dataLayerPointsProgram",{get:function(){return this.getProgramWithName(u)},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"dataLayerVectorFieldProgram",{get:function(){return this.getProgramWithName(d)},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"dataLayerLinesProgram",{get:function(){return this.getProgramWithName(c)},enumerable:!1,configurable:!0}),m.prototype.uniformTypeForValue=function(e,t){if(t===h.FLOAT){if(f.isArray(e)){for(var r=0;r<e.length;r++)if(!f.isNumber(e[r]))throw new Error("Invalid uniform value: "+e+' for program "'+this.name+'", expected float or float[] of length 1-4.')}else if(!f.isNumber(e))throw new Error("Invalid uniform value: "+e+' for program "'+this.name+'", expected float or float[] of length 1-4.');if(!f.isArray(e)||1===e.length)return h.FLOAT_1D_UNIFORM;if(2===e.length)return h.FLOAT_2D_UNIFORM;if(3===e.length)return h.FLOAT_3D_UNIFORM;if(4===e.length)return h.FLOAT_4D_UNIFORM;throw new Error("Invalid uniform value: "+e+' for program "'+this.name+'", expected float or float[] of length 1-4.')}if(t===h.INT){if(f.isArray(e)){for(r=0;r<e.length;r++)if(!f.isInteger(e[r]))throw new Error("Invalid uniform value: "+e+' for program "'+this.name+'", expected int or int[] of length 1-4.')}else if(!f.isInteger(e))throw new Error("Invalid uniform value: "+e+' for program "'+this.name+'", expected int or int[] of length 1-4.');if(!f.isArray(e)||1===e.length)return h.INT_1D_UNIFORM;if(2===e.length)return h.INT_2D_UNIFORM;if(3===e.length)return h.INT_3D_UNIFORM;if(4===e.length)return h.INT_4D_UNIFORM;throw new Error("Invalid uniform value: "+e+' for program "'+this.name+'", expected int or int[] of length 1-4.')}if(t!==n.BOOL)throw new Error("Invalid uniform data type: "+t+' for program "'+this.name+'", expected '+h.FLOAT+" or "+h.INT+".");if(f.isBoolean(e))return h.FLOAT_1D_UNIFORM;throw new Error("Invalid uniform value: "+e+' for program "'+this.name+'", expected boolean.')},m.prototype.setProgramUniform=function(e,t,r,n,i){var a,o=this.gl,s=this.uniforms,l=this.errorCallback;o.useProgram(e);var u=null===(a=s[r])||void 0===a?void 0:a.location[t];if(void 0===u){e=o.getUniformLocation(e,r);if(!e)return void l('Could not init uniform "'+r+'" for program "'+this.name+'".\nCheck that uniform is present in shader code, unused uniforms may be removed by compiler.\nAlso check that uniform type in shader code matches type '+i+".\nError code: "+o.getError()+".");u=e,s[r]&&(s[r].location[t]=u)}switch(i){case h.FLOAT_1D_UNIFORM:f.isBoolean(n)?o.uniform1f(u,n?1:0):o.uniform1f(u,n);break;case h.FLOAT_2D_UNIFORM:o.uniform2fv(u,n);break;case h.FLOAT_3D_UNIFORM:o.uniform3fv(u,n);break;case h.FLOAT_4D_UNIFORM:o.uniform4fv(u,n);break;case h.INT_1D_UNIFORM:o.uniform1i(u,n);break;case h.INT_2D_UNIFORM:o.uniform2iv(u,n);break;case h.INT_3D_UNIFORM:o.uniform3iv(u,n);break;case h.INT_4D_UNIFORM:o.uniform4iv(u,n);break;default:throw new Error("Unknown uniform type "+i+' for GPUProgram "'+this.name+'".')}},m.prototype.setUniform=function(e,t,r){var n,i=this.programs,a=this.uniforms,o=null===(n=a[e])||void 0===n?void 0:n.type;if(r){r=this.uniformTypeForValue(t,r);if(void 0===o)o=r;else if(o!==r)throw new Error('Uniform "'+e+'" for GPUProgram "'+this.name+'" cannot change from type '+o+" to type "+r+".")}if(void 0===o)throw new Error('Unknown type for uniform "'+e+'", please pass in dataType to GPUProgram.setUniform when initing a new uniform.');a[e]?a[e].value=t:a[e]={type:o,location:{},value:t};for(var s=Object.keys(i),l=0;l<s.length;l++){var u=s[l];this.setProgramUniform(i[u],u,e,t,o)}},m.prototype.setVertexUniform=function(t,e,r,n){var i=this,a=this.uniformTypeForValue(r,n);if(void 0===t)throw new Error("Must pass in valid WebGLProgram to setVertexUniform, got undefined.");n=Object.keys(this.programs).find(function(e){return i.programs[e]===t});if(!n)throw new Error('Could not find valid vertex programName for WebGLProgram "'+this.name+'".');this.setProgramUniform(t,n,e,r,a)},m.prototype.destroy=function(){var t=this,r=this.gl,e=this.fragmentShader,n=this.programs;Object.values(n).forEach(function(e){r.deleteProgram(e)}),Object.keys(this.programs).forEach(function(e){delete t.programs[e]}),r.deleteShader(e),delete this.fragmentShader,delete this.gl,delete this.errorCallback},m);function m(e){this.uniforms={},this.programs={};var t=e.gl,r=e.errorCallback,n=e.name,i=e.fragmentShader,a=e.glslVersion,o=e.uniforms,e=e.defines;if(this.gl=t,this.errorCallback=r,this.name=n,this.glslVersion=a,"string"==typeof i||"string"==typeof i[0]){i="string"==typeof i?i:i.join("\n");e&&(i=m.convertDefinesToString(e)+i);t=p.compileShader(t,r,i,t.FRAGMENT_SHADER,n);if(!t)return void r('Unable to compile fragment shader for program "'+n+'".');this.fragmentShader=t}else if(e)throw new Error('Unable to attach defines to program "'+n+'" because fragment shader is already compiled.');if(o)for(var s=0;s<(null==o?void 0:o.length);s++){var l=o[s],u=l.name,f=l.value,l=l.dataType;this.setUniform(u,f,l)}}t.GPUProgram=_},404:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Vector4=void 0;var r=(Object.defineProperty(n.prototype,"width",{get:function(){return this.z},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this.w},enumerable:!1,configurable:!0}),n.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},n);function n(e,t,r,n){void 0===t&&(t=0),void 0===r&&(r=0),void 0===n&&(n=1),this.x=e=void 0===e?0:e,this.y=t,this.z=r,this.w=n}t.Vector4=r},215:function(e,t,l){"use strict";var a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.WebGLCompute=void 0;var _=l(162),m=l(809),u=l(930),F=l(738),o=l(664),r=l(404),y=l(593),E=l(501),v=l(627),n=(i.initWithThreeRenderer=function(e,t,r){return new i(a({canvas:e.domElement,context:e.getContext()},t),r,e)},Object.defineProperty(i.prototype,"singleColorProgram",{get:function(){var e;return void 0===this._singleColorProgram&&(e=this.initProgram({name:"singleColor",fragmentShader:this.glslVersion===F.GLSL3?l(805):l(971)}),this._singleColorProgram=e),this._singleColorProgram},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"singleColorWithWrapCheckProgram",{get:function(){var e;return void 0===this._singleColorWithWrapCheckProgram&&(e=this.initProgram({name:"singleColorWithWrapCheck",fragmentShader:this.glslVersion===F.GLSL3?l(674):l(425)}),this._singleColorWithWrapCheckProgram=e),this._singleColorWithWrapCheckProgram},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"vectorMagnitudeProgram",{get:function(){var e;return void 0===this._vectorMagnitudeProgram&&(e=this.initProgram({name:"vectorMagnitude",fragmentShader:this.glslVersion===F.GLSL3?l(850):l(754)}),this._vectorMagnitudeProgram=e),this._vectorMagnitudeProgram},enumerable:!1,configurable:!0}),i.prototype.isWebGL2=function(){return y.isWebGL2(this.gl)},Object.defineProperty(i.prototype,"quadPositionsBuffer",{get:function(){var e;return void 0===this._quadPositionsBuffer&&(e=new Float32Array([-1,-1,1,-1,-1,1,1,1]),this._quadPositionsBuffer=this.initVertexBuffer(e)),this._quadPositionsBuffer},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"boundaryPositionsBuffer",{get:function(){var e;return void 0===this._boundaryPositionsBuffer&&(e=new Float32Array([-1,-1,1,-1,1,1,-1,1,-1,-1]),this._boundaryPositionsBuffer=this.initVertexBuffer(e)),this._boundaryPositionsBuffer},enumerable:!1,configurable:!0}),i.prototype.getCirclePositionsBuffer=function(e){if(null==this._circlePositionsBuffer[e]){for(var t=[0,0],r=0;r<=e;r++)t.push(Math.cos(2*Math.PI*r/e),Math.sin(2*Math.PI*r/e));var n=new Float32Array(t),n=this.initVertexBuffer(n);this._circlePositionsBuffer[e]=n}return this._circlePositionsBuffer[e]},i.prototype.initVertexBuffer=function(e){var t=this.errorCallback,r=this.gl,n=r.createBuffer();if(n)return r.bindBuffer(r.ARRAY_BUFFER,n),r.bufferData(r.ARRAY_BUFFER,e,r.STATIC_DRAW),n;t("Unable to allocate gl buffer.")},i.prototype.initProgram=function(t){var r=["name","fragmentShader","uniforms","defines"];Object.keys(t).forEach(function(e){if(r.indexOf(e)<0)throw new Error("Invalid key "+e+' passed to WebGLCompute.initProgram with name "'+t.name+'".  Valid keys are '+r.join(", ")+".")});var e=this.gl,n=this.errorCallback,i=this.glslVersion;return new o.GPUProgram(a(a({},t),{gl:e,errorCallback:n,glslVersion:i}))},i.prototype.initDataLayer=function(t){var r=["name","dimensions","type","numComponents","data","filter","wrapS","wrapT","writable","numBuffers"];Object.keys(t).forEach(function(e){if(r.indexOf(e)<0)throw new Error("Invalid key "+e+' passed to WebGLCompute.initDataLayer with name "'+t.name+'".  Valid keys are '+r.join(", ")+".")});var e=this.gl,n=this.errorCallback,i=this.glslVersion;return new u.DataLayer(a(a({},t),{gl:e,glslVersion:i,errorCallback:n}))},i.prototype.cloneDataLayer=function(t){var r=0;try{r=t.getLength()}catch(e){r=t.getDimensions()}var e=t.writable?void 0:t.initializationData,n=this.initDataLayer({name:t.name+"-copy",dimensions:r,type:t.type,numComponents:t.numComponents,data:e,filter:t.filter,wrapS:t.wrapS,wrapT:t.wrapT,writable:t.writable,numBuffers:t.numBuffers});if(t.writable){for(var i=0;i<t.numBuffers-1;i++)this.step({program:this.copyProgramForType(t.type),input:t.getPreviousStateTexture(-t.numBuffers+i+1),output:n});this.step({program:this.copyProgramForType(t.type),input:t.getCurrentStateTexture(),output:n})}return n},i.prototype.initTexture=function(t){var r=["name","url","filter","wrapS","wrapT","format","type","onLoad"];Object.keys(t).forEach(function(e){if(r.indexOf(e)<0)throw new Error("Invalid key "+e+' passed to WebGLCompute.initTexture with name "'+t.name+'".  Valid keys are '+r.join(", ")+".")});var e=t.url,n=t.name;if(!v.isString(e))throw new Error("Expected WebGLCompute.initTexture params to have url of type string, got "+e+" of type "+typeof e+".");if(!v.isString(n))throw new Error("Expected WebGLCompute.initTexture params to have name of type string, got "+n+" of type "+typeof n+".");var i=void 0!==t.filter?t.filter:F.NEAREST;if(!v.isValidFilterType(i))throw new Error("Invalid filter: "+i+' for DataLayer "'+n+'", must be '+v.validFilterTypes.join(", ")+".");var a=void 0!==t.wrapS?t.wrapS:F.CLAMP_TO_EDGE;if(!v.isValidWrapType(a))throw new Error("Invalid wrapS: "+a+' for DataLayer "'+n+'", must be '+v.validWrapTypes.join(", ")+".");var o=void 0!==t.wrapT?t.wrapT:F.CLAMP_TO_EDGE;if(!v.isValidWrapType(o))throw new Error("Invalid wrapT: "+o+' for DataLayer "'+n+'", must be '+v.validWrapTypes.join(", ")+".");var s=void 0!==t.format?t.format:F.RGBA;if(!v.isValidTextureFormatType(s))throw new Error("Invalid format: "+s+' for DataLayer "'+n+'", must be '+v.validTextureFormatTypes.join(", ")+".");var l=void 0!==t.type?t.type:F.UNSIGNED_BYTE;if(!v.isValidTextureDataType(l))throw new Error("Invalid type: "+l+' for DataLayer "'+n+'", must be '+v.validTextureDataTypes.join(", ")+".");var u=this.gl,f=this.errorCallback,h=u.createTexture();if(null===h)throw new Error("Unable to init glTexture.");u.bindTexture(u.TEXTURE_2D,h);var p=u.RGBA,c=u[s],d=u[l],l=new Uint8Array([0,0,0,0]);u.texImage2D(u.TEXTURE_2D,0,p,1,1,0,c,d,l);var g=new Image;return g.onload=function(){u.bindTexture(u.TEXTURE_2D,h),u.texImage2D(u.TEXTURE_2D,0,p,c,d,g),y.isPowerOf2(g.width)&&y.isPowerOf2(g.height)||console.warn("Texture "+n+" dimensions ["+g.width+", "+g.height+"] are not power of 2."),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u[a]),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u[o]),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u[i]),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u[i]),t.onLoad&&t.onLoad(h)},g.onerror=function(e){f("Error loading image "+n+": "+e)},g.src=e,h},i.prototype.onResize=function(e){var t=e.clientWidth,r=e.clientHeight;e.width=t,e.height=r,this.width=t,this.height=r},i.prototype.drawSetup=function(e,t,r,n){var i=this.gl;if(e){var a=[];if(r)if(r.constructor===WebGLTexture)a.push(r);else if(r.constructor===u.DataLayer)a.push(r.getCurrentStateTexture());else for(var o=0;o<r.length;o++){var s=r[o];a.push(s.getCurrentStateTexture?s.getCurrentStateTexture():s)}this.setOutputLayer(t,r,n),i.useProgram(e);for(o=0;o<a.length;o++)i.activeTexture(i.TEXTURE0+o),i.bindTexture(i.TEXTURE_2D,a[o])}},i.prototype.copyProgramForType=function(e){switch(e){case F.HALF_FLOAT:case F.FLOAT:return this.copyFloatProgram;case F.UNSIGNED_BYTE:case F.UNSIGNED_SHORT:case F.UNSIGNED_INT:return this.copyUintProgram;case F.BYTE:case F.SHORT:case F.INT:return this.copyIntProgram;default:throw new Error("Invalid type: "+e+" passed to WebGLCompute.copyProgramForType.")}},i.prototype.setBlendMode=function(e){var t=this.gl;e&&(t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA))},i.prototype.addLayerToInputs=function(e,t){var r=t;return v.isArray(r)?r.indexOf(e)<0&&r.push(e):r!==e?(t=r,r=[],t&&r.push(t),r.push(e)):r=[r],r},i.prototype.passThroughLayerDataFromInputToOutput=function(e){var t=this.copyProgramForType(e.internalType);this.step({program:t,input:e,output:e})},i.prototype.setOutputLayer=function(e,t,r){var n=this.gl;if(r){if(t&&(t===r||v.isArray(t)&&-1<t.indexOf(r))){if(1===r.numBuffers)throw new Error("Cannot use same buffer for input and output of a program. Try increasing the number of buffers in your output layer to at least 2 so you can render to nextState using currentState as an input.");e?r._bindOutputBufferForWrite(!0):(this.passThroughLayerDataFromInputToOutput(r),r._bindOutputBufferForWrite(!1))}else e||r._usingTextureOverrideForCurrentBuffer()&&this.passThroughLayerDataFromInputToOutput(r),r._bindOutputBufferForWrite(!1);var i=r.getDimensions(),a=i[0],i=i[1];n.viewport(0,0,a,i)}else{n.bindFramebuffer(n.FRAMEBUFFER,null);a=this.width,i=this.height;n.viewport(0,0,a,i)}},i.prototype.setPositionAttribute=function(e,t){this.setVertexAttribute(e,"a_internal_position",2,t)},i.prototype.setIndexAttribute=function(e,t){this.setVertexAttribute(e,"a_internal_index",1,t)},i.prototype.setUVAttribute=function(e,t){this.setVertexAttribute(e,"a_internal_uv",2,t)},i.prototype.setVertexAttribute=function(e,t,r,n){var i=this.gl,e=i.getAttribLocation(e,t);if(e<0)throw new Error('Unable to find vertex attribute "'+t+'" in program "'+n+'".');i.vertexAttribPointer(e,r,i.FLOAT,!1,0,0),i.enableVertexAttribArray(e)},i.prototype.step=function(e){var t=this.gl,r=this.errorState,n=this.quadPositionsBuffer,i=e.program,a=e.input,o=e.output;r||(r=i.defaultProgram,this.drawSetup(r,!0,a,o),i.setVertexUniform(r,"u_internal_scale",[1,1],F.FLOAT),i.setVertexUniform(r,"u_internal_translation",[0,0],F.FLOAT),t.bindBuffer(t.ARRAY_BUFFER,n),this.setPositionAttribute(r,i.name),this.setBlendMode(e.shouldBlendAlpha),t.drawArrays(t.TRIANGLE_STRIP,0,4),t.disable(t.BLEND))},i.prototype.stepBoundary=function(e){var t=this.gl,r=this.errorState,n=this.boundaryPositionsBuffer,i=e.program,a=e.input,o=e.output,s=o?o.getDimensions():[this.width,this.height],l=s[0],s=s[1];if(!r){r=i.defaultProgram;this.drawSetup(r,!1,a,o);s=[1/l,1/s];if(i.setVertexUniform(r,"u_internal_scale",[1-s[0],1-s[1]],F.FLOAT),i.setVertexUniform(r,"u_internal_translation",s,F.FLOAT),t.bindBuffer(t.ARRAY_BUFFER,n),this.setPositionAttribute(r,i.name),this.setBlendMode(e.shouldBlendAlpha),e.singleEdge)switch(e.singleEdge){case"LEFT":t.drawArrays(t.LINES,3,2);break;case"RIGHT":t.drawArrays(t.LINES,1,2);break;case"TOP":t.drawArrays(t.LINES,2,2);break;case"BOTTOM":t.drawArrays(t.LINES,0,2);break;default:throw new Error("Unknown boundary edge type: "+e.singleEdge+".")}else t.drawArrays(t.LINE_LOOP,0,4);t.disable(t.BLEND)}},i.prototype.stepNonBoundary=function(e){var t=this.gl,r=this.errorState,n=this.quadPositionsBuffer,i=e.program,a=e.input,o=e.output,s=o?o.getDimensions():[this.width,this.height],l=s[0],s=s[1];r||(r=i.defaultProgram,this.drawSetup(r,!1,a,o),i.setVertexUniform(r,"u_internal_scale",[1-2*(s=[1/l,1/s])[0],1-2*s[1]],F.FLOAT),i.setVertexUniform(r,"u_internal_translation",s,F.FLOAT),t.bindBuffer(t.ARRAY_BUFFER,n),this.setPositionAttribute(r,i.name),this.setBlendMode(e.shouldBlendAlpha),t.drawArrays(t.TRIANGLE_STRIP,0,4),t.disable(t.BLEND))},i.prototype.stepCircle=function(e){var t=this.gl,r=this.errorState,n=this.width,i=this.height,a=e.program,o=e.position,s=e.radius,l=e.input,u=e.output;if(!r){r=a.defaultProgram;this.drawSetup(r,!1,l,u),a.setVertexUniform(r,"u_internal_scale",[2*s/n,2*s/i],F.FLOAT),a.setVertexUniform(r,"u_internal_translation",[2*o[0]/n-1,2*o[1]/i-1],F.FLOAT);i=e.numSegments||18;if(i<3)throw new Error("numSegments for WebGLCompute.stepCircle must be greater than 2, got "+i+".");t.bindBuffer(t.ARRAY_BUFFER,this.getCirclePositionsBuffer(i)),this.setPositionAttribute(r,a.name),this.setBlendMode(e.shouldBlendAlpha),t.drawArrays(t.TRIANGLE_FAN,0,i+2),t.disable(t.BLEND)}},i.prototype.stepSegment=function(e){var t=this.gl,r=this.errorState,n=e.program,i=e.position1,a=e.position2,o=e.thickness,s=e.input,l=e.output,u=l?l.getDimensions():[this.width,this.height],f=u[0],u=u[1];if(!r){r=n.segmentProgram;this.drawSetup(r,!1,s,l),n.setVertexUniform(r,"u_internal_halfThickness",o/2,F.FLOAT),n.setVertexUniform(r,"u_internal_scale",[2/f,2/u],F.FLOAT);l=i[0]-a[0],f=i[1]-a[1],u=Math.atan2(f,l);n.setVertexUniform(r,"u_internal_rotation",u,F.FLOAT);u=(i[0]+a[0])/2,a=(i[1]+a[1])/2;n.setVertexUniform(r,"u_internal_translation",[2*u/this.width-1,2*a/this.height-1],F.FLOAT);l=Math.sqrt(l*l+f*f),f=e.numCapSegments?2*e.numCapSegments:18;if(e.endCaps){if(f<6||f%6!=0)throw new Error("numSegments for WebGLCompute.stepSegment must be divisible by 6, got "+f+".");n.setVertexUniform(r,"u_internal_length",l-o*Math.sin(Math.PI/f),F.FLOAT),t.bindBuffer(t.ARRAY_BUFFER,this.getCirclePositionsBuffer(f))}else n.setVertexUniform(r,"u_internal_length",l-o,F.FLOAT),t.bindBuffer(t.ARRAY_BUFFER,this.quadPositionsBuffer);this.setPositionAttribute(r,n.name),this.setBlendMode(e.shouldBlendAlpha),e.endCaps?t.drawArrays(t.TRIANGLE_FAN,0,2+f):t.drawArrays(t.TRIANGLE_STRIP,0,4),t.disable(t.BLEND)}},i.prototype.stepPolyline=function(e){var t=e.program,r=e.input,n=e.output,i=e.positions,a=!!e.closeLoop,o=this.gl,s=this.width,l=this.height;if(!this.errorState){for(var u,f,h,p,c,d=e.thickness/2,g=a?4*i.length+2:4*(i.length-1),_=new Float32Array(2*g),m=e.includeUVs?new Float32Array(2*g):void 0,y=e.includeNormals?new Float32Array(2*g):void 0,v=[0,0],T=[0,0],b=[0,0],E=[0,0],w=[0,0],A=0;A<i.length;A++)!a&&A===i.length-1||(h=i[A],u=i[(A+1)%i.length],v[0]=u[0]-h[0],v[1]=u[1]-h[1],p=Math.sqrt(v[0]*v[0]+v[1]*v[1]),b[0]=v[1]/p,b[1]=-v[0]/p,f=4*A+2,a||0!==A||(_[0]=h[0]+b[0]*d,_[1]=h[1]+b[1]*d,_[2]=h[0]-b[0]*d,_[3]=h[1]-b[1]*d,m&&(m[0]=0,m[1]=1,m[2]=0,m[3]=0),y&&(y[0]=b[0],y[1]=b[1],y[2]=b[0],y[3]=b[1])),c=(A+1)/(i.length-1),_[2*f]=u[0]+b[0]*d,_[2*f+1]=u[1]+b[1]*d,_[2*f+2]=u[0]-b[0]*d,_[2*f+3]=u[1]-b[1]*d,m&&(m[2*f]=c,m[2*f+1]=1,m[2*f+2]=c,m[2*f+3]=0),y&&(y[2*f]=b[0],y[2*f+1]=b[1],y[2*f+2]=b[0],y[2*f+3]=b[1]),(A<i.length-2||a)&&(p=i[(A+1)%i.length],h=i[(A+2)%i.length],T[0]=h[0]-p[0],T[1]=h[1]-p[1],h=Math.sqrt(T[0]*T[0]+T[1]*T[1]),E[0]=T[1]/h,E[1]=-T[0]/h,_[(2+f)%(4*i.length)*2]=p[0]+E[0]*d,_[(2+f)%(4*i.length)*2+1]=p[1]+E[1]*d,_[(2+f)%(4*i.length)*2+2]=p[0]-E[0]*d,_[(2+f)%(4*i.length)*2+3]=p[1]-E[1]*d,m&&(m[(2+f)%(4*i.length)*2]=c,m[(2+f)%(4*i.length)*2+1]=1,m[(2+f)%(4*i.length)*2+2]=c,m[(2+f)%(4*i.length)*2+3]=0),y&&(y[(2+f)%(4*i.length)*2]=E[0],y[(2+f)%(4*i.length)*2+1]=E[1],y[(2+f)%(4*i.length)*2+2]=E[0],y[(2+f)%(4*i.length)*2+3]=E[1]),p=b[0]*E[1]-b[1]*E[0],Math.abs(p)<1e-6||(w[0]=b[0]+E[0],w[1]=b[1]+E[1],c=Math.sqrt(w[0]*w[0]+w[1]*w[1]),w[0]/=c,w[1]/=c,c=Math.acos(b[0]*E[0]+b[1]*E[1]),c=d/Math.cos(c/2),p<0?(_[2*f]=u[0]+w[0]*c,_[2*f+1]=u[1]+w[1]*c,_[(2+f)%(4*i.length)*2]=_[2*f],_[(2+f)%(4*i.length)*2+1]=_[2*f+1]):(_[2*f+2]=u[0]-w[0]*c,_[2*f+3]=u[1]-w[1]*c,_[(2+f)%(4*i.length)*2+2]=_[2*f+2],_[(2+f)%(4*i.length)*2+3]=_[2*f+3]))));a&&(_[8*i.length]=_[0],_[8*i.length+1]=_[1],_[8*i.length+2]=_[2],_[8*i.length+3]=_[3],m&&(m[8*i.length]=m[0],m[8*i.length+1]=m[1],m[8*i.length+2]=m[2],m[8*i.length+3]=m[3]),y&&(y[8*i.length]=y[0],y[8*i.length+1]=y[1],y[8*i.length+2]=y[2],y[8*i.length+3]=y[3]));var L=m?y?t.defaultProgramWithUVNormal:t.defaultProgramWithUV:y?t.defaultProgramWithNormal:t.defaultProgram;this.drawSetup(L,!1,r,n),t.setVertexUniform(L,"u_internal_scale",[2/s,2/l],F.FLOAT),t.setVertexUniform(L,"u_internal_translation",[-1,-1],F.FLOAT),o.bindBuffer(o.ARRAY_BUFFER,this.initVertexBuffer(_)),this.setPositionAttribute(L,t.name),m&&(o.bindBuffer(o.ARRAY_BUFFER,this.initVertexBuffer(m)),this.setUVAttribute(L,t.name)),y&&(o.bindBuffer(o.ARRAY_BUFFER,this.initVertexBuffer(y)),this.setVertexAttribute(L,"a_internal_normal",2,t.name)),this.setBlendMode(e.shouldBlendAlpha),o.drawArrays(o.TRIANGLE_STRIP,0,g),o.disable(o.BLEND)}},i.prototype.stepTriangleStrip=function(e){var t,r=e.program,n=e.input,i=e.output,a=e.positions,o=e.uvs,s=e.normals,l=this.gl,u=this.width,f=this.height;this.errorState||(t=o?s?r.defaultProgramWithUVNormal:r.defaultProgramWithUV:s?r.defaultProgramWithNormal:r.defaultProgram,this.drawSetup(t,!1,n,i),r.setVertexUniform(t,"u_internal_scale",[2/u,2/f],F.FLOAT),r.setVertexUniform(t,"u_internal_translation",[-1,-1],F.FLOAT),l.bindBuffer(l.ARRAY_BUFFER,this.initVertexBuffer(a)),this.setPositionAttribute(t,r.name),o&&(l.bindBuffer(l.ARRAY_BUFFER,this.initVertexBuffer(o)),this.setUVAttribute(t,r.name)),s&&(l.bindBuffer(l.ARRAY_BUFFER,this.initVertexBuffer(s)),this.setVertexAttribute(t,"a_internal_normal",2,r.name)),a=e.count||a.length/2,this.setBlendMode(e.shouldBlendAlpha),l.drawArrays(l.TRIANGLE_STRIP,0,a),l.disable(l.BLEND))},i.prototype.stepLines=function(e){var t=this.gl,r=this.errorState,n=this.width,i=this.height,a=e.indices,o=e.uvs,s=e.normals,l=e.input,u=e.output,f=e.program;if(!r){if(e.closeLoop&&a)throw new Error("WebGLCompute.stepLines() can't be called with closeLoop == true and indices.");r=o?s?f.defaultProgramWithUVNormal:f.defaultProgramWithUV:s?f.defaultProgramWithNormal:f.defaultProgram;this.drawSetup(r,!1,l,u);var h=e.count||(a?a.length:e.positions.length/2);if(f.setVertexUniform(r,"u_internal_scale",[2/n,2/i],F.FLOAT),f.setVertexUniform(r,"u_internal_translation",[-1,-1],F.FLOAT),a){for(var p=new Float32Array(2*h),c=0;c<h;c++){var d=a[c];p[2*c]=e.positions[2*d],p[2*c+1]=e.positions[2*d+1]}t.bindBuffer(t.ARRAY_BUFFER,this.initVertexBuffer(p))}else t.bindBuffer(t.ARRAY_BUFFER,this.initVertexBuffer(e.positions));this.setPositionAttribute(r,f.name),o&&(t.bindBuffer(t.ARRAY_BUFFER,this.initVertexBuffer(o)),this.setUVAttribute(r,f.name)),s&&(t.bindBuffer(t.ARRAY_BUFFER,this.initVertexBuffer(s)),this.setVertexAttribute(r,"a_internal_normal",2,f.name)),this.setBlendMode(e.shouldBlendAlpha),e.indices?t.drawArrays(t.LINES,0,h):e.closeLoop?t.drawArrays(t.LINE_LOOP,0,h):t.drawArrays(t.LINE_STRIP,0,h),t.disable(t.BLEND)}},i.prototype.drawLayerAsPoints=function(e){var t=this,r=t.gl,n=t.errorState,i=t.pointIndexArray,a=t.width,o=t.height,s=e.positions,l=e.output;if(!n){if(2!==s.numComponents&&4!==s.numComponents)throw new Error('WebGLCompute.drawPoints() must be passed a position DataLayer with either 2 or 4 components, got position DataLayer "'+s.name+'" with '+s.numComponents+" components.");var u=s.getLength(),f=e.count||u;if(u<f)throw new Error("Invalid count "+f+" for position DataLayer of length "+u+".");t=e.program;void 0===t&&(t=this.singleColorProgram,h=e.color||[1,0,0],t.setUniform("u_color",h,F.FLOAT));var n=t.dataLayerPointsProgram,h=this.addLayerToInputs(s,e.input);this.drawSetup(n,!1,h,l),t.setVertexUniform(n,"u_internal_positions",h.indexOf(s),F.INT),t.setVertexUniform(n,"u_internal_scale",[1/a,1/o],F.FLOAT),t.setVertexUniform(n,"u_internal_positionWithAccumulation",4===s.numComponents?1:0,F.INT);o=e.pointSize||1;t.setVertexUniform(n,"u_internal_pointSize",o,F.FLOAT);s=s.getDimensions();t.setVertexUniform(n,"u_internal_positionsDimensions",s,F.FLOAT),t.setVertexUniform(n,"u_internal_wrapX",e.wrapX?1:0,F.INT),t.setVertexUniform(n,"u_internal_wrapY",e.wrapY?1:0,F.INT),(void 0===this.pointIndexBuffer||i&&i.length<f)&&(u=y.initSequentialFloatArray(u),this.pointIndexArray=u,this.pointIndexBuffer=this.initVertexBuffer(u)),r.bindBuffer(r.ARRAY_BUFFER,this.pointIndexBuffer),this.setIndexAttribute(n,t.name),this.setBlendMode(e.shouldBlendAlpha),r.drawArrays(r.POINTS,0,f),r.disable(r.BLEND)}},i.prototype.drawLayerAsLines=function(e){var t=this.gl,r=this.errorState,n=this.width,i=this.height,a=e.positions,o=e.output;if(!r){if(2!==a.numComponents&&4!==a.numComponents)throw new Error('WebGLCompute.drawLayerAsLines() must be passed a position DataLayer with either 2 or 4 components, got position DataLayer "'+a.name+'" with '+a.numComponents+" components.");if(e.closeLoop&&e.indices)throw new Error("WebGLCompute.drawLayerAsLines() can't be called with closeLoop == true and indices.");var s=e.program;void 0===s&&(s=e.wrapX||e.wrapY?this.singleColorWithWrapCheckProgram:this.singleColorProgram,l=e.color||[1,0,0],s.setUniform("u_color",l,F.FLOAT));var r=s.dataLayerLinesProgram,l=this.addLayerToInputs(a,e.input);this.drawSetup(r,!1,l,o);var u=e.indices||y.initSequentialFloatArray(e.count||a.getLength()),f=e.count||u.length;s.setVertexUniform(r,"u_internal_positions",l.indexOf(a),F.INT),s.setVertexUniform(r,"u_internal_scale",[1/n,1/i],F.FLOAT),s.setVertexUniform(r,"u_internal_positionWithAccumulation",4===a.numComponents?1:0,F.INT);a=a.getDimensions();if(s.setVertexUniform(r,"u_internal_positionsDimensions",a,F.FLOAT),s.setVertexUniform(r,"u_internal_wrapX",e.wrapX?1:0,F.INT),s.setVertexUniform(r,"u_internal_wrapY",e.wrapY?1:0,F.INT),void 0===this.indexedLinesIndexBuffer){var h=void 0;if(u.constructor!==Float32Array){for(var h=new Float32Array(u.length),p=0;p<f;p++)h[p]=u[p];console.warn("Converting indices array of type "+u.constructor+" to Float32Array in WebGLCompute.drawIndexedLines for WebGL compatibility, you may want to use a Float32Array to store this information so the conversion is not required.")}else h=u;this.indexedLinesIndexBuffer=this.initVertexBuffer(h)}else t.bindBuffer(t.ARRAY_BUFFER,this.indexedLinesIndexBuffer),t.bufferData(t.ARRAY_BUFFER,u,t.STATIC_DRAW);this.setIndexAttribute(r,s.name),this.setBlendMode(e.shouldBlendAlpha),e.indices?t.drawArrays(t.LINES,0,f):e.closeLoop?t.drawArrays(t.LINE_LOOP,0,f):t.drawArrays(t.LINE_STRIP,0,f),t.disable(t.BLEND)}},i.prototype.drawLayerAsVectorField=function(e){var t=this,r=t.gl,n=t.errorState,i=t.vectorFieldIndexArray,a=t.width,o=t.height,s=e.data,l=e.output;if(!n){if(2!==s.numComponents)throw new Error('WebGLCompute.drawLayerAsVectorField() must be passed a fieldLayer with 2 components, got fieldLayer "'+s.name+'" with '+s.numComponents+" components.");t=e.program;void 0===t&&(t=this.singleColorProgram,u=e.color||[1,0,0],t.setUniform("u_color",u,F.FLOAT));var n=t.dataLayerVectorFieldProgram,u=this.addLayerToInputs(s,e.input);this.drawSetup(n,!1,u,l),t.setVertexUniform(n,"u_internal_vectors",u.indexOf(s),F.INT);s=e.vectorScale||1;t.setVertexUniform(n,"u_internal_scale",[s/a,s/o],F.FLOAT);s=e.vectorSpacing||10,s=[Math.floor(a/s),Math.floor(o/s)];t.setVertexUniform(n,"u_internal_dimensions",s,F.FLOAT);s=2*s[0]*s[1];(void 0===this.vectorFieldIndexBuffer||i&&i.length<s)&&(i=y.initSequentialFloatArray(s),this.vectorFieldIndexArray=i,this.vectorFieldIndexBuffer=this.initVertexBuffer(i)),r.bindBuffer(r.ARRAY_BUFFER,this.vectorFieldIndexBuffer),this.setIndexAttribute(n,t.name),this.setBlendMode(e.shouldBlendAlpha),r.drawArrays(r.LINES,0,s),r.disable(r.BLEND)}},i.prototype.drawLayerMagnitude=function(e){var t,r,n=this.gl,i=this.errorState,a=this.quadPositionsBuffer,o=e.data,s=e.output;i||(t=this.vectorMagnitudeProgram,r=e.color||[1,0,0],t.setUniform("u_color",r,F.FLOAT),i=e.scale||1,t.setUniform("u_scale",i,F.FLOAT),t.setUniform("u_internal_numDimensions",o.numComponents,F.INT),r=t.defaultProgram,i=this.addLayerToInputs(o,e.input),this.drawSetup(r,!0,i,s),t.setVertexUniform(r,"u_internal_data",i.indexOf(o),F.INT),t.setVertexUniform(r,"u_internal_scale",[1,1],F.FLOAT),t.setVertexUniform(r,"u_internal_translation",[0,0],F.FLOAT),n.bindBuffer(n.ARRAY_BUFFER,a),this.setPositionAttribute(r,t.name),this.setBlendMode(e.shouldBlendAlpha),n.drawArrays(n.TRIANGLE_STRIP,0,4),n.disable(n.BLEND))},i.prototype.getContext=function(){return this.gl},i.prototype.getValues=function(e){var t=this.gl,r=this.glslVersion;e._bindOutputBuffer();var n,i=e.getDimensions(),a=i[0],o=i[1],s=e.glNumChannels,l=e.glType,u=e.glFormat,f=e.internalType;switch(f){case F.HALF_FLOAT:n=void 0!==t.FLOAT?(s=4,u=t.RGBA,l=t.FLOAT,new Float32Array(a*o*s)):new Uint16Array(a*o*s);break;case F.FLOAT:s=4,u=t.RGBA,n=new Float32Array(a*o*s);break;case F.UNSIGNED_BYTE:if(r===F.GLSL1){s=4,u=t.RGBA,n=new Uint8Array(a*o*s);break}s=4,u=t.RGBA_INTEGER,l=t.UNSIGNED_INT,n=new Uint32Array(a*o*s);break;case F.UNSIGNED_SHORT:s=4,u=t.RGBA_INTEGER,l=t.UNSIGNED_INT,n=new Uint32Array(a*o*s);break;case F.UNSIGNED_INT:s=4,u=t.RGBA_INTEGER,n=new Uint32Array(a*o*s);break;case F.BYTE:case F.SHORT:s=4,u=t.RGBA_INTEGER,l=t.INT,n=new Int32Array(a*o*s);break;case F.INT:s=4,u=t.RGBA_INTEGER,n=new Int32Array(a*o*s);break;default:throw new Error("Unsupported internalType "+f+" for getValues().")}if(this.readyToRead()){t.readPixels(0,0,a,o,u,l,n);var h=e.numComponents,p=e.type,c=a*o*h,d=f===F.HALF_FLOAT&&n.constructor===Uint16Array,g=d?new DataView(n.buffer):void 0,_=n;if(f!==p)switch(p){case F.HALF_FLOAT:case F.FLOAT:_=new Float32Array(c);break;case F.UNSIGNED_BYTE:_=new Uint8Array(c);break;case F.BYTE:_=new Int8Array(c);break;case F.UNSIGNED_SHORT:_=new Uint16Array(c);break;case F.SHORT:_=new Int16Array(c);break;case F.UNSIGNED_INT:_=new Uint32Array(c);break;case F.INT:_=new Int32Array(c);break;default:throw new Error("Unsupported type "+p+" for getValues().")}if(d||_!==n||h!==s)for(var m=0,y=a*o;m<y;m++)for(var v=m*s,T=m*h,b=0;b<h;b++)_[T+b]=d?E.getFloat16(g,2*(v+b),!0):n[v+b];return _=_.length!==c?_.slice(0,c):_}throw new Error("Unable to read values from Buffer with status: "+t.checkFramebufferStatus(t.FRAMEBUFFER)+".")},i.prototype.readyToRead=function(){var e=this.gl;return e.checkFramebufferStatus(e.FRAMEBUFFER)==e.FRAMEBUFFER_COMPLETE},i.prototype.savePNG=function(e,t,r){void 0===t&&(t=e.name);var n=this.getValues(e),i=e.getDimensions(),a=i[0],o=i[1],s=document.createElement("canvas");s.width=a,s.height=o;for(var l=s.getContext("2d"),i=l.getImageData(0,0,a,o),u=i.data,f=e.type===F.FLOAT||e.type===F.HALF_FLOAT,h=0;h<o;h++)for(var p=0;p<a;p++){for(var c=h*a+p,d=(o-1-h)*a+p,g=0;g<e.numComponents;g++)u[4*d+g]=n[e.numComponents*c+g]*(f?255:1);e.numComponents<4&&(u[4*d+3]=255)}l.putImageData(i,0,0),s.toBlob(function(e){e?r?m.changeDpiBlob(e,r).then(function(e){_.saveAs(e,t+".png")}):_.saveAs(e,t+".png"):console.warn("Problem saving PNG, unable to init blob.")},"image/png")},i.prototype.reset=function(){throw new Error("WebGLCompute.reset() not implemented.")},i.prototype.attachDataLayerToThreeTexture=function(e,t){if(!this.renderer)throw new Error("WebGLCompute was not inited with a renderer.");if(1<e.numBuffers)throw new Error('DataLayer "'+e.name+'" contains multiple WebGL textures (one for each buffer) that are flip-flopped during compute cycles, please choose a DataLayer with one buffer.');t=this.renderer.properties.get(t);t.__webglTexture=e.getCurrentStateTexture(),t.__webglInit=!0},i.prototype.resetThreeState=function(){if(!this.renderer)throw new Error("WebGLCompute was not inited with a renderer.");var e=this.gl,t=this.renderer.getViewport(new r.Vector4);e.viewport(t.x,t.y,t.width,t.height),this.renderer.setRenderTarget(null),this.renderer.resetState()},i.prototype.destroy=function(){delete this.renderer},i);function i(e,t,r){void 0===t&&(t=function(e){throw new Error(e)}),this.errorState=!1,this._circlePositionsBuffer={};var n=["canvas","context","antialias","glslVersion"];Object.keys(e).forEach(function(e){if(n.indexOf(e)<0)throw new Error("Invalid key "+e+" passed to WebGLCompute.constructor.  Valid keys are "+n.join(", ")+".")});var i=this;this.errorCallback=function(e){i.errorState||(i.errorState=!0,t(e))};var a=e.canvas,o=e.context;if(!o){var s={};if(void 0!==e.antialias&&(s.antialias=e.antialias),null===(o=a.getContext("webgl2",s)||a.getContext("webgl",s)||a.getContext("experimental-webgl",s)))return void this.errorCallback("Unable to initialize WebGL context.")}y.isWebGL2(o)?console.log("Using WebGL 2.0 context."):console.log("Using WebGL 1.0 context."),this.gl=o,this.renderer=r;e=void 0===e.glslVersion?F.GLSL1:e.glslVersion;this.glslVersion=e,y.isWebGL2(o)||e!==F.GLSL3||console.warn("GLSL3.x is incompatible with WebGL1.0 contexts."),o.disable(o.DEPTH_TEST),o.pixelStorei(o.UNPACK_ALIGNMENT,1),this.copyFloatProgram=this.initProgram({name:"copyFloat",fragmentShader:e===F.GLSL3?l(518):l(541),uniforms:[{name:"u_state",value:0,dataType:F.INT}]}),e===F.GLSL3?(this.copyIntProgram=this.initProgram({name:"copyInt",fragmentShader:l(546),uniforms:[{name:"u_state",value:0,dataType:F.INT}]}),this.copyUintProgram=this.initProgram({name:"copyUint",fragmentShader:l(374),uniforms:[{name:"u_state",value:0,dataType:F.INT}]})):(this.copyIntProgram=this.copyFloatProgram,this.copyUintProgram=this.copyFloatProgram),o.bindBuffer(o.ARRAY_BUFFER,null),this.onResize(a),this.maxNumTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),console.log(this.maxNumTextures+" textures max.")}t.WebGLCompute=n},581:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getExtension=t.EXT_COLOR_BUFFER_FLOAT=t.WEBGL_DEPTH_TEXTURE=t.OES_TEXTURE_HAlF_FLOAT_LINEAR=t.OES_TEXTURE_FLOAT_LINEAR=t.OES_TEXTURE_HALF_FLOAT=t.OES_TEXTURE_FLOAT=void 0;var a={};t.OES_TEXTURE_FLOAT="OES_texture_float",t.OES_TEXTURE_HALF_FLOAT="OES_texture_half_float",t.OES_TEXTURE_FLOAT_LINEAR="OES_texture_float_linear",t.OES_TEXTURE_HAlF_FLOAT_LINEAR="OES_texture_half_float_linear",t.WEBGL_DEPTH_TEXTURE="WEBGL_depth_texture",t.EXT_COLOR_BUFFER_FLOAT="EXT_color_buffer_float",t.getExtension=function(e,t,r,n){if(void 0===n&&(n=!1),void 0!==a[t])return a[t];var i;try{i=e.getExtension(t)}catch(e){}return i?(a[t]=i,console.log("Loaded extension: "+t+".")):(a[t]=!1,console.warn("Unsupported "+(n?"optional ":"")+"extension: "+t+".")),i||n||r("Required extension unsupported by this device / browser: "+t+"."),i}},607:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.WebGLCompute=void 0;var a=r(215);Object.defineProperty(t,"WebGLCompute",{enumerable:!0,get:function(){return a.WebGLCompute}}),i(r(738),t)},593:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initSequentialFloatArray=t.isPowerOf2=t.isWebGL2=t.compileShader=void 0,t.compileShader=function(e,t,r,n,i){var a=e.createShader(n);return a?(e.shaderSource(a,r),e.compileShader(a),e.getShaderParameter(a,e.COMPILE_STATUS)?a:(t("Could not compile "+(n===e.FRAGMENT_SHADER?"fragment":"vertex")+"\n\t\t\t shader"+(i?' for program "'+i+'"':"")+": "+e.getShaderInfoLog(a)+"."),null)):(t("Unable to init gl shader."),null)},t.isWebGL2=function(e){return"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext},t.isPowerOf2=function(e){return 0==(e&e-1)},t.initSequentialFloatArray=function(e){for(var t=new Float32Array(e),r=0;r<e;r++)t[r]=r;return t}},541:e=>{e.exports="precision highp float;\n\nvarying vec2 v_UV;\n\nuniform sampler2D u_state;\n\nvoid main() {\n\tgl_FragColor = texture2D(u_state, v_UV);\n}"},328:e=>{e.exports="precision highp float;\nprecision highp int;\n\n/**\n * Returns accurate MOD when arguments are approximate integers.\n */\nfloat modI(float a, float b) {\n    float m = a - floor((a + 0.5) / b) * b;\n    return floor(m + 0.5);\n}\n\n// Cannot use int vertex attributes: https://stackoverflow.com/questions/27874983/webgl-how-to-use-integer-attributes-in-glsl\nattribute float a_internal_index; // Index of point.\n\nuniform sampler2D u_internal_positions; // Texture lookup with position data.\nuniform vec2 u_internal_positionsDimensions;\nuniform vec2 u_internal_scale;\nuniform bool u_internal_positionWithAccumulation;\nuniform bool u_internal_wrapX;\nuniform bool u_internal_wrapY;\n\nvarying vec2 v_UV;\nvarying vec2 v_lineWrapping; // Use this to test if line is only half wrapped and should not be rendered.\nvarying float v_index;\n\nvoid main() {\n\t// Calculate a uv based on the point's index attribute.\n\tvec2 particleUV = vec2(\n\t\tmodI(a_internal_index, u_internal_positionsDimensions.x),\n\t\tfloor(floor(a_internal_index + 0.5) / u_internal_positionsDimensions.x)\n\t) / u_internal_positionsDimensions;\n\n\t// Calculate a global uv for the viewport.\n\t// Lookup vertex position and scale to [0, 1] range.\n\t// We have packed a 2D displacement with the position.\n\tvec4 positionData = texture2D(u_internal_positions, particleUV);\n\t// position = first two components plus last two components (optional accumulation buffer).\n\tvec2 positionAbsolute = positionData.rg;\n\tif (u_internal_positionWithAccumulation) positionAbsolute += positionData.ba;\n\tv_UV = positionAbsolute * u_internal_scale;\n\n\t// Wrap if needed.\n\tv_lineWrapping = vec2(0.0);\n\tif (u_internal_wrapX) {\n\t\tif (v_UV.x < 0.0) {\n\t\t\tv_UV.x += 1.0;\n\t\t\tv_lineWrapping.x = 1.0;\n\t\t} else if (v_UV.x > 1.0) {\n\t\t\tv_UV.x -= 1.0;\n\t\t\tv_lineWrapping.x = 1.0;\n\t\t}\n\t}\n\tif (u_internal_wrapY) {\n\t\tif (v_UV.y < 0.0) {\n\t\t\tv_UV.y += 1.0;\n\t\t\tv_lineWrapping.y = 1.0;\n\t\t} else if (v_UV.y > 1.0) {\n\t\t\tv_UV.y -= 1.0;\n\t\t\tv_lineWrapping.y = 1.0;\n\t\t}\n\t}\n\n\t// Calculate position in [-1, 1] range.\n\tvec2 position = v_UV * 2.0 - 1.0;\n\n\tv_index = a_internal_index;\n\tgl_Position = vec4(position, 0, 1);\n}"},87:e=>{e.exports="precision highp float;\nprecision highp int;\n\n/**\n * Returns accurate MOD when arguments are approximate integers.\n */\nfloat modI(float a, float b) {\n    float m = a - floor((a + 0.5) / b) * b;\n    return floor(m + 0.5);\n}\n\n// Cannot use int vertex attributes: https://stackoverflow.com/questions/27874983/webgl-how-to-use-integer-attributes-in-glsl\nattribute float a_internal_index; // Index of point.\n\nuniform sampler2D u_internal_positions; // Texture lookup with position data.\nuniform vec2 u_internal_positionsDimensions;\nuniform vec2 u_internal_scale;\nuniform float u_internal_pointSize;\nuniform bool u_internal_positionWithAccumulation;\nuniform bool u_internal_wrapX;\nuniform bool u_internal_wrapY;\n\nvarying vec2 v_UV;\nvarying float v_index;\n\nvoid main() {\n\t// Calculate a uv based on the point's index attribute.\n\tvec2 particleUV = vec2(\n\t\tmodI(a_internal_index, u_internal_positionsDimensions.x),\n\t\tfloor(floor(a_internal_index + 0.5) / u_internal_positionsDimensions.x)\n\t) / u_internal_positionsDimensions;\n\n\t// Calculate a global uv for the viewport.\n\t// Lookup vertex position and scale to [0, 1] range.\n\t// We have packed a 2D displacement with the position.\n\tvec4 positionData = texture2D(u_internal_positions, particleUV);\n\t// position = first two components plus last two components (optional accumulation buffer).\n\tvec2 positionAbsolute = positionData.rg;\n\tif (u_internal_positionWithAccumulation) positionAbsolute += positionData.ba;\n\tv_UV = positionAbsolute * u_internal_scale;\n\n\t// Wrap if needed.\n\tif (u_internal_wrapX) {\n\t\tif (v_UV.x < 0.0) v_UV.x += 1.0;\n\t\tif (v_UV.x > 1.0) v_UV.x -= 1.0;\n\t}\n\tif (u_internal_wrapY) {\n\t\tif (v_UV.y < 0.0) v_UV.y += 1.0;\n\t\tif (v_UV.y > 1.0) v_UV.y -= 1.0;\n\t}\n\n\t// Calculate position in [-1, 1] range.\n\tvec2 position = v_UV * 2.0 - 1.0;\n\n\tv_index = a_internal_index;\n\tgl_PointSize = u_internal_pointSize;\n\tgl_Position = vec4(position, 0, 1);\n}"},444:e=>{e.exports="precision highp float;\nprecision highp int;\n\n/**\n * Returns accurate MOD when arguments are approximate integers.\n */\nfloat modI(float a, float b) {\n    float m = a - floor((a + 0.5) / b) * b;\n    return floor(m + 0.5);\n}\n\n// Cannot use int vertex attributes: https://stackoverflow.com/questions/27874983/webgl-how-to-use-integer-attributes-in-glsl\nattribute float a_internal_index; // Index of point.\n\nuniform sampler2D u_internal_vectors; // Texture lookup with vector data.\nuniform vec2 u_internal_dimensions;\nuniform vec2 u_internal_scale;\n\nvarying vec2 v_UV;\nvarying float v_index;\n\nvoid main() {\n\t// Divide index by 2.\n\tfloat index = floor((a_internal_index + 0.5) / 2.0);\n\t// Calculate a uv based on the vertex index attribute.\n\tv_UV = vec2(\n\t\tmodI(index, u_internal_dimensions.x),\n\t\tfloor(floor(index + 0.5) / u_internal_dimensions.x)\n\t) / u_internal_dimensions;\n\n\t// Add vector displacement if needed.\n\tif (modI(a_internal_index, 2.0) > 0.0) {\n\t\t// Lookup vectorData at current UV.\n\t\tvec2 vectorData = texture2D(u_internal_vectors, v_UV).xy;\n\t\tv_UV += vectorData * u_internal_scale;\n\t}\n\n\t// Calculate position in [-1, 1] range.\n\tvec2 position = v_UV * 2.0 - 1.0;\n\n\tv_index = a_internal_index;\n\tgl_Position = vec4(position, 0, 1);\n}"},790:e=>{e.exports="precision highp float;\n\nattribute vec2 a_internal_position;\n#ifdef UV_ATTRIBUTE\nattribute vec2 a_internal_uv;\n#endif\n#ifdef NORMAL_ATTRIBUTE\nattribute vec2 a_internal_normal;\n#endif\n\nuniform vec2 u_internal_scale;\nuniform vec2 u_internal_translation;\n\nvarying vec2 v_UV;\nvarying vec2 v_UV_local;\n#ifdef NORMAL_ATTRIBUTE\nvarying vec2 v_normal;\n#endif\n\nvoid main() {\n\t// Optional varyings.\n\t#ifdef UV_ATTRIBUTE\n\tv_UV_local = a_internal_uv;\n\t#else\n\tv_UV_local = a_internal_position;\n\t#endif\n\t#ifdef NORMAL_ATTRIBUTE\n\tv_normal = a_internal_normal;\n\t#endif\n\n\t// Apply transformations.\n\tvec2 position = u_internal_scale * a_internal_position + u_internal_translation;\n\n\t// Calculate a global uv for the viewport.\n\tv_UV = 0.5 * (position + 1.0);\n\n\t// Calculate vertex position.\n\tgl_Position = vec4(position, 0, 1);\n}"},852:e=>{e.exports="// Vertex shader for fullscreen quad.\nprecision highp float;\n\nattribute vec2 a_internal_position;\n\nuniform float u_internal_halfThickness;\nuniform vec2 u_internal_scale;\nuniform float u_internal_length;\nuniform float u_internal_rotation;\nuniform vec2 u_internal_translation;\n\nvarying vec2 v_UV_local;\nvarying vec2 v_UV;\n\nmat2 rotate2d(float _angle){\n\treturn mat2(cos(_angle), -sin(_angle), sin(_angle), cos(_angle));\n}\n\nvoid main() {\n\t// Calculate UV coordinates of current rendered object.\n\tv_UV_local = 0.5 * (a_internal_position + 1.0);\n\n\tvec2 position = a_internal_position;\n\n\t// Apply thickness / radius.\n\tposition *= u_internal_halfThickness;\n\n\t// Stretch center of shape to form a round-capped line segment.\n\tif (position.x < 0.0) {\n\t\tposition.x -= u_internal_length / 2.0;\n\t\tv_UV_local.x = 0.0; // Set entire cap UV.x to 0.\n\t} else if (position.x > 0.0) {\n\t\tposition.x += u_internal_length / 2.0;\n\t\tv_UV_local.x = 1.0; // Set entire cap UV.x to 1.\n\t}\n\n\t// Apply transformations.\n\tposition = u_internal_scale * (rotate2d(-u_internal_rotation) * position) + u_internal_translation;\n\n\t// Calculate a global uv for the viewport.\n\tv_UV = 0.5 * (position + 1.0);\n\n\t// Calculate vertex position.\n\tgl_Position = vec4(position, 0, 1);\n}"},971:e=>{e.exports="// Fragment shader that draws a single color.\nprecision highp float;\n\nuniform vec3 u_color;\n\nvoid main() {\n\tgl_FragColor = vec4(u_color, 1);\n}"},425:e=>{e.exports="// Fragment shader that draws a single color.\nprecision highp float;\n\nuniform vec3 u_color;\nvarying vec2 v_lineWrapping;\n\nvoid main() {\n\t// Check if this line has wrapped.\n\tif ((v_lineWrapping.x != 0.0 && v_lineWrapping.x != 1.0) || (v_lineWrapping.y != 0.0 && v_lineWrapping.y != 1.0)) {\n\t\t// Render nothing.\n\t\tdiscard;\n\t\treturn;\n\t}\n\tgl_FragColor = vec4(u_color, 1);\n}"},754:e=>{e.exports="// Fragment shader that draws the magnitude of a DataLayer.\nprecision highp float;\n\nvarying vec2 v_UV;\n\nuniform vec3 u_color;\nuniform float u_scale;\nuniform int u_internal_numDimensions;\nuniform sampler2D u_internal_data;\n\nvoid main() {\n\tvec4 value = texture2D(u_internal_data, v_UV);\n\tif (u_internal_numDimensions < 4) value.a = 0.0;\n\tif (u_internal_numDimensions < 3) value.b = 0.0;\n\tif (u_internal_numDimensions < 2) value.g = 0.0;\n\tfloat mag = length(value);\n\tgl_FragColor = vec4(mag * u_scale * u_color, 1);\n}"},518:e=>{e.exports="#version 300 es\nprecision highp float;\nprecision highp sampler2D;\n\nin vec2 v_UV;\n\nuniform sampler2D u_state;\n\nout vec4 out_fragColor;\n\nvoid main() {\n\tout_fragColor = texture(u_state, v_UV);\n}"},546:e=>{e.exports="#version 300 es\nprecision highp float;\nprecision highp int;\nprecision highp isampler2D;\n\nin vec2 v_UV;\n\nuniform isampler2D u_state;\n\nout ivec4 out_fragColor;\n\nvoid main() {\n\tout_fragColor = texture(u_state, v_UV);\n}"},374:e=>{e.exports="#version 300 es\nprecision highp float;\nprecision highp int;\nprecision highp usampler2D;\n\nin vec2 v_UV;\n\nuniform usampler2D u_state;\n\nout uvec4 out_fragColor;\n\nvoid main() {\n\tout_fragColor = texture(u_state, v_UV);\n}"},805:e=>{e.exports="// Fragment shader that draws a single color.\nprecision highp float;\n\nuniform vec3 u_color;\n\nvoid main() {\n\tgl_FragColor = vec4(u_color, 1);\n}"},674:e=>{e.exports="// Fragment shader that draws a single color.\nprecision highp float;\n\nuniform vec3 u_color;\nvarying vec2 v_lineWrapping;\n\nvoid main() {\n\t// check if this line has wrapped.\n\tif ((v_lineWrapping.x != 0.0 && v_lineWrapping.x != 1.0) || (v_lineWrapping.y != 0.0 && v_lineWrapping.y != 1.0)) {\n\t\t// Render nothing.\n\t\tdiscard;\n\t\treturn;\n\t}\n\tgl_FragColor = vec4(u_color, 1);\n}"},850:e=>{e.exports="// Fragment shader that draws the magnitude of a DataLayer.\nprecision highp float;\n\nvarying vec2 v_UV;\n\nuniform vec3 u_color;\nuniform float u_scale;\nuniform sampler2D u_internal_data;\n\nvoid main() {\n\tvec4 value = texture2D(u_internal_data, v_UV);\n\tfloat mag = length(value);\n\tgl_FragColor = vec4(mag * u_scale * u_color, 1);\n}"}},i={},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n(607);function n(e){var t=i[e];if(void 0!==t)return t.exports;t=i[e]={id:e,loaded:!1,exports:{}};return r[e].call(t.exports,t,t.exports,n),t.loaded=!0,t.exports}var r,i});
//# sourceMappingURL=webgl-compute.min.js.map